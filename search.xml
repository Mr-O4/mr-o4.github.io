<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Golang [nil] 选项设计模式</title>
      <link href="posts/f0e2800f"/>
      <url>posts/f0e2800f</url>
      
        <content type="html"><![CDATA[<p>用函数式编程的方法解决多成员结构体的初始化问题</p><span id="more"></span><h1 id="选项设计模式"><a href="#选项设计模式" class="headerlink" title="选项设计模式"></a>选项设计模式</h1><p>在编写程序时，经常会遇到这样一类场景：</p><p>定义一个包内可见的结构体，对外提供一个 <code>NewSTRUCT()</code> 方法来创建。 而创建时要求使用者给出结构体变量的值作为参数。当结构体变量很多的时候，会写出一堆很丑很可怕的代码。例如：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> student <span class="keyword">struct</span> &#123;</span><br><span class="line">    name   <span class="keyword">string</span><span class="comment">// *必填</span></span><br><span class="line">    age    <span class="keyword">int</span><span class="comment">// *必填</span></span><br><span class="line">    height <span class="keyword">int</span><span class="comment">// 选填</span></span><br><span class="line">    weight <span class="keyword">int</span><span class="comment">// 选填 </span></span><br><span class="line">    score  <span class="keyword">float32</span><span class="comment">// 选填</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewStudent</span> <span class="params">(name <span class="keyword">string</span>, age <span class="keyword">int</span>)</span> *<span class="title">student</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;student&#123;name: name, age: age&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewStudentWithHight</span> <span class="params">(name <span class="keyword">string</span>, age, height <span class="keyword">int</span>)</span> *<span class="title">student</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;student&#123;name: name, age: age, height: height&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewStudentWithWeight</span> <span class="params">(name <span class="keyword">string</span>, age, weight <span class="keyword">int</span>)</span> *<span class="title">student</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;student&#123;name: name, age: age, weight: weight&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewStudentWithScore</span> <span class="params">(name <span class="keyword">string</span>, age <span class="keyword">int</span>, score <span class="keyword">float32</span>)</span> *<span class="title">student</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;student&#123;name: name, age: age, score: score&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewStudentWithHightAndWeight</span><span class="params">(name <span class="keyword">string</span>, age, height, weight <span class="keyword">int</span>)</span> *<span class="title">student</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;student&#123;name: name, age: age, height: height, weight: weight&#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>这样的代码真的… 又臭又长。</p><p>因为 Golang 不支持函数重载，所以你不得不使用不同的函数名来对应不同的配置选项。</p><p>解决方法有两种：<code>Builder 模式</code> 和 <code>Function Option 模式</code></p><h2 id="Builder-模式"><a href="#Builder-模式" class="headerlink" title="Builder 模式"></a>Builder 模式</h2><p>Builder 模式又称生成器模式，通过为目标结构体多创建一个 <strong>Builder 结构体</strong> 来负责创建 student 这件事，一般以<code>目标结构体的名称 + Builder</code> 命名。</p><p>使用 Builder 模式的步骤如下：</p><ol><li>  定义一个 Builder 结构体，并在结构体中携带一个目标结构体的指针</li><li>  并在构造 Builder 的函数里要求一些 <em>必填</em> 的参数，然后返回一个 Builder 对象</li><li>  逐一为目标结构体的 <em>选填</em> 参数定义属于 Builder 结构体的方法，注意这些方法的返回值只能是 Builder结构体，这样才可以链式调用</li><li>  最后编写 Builder 结构体的 <code>Build()</code> 方法，返回目标结构体</li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 目标结构体：student</span></span><br><span class="line"><span class="keyword">type</span> student <span class="keyword">struct</span> &#123;</span><br><span class="line">    name   <span class="keyword">string</span><span class="comment">// *必填</span></span><br><span class="line">    age    <span class="keyword">int</span><span class="comment">// *必填</span></span><br><span class="line">    height <span class="keyword">int</span><span class="comment">// 选填</span></span><br><span class="line">    weight <span class="keyword">int</span><span class="comment">// 选填 </span></span><br><span class="line">    score  <span class="keyword">float32</span><span class="comment">// 选填</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 目标结构体的 builder：studentBuilder</span></span><br><span class="line"><span class="keyword">type</span> studentBuilder <span class="keyword">struct</span> &#123;</span><br><span class="line">    stu *student<span class="comment">// 携带一个目标结构体 student 的指针</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 学生 builder 的创建方法，要求输入必填项</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewStudentBuilder</span> <span class="params">(name <span class="keyword">string</span>, age <span class="keyword">int</span>)</span> *<span class="title">studentBuilder</span></span>&#123;</span><br><span class="line">    s := student&#123;name: name, age: age&#125;</span><br><span class="line">    <span class="keyword">return</span> &amp;studentBuilder&#123;stu: &amp;s&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 其他选填项，重点在于这是 builder 的方法，返回值是 builder 自己，这样才可以链式调用</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *studentBuilder)</span> <span class="title">Height</span> <span class="params">(h <span class="keyword">int</span>)</span> *<span class="title">studentBuilder</span></span> &#123;</span><br><span class="line">    b.stu.height = h</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *studentBuilder)</span> <span class="title">Weight</span> <span class="params">(w <span class="keyword">int</span>)</span> *<span class="title">studentBuilder</span></span> &#123;</span><br><span class="line">    b.stu.weight = w</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *studentBuilder)</span> <span class="title">Score</span> <span class="params">(s <span class="keyword">float32</span>)</span> *<span class="title">studentBuilder</span></span> &#123;</span><br><span class="line">    b.stu.score = s</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 最重要的一步：通过 Build 方法把 student 结构体返回出去</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *studentBuilder)</span> <span class="title">Build</span> <span class="params">()</span> *<span class="title">student</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> b.stu</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把 student 的构建函数也代理过来，这一步可选可不选</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewStudent</span><span class="params">(name <span class="keyword">string</span>, age <span class="keyword">int</span>)</span> *<span class="title">studentBuilder</span></span> &#123;</span><br><span class="line">    s := student&#123;name: name, age: age&#125;</span><br><span class="line">    <span class="keyword">return</span> &amp;studentBuilder&#123;stu: &amp;s&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样在创建 student 的时候可以这样调用：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s1 := NewStudentBuilder(<span class="string">&quot;Boii&quot;</span>, <span class="number">18</span>).Height(<span class="number">180</span>).Weight(<span class="number">150</span>).Score(<span class="number">100.0</span>).Build()</span><br><span class="line">    <span class="comment">// 或者</span></span><br><span class="line">    s2 := NewStudent(<span class="string">&quot;Boii&quot;</span>, <span class="number">18</span>).Height(<span class="number">180</span>).Weight(<span class="number">150</span>).Score(<span class="number">100.0</span>).Build()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>简洁清晰！</p><h2 id="Function-Option-模式"><a href="#Function-Option-模式" class="headerlink" title="Function Option 模式"></a>Function Option 模式</h2><p>上面的 Builder 模式其实是设计模式中的一种创建型模式，在 Java 中可以使用内部类把 Builder 嵌在目标类中，但是在 Golang 就得多搞出一个结构体。但是使用 Function Option 模式则不需要多余的结构体，还可以发挥函数式编程的优点。</p><p>使用 Function Option 模式的步骤如下：</p><ol><li>  自定义一个 Option 类型，以一个函数为基础，该函数接收一个目标结构体指针为参数</li><li>  逐一为目标结构体的每一个变量定义一个选项函数，接收变量的值，返回 Option 类型；在返回的 Option 中将变量的值赋给目标结构体</li><li>定义目标结构体的构造函数，在构造函数中：<ul><li>  参数：将 <em>必填</em> 选项作为普通参数，外加 Option 类型的可变参数</li><li>  返回值：目标结构体</li><li>  函数体：构造目标结构体对象，遍历可变参数并执行，最后返回目标结构体对象</li></ul></li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 目标结构体：student</span></span><br><span class="line"><span class="keyword">type</span> student <span class="keyword">struct</span> &#123;</span><br><span class="line">    name   <span class="keyword">string</span> <span class="comment">// *必填</span></span><br><span class="line">    age    <span class="keyword">int</span> <span class="comment">// *必填</span></span><br><span class="line">    height <span class="keyword">int</span> <span class="comment">// 选填</span></span><br><span class="line">    weight <span class="keyword">int</span> <span class="comment">// 选填 </span></span><br><span class="line">    score  <span class="keyword">float32</span><span class="comment">// 选填</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义一个 Option 类型，以一个函数为基础，函数结构一个目标结构体 student 指针作为参数</span></span><br><span class="line"><span class="keyword">type</span> Option <span class="function"><span class="keyword">func</span><span class="params">(s *student)</span></span> </span><br><span class="line"></span><br><span class="line"><span class="comment">// 逐一为目标结构体的每一个变量定义一个选项函数，结构变量的值 n ，返回 Option 类型</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Name</span><span class="params">(n <span class="keyword">string</span>)</span> <span class="title">Option</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(s *student)</span></span> &#123;<span class="comment">// 在返回的 Option 中将变量赋值</span></span><br><span class="line">        s.name = n</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Age</span><span class="params">(a <span class="keyword">int</span>)</span> <span class="title">Option</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(s *student)</span></span> &#123;</span><br><span class="line">        s.age = a</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Height</span><span class="params">(h <span class="keyword">int</span>)</span> <span class="title">Option</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(s *student)</span></span> &#123;</span><br><span class="line">        s.height =h</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Weight</span><span class="params">(w <span class="keyword">int</span>)</span> <span class="title">Option</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(s *student)</span></span> &#123;</span><br><span class="line">        s.weight = w</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Score</span><span class="params">(sc <span class="keyword">float32</span>)</span> <span class="title">Option</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(s *student)</span></span> &#123;</span><br><span class="line">        s.score = sc</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义目标结构体的构造函数</span></span><br><span class="line"><span class="comment">// 必填选项作为普通参数，Option 作为可变参数</span></span><br><span class="line"><span class="comment">// 返回目标结构体对象</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewStudent</span><span class="params">(name <span class="keyword">string</span>, age <span class="keyword">int</span>, options ... Option)</span> *<span class="title">student</span></span> &#123;</span><br><span class="line">    s := student&#123;<span class="comment">// 构造一个目标结构体对象 </span></span><br><span class="line">        name:   name,</span><br><span class="line">        age:    age,</span><br><span class="line">        height: <span class="number">180</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> _, option := <span class="keyword">range</span> options &#123;<span class="comment">// 遍历 options 得到传进来的一堆选项函数</span></span><br><span class="line">        option(&amp;s)<span class="comment">// 执行这些选项函数</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &amp;s<span class="comment">// 返回目标结构体对象</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样我们就可以像这样创建目标结构体：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s1 := NewStudent(<span class="string">&quot;Boii&quot;</span>, <span class="number">18</span>, Height(<span class="number">177</span>), Weight(<span class="number">150</span>), Score(<span class="number">100.00</span>))</span><br><span class="line">    s2 := NewStudent(<span class="string">&quot;Boii&quot;</span>, <span class="number">18</span>, Height(<span class="number">177</span>), Weight(<span class="number">150</span>))</span><br><span class="line">    s3 := NewStudent(<span class="string">&quot;Boii&quot;</span>, <span class="number">18</span>, Score(<span class="number">100.00</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>最推荐的还是 Function Option 模式，直接使用函数式编程，代码读起来也优雅。</p><p>它能带来一下好处（摘自<a href="https://coolshell.cn/articles/21146.html#%E9%85%8D%E7%BD%AE%E5%AF%B9%E8%B1%A1%E6%96%B9%E6%A1%88">左耳朵耗子叔</a>）：</p><ul><li>  直觉式的编程</li><li>  高度的可配置化</li><li>  很容易维护和扩展</li><li>  自文档</li><li>  对于新来的人很容易上手</li><li>  没有什么令人困惑的事（是nil 还是空）</li></ul>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
          <category> nil </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 函数式编程 </tag>
            
            <tag> Golang </tag>
            
            <tag> 选项设计模式 </tag>
            
            <tag> Function Option </tag>
            
            <tag> 生成器模式 </tag>
            
            <tag> Builder 模式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Golang [nil] 交叉编译</title>
      <link href="posts/c8f1d592"/>
      <url>posts/c8f1d592</url>
      
        <content type="html"><![CDATA[<p>编译多平台程序的必备技能</p><span id="more"></span><h2 id="交叉编译"><a href="#交叉编译" class="headerlink" title="交叉编译"></a>交叉编译</h2><p>Golang 支持交叉编译，可以在一个平台上生成另一个平台的可执行程序。</p><p>Mac 下编译 Linux 和 Windows 64位可执行程序</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build main.go</span><br><span class="line">CGO_ENABLED=0 GOOS=windows GOARCH=amd64 go build main.go12</span><br></pre></td></tr></table></figure><p>Linux 下编译 Mac 和 Windows 64位可执行程序</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CGO_ENABLED=0 GOOS=darwin GOARCH=amd64 go build main.go</span><br><span class="line">CGO_ENABLED=0 GOOS=windows GOARCH=amd64 go build main.go12</span><br></pre></td></tr></table></figure><p>Windows 下编译 Mac 和 Linux 64位可执行程序</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">SET</span> CGO_ENABLED=<span class="number">0</span></span><br><span class="line"><span class="built_in">SET</span> GOOS=darwin</span><br><span class="line"><span class="built_in">SET</span> GOARCH=amd64</span><br><span class="line">go build main.go</span><br><span class="line"></span><br><span class="line"><span class="built_in">SET</span> CGO_ENABLED=<span class="number">0</span></span><br><span class="line"><span class="built_in">SET</span> GOOS=linux</span><br><span class="line"><span class="built_in">SET</span> GOARCH=amd64</span><br><span class="line">go build main.go</span><br></pre></td></tr></table></figure><p>上面的命令编译 64 位可执行程序，也可以使用 386 编译 32 位可执行程序。</p><h2 id="条件编译"><a href="#条件编译" class="headerlink" title="条件编译"></a>条件编译</h2><p>Golang 虽然能跨平台编译但是也无法完全解决平台之间的差异，不过 Golang 能够选择性编译。</p><p>当我们写的程序在不同的平台上调用的东西不同时，比如编译 Linux 平台的可执行文件的时候要编译这个文件，编译 Windows 平台的可执行文件的时候要编译那个文件。这种情况下就可以使用选择性编译。</p><p>选择性编译有两种方式： <code>编译注释（构建约束）</code> 和 <code>文件后缀</code>。</p><h3 id="编译注释（构建约束）"><a href="#编译注释（构建约束）" class="headerlink" title="编译注释（构建约束）"></a>编译注释（构建约束）</h3><p>编译注释长这样：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// +build darwin freebsd</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// sort package is used to sort.</span></span><br><span class="line"><span class="keyword">package</span> sort</span><br></pre></td></tr></table></figure><p><strong>第一行就是编译注释，或者叫构建约束（build constraint）、构建标记（build tag）。</strong> </p><p>格式为：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// +build [$GOOS] [$GOARCH]</span></span><br></pre></td></tr></table></figure><p>这是 Go 一开始就有的特性，在 Go 源码中有很多这样的注释行。上面注释行的意思，这个文件只在 darwin 系统或 freebsd 系统下会包含在包中，其他系统会忽略这个文件。</p><p>它需要遵循以下几点：</p><ol><li>必须在文件顶部附近，它的前面只能有空行或其他注释行；可见包子句也在约束之后</li><li>约束可以出现在任何源文件中，比如 <code>.go</code>、<code>.s</code> 等</li><li>约束可以有多行</li><li>为了区别约束和包文档，在约束之后必须有空行</li><li><code>//</code> 后面必须留一个空格</li><li><code>+build</code> 是关键字，声明这是一个编译注释</li><li>逻辑关系:<ol><li><code>!</code>: 非（感叹号）</li><li><code>,</code>: 与（逗号）</li><li><code>  </code>: 或（空格）</li></ol></li><li>$GOOS 取值：<ol><li>darwin</li><li>dragonfly</li><li>freebsd</li><li>linux</li><li>netbsd</li><li>openbsd</li><li>plan9</li><li>solaris</li><li>windows</li></ol></li><li>$GOARCH 取值：<ol><li>386</li><li>amd64</li><li>arm</li></ol></li></ol><blockquote><p>GOOS 和 GOARCH 的取值可以通过命令 <code>go tool dist list</code> 查看</p></blockquote><h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// +build A,B !C,D </span></span><br><span class="line"></span><br><span class="line">代表编译此文件需符合 (A且B) 或 ((非C)且D) 。</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// +build !windows,arm</span></span><br><span class="line">代表此文件在 系统不是windows，并且处理器架构是arm时编译</span><br></pre></td></tr></table></figure><h3 id="文件后缀"><a href="#文件后缀" class="headerlink" title="文件后缀"></a>文件后缀</h3><p>通过在文件名后加上 <code>_$GOOS.go</code> 的方式也可以实现条件编译。</p><p>后缀有3种形式：</p><ol><li><code>_$GOOS.go</code></li><li><code>_$GOARCH.go</code></li><li><code>_$GOOS_$GOARCH.go</code></li></ol><h4 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">color_windows.go    <span class="regexp">//</span> 该文件仅在编译 windows 可执行文件时编译</span><br><span class="line">color_linux.go      <span class="regexp">//</span> 该文件仅在编译 linux 可执行文件时编译</span><br><span class="line">color_darwin.go     <span class="regexp">//</span> 该文件仅在编译 darwin 可执行文件时编译</span><br><span class="line">color_linux_arm.go  <span class="regexp">//</span> 该文件仅在编译 linux 可执行文件时，且处理器架构为 arm 时编译</span><br></pre></td></tr></table></figure><h3 id="如何选择"><a href="#如何选择" class="headerlink" title="如何选择"></a>如何选择</h3><p>如果是排除某一两个平台的情况<br>如果是在很多个平台都可用的情况<br>则使用 <code>编译注释</code></p><p>如果是指定某一个平台的情况<br>如果是指定某一种架构的情况<br>则使用 <code>文件后缀</code></p><h3 id="其他文件名"><a href="#其他文件名" class="headerlink" title="其他文件名"></a>其他文件名</h3><p>以 <code>下划线</code> 或 <code>点</code> 开头的文件不会被编译。</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="module-access"><span class="module"><span class="identifier">_file</span>.</span></span>cfg</span><br><span class="line">.set.vm</span><br></pre></td></tr></table></figure><p>这两个文件在编译时不会被编译。</p><h2 id="新版构建约束"><a href="#新版构建约束" class="headerlink" title="新版构建约束"></a>新版构建约束</h2><p>自 Go1.17 开始，Golang 调整了构建约束，也就是编译注释。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//go:build [$GOOS] [$GOARCH]</span></span><br></pre></td></tr></table></figure><h3 id="对比"><a href="#对比" class="headerlink" title="对比"></a>对比</h3><p>旧版：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// +build linux,amd64</span></span><br></pre></td></tr></table></figure><p>新版：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//go:build linux &amp;&amp; amd64</span></span><br></pre></td></tr></table></figure><p>主要改变：</p><ol><li><p><code>// +build</code> 改成 <code>//go:build</code>，双斜杠后<strong>没有</strong>空格！！</p></li><li><p>一个文件只能有一行构建语句。（旧版可以多行）</p></li><li><p>gofmt 工具会自动根据旧版语法生成对应的新版语法，并且为了兼容两者都保留，新版在支持的环境下会覆盖旧版。</p> <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// +build !freebsd, !plan9</span></span><br></pre></td></tr></table></figure><p> gofmt 后：</p> <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//go:build !freebsd &amp;&amp; !plan9</span></span><br><span class="line"><span class="comment">// +build !freebsd, !plan9</span></span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
          <category> nil </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
            <tag> 交叉编译 </tag>
            
            <tag> 条件编译 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Golang [nil] 类型转换</title>
      <link href="posts/2c39f343"/>
      <url>posts/2c39f343</url>
      
        <content type="html"><![CDATA[<p>类型转换的三种方式</p><span id="more"></span><h1 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h1><p><strong>Go 不会对数据进行隐式转换，只能显式的手动转换</strong></p><h2 id="简单的转换"><a href="#简单的转换" class="headerlink" title="简单的转换"></a>简单的转换</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">T(expression)</span><br></pre></td></tr></table></figure><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>(time.Now().Weekday())    <span class="comment">// 星期转int</span></span><br><span class="line"><span class="keyword">int</span>(time.now().Month())      <span class="comment">// 月份转int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a <span class="keyword">float32</span></span><br><span class="line">a = <span class="number">3.14</span></span><br><span class="line">b := <span class="keyword">int</span>(a)     <span class="comment">// float32 转 int</span></span><br></pre></td></tr></table></figure><p>注意：这种方式不是所有数据类型都能转换的。</p><ol><li>例如 string 类型的 <code>&quot;Boii&quot;</code> 转 int 就会失败</li><li>低精度转高精度时是安全的，高精度转低精度则会丢失精度，例如 float64转float32</li><li>不能对 int、float 同 string 互转，跨大类型转换，可以使用 <code>strconv 包</code> 提供的函数</li></ol><h2 id="strconv-包"><a href="#strconv-包" class="headerlink" title="strconv 包"></a>strconv 包</h2><p>strconv 包提供了基本数据类型之间的类型转换功能。</p><h3 id="string-gt-int-Atoi"><a href="#string-gt-int-Atoi" class="headerlink" title="string -&gt; int : Atoi()"></a>string -&gt; int : Atoi()</h3><p>将 string 转换为 int：Atoi()</p><p>Atoi() 函数签名：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Atoi</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="params">(<span class="keyword">int</span>, error)</span></span></span><br></pre></td></tr></table></figure><p>由于 string 有可能无法转换为 int，所以提供了两个返回值</p><ul><li>第一个是转换成 int 的值</li><li>第二个是返回是否转换成功</li></ul><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// success</span></span><br><span class="line">i, err := strconv.Atoi(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">fmt.Print(i + <span class="number">5</span>)    <span class="comment">// 8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// fail</span></span><br><span class="line">i, err := strconv.Atoi(<span class="string">&quot;a&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Print(<span class="string">&quot;Converted FAILED!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="int-gt-string-Itoa"><a href="#int-gt-string-Itoa" class="headerlink" title="int -&gt; string : Itoa()"></a>int -&gt; string : Itoa()</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Itoa</span><span class="params">(i <span class="keyword">int</span>)</span> <span class="title">string</span></span></span><br></pre></td></tr></table></figure><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a := strconv.Itoa(<span class="number">18</span>)</span><br><span class="line">fmt.Println(a)         <span class="comment">// 18</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;%T \n&quot;</span>, a) <span class="comment">// string</span></span><br></pre></td></tr></table></figure><h3 id="string-gt-T-ParseT"><a href="#string-gt-T-ParseT" class="headerlink" title="string -&gt; T : ParseT()"></a>string -&gt; T : ParseT()</h3><p>Parse 类函数用于将字符转转换为给定类型的值</p><h4 id="ParseBool-str-string"><a href="#ParseBool-str-string" class="headerlink" title="ParseBool(str string)"></a>ParseBool(str string)</h4><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">b, err := strconv.ParseBool(<span class="string">&quot;true&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">4fmt.Println(b) <span class="comment">// true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ParseBool 的内部实现非常简单</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ParseBool</span><span class="params">(str <span class="keyword">string</span>)</span> <span class="params">(<span class="keyword">bool</span>, error)</span></span> &#123;</span><br><span class="line">4<span class="keyword">switch</span> str &#123;</span><br><span class="line">4<span class="keyword">case</span> <span class="string">&quot;1&quot;</span>, <span class="string">&quot;t&quot;</span>, <span class="string">&quot;T&quot;</span>, <span class="string">&quot;true&quot;</span>, <span class="string">&quot;TRUE&quot;</span>, <span class="string">&quot;True&quot;</span>:</span><br><span class="line">44<span class="keyword">return</span> <span class="literal">true</span>, <span class="literal">nil</span></span><br><span class="line">4<span class="keyword">case</span> <span class="string">&quot;0&quot;</span>, <span class="string">&quot;f&quot;</span>, <span class="string">&quot;F&quot;</span>, <span class="string">&quot;false&quot;</span>, <span class="string">&quot;FALSE&quot;</span>, <span class="string">&quot;False&quot;</span>:</span><br><span class="line">44<span class="keyword">return</span> <span class="literal">false</span>, <span class="literal">nil</span></span><br><span class="line">4&#125;</span><br><span class="line">4<span class="keyword">return</span> <span class="literal">false</span>, syntaxError(<span class="string">&quot;ParseBool&quot;</span>, str)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ParseInt-s-string-base-int-bitSize-int"><a href="#ParseInt-s-string-base-int-bitSize-int" class="headerlink" title="ParseInt(s string, base int, bitSize int)"></a>ParseInt(s string, base int, bitSize int)</h4><ul><li>s：要解析 int 的字符串</li><li>base：指定字符串中数字的进制（2到36），如果为0，会从字符串前置判断：<ul><li><code>0b</code>代表2进制</li><li><code>0o</code>代表8进制</li><li><code>0x</code>代表16进制</li><li>否则是10进制。</li></ul></li><li>bitSize：指定结果必须能无溢出赋值的整数类型，0、8、16、32、64 分别代表 int、int8、int16、int32、int64</li></ul><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">i, err := strconv.ParseInt(<span class="string">&quot;-C&quot;</span>, <span class="number">16</span>, <span class="number">0</span>)</span><br><span class="line"><span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">4fmt.Println(i)         <span class="comment">// -12</span></span><br><span class="line">4fmt.Printf(<span class="string">&quot;%T \n&quot;</span>, i) <span class="comment">// int64</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>十六进制中，C代表12，例子中传递的是 -C ，也就是-12</p><h4 id="ParseUint-s-string-base-int-bitSize-int"><a href="#ParseUint-s-string-base-int-bitSize-int" class="headerlink" title="ParseUint(s string, base int, bitSize int)"></a>ParseUint(s string, base int, bitSize int)</h4><p>和 Parseuint 一样，不过是针对 无符号整型的，如果传递一个有符号的数字字符串，会转换失败</p><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// success</span></span><br><span class="line">u, err := strconv.ParseUint(<span class="string">&quot;45&quot;</span>, <span class="number">7</span>, <span class="number">0</span>)</span><br><span class="line"><span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">4fmt.Println(u)         <span class="comment">// 33</span></span><br><span class="line">4fmt.Printf(<span class="string">&quot;%T \n&quot;</span>, u) <span class="comment">// uint64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// fail</span></span><br><span class="line">u, err := strconv.ParseUint(<span class="string">&quot;-10&quot;</span>, <span class="number">10</span>, <span class="number">0</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Print(<span class="string">&quot;Converted FAILED!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>7进制的 45 等于 10进制的33</p><h4 id="ParseFloat-s-string-bitSize-int"><a href="#ParseFloat-s-string-bitSize-int" class="headerlink" title="ParseFloat(s string, bitSize int)"></a>ParseFloat(s string, bitSize int)</h4><ul><li>s：要解析成 float 的字符串，</li><li>bitSize：指定了期望的接收类型，32是float32（返回值可以不改变精确值的赋值给float32），64是float64。</li></ul><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">f, err := strconv.ParseFloat(<span class="string">&quot;3.14&quot;</span>, <span class="number">64</span>)</span><br><span class="line"><span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">4fmt.Println(f)         <span class="comment">// 3.14</span></span><br><span class="line">4fmt.Printf(<span class="string">&quot;%T \n&quot;</span>, f) <span class="comment">// float64</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>bitSize 表示位数，只能填 64或32，不过 ParseFloat 只能接收64位类型的浮点数，即使 bitSize 你填32，依然会返回一个 float64 类型的数据给你，因为其内部实现是调用了一个 <code>atof32()</code> 的函数，然后 <code>return float64(f)</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ParseFloat</span><span class="params">(s <span class="keyword">string</span>, bitSize <span class="keyword">int</span>)</span> <span class="params">(<span class="keyword">float64</span>, error)</span></span> &#123;</span><br><span class="line">4f, n, err := parseFloatPrefix(s, bitSize)</span><br><span class="line">4<span class="keyword">if</span> err == <span class="literal">nil</span> &amp;&amp; n != <span class="built_in">len</span>(s) &#123;</span><br><span class="line">44<span class="keyword">return</span> <span class="number">0</span>, syntaxError(fnParseFloat, s)</span><br><span class="line">4&#125;</span><br><span class="line">4<span class="keyword">return</span> f, err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">parseFloatPrefix</span><span class="params">(s <span class="keyword">string</span>, bitSize <span class="keyword">int</span>)</span> <span class="params">(<span class="keyword">float64</span>, <span class="keyword">int</span>, error)</span></span> &#123;</span><br><span class="line">4<span class="keyword">if</span> bitSize == <span class="number">32</span> &#123;</span><br><span class="line">44f, n, err := atof32(s)</span><br><span class="line">44<span class="keyword">return</span> <span class="keyword">float64</span>(f), n, err</span><br><span class="line">4&#125;</span><br><span class="line">4<span class="keyword">return</span> atof64(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ParseComplex-s-string-bitSize-int"><a href="#ParseComplex-s-string-bitSize-int" class="headerlink" title="ParseComplex(s string, bitSize int)"></a>ParseComplex(s string, bitSize int)</h4><ul><li>s：要解析成 float 的字符串，</li><li>bitSize：指定了期望的接收类型，64是complex64（返回值可以不改变精确值的赋值给float32），128是complex128。</li></ul><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">c, err := strconv.ParseComplex(<span class="string">&quot;3+4i&quot;</span>, <span class="number">128</span>)</span><br><span class="line"><span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">4fmt.Println(c)         <span class="comment">// (3+4i)</span></span><br><span class="line">4fmt.Printf(<span class="string">&quot;%T \n&quot;</span>, c) <span class="comment">// complex128</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="T-gt-string-FormatT"><a href="#T-gt-string-FormatT" class="headerlink" title="T -&gt; string : FormatT()"></a>T -&gt; string : FormatT()</h3><p>FormatT 系列函数用于将 T 类型数据转成字符串</p><h4 id="FormatBool"><a href="#FormatBool" class="headerlink" title="FormatBool"></a>FormatBool</h4><p>函数签名：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FormatBool(b <span class="keyword">bool</span>) <span class="keyword">string</span></span><br></pre></td></tr></table></figure><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">b := strconv.FormatBool(<span class="literal">true</span>)</span><br><span class="line">fmt.Println(b) <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h4 id="FormatInt"><a href="#FormatInt" class="headerlink" title="FormatInt"></a>FormatInt</h4><p>函数签名：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FormatInt(i <span class="keyword">int64</span>, base <span class="keyword">int</span>) <span class="keyword">string</span></span><br></pre></td></tr></table></figure><ul><li>i：要转成字符串的数字，必须是 int64 类型</li><li>base：要转成什么进制再转字符串</li></ul><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">i1 := strconv.FormatInt(<span class="number">31</span>, <span class="number">16</span>)</span><br><span class="line">fmt.Println(i1) <span class="comment">// 1f ,将 10进制的31 转成 16进制的1f 然后转成字符串返回</span></span><br><span class="line"></span><br><span class="line">i2 := strconv.FormatInt(<span class="number">-0x1E</span>, <span class="number">8</span>)</span><br><span class="line">fmt.Println(i2) <span class="comment">// -36, 将 16进制的-1E 转成 8进制的-36 然后转成字符串返回</span></span><br></pre></td></tr></table></figure><h4 id="FormatUint"><a href="#FormatUint" class="headerlink" title="FormatUint"></a>FormatUint</h4><p>函数签名：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FormatUint(i <span class="keyword">uint64</span>, base <span class="keyword">int</span>) <span class="keyword">string</span></span><br></pre></td></tr></table></figure><ul><li>i：要转成字符串的数字，必须是 uint64 类型</li><li>base：要转成什么进制再转字符串</li></ul><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">u := strconv.FormatUint(<span class="number">12</span>, <span class="number">8</span>)</span><br><span class="line">fmt.Println(u) <span class="comment">// 14, 将 10进制的12 转成 8进制的14 然后转成字符串返回</span></span><br></pre></td></tr></table></figure><h4 id="FormatFloat"><a href="#FormatFloat" class="headerlink" title="FormatFloat"></a>FormatFloat</h4><p>函数签名：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FormatFloat(f <span class="keyword">float64</span>, fmt <span class="keyword">byte</span>, prec, bitSize <span class="keyword">int</span>) <span class="keyword">string</span></span><br></pre></td></tr></table></figure><ul><li>f：要转成字符串的浮点数</li><li>fmt：[‘f’, ‘b’, ‘e’, ‘E’, ‘g’, ‘G’]；表示格式<ul><li>f：000.000</li><li>b：000p±000 二进制指数</li><li>e：0.0000e±00 十进制指数</li><li>E：0.0000E±00 十进制指数</li><li>g：指数很大时用e格式，不大时用f格式</li><li>G：指数很大时用E格式，不大时用f格式</li></ul></li><li>prec：<ul><li>对于 f格式、e格式、E格式：控制小数点后位数</li><li>对于 g格式、G格式：控制中数字个数</li><li>为-1时，代表使用最少数量的、但又必需的数字来表示f</li></ul></li><li>bitSize：表示浮点数来源类型（32：float32、64：float64）</li></ul><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">v := <span class="number">4.12345678</span></span><br><span class="line"></span><br><span class="line">ff64 := strconv.FormatFloat(v, <span class="string">&#x27;f&#x27;</span>, <span class="number">30</span>, <span class="number">64</span>)</span><br><span class="line">ff32 := strconv.FormatFloat(v, <span class="string">&#x27;f&#x27;</span>, <span class="number">30</span>, <span class="number">32</span>)</span><br><span class="line">fb := strconv.FormatFloat(v, <span class="string">&#x27;b&#x27;</span>, <span class="number">10</span>, <span class="number">32</span>)</span><br><span class="line">fe := strconv.FormatFloat(v, <span class="string">&#x27;e&#x27;</span>, <span class="number">-1</span>, <span class="number">32</span>)</span><br><span class="line">fe10 := strconv.FormatFloat(v, <span class="string">&#x27;e&#x27;</span>, <span class="number">10</span>, <span class="number">32</span>)</span><br><span class="line">fg := strconv.FormatFloat(v, <span class="string">&#x27;g&#x27;</span>, <span class="number">10</span>, <span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">fmt.Println(ff64) <span class="comment">// 4.123456779999999710639713157434</span></span><br><span class="line">fmt.Println(ff32) <span class="comment">// 4.123456954956054687500000000000</span></span><br><span class="line">fmt.Println(fb)   <span class="comment">// 8647516p-21</span></span><br><span class="line">fmt.Println(fe)   <span class="comment">// 4.123457e+00</span></span><br><span class="line">fmt.Println(fe10) <span class="comment">// 4.1234569550e+00</span></span><br><span class="line">fmt.Println(fg)   <span class="comment">// 4.123456955</span></span><br></pre></td></tr></table></figure><h4 id="FormatComplex"><a href="#FormatComplex" class="headerlink" title="FormatComplex"></a>FormatComplex</h4><p>函数签名：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FormatComplex(c <span class="keyword">complex128</span>, fmt <span class="keyword">byte</span>, prec, bitSize <span class="keyword">int</span>) <span class="keyword">string</span></span><br></pre></td></tr></table></figure><ul><li>f：要转成字符串的复数</li><li>fmt：[‘f’, ‘b’, ‘e’, ‘E’, ‘g’, ‘G’]；表示格式<ul><li>f：000.000</li><li>b：000p±000 二进制指数</li><li>e：0.0000e±00 十进制指数</li><li>E：0.0000E±00 十进制指数</li><li>g：指数很大时用e格式，不大时用f格式</li><li>G：指数很大时用E格式，不大时用f格式</li></ul></li><li>prec：<ul><li>对于 f格式、e格式、E格式：控制小数点后位数</li><li>对于 g格式、G格式：控制中数字个数</li><li>为-1时，代表使用最少数量的、但又必需的数字来表示f</li></ul></li><li>bitSize：表示复数来源类型（64：complex64、128：complex128）</li></ul><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">c := strconv.FormatComplex(<span class="number">3</span>+<span class="number">8i</span>, <span class="string">&#x27;e&#x27;</span>, <span class="number">10</span>, <span class="number">64</span>)</span><br><span class="line">fmt.Println(c)<span class="comment">// (3.0000000000e+00+8.0000000000e+00i)</span></span><br></pre></td></tr></table></figure><h3 id="T-gt-string-amp-append-to-slice-AppendT"><a href="#T-gt-string-amp-append-to-slice-AppendT" class="headerlink" title="T -&gt; string &amp; append to slice : AppendT()"></a>T -&gt; string &amp; append to slice : AppendT()</h3><p>AppendT 系列函数用于将 T 转成字符串后 append 到一个 切片 slice 中</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;strconv&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// 声明一个slice</span></span><br><span class="line">    b10 := []<span class="keyword">byte</span>(<span class="string">&quot;int (base 10):&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将转换为10进制的string，追加到slice中</span></span><br><span class="line">    b10 = strconv.AppendInt(b10, <span class="number">-42</span>, <span class="number">10</span>)</span><br><span class="line">    fmt.Println(<span class="keyword">string</span>(b10))    <span class="comment">// int (base 10):-42</span></span><br><span class="line"></span><br><span class="line">    b16 := []<span class="keyword">byte</span>(<span class="string">&quot;int (base 16):&quot;</span>)</span><br><span class="line">    b16 = strconv.AppendInt(b16, <span class="number">-42</span>, <span class="number">16</span>)</span><br><span class="line">    fmt.Println(<span class="keyword">string</span>(b16))    <span class="comment">// int (base 16):-2a</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="类型断言"><a href="#类型断言" class="headerlink" title="类型断言"></a>类型断言</h2><p>类型断言分两种形式：<code>Type Assertion</code> 和 <code>Type Switch</code>。</p><h3 id="Type-Assertion"><a href="#Type-Assertion" class="headerlink" title="Type Assertion"></a>Type Assertion</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expression.(Type)</span><br></pre></td></tr></table></figure><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">t := i.(T)</span><br><span class="line">t, ok := i.(T)</span><br></pre></td></tr></table></figure><p>Type Assertion 的作用有两个：</p><ol><li>检查 <code>i</code> 是否为 nil</li><li>检查 <code>i</code> 的值是否为 T 类型</li></ol><p>使用方式有两种:</p><ol><li><code>t := i.(T)</code>：<ul><li><strong>说明</strong>：可以断言一个接口对象 <code>i</code> 的值不是 <em>nil</em>，并且值是 T 类型。</li><li><strong>断言成功</strong>：返回 <code>i</code> 的值给 <code>t</code></li><li><strong>断言失败</strong>：引发 <code>panic</code></li></ul></li><li><code>t, ok := i.(T)</code><ul><li><strong>说明</strong>：可以断言一个接口对象 <code>i</code> 的值不是 <em>nil</em>，并且值是 T 类型。</li><li><strong>断言成功</strong>：返回 <code>i</code> 的值给 <code>t</code>，<code>ok</code> 的值置为 <em>true</em></li><li><strong>断言失败</strong>：返回 <code>T</code> 的零值给 <code>t</code>，<code>ok</code> 的值置为 <em>false</em></li></ul></li></ol><p>eg：</p><ol><li><p><code>t := i.(T)</code></p> <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">4<span class="keyword">var</span> i <span class="keyword">interface</span>&#123;&#125; = <span class="number">10</span></span><br><span class="line">4t1 := i.(<span class="keyword">int</span>)</span><br><span class="line">4fmt.Println(t1)    <span class="comment">// 10</span></span><br><span class="line"></span><br><span class="line">4fmt.Println(<span class="string">&quot;+++++++++++++++++++++&quot;</span>)</span><br><span class="line"></span><br><span class="line">4t2 := i.(<span class="keyword">string</span>)    <span class="comment">// 这里会引发 panic</span></span><br><span class="line">4fmt.Println(t2)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// --------------------------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line"><span class="number">10</span></span><br><span class="line">+++++++++++++++++++++</span><br><span class="line"><span class="built_in">panic</span>: <span class="keyword">interface</span> conversion: <span class="keyword">interface</span> &#123;&#125; is <span class="keyword">int</span>, not <span class="keyword">string</span></span><br></pre></td></tr></table></figure><p> 接口值为 nil 时，断言会引发 panic</p> <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">4<span class="keyword">var</span> i <span class="keyword">interface</span>&#123;&#125;    <span class="comment">// i 的值为 nil</span></span><br><span class="line">4t := i.(<span class="keyword">interface</span>&#123;&#125;) <span class="comment">// 这里会引发 panic</span></span><br><span class="line">4fmt.Println(t)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// --------------------------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line"><span class="built_in">panic</span>: <span class="keyword">interface</span> conversion: <span class="keyword">interface</span> is <span class="literal">nil</span>, not <span class="keyword">interface</span> &#123;&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>t, ok := i.(T)</code></p> <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">4<span class="keyword">var</span> i1 <span class="keyword">interface</span>&#123;&#125; = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">4t1, ok := i1.(<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">4fmt.Printf(<span class="string">&quot;t1: %d, %v\n&quot;</span>, t1, ok) <span class="comment">// t1: 10, true</span></span><br><span class="line">4t2, ok := i1.(<span class="keyword">int</span>)</span><br><span class="line">4fmt.Printf(<span class="string">&quot;t2: %v, %v\n&quot;</span>, t2, ok) <span class="comment">// t2: 10, true</span></span><br><span class="line">4t3, ok := i1.(<span class="keyword">string</span>)</span><br><span class="line">4fmt.Printf(<span class="string">&quot;t3: %v, %v\n&quot;</span>, t3, ok) <span class="comment">// t3: , false</span></span><br><span class="line"></span><br><span class="line">4<span class="keyword">var</span> i2 <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">4t4, ok := i2.(<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">4fmt.Printf(<span class="string">&quot;t4: %v, %v\n&quot;</span>, t4, ok) <span class="comment">// t4: &lt;nil&gt;, false</span></span><br><span class="line"></span><br><span class="line">4i2 = <span class="string">&quot;Boii&quot;</span></span><br><span class="line">4t5, ok := i2.(<span class="keyword">int</span>)</span><br><span class="line">4fmt.Printf(<span class="string">&quot;t5: %v, %v\n&quot;</span>, t5, ok) <span class="comment">// t5: 0, false</span></span><br><span class="line">4t6, ok := i2.(<span class="keyword">string</span>)</span><br><span class="line">4fmt.Printf(<span class="string">&quot;t6: %v, %v\n&quot;</span>, t6, ok) <span class="comment">// t6: Boii, true</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// --------------------------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line">t1: <span class="number">10</span>, <span class="literal">true</span></span><br><span class="line">t2: <span class="number">10</span>, <span class="literal">true</span></span><br><span class="line">t3: , <span class="literal">false</span></span><br><span class="line">t4: &lt;<span class="literal">nil</span>&gt;, <span class="literal">false</span></span><br><span class="line">t5: <span class="number">0</span>, <span class="literal">false</span></span><br><span class="line">t6: Boii, <span class="literal">true</span></span><br></pre></td></tr></table></figure><p> 虽然 <code>t3、t4、t5</code> 断言失败，但没有引发 <code>panic</code></p></li></ol><h3 id="Type-Switch"><a href="#Type-Switch" class="headerlink" title="Type Switch"></a>Type Switch</h3><p>上面的方式适合 断言指定一种类型，如果需要断言 接口对象 <code>i</code> 是多种类型中的一种，则需要用 Type Switch。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> t := 接口对象.(<span class="keyword">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> T1:  ...</span><br><span class="line">    <span class="keyword">case</span> T2:  ...</span><br><span class="line">    <span class="keyword">case</span> <span class="literal">nil</span>: ...</span><br><span class="line">    <span class="keyword">default</span>: ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>接口对象.(type)</code> 中的 <code>.(type)</code> 是固定格式，不要修改。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">typeSwitch</span><span class="params">(i <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> t := i.(<span class="keyword">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">int</span>:</span><br><span class="line">        fmt.Println(t, <span class="string">&quot;is int.&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">string</span>:</span><br><span class="line">        fmt.Println(t, <span class="string">&quot;is string.&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">float64</span>:</span><br><span class="line">        fmt.Println(t, <span class="string">&quot;is float64&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="literal">nil</span>:</span><br><span class="line">        fmt.Println(t, <span class="string">&quot;is nil&quot;</span>)</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        fmt.Println(t, <span class="string">&quot;啥也不是&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">4<span class="keyword">var</span> i <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">4typeSwitch(i)      <span class="comment">// &lt;nil&gt; is nil</span></span><br><span class="line">4typeSwitch(<span class="string">&quot;Boii&quot;</span>) <span class="comment">// Boii is string.</span></span><br><span class="line">4typeSwitch(<span class="number">3.14</span>)   <span class="comment">// 3.14 is float64</span></span><br><span class="line">4typeSwitch(<span class="literal">true</span>)   <span class="comment">// true 啥也不是</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>t</code> 是什么类型就走什么分支，<code>t</code> 是 nil 就走 <code>case nil</code> 分支，没有一个满足就走 <code>default</code> 分支。<br><code>default</code> 分支是可选的。</p>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
          <category> Basic </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Golang [nil] Go Module</title>
      <link href="posts/5bdd8b42"/>
      <url>posts/5bdd8b42</url>
      
        <content type="html"><![CDATA[<p>开启 Go Module 来管理你的模块</p><span id="more"></span><h1 id="Go-Module"><a href="#Go-Module" class="headerlink" title="Go Module"></a>Go Module</h1><h2 id="启用-GO111MODULE"><a href="#启用-GO111MODULE" class="headerlink" title="启用 GO111MODULE"></a>启用 GO111MODULE</h2><p><strong>版本要求：go 1.11+，1.13起默认开启</strong></p><p>启用 go module 支持首先要设置环境变量，有三个可选值：<span class='p blue'>auto</span>、<span class='p green'>on</span>、<span class='p red'>off</span>，默认是 <span class='p blue'>auto</span>。</p><ol><li><code>GO111MODULE=off</code> 禁用模块支持，编译时会从 <code>GOPATH</code> 和 <code>vendor</code> 文件夹中查找包。</li><li><code>GO111MODULE=on</code> 开启模块支持，编译时会忽略 <code>GOPATH</code> 和 <code>vendor</code> 文件夹，只根据 <code>go.mod</code> 下载依赖。</li><li><code>GO111MODULE=auto</code>，当项目在 <code>$GOPATH/src</code> 外且项目根目录有 <code>go.mod</code> 文件时，开启模块支持。</li></ol><p>设置 <code>GO111MODULE=on</code> 之后就可以使用 <code>go module</code> 了，以后就没必要在 <code>GOPATH</code> 中创建项目了。</p><p>使用 go module 管理依赖后会在项目根目录下生成两个文件 <code>go.mod</code> 和 <code>go.sum</code>。</p><p>开启方式：</p><ul><li><p>windows：在环境变量中添加一条值<br>  <img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20210217115631352_20287.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20210217115631352_20287.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></li><li><p>Linux：直接执行命令到 <code>/etc/profile</code> 或 <code>$HOME/.profile</code></p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> <span class="string">&quot;export GO111MODULE=auto&quot;</span> &gt;&gt; /etc/profile</span></span><br></pre></td></tr></table></figure><p>  或者</p>  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">go</span> env -w GO111MODULE=auto</span><br></pre></td></tr></table></figure></li></ul><h2 id="go-mod-命令"><a href="#go-mod-命令" class="headerlink" title="go mod 命令"></a>go mod 命令</h2><p>常用 <code>go mod</code> 命令如下：</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> <span class="keyword">mod</span> init     初始化当前文件夹，创建 <span class="keyword">go</span>.<span class="keyword">mod</span> 文件</span><br><span class="line"><span class="keyword">go</span> <span class="keyword">mod</span> download 下载依赖的 module 到本地cache（默认为 $GOPATH/pkg/<span class="keyword">mod</span>，使用命令 <span class="keyword">go</span> env GOMODCACHE 可查看）</span><br><span class="line"><span class="keyword">go</span> <span class="keyword">mod</span> <span class="keyword">edit</span>     编辑 <span class="keyword">go</span>.<span class="keyword">mod</span> 文件</span><br><span class="line"><span class="keyword">go</span> <span class="keyword">mod</span> graph    打印模块依赖图</span><br><span class="line"><span class="keyword">go</span> <span class="keyword">mod</span> tidy     增加缺少的 module，删除无用的 module</span><br><span class="line"><span class="keyword">go</span> <span class="keyword">mod</span> vendor   将依赖复制到 vendor 下，vendor 目录不存在时会自动创建</span><br><span class="line"><span class="keyword">go</span> <span class="keyword">mod</span> verify   检验依赖</span><br><span class="line"><span class="keyword">go</span> <span class="keyword">mod</span> why      解释为什么要依赖</span><br></pre></td></tr></table></figure><h2 id="go-mod-init-初始化"><a href="#go-mod-init-初始化" class="headerlink" title="go mod init 初始化"></a>go mod init 初始化</h2><p>初始化当前文件夹，创建 go.mod 文件。</p><p>第一步，切换到项目目录中<br>第二步，执行命令 <code>go mod init module名</code></p><p>eg：</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20210217123923793_585.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20210217123923793_585.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h2 id="go-mod-tidy-整理依赖"><a href="#go-mod-tidy-整理依赖" class="headerlink" title="go mod tidy 整理依赖"></a>go mod tidy 整理依赖</h2><p>我们在代码中删除依赖代码后，相关的依赖库并不会在 <code>go.mod</code> 文件中自动移除。这种情况下我们可以使用 <code>go mod tidy</code> 命令更新 <code>go.mod</code> 中的依赖关系。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go mod tidy</span></span><br></pre></td></tr></table></figure><h2 id="go-mod-edit-编辑mod文件"><a href="#go-mod-edit-编辑mod文件" class="headerlink" title="go mod edit 编辑mod文件"></a>go mod edit 编辑mod文件</h2><h3 id="格式化"><a href="#格式化" class="headerlink" title="格式化"></a>格式化</h3><p>因为我们可以手动修改go.mod文件，所以有些时候需要格式化该文件。Go提供了一下命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go mod edit -fmt</span></span><br></pre></td></tr></table></figure><h3 id="添加依赖项"><a href="#添加依赖项" class="headerlink" title="添加依赖项"></a>添加依赖项</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go mod edit -require=要添加的模块</span></span><br></pre></td></tr></table></figure><p>eg：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go mod edit -require=rsc.io/quote</span></span><br></pre></td></tr></table></figure><h3 id="移除依赖项"><a href="#移除依赖项" class="headerlink" title="移除依赖项"></a>移除依赖项</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go mod edit -droprequire=要移除的模块</span></span><br></pre></td></tr></table></figure><p>eg：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go mod edit -require=github.com/sirupsen/logrus@v1.7.1</span></span><br></pre></td></tr></table></figure><h2 id="go-get"><a href="#go-get" class="headerlink" title="go get"></a>go get</h2><p>在项目中执行 <code>go get</code> 命令可以下载依赖包，并且还可以指定下载的版本。</p><ol><li>运行 <code>go get -u</code> 将会升级到最新的次要版本或者修订版本(x.y.z, z是修订版本号， y是次要版本号)</li><li>运行 <code>go get -u=patch</code> 将会升级到最新的修订版本</li><li>运行 <code>go get package@version</code> 将会升级到指定的版本号 version</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go get</span> </span><br></pre></td></tr></table></figure><p>如果下载所有依赖可以使用 <code>go mod download</code> 命令。</p><h2 id="go-mod-文件"><a href="#go-mod-文件" class="headerlink" title="go.mod 文件"></a>go.mod 文件</h2><p><strong><code>go.mod</code></strong> 有 5 种指令：<code>module</code>、<code>go</code>、<code>require</code>、<code>exclude</code>、<code>replace</code></p><ul><li><strong>module</strong>：定义模块路径</li><li><strong>go</strong>：设置预期的语言版本</li><li><strong>require</strong>：依赖包列表及版本</li><li><strong>exclude</strong>：禁止依赖包列表（仅在当前模块为主模块时生效）</li><li><strong>replace</strong>：替换依赖包列表（仅在当前模块为主模块时生效）</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span> my/thing</span><br><span class="line"></span><br><span class="line">go <span class="number">1.16</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span> other/thing v1<span class="number">.0</span><span class="number">.2</span> <span class="comment">// 这是注释</span></span><br><span class="line"><span class="built_in">require</span> <span class="keyword">new</span>/thing/v2 v2<span class="number">.3</span><span class="number">.4</span> <span class="comment">// indirect</span></span><br><span class="line"><span class="built_in">require</span>（</span><br><span class="line">  <span class="keyword">new</span>/thing v2<span class="number">.3</span><span class="number">.4</span></span><br><span class="line">  old/thing v0<span class="number">.0</span><span class="number">.0</span>-<span class="number">20190603091049</span>-60506f45cf65</span><br><span class="line">）</span><br><span class="line"></span><br><span class="line">exclude old/thing v1<span class="number">.2</span><span class="number">.3</span></span><br><span class="line"></span><br><span class="line">replace bad/thing v1<span class="number">.4</span><span class="number">.5</span> =&gt; good/thing v1<span class="number">.4</span><span class="number">.5</span></span><br></pre></td></tr></table></figure><h2 id="语义化版本"><a href="#语义化版本" class="headerlink" title="语义化版本"></a>语义化版本</h2><p>语义化版本号格式为：<code>X.Y.Z</code>（主版本号.次版本号.修订号），使用方法如下：</p><ul><li>进行不向下兼容的修改时，递增主版本号。</li><li>API 保持向下兼容的新增及修改时，递增次版本号。</li><li>修复问题但不影响 API 时，递增修订号。</li></ul><p>例如：<br>有一个语义化版本号为：<code>v0.1.2</code>，则其主版本号为 0，次版本为 1，修订号为 2。</p><p>而前面的 v 是 version（版本）的首字母，是 Go 语言惯例使用的，标准的语义化版本没有这个约定。</p><p>所以在使用 Go 命令行工具或 go.mod 文件时，就可以使用语义化版本号来进行模块查询，具体规则如下：</p><ul><li>默认值（<code>@latest</code>）：将匹配<strong>最新可用</strong>的标签版本或源码库的最新未标签版本。</li><li>指定某个 commit（<code>@c854792</code>）：将匹配该 <strong>commit</strong> 时的版本。</li><li>指定某个分支（<code>@master</code>）：将匹配该<strong>分支</strong>版本。</li><li>完全指定版本（<code>@v1.2.3</code>）：将匹配该<strong>指定</strong>版本。</li><li>版本前缀（<code>@v1 或 @v1.2</code>）：将匹配具有该<strong>前缀</strong>的<strong>最新可用</strong>标签版本。</li><li>版本比较（<code>@&lt;v1.2.3 或 @&gt;=v1.5.6</code>）：将匹配<strong>最接近比较目标</strong>的可用标签版本。&lt; 则为小于该版本的最新版本，&gt; 则为大于版本的最旧版本。当使用类 Unix 系统时，需用引号将字符串包裹起来以防止大于小于号被解释为重定向。<br>  如：<code>go get &#39;github.com/gin-gonic/gin@&lt;v1.2.3&#39;</code>。</li></ul><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20210217145451209_10624.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20210217145451209_10624.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>如上图所示，为了能让 Go Modules 的使用者能够从旧版本更方便地升级至新版本，Go 语言官方提出了两个重要的规则：</p><ol><li>导入兼容性规则（import compatibility rule）：如果旧包和新包具有相同的导入路径，则新包必须向后兼容旧包。</li><li>语义化导入版本规则（semantic import versioning rule）：每个不同主版本（即不兼容的包 v1 或 v2）使用不同的导入路径，以主版本结尾，且每个主版本中最多一个。如：一个 rsc.io/quote、一个 rsc.io/quote/v2、一个 rsc.io/quote/v3。</li></ol><p>而与 Git 分支的集成如下：</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20210217145532595_1214.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20210217145532595_1214.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Go Modules 分支"></p><blockquote><p>参考 <a href="https://juejin.cn/post/6844903872054427656">Go Modules 详解</a></p></blockquote><h2 id="在项目中使用-go-module"><a href="#在项目中使用-go-module" class="headerlink" title="在项目中使用 go module"></a>在项目中使用 go module</h2><h3 id="既有项目"><a href="#既有项目" class="headerlink" title="既有项目"></a>既有项目</h3><p>如果需要对一个已经存在的项目启用 <code>go module</code>，可以按照以下步骤操作：</p><ol><li>在项目目录下执行 <code>go mod init</code>，生成一个go.mod文件。</li><li>执行 <code>go get</code>，查找并记录当前项目的依赖，同时生成一个go.sum记录每个依赖库的版本和哈希值。</li></ol><h3 id="新项目"><a href="#新项目" class="headerlink" title="新项目"></a>新项目</h3><p>对于一个新创建的项目，我们可以在项目文件夹下按照以下步骤操作：</p><ol><li>执行 <code>go mod init 项目名</code> 命令，在当前项目文件夹下创建一个 <code>go.mod</code> 文件。</li><li>手动编辑 <code>go.mod</code> 中的 require 依赖项或执行 <code>go get</code> 自动发现、维护依赖。</li><li>如果没反应，可以试试 <code>go mod tidy</code></li></ol><h2 id="VSCode-go-的坑"><a href="#VSCode-go-的坑" class="headerlink" title="VSCode-go 的坑"></a>VSCode-go 的坑</h2><h3 id="开启-GOMODULE-就报错"><a href="#开启-GOMODULE-就报错" class="headerlink" title="开启 GOMODULE 就报错"></a>开启 GOMODULE 就报错</h3><blockquote><p>报错信息：<code>found module &quot;golang.org/x/tools&quot; twice in the workspace</code></p></blockquote><p>一开始的时候我是在 VSC 里建了一个工作区，把 GOPATH 所在目录添加在工作区里，然后开启 GO111MODULE=auto，结果就一直报错。<br>后来<strong>新建一个工作区</strong>，把自己放项目的文件夹添加到工作区，就没事了。</p><p>我的 GOPATH：<code>GOPATH=E:\---CODE\GO\root</code></p><p>GOPATH 放进去的工作区：<br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20210216232600109_13119.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20210216232600109_13119.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>没有 GOPATH 的工作区</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20210216232836076_13857.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20210216232836076_13857.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>相安无事</p><h3 id="go-tools-下载失败"><a href="#go-tools-下载失败" class="headerlink" title="go tools 下载失败"></a>go tools 下载失败</h3><p>解决办法：把 GOPROXY 改到 <a href="https://goproxy.cn/">https://goproxy.cn</a>。阿里云那个有时候不行，官网被墙。<br>我试了只有这个地址一次过。</p><ul><li><p>第一步：修改环境变量 GOPROXY<br>  <img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20210216233219520_22889.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20210216233219520_22889.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></li><li><p>第二步：确保 GOPATH 下有<code>bin</code>、<code>pkg</code>、<code>src</code> 三个目录</p></li><li><p>第三步：在 VSC 中按下 <code>Ctrl+Shift+P</code> 唤醒快捷命令行，输入：<code>Go:install/Update Tools</code>，回车。<br>  <img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20210216232958058_14544.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20210216232958058_14544.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></li></ul><ul><li><p>第四步：全选，然后点击 OK 开始下载<br>  <img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20210216233135419_18930.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20210216233135419_18930.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></li><li><p>第四步：丝滑顺畅一次过<br>  <img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20210216233350018_30494.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20210216233350018_30494.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
          <category> Basic </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gin [0-Get Start]</title>
      <link href="posts/451cd62"/>
      <url>posts/451cd62</url>
      
        <content type="html"><![CDATA[<p>Hello Gin.</p><span id="more"></span><h1 id="GetStart"><a href="#GetStart" class="headerlink" title="GetStart"></a>GetStart</h1><h2 id="要求"><a href="#要求" class="headerlink" title="要求"></a>要求</h2><ul><li>&gt;= Go v1.13</li></ul><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>前提：</p><ul><li>安装 <a href="https://golang.org/dl/">Golang</a></li><li>设置 Go 工作区</li></ul><ol><li>下载并安装 gin：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ go get -u github.com/gin-gonic/gin</span><br></pre></td></tr></table></figure><ol start="2"><li>在代码中引入<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;net/http&quot;</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h2><p>先创建一个go文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ touch demo.go</span><br></pre></td></tr></table></figure><p>接着编写下面的代码：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">    <span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    app := gin.Default()</span><br><span class="line">    app.GET(<span class="string">&quot;/hi&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">            <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;Hello Gin!&quot;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    app.Run()    <span class="comment">// 默认运行在 8080 端口</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后执行 <code>go run demo.go</code> 命令运行代码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ go rum demo.go</span><br></pre></td></tr></table></figure><p>最后打开浏览器访问 <a href="http://localhost:8080/hi">http://localhost:8080/hi</a></p>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
          <category> Framework </category>
          
      </categories>
      
      
        <tags>
            
            <tag> gin </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gin [5-中间件]</title>
      <link href="posts/a55bf0d2"/>
      <url>posts/a55bf0d2</url>
      
        <content type="html"><![CDATA[<p>中间件的创建和使用</p><span id="more"></span><h1 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h1><p>用在 <code>客户端</code> 与 <code>服务端</code> 之间的插件，我们称之为 <code>中间件</code>。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/5592618688329.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/5592618688329.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="中间件示意图"></p><p>中间件是一个概念，其实质就是一些遵循一定规范的函数，也称做 <code>钩子函数(Hook)</code>。</p><p>中间件适合处理一些公共的业务逻辑，比如登录认证、权限校验、数据分页、记录日志、耗时统计等。</p><h2 id="定义中间件"><a href="#定义中间件" class="headerlink" title="定义中间件"></a>定义中间件</h2><p>定义一个中间件，其实就是定义一个 <code>gin.HandlerFunc</code></p><p>这个 <code>HandlerFunc</code> 其实是一个函数，例如前面我们已经写了很多次的 GET请求、POST请求，第一个参数为路由路径，第二个参数写的就是这种格式的处理函数。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(group *RouterGroup)</span> <span class="title">GET</span><span class="params">(relativePath <span class="keyword">string</span>, handlers ...HandlerFunc)</span> <span class="title">IRoutes</span></span></span><br></pre></td></tr></table></figure><p>对于这个 <code>HandlerFunc</code>，源码中是这样定义的：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//gin.go</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// HandlerFunc defines the handler used by gin middleware as return value.</span></span><br><span class="line"><span class="keyword">type</span> HandlerFunc <span class="function"><span class="keyword">func</span><span class="params">(*Context)</span></span></span><br></pre></td></tr></table></figure><p>形参列表只有一个 <code>*gin.Context</code> 类型的参数，没有返回值。</p><p>这样的函数就是一个 <code>HandlerFunc</code>，就可以作为一个中间件。</p><p>eg：定义一个计时中间件</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">timer</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    start := time.Now()</span><br><span class="line">    c.Next()</span><br><span class="line">    end   := time.Since(start)</span><br><span class="line"></span><br><span class="line">    fmt.Println(end)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>简简单单，上面的栗子就已经定义了一个名为 timer 的中间件，用于计时。</p><p>这里的 <code>c.Next()</code> 是主动调用后面的 <code>HandlerFunc</code>，它还有一个兄弟：<code>c.Abort()</code>，这个我们放在后面讲。</p><h2 id="局部注册中间件"><a href="#局部注册中间件" class="headerlink" title="局部注册中间件"></a>局部注册中间件</h2><p>使用中间件也很简单，我们在接收请求的时候，即编写 <code>Handler()</code>、或者 <code>GET()</code> 这些方法时，最后一个参数就可以传入一个或多个 <code>HandlerFunc</code>。</p><p>eg:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sleep</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    start := time.Now()</span><br><span class="line">    time.Sleep(time.Second)    <span class="comment">// 睡眠一秒</span></span><br><span class="line">    end   := time.Since(start)</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;sleep middleware: &quot;</span>, end)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">indexHandler</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Index handler&quot;</span>)</span><br><span class="line">    c.JSON(http.StatusOK, gin.H&#123; <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;Here is index.&quot;</span> &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    r := gin.Default()</span><br><span class="line"></span><br><span class="line">    r.GET(<span class="string">&quot;/&quot;</span>, sleep, indexHandler)    <span class="comment">// 局部注册中间件到此路由</span></span><br><span class="line"></span><br><span class="line">    r.Run(<span class="string">&quot;:9090&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出：<br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/835062854610.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/835062854610.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>上面的栗子中可以看出，局部注册就是把中间件写在需要使用该中间件的路由中。</p><p>这里 <code>timer</code> 和 <code>indexHandler</code> 本质上都是一样的，但是被调用顺序不同。</p><p>客户端请求 <code>/</code> 这个路径时，会先调用 <code>timer</code> 这个中间件，等它执行完后再去执行 <code>indexHandler</code>。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/3420038008778.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/3420038008778.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h2 id="全局注册中间件"><a href="#全局注册中间件" class="headerlink" title="全局注册中间件"></a>全局注册中间件</h2><p>全局注册中间件，会使得该作用域下所有路由都会执行对应的中间件。注册时使用<code>Use()</code> 方法。</p><p>啥意思呢？</p><p>就是说，假设你定义了 <code>r := gin.Default()</code>，</p><p>然后你写 <code>r.Use(timer)</code>，这样你的网站所有的路由都会执行 timer 这个中间件。</p><p>如果你是用 <code>userG := r.Group(&quot;/user&quot;)</code>，然后写 <code>userG.Use(timer)</code>，这样 userG 这个路由组下所有路由都会执行 timer 这个中间件</p><p>而组外的其他路由并不一定会执行 timer。</p><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义一个中间件</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">timer</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    start := time.Now()</span><br><span class="line">    c.Next()</span><br><span class="line">    end := time.Since(start)</span><br><span class="line">    fmt.Println(end)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    r := gin.Default()</span><br><span class="line"></span><br><span class="line">    userG := r.Group(<span class="string">&quot;/user&quot;</span>)    <span class="comment">// 定义一个路由组 userG</span></span><br><span class="line">    userG.Use(timer)             <span class="comment">// 绑定 timer 中间件</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 以下两个路由会执行 timer 中间件</span></span><br><span class="line">        userG.POST(<span class="string">&quot;/register&quot;</span>, Register)</span><br><span class="line">        userG.POST(<span class="string">&quot;/login&quot;</span>, Login)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义一个路由组 boogG</span></span><br><span class="line">    bookG := r.Group(<span class="string">&quot;/book&quot;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 以下两个路由不会执行 timer 中间件</span></span><br><span class="line">        bookG.GET(<span class="string">&quot;/search/:id&quot;</span>, SearchBook)</span><br><span class="line">        bookG.DELETE(<span class="string">&quot;/remove/:id&quot;</span>, RemoveBook)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    r.Run(<span class="string">&quot;:9090&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/1537822060392.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/1537822060392.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>可以清楚看到，请求 /user 组下的路径时，调用了 timer 打印了时间，而请求 /book 组时没有。</p><h2 id="中间链（职责链模式）"><a href="#中间链（职责链模式）" class="headerlink" title="中间链（职责链模式）"></a>中间链（职责链模式）</h2><h3 id="c-Next"><a href="#c-Next" class="headerlink" title="c.Next()"></a>c.Next()</h3><p>上面的栗子中，我们使用到了 <code>c.Next()</code> 函数，这会改变程序的执行流。</p><p>中间件里没有使用到 <code>c.Next()</code> 的时候，其执行流如下</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/4472457420778.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/4472457420778.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>没有 <code>c.Next()</code> 的时候会执行完前一个中间件，就执行下一个中间件。</p><p>而在中间件中使用 <code>c.Next()</code> 时则会改变其执行流。</p><p>其实就是将下一个中间件的执行时机提前了，但是下一个中间件执行完以后还会回到当前的中间件。</p><p>其执行流如下图：</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/77417672863.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/77417672863.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 中间件1</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">m1</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;m1 in...&quot;</span>)</span><br><span class="line">    c.Next()</span><br><span class="line">    fmt.Println(<span class="string">&quot;m1 out...&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 中间件2</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">m2</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;m2 in...&quot;</span>)</span><br><span class="line">    c.Next()</span><br><span class="line">    fmt.Println(<span class="string">&quot;m2 out...&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 首页处理函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">indexHandler</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Index handler in...&quot;</span>)</span><br><span class="line"></span><br><span class="line">    c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">        <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;Here is index.&quot;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    c.Next()</span><br><span class="line">    fmt.Println(<span class="string">&quot;Index handler out...&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    r := gin.Default()</span><br><span class="line"></span><br><span class="line">    r.GET(<span class="string">&quot;/&quot;</span>, m1, m2, indexHandler)    <span class="comment">// 依次局部注册三个中间件</span></span><br><span class="line"></span><br><span class="line">    r.Run(<span class="string">&quot;:9090&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/2607899532868.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/2607899532868.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>三个 <code>HandlerFunc</code> 的注册顺序依次是 <code>m1、m2、indexHandler</code></p><p>每个都调用了 <code>c.Next()</code>，</p><p>所以他们的执行流应该是：</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/3247650618373.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/3247650618373.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h3 id="c-Abort"><a href="#c-Abort" class="headerlink" title="c.Abort()"></a>c.Abort()</h3><p><code>c.Abort()</code> 是 <code>c.Next()</code> 的兄弟。</p><p><code>c.Next()</code> 调用下一个 HandlerFunc;<br><code>c.Abort()</code> 阻止调用下一个 HandlerFunc。一旦阻止了，则后面不管有多少个 HandlerFunc，它们都没有机会执行了。</p><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 中间件1</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">m1</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;m1 in...&quot;</span>)</span><br><span class="line">    c.Next()</span><br><span class="line">    fmt.Println(<span class="string">&quot;m1 out...&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 中间件2</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">m2</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;m2 in...&quot;</span>)</span><br><span class="line">    c.Abort()    <span class="comment">// 阻止调用后面的 HandlerFunc</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;m2 out...&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 中间件3</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">m3</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;m3 in...&quot;</span>)</span><br><span class="line">    c.Next()</span><br><span class="line">    fmt.Println(<span class="string">&quot;m3 out...&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 首页处理函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">indexHandler</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Index handler in...&quot;</span>)</span><br><span class="line"></span><br><span class="line">    c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">        <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;Here is index.&quot;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    c.Next()</span><br><span class="line">    fmt.Println(<span class="string">&quot;Index handler out...&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    r := gin.Default()</span><br><span class="line"></span><br><span class="line">    r.GET(<span class="string">&quot;/&quot;</span>, m1, m2, m3, indexHandler)    <span class="comment">// 依次局部注册四个中间件</span></span><br><span class="line"></span><br><span class="line">    r.Run(<span class="string">&quot;:9090&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/2547203825659.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/2547203825659.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>在 <code>m2</code> 的时候调用了 <code>c.Abort()</code>，所以后面的 <code>m3、indexHandler</code> 都没有机会执行了。</p><h2 id="中间件之间数据传递"><a href="#中间件之间数据传递" class="headerlink" title="中间件之间数据传递"></a>中间件之间数据传递</h2><p>中间件之间要传递数据，可以通过 <code>c.Set(key, value)</code> 的方式发送，在获取的地方用 <code>c.Get(key)</code> 的方式获取。</p><p>获取的方法有非常多，如下图：</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/4093224325543.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/4093224325543.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>在这里的获取要注意执行流的问题，如果第2个中间件执行 <code>c.Set()</code>，但是在第1个中间件就执行了 <code>c.Get()</code>，那会什么都拿不到。</p><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 中间件1</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">m1</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;m1 in...&quot;</span>)</span><br><span class="line">    c.Set(<span class="string">&quot;k&quot;</span>, <span class="number">123</span>)    <span class="comment">// 设置数据</span></span><br><span class="line">    c.Next()</span><br><span class="line">    fmt.Println(<span class="string">&quot;m1 out...&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 首页处理函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">indexHandler</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Index handler in...&quot;</span>)</span><br><span class="line"></span><br><span class="line">    fmt.Println(c.MustGet(<span class="string">&quot;k&quot;</span>))    <span class="comment">// 获取数据</span></span><br><span class="line"></span><br><span class="line">    c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">        <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;Here is index.&quot;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;Index handler out...&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    r := gin.Default()</span><br><span class="line"></span><br><span class="line">    r.GET(<span class="string">&quot;/&quot;</span>, m1, indexHandler)</span><br><span class="line"></span><br><span class="line">    r.Run(<span class="string">&quot;:9090&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/1886277063287.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/1886277063287.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h2 id="默认中间件"><a href="#默认中间件" class="headerlink" title="默认中间件"></a>默认中间件</h2><p><code>gin.Default()</code> 默认使用了 <code>Logger</code> 和 <code>Recovery</code> 中间件，其中：</p><p><code>Logger中间件</code> 将日志写入 <code>gin.DefaultWriter</code>，即使配置了 <code>GIN_MODE=release</code>。</p><p><code>Recovery中间件</code> 会 recover 任何 panic。如果有panic的话，会写入500响应码。</p><p>如果不想使用上面两个默认的中间件，可以使用 <code>gin.New()</code> 新建一个没有任何默认中间件的路由。</p><h2 id="并发注意事项"><a href="#并发注意事项" class="headerlink" title="并发注意事项"></a>并发注意事项</h2><p>gin中间件中使用goroutine</p><p>当在中间件或 <code>handler</code> 中启动新的 <code>goroutine</code> 时，不能使用原始的上下文<code>（c *gin.Context）</code>，必须使用其只读副本<code>（c.Copy()）</code>。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">m1</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    start := time.Now()</span><br><span class="line">    end := time.Since(start)</span><br><span class="line">    c.Set(<span class="string">&quot;timer&quot;</span>, end)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// go func(c)         // 错误！！！</span></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123; <span class="comment">// 只能使用上下文的拷贝，不能使用原本的上下文</span></span><br><span class="line">        fmt.Println(<span class="string">&quot;Other goroutine: &quot;</span>, c.MustGet(<span class="string">&quot;timer&quot;</span>))</span><br><span class="line">    &#125;(c.Copy())</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">indexHandler</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    timer := c.MustGet(<span class="string">&quot;timer&quot;</span>)</span><br><span class="line">    fmt.Println(<span class="string">&quot;indexHandler: &quot;</span>, timer)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    r := gin.Default()</span><br><span class="line"></span><br><span class="line">    r.GET(<span class="string">&quot;/&quot;</span>, indexHandler)</span><br><span class="line"></span><br><span class="line">    r.Run(<span class="string">&quot;:9090&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/1064955184484.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/1064955184484.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
          <category> Framework </category>
          
      </categories>
      
      
        <tags>
            
            <tag> gin </tag>
            
            <tag> 拦截器 </tag>
            
            <tag> 中间件 </tag>
            
            <tag> 监视器 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gin [4-上传下载重定向]</title>
      <link href="posts/64ec0a72"/>
      <url>posts/64ec0a72</url>
      
        <content type="html"><![CDATA[<p>上传、下载和重定向</p><span id="more"></span><h1 id="上传下载和重定向"><a href="#上传下载和重定向" class="headerlink" title="上传下载和重定向"></a>上传下载和重定向</h1><p>文件上传是后端开发中很常见的需求。</p><p>文件上传的原理无非是客户端 <code>选择文件并点击上传</code>，浏览器将文件内容读取然后传送到服务器；</p><p>服务端读取数据并新建文件，写入浏览器传输过来的内容。</p><h2 id="单个文件上传"><a href="#单个文件上传" class="headerlink" title="单个文件上传"></a>单个文件上传</h2><h3 id="前端部分"><a href="#前端部分" class="headerlink" title="前端部分"></a>前端部分</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/upload&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;f1&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;上传&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/6000782296428.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/6000782296428.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="><br>前端需要用一个表单来进行上传，这里我们设置了表单提交的请求方式为 POST。</p><p>注意一定要指定编码类型 <code>enctype=&quot;multipart/form-data&quot;</code></p><p>上传文件后点击上传按钮会向 <code>http://localhost:9090/upload</code> 这个路径发起POST请求。</p><h3 id="后端部分"><a href="#后端部分" class="headerlink" title="后端部分"></a>后端部分</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    r := gin.Default()</span><br><span class="line"></span><br><span class="line">    r.POST(<span class="string">&quot;/upload&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 从请求中读取文件</span></span><br><span class="line">        f, _ := c.FormFile(<span class="string">&quot;f1&quot;</span>)</span><br><span class="line">        <span class="comment">// 保存文件</span></span><br><span class="line">        c.SaveUploadedFile(f, <span class="string">&quot;./&quot;</span> + f.Filename)</span><br><span class="line">        <span class="comment">// 给客户端返回上传成功的消息</span></span><br><span class="line">        c.JSON(<span class="number">200</span>, gin.H&#123;<span class="string">&quot;code&quot;</span>: <span class="number">2003</span>, <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;上传成功&quot;</span>&#125;)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    r.Run(<span class="string">&quot;:9090&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>后端的处理主要分3步：</p><ol><li>从请求中读取文件</li><li>保存文件</li><li>给客户端返回上传成功的消息</li></ol><p>通过 <code>gin.FormFile()</code> 可以获取前端上传的文件，参数是 <code>&lt;input /&gt;</code> 标签的 <code>name</code> 属性，通过参数可以定位到上传的任何一个文件。</p><p>获取到文件后可以保存在数据库中，或者通过 <code>gin.SaveUploadedFile()</code> 将文件保存在某个位置，只需要将文件对象 <code>f</code> 和 路径作为参数传入即可。</p><p>最后给客户端返回一条上传成功的消息。</p><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/1762924054854.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/1762924054854.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="上传文件"></p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/5500107717484.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/5500107717484.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="上传成功"></p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/5880663088309.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/5880663088309.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="成功保存"></p><h4 id="使用-Postman"><a href="#使用-Postman" class="headerlink" title="使用 Postman"></a>使用 Postman</h4><p>使用 PostMan 时需要给 Header 添加一个属性 <code>Content-Type: multipart/form-data</code></p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/3692804942610.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/3692804942610.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>然后在 Body 中的 form-data 中上传数据</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/1504988688338.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/1504988688338.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h4 id="使用-curl-命令"><a href="#使用-curl-命令" class="headerlink" title="使用 curl 命令"></a>使用 curl 命令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST http://localhost:9090/upload \</span><br><span class="line">  -F <span class="string">&quot;file=@/xx/xx/xxx.zip&quot;</span> \</span><br><span class="line">  -H <span class="string">&quot;Content-Type: multipart/form-data&quot;</span></span><br></pre></td></tr></table></figure><h2 id="多个文件上传"><a href="#多个文件上传" class="headerlink" title="多个文件上传"></a>多个文件上传</h2><h3 id="前端部分-1"><a href="#前端部分-1" class="headerlink" title="前端部分"></a>前端部分</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/upload_multi&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;files&quot;</span> <span class="attr">multiple</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;上传&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="后端部分-1"><a href="#后端部分-1" class="headerlink" title="后端部分"></a>后端部分</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    r := gin.Default()</span><br><span class="line"></span><br><span class="line">    r.POST(<span class="string">&quot;/upload&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 从请求中读取文件</span></span><br><span class="line">        form, _ := c.MultipartForm()</span><br><span class="line">        files := form.File[<span class="string">&quot;files&quot;</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 逐个保存文件</span></span><br><span class="line">        <span class="keyword">for</span> _, file := <span class="keyword">range</span> files &#123;</span><br><span class="line">            c.SaveUploadedFile(f, <span class="string">&quot;./&quot;</span>+f.Filename)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 给客户端返回上传成功的消息</span></span><br><span class="line">        c.JSON(<span class="number">200</span>, gin.H&#123;<span class="string">&quot;code&quot;</span>: <span class="number">2003</span>, <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;上传成功&quot;</span>&#125;)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    r.Run(<span class="string">&quot;:9090&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>单个文件上传和多个文件上传只有一点点区别</p><p>多个文件上传使用 <code>gin.Context.MultipartForm()</code> 来获取，该方法会返回一个 Form 结构体，结构体中map类型字段 <code>File</code> 存储了所有已上传的文件</p><p>通过遍历来逐个处理，然后给客户端返回上传成功的消息即可。</p><h2 id="上传文件大小限制"><a href="#上传文件大小限制" class="headerlink" title="上传文件大小限制"></a>上传文件大小限制</h2><p>gin 默认上传的文件大小最大为 32Mb，如果要调小或调大，可以设置 <code>gin.Engine.MaxMultipartMemory</code></p><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    r := gin.Default()</span><br><span class="line">    <span class="comment">// 为 multipart forms 设置较高的内存限制 (默认是 32 MiB)</span></span><br><span class="line">        r.MaxMultipartMemory = <span class="number">2</span> &lt;&lt; <span class="number">30</span>;    <span class="comment">// 2*2^30 byte = 2Gb</span></span><br><span class="line"></span><br><span class="line">    r.Run(<span class="string">&quot;:9090&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="下载文件"><a href="#下载文件" class="headerlink" title="下载文件"></a>下载文件</h2><p>实现下载功能要先获取文件名，然后给响应头添加一个属性 <code>Content-Disposition: attachment; filename=文件名</code></p><p>然后调用 <code>gin.Context.File()</code> 方法，传入文件路径即可。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    r := gin.Default()</span><br><span class="line">    filename := <span class="string">&quot;a.txt&quot;</span></span><br><span class="line">    r.GET(<span class="string">&quot;/download&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 获取文件名</span></span><br><span class="line">        filename := <span class="string">&quot;a.txt&quot;</span></span><br><span class="line">        <span class="comment">// 设置响应头</span></span><br><span class="line">        c.Header(<span class="string">&quot;Content-Disposition&quot;</span>, <span class="string">&quot;attachment; filename=&quot;</span>+filename)</span><br><span class="line">        <span class="comment">// 向客户端返回文件数据</span></span><br><span class="line">        c.File(<span class="string">&quot;./&quot;</span>+filename)</span><br><span class="line">    &#125;</span><br><span class="line">    r.Run(<span class="string">&quot;:9090&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/1820376192887.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/1820376192887.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>当然，还可以在响应头中添加更多信息</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    r := gin.Default()</span><br><span class="line">    filename := <span class="string">&quot;a.txt&quot;</span></span><br><span class="line">    r.GET(<span class="string">&quot;/download&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 获取文件名</span></span><br><span class="line">        filename := <span class="string">&quot;a.txt&quot;</span></span><br><span class="line">        <span class="comment">// 设置状态码</span></span><br><span class="line">        c.Writer.WriteHeader(http.StatusOK)</span><br><span class="line">        <span class="comment">// 添加内容位置声明</span></span><br><span class="line">        c.Header(<span class="string">&quot;Content-Disposition&quot;</span>, <span class="string">&quot;attachment; filename=&quot;</span>+filename)</span><br><span class="line">        <span class="comment">// 添加内容类型声明</span></span><br><span class="line">        c.Header(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/text/plain&quot;</span>)</span><br><span class="line">        <span class="comment">// 向客户端返回数据</span></span><br><span class="line">        c.File(<span class="string">&quot;./&quot;</span> + filename)</span><br><span class="line">    &#125;</span><br><span class="line">    r.Run(<span class="string">&quot;:9090&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注意！<code>c.File(path)</code> 中的参数 path 最好是绝对路径，可以使用 <code>path.Join(路径, 文件名)</code> 来得到绝对路径。<br>处理不好 path 参数容易出错。</p></blockquote><h2 id="重定向-和-转发"><a href="#重定向-和-转发" class="headerlink" title="重定向 和 转发"></a>重定向 和 转发</h2><p>重定向和转发在实际开发过程中很有必要。</p><p>比如对 API 进行升级后，一些原本的请求路径不再使用，但是为了兼容，防止一些旧版本继续请求的时候请求失败，所以需要对原本的路由做重定向或转发处理。</p><p>区别：</p><ul><li><p>重定向：用户请求一个旧的地址的时候，返回301，并告知新地址；然后用户再次请求新地址，得到正确返回。</p></li><li><p>重定向：重定向过后浏览器的URL会发生变化。</p></li><li><p>重定向：可以将请求转到别的地址，这个地址可以是外部链接，也可以是内部其他路由。</p></li><li><p>转发：用户请求一个旧地址的时候，服务端内部将请求路径修改为新地址，然后返回给用户</p></li><li><p>转发：转发过后浏览器的URL不会发生变化。</p></li><li><p>转发：只能转发到站内路由。</p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/3628459928845.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/3628459928845.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="重定向和转发"></p><h3 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c.Redirect(http.StatusMovedPermanently, <span class="string">&quot;重定向的路径&quot;</span>)</span><br></pre></td></tr></table></figure><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    r := gin.Default()</span><br><span class="line"></span><br><span class="line">    r.GET(<span class="string">&quot;/index&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        c.JSON(http.StatusOK, gin.H&#123; <span class="string">&quot;msg&quot;</span>: c.FullPath() &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重定向到站内其他路由</span></span><br><span class="line">    r.GET(<span class="string">&quot;/redirect&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        c.Redirect(http.StatusMovedPermanently, <span class="string">&quot;/index&quot;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重定向到站外链接</span></span><br><span class="line">    r.GET(<span class="string">&quot;/redirect2&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        c.Redirect(http.StatusMovedPermanently, <span class="string">&quot;https://www.boii.xyz&quot;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    r.Run(<span class="string">&quot;:9090&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/5296060724295.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/5296060724295.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="重定向到站内"></p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/3265866644390.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/3265866644390.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="重定向到站外"></p><h3 id="转发"><a href="#转发" class="headerlink" title="转发"></a>转发</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c.Request.URL.Path = <span class="string">&quot;转发的目标路径&quot;</span></span><br></pre></td></tr></table></figure><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    r := gin.Default()</span><br><span class="line"></span><br><span class="line">    r.GET(<span class="string">&quot;/index&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        c.JSON(http.StatusOK, gin.H&#123; <span class="string">&quot;msg&quot;</span>: c.FullPath() &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 转发到站内其他路由</span></span><br><span class="line">    r.GET(<span class="string">&quot;/forward&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123; <span class="comment">// URL 不会改变</span></span><br><span class="line">        c.Request.URL.Path = <span class="string">&quot;/index&quot;</span>    <span class="comment">// 修改请求的目标路径</span></span><br><span class="line">        r.HandleContext(c)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    r.Run(<span class="string">&quot;:9090&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/623353626862.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/623353626862.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="转发到站内"></p>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
          <category> Framework </category>
          
      </categories>
      
      
        <tags>
            
            <tag> gin </tag>
            
            <tag> 上传 </tag>
            
            <tag> 下载 </tag>
            
            <tag> 重定向 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gin [3-路由组]</title>
      <link href="posts/2c48000c"/>
      <url>posts/2c48000c</url>
      
        <content type="html"><![CDATA[<p>路由和路由组的创建和实现</p><span id="more"></span><h1 id="路由组"><a href="#路由组" class="headerlink" title="路由组"></a>路由组</h1><p>开发中常常会遇到一种需求：</p><p>将系统划分成多个模块，例如用户管理模块、书籍管理模块等，这些模块下各自有子模块。</p><p>在设计路由路径的时候可能就需要设置成下面的样子：</p><ul><li>/user/register</li><li>/user/login</li><li>/user/:id/info</li><li>/user/:id/setting</li><li>/book/add</li><li>/book/search/:id</li><li>/book/remove/:id</li><li>/book/modify/:id</li></ul><p>这样的设计虽然没有什么问题，但是不方便管理，如果突然对 user 或者 book 这个大的模块进行修改还导致所有子模块全部都要改动。</p><p>所以合理的使用 <strong>路由组</strong> 可以很好的解决这些问题。</p><h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.go</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    r := gin.Default()</span><br><span class="line">    <span class="comment">// 创建 /user 路由组</span></span><br><span class="line">    userG := r.Group(<span class="string">&quot;/user&quot;</span>)</span><br><span class="line">    <span class="comment">// &#123;&#125; 是书写规范</span></span><br><span class="line">    &#123;</span><br><span class="line">        userG.POST(<span class="string">&quot;/register&quot;</span>, Register)</span><br><span class="line">        userG.POST(<span class="string">&quot;/login&quot;</span>, Login)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建 /book 路由组</span></span><br><span class="line">    bookG := r.Group(<span class="string">&quot;/book&quot;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        bookG.GET(<span class="string">&quot;/search/:id&quot;</span>, SearchBook)</span><br><span class="line">        bookG.DELETE(<span class="string">&quot;/remove/:id&quot;</span>, RemoveBook)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    r.Run(<span class="string">&quot;:9090&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// routes.go</span></span><br><span class="line"><span class="keyword">type</span> UserInfo <span class="keyword">struct</span> &#123;</span><br><span class="line">    User <span class="keyword">string</span> <span class="string">`form:&quot;user&quot;`</span></span><br><span class="line">    Pass <span class="keyword">string</span> <span class="string">`form:&quot;pass&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Register</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> u UserInfo</span><br><span class="line">    c.ShouldBind(&amp;u)</span><br><span class="line">    c.JSON(http.StatusOK, gin.H&#123; <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;Hello &quot;</span> + u.User &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Login</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> u UserInfo</span><br><span class="line">    c.ShouldBind(&amp;u)</span><br><span class="line">    c.JSON(http.StatusOK, gin.H&#123; <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;Hello &quot;</span> + u.User &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SearchBook</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    bookID := c.Param(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">    c.JSON(http.StatusOK, gin.H&#123; <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;ID &quot;</span> + bookID &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">RemoveBook</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    bookID := c.Param(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">    c.JSON(http.StatusOK, gin.H&#123; <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;ID &quot;</span> + bookID + <span class="string">&quot;was removed.&quot;</span> &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>首先通过 <code>gin.Group()</code> 传入组的共同前缀，例如上面的 <code>/user</code>、<code>/book</code>，获得一个路由组对象</p><p>然后就可以像之前一样的去绑定各个子路由了。之前的 <code>GET()</code>、<code>POST()</code> 等方法同样适用。</p><p>效果：<br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/3664825137700.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/3664825137700.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/4105243857095.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/4105243857095.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h2 id="路由拆分和注册"><a href="#路由拆分和注册" class="headerlink" title="路由拆分和注册"></a>路由拆分和注册</h2>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
          <category> Framework </category>
          
      </categories>
      
      
        <tags>
            
            <tag> gin </tag>
            
            <tag> 路由 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gin [2-接收请求]</title>
      <link href="posts/d9677098"/>
      <url>posts/d9677098</url>
      
        <content type="html"><![CDATA[<p>接收请求</p><span id="more"></span><h1 id="接收请求"><a href="#接收请求" class="headerlink" title="接收请求"></a>接收请求</h1><p>作为一个服务器，最基本的任务就是接收请求，然后是返回结果。</p><p>客户端发来的请求可以有多种，如 GET、POST、PUT、DELETE。<br>最基本的就是 GET、POST 两种，不过这里还是建议遵循 RESTful 规范。</p><h2 id="基本处理：Handle"><a href="#基本处理：Handle" class="headerlink" title="基本处理：Handle()"></a>基本处理：Handle()</h2><p>gin 接收请求有一种最基本的方法，使用 <code>Handle()</code> 方法。</p><p>其方法签名如下：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(group *RouterGroup)</span> <span class="title">Handle</span><span class="params">(httpMethod, relativePath <span class="keyword">string</span>, handlers ...HandlerFunc)</span> <span class="title">IRoutes</span>;</span></span><br></pre></td></tr></table></figure><p>其接受的第一个参数为 HTTP 请求方式，第二个为路由路径，第三个为该请求对应的处理函数。</p><p>最基本的栗子，接收一个 GET 请求：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    app := gin.Default()</span><br><span class="line"></span><br><span class="line">    app.Handle(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;/hello&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">            <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;Hello!&quot;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    app.Run(<span class="string">&quot;:9090&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>第4行调用了 <code>Handle()</code>，请求方式为 GET 方法，路由路径为 <code>/hello</code>，处理方法是返回一串JSON数据。</p><p>浏览器访问 <code>http://localhost:9090/hello</code> 可得到下面的结果</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/957715546196.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/957715546196.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>接收 POST、PUT 等方式的请求**：</p><p>通过 <code>Handle()</code> 第一个参数我们可以接收不同方式的请求，例如 POST</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    r := gin.Default()</span><br><span class="line">    <span class="comment">// http://127.0.0.1:9090/login</span></span><br><span class="line">    r.Handle(<span class="string">&quot;POST&quot;</span>, <span class="string">&quot;/login&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;    <span class="comment">// 处理 POST 请求</span></span><br><span class="line">        user := c.PostForm(<span class="string">&quot;user&quot;</span>)    <span class="comment">// 获取表单参数</span></span><br><span class="line">        pass := c.PostForm(<span class="string">&quot;pass&quot;</span>)    <span class="comment">// 获取表单参数</span></span><br><span class="line">        <span class="comment">// 处理业务逻辑</span></span><br><span class="line">        <span class="keyword">if</span> user == <span class="string">&quot;Boii&quot;</span> &amp;&amp; pass == <span class="string">&quot;123&quot;</span> &#123;</span><br><span class="line">            c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">                <span class="string">&quot;code&quot;</span>: <span class="number">2001</span>,</span><br><span class="line">                <span class="string">&quot;msg&quot;</span>:  <span class="string">&quot;登录成功&quot;</span>,</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        c.YAML(http.StatusOK, gin.H&#123;</span><br><span class="line">            <span class="string">&quot;code&quot;</span>: <span class="number">4001</span>,</span><br><span class="line">            <span class="string">&quot;msg&quot;</span>:  <span class="string">&quot;登录失败&quot;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    r.Run(<span class="string">&quot;:9090&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过 Postman 可以设定表单参数然后发起请求，我们用gin写的代码就可以接收到一个 POST 请求，并进行处理。<br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/840022092674.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/840022092674.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>可以看到， Postman 中设置了两个参数 <code>user</code> 和 <code>pass</code>，向 <code>http://localhost:9090/login</code> 发清请求。</p><p>关于获取参数后面会详解。</p><h2 id="快捷方式：gin-GET-、gin-POST-…"><a href="#快捷方式：gin-GET-、gin-POST-…" class="headerlink" title="快捷方式：gin.GET()、gin.POST()…"></a>快捷方式：gin.GET()、gin.POST()…</h2><p>像 GET、POST、PUT、DELETE 等这些 HTTP方式的处理函数会很常用，所以 gin 提供了一系列方法供我们更方便的使用。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// POST is a shortcut for router.Handle(&quot;POST&quot;, path, handle).</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(group *RouterGroup)</span> <span class="title">POST</span><span class="params">(relativePath <span class="keyword">string</span>, handlers ...HandlerFunc)</span> <span class="title">IRoutes</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> group.handle(http.MethodPost, relativePath, handlers)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GET is a shortcut for router.Handle(&quot;GET&quot;, path, handle).</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(group *RouterGroup)</span> <span class="title">GET</span><span class="params">(relativePath <span class="keyword">string</span>, handlers ...HandlerFunc)</span> <span class="title">IRoutes</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> group.handle(http.MethodGet, relativePath, handlers)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// DELETE is a shortcut for router.Handle(&quot;DELETE&quot;, path, handle).</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(group *RouterGroup)</span> <span class="title">DELETE</span><span class="params">(relativePath <span class="keyword">string</span>, handlers ...HandlerFunc)</span> <span class="title">IRoutes</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> group.handle(http.MethodDelete, relativePath, handlers)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PATCH is a shortcut for router.Handle(&quot;PATCH&quot;, path, handle).</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(group *RouterGroup)</span> <span class="title">PATCH</span><span class="params">(relativePath <span class="keyword">string</span>, handlers ...HandlerFunc)</span> <span class="title">IRoutes</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> group.handle(http.MethodPatch, relativePath, handlers)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PUT is a shortcut for router.Handle(&quot;PUT&quot;, path, handle).</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(group *RouterGroup)</span> <span class="title">PUT</span><span class="params">(relativePath <span class="keyword">string</span>, handlers ...HandlerFunc)</span> <span class="title">IRoutes</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> group.handle(http.MethodPut, relativePath, handlers)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// OPTIONS is a shortcut for router.Handle(&quot;OPTIONS&quot;, path, handle).</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(group *RouterGroup)</span> <span class="title">OPTIONS</span><span class="params">(relativePath <span class="keyword">string</span>, handlers ...HandlerFunc)</span> <span class="title">IRoutes</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> group.handle(http.MethodOptions, relativePath, handlers)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// HEAD is a shortcut for router.Handle(&quot;HEAD&quot;, path, handle).</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(group *RouterGroup)</span> <span class="title">HEAD</span><span class="params">(relativePath <span class="keyword">string</span>, handlers ...HandlerFunc)</span> <span class="title">IRoutes</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> group.handle(http.MethodHead, relativePath, handlers)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过源码可以看出，gin 很贴心的做了一层封装，提供了对应请求方式的 <code>shortcut</code>，使开发者更方便的调用。<br>参数上只需要传递 <code>路由路径</code> 和 <code>处理函数</code> 即可，这些“快捷方式”会帮我们调用 <code>handle()</code>。</p><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    r := gin.Default()</span><br><span class="line">    <span class="comment">// http://127.0.0.1:9090/hello</span></span><br><span class="line">    r.GET(<span class="string">&quot;/hello&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        c.JSON(http.StatusOK, gin.H&#123; <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;Hello&quot;</span>&#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    r.Run(<span class="string">&quot;:9090&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    r := gin.Default()</span><br><span class="line">    <span class="comment">// http://127.0.0.1:9090/login</span></span><br><span class="line">    r.POST(<span class="string">&quot;/login&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        c.JSON(http.StatusOK, gin.H&#123; <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;Hello&quot;</span>&#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    r.Run(<span class="string">&quot;:9090&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="404-页面"><a href="#404-页面" class="headerlink" title="404 页面"></a>404 页面</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    r := gin.Default()</span><br><span class="line"></span><br><span class="line">    r.NoRoute(<span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        c.HTML(http.StatusNotFound, <span class="string">&quot;views/404.html&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    r.Run(<span class="string">&quot;:9090&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>不需要指定路径，只要用户访问不存在的路径，就会执行此路由。</p><h2 id="处理请求参数"><a href="#处理请求参数" class="headerlink" title="处理请求参数"></a>处理请求参数</h2><h3 id="获取-GET-请求的参数"><a href="#获取-GET-请求的参数" class="headerlink" title="获取 GET 请求的参数"></a>获取 GET 请求的参数</h3><p>GET 请求的参数会显式的携带在URL中。</p><p>可以通过 <code>gin.Context.Query()</code> 或 <code>gin.Context.DefaultQuery()</code> 两种方法获取。</p><p>他们的区别是 <code>DefaultQuery()</code> 需要填入默认值。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Context)</span> <span class="title">Query</span><span class="params">(key <span class="keyword">string</span>)</span> <span class="title">string</span>;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Context)</span> <span class="title">DefaultQuery</span><span class="params">(key, defaultValue <span class="keyword">string</span>)</span> <span class="title">string</span>;</span></span><br></pre></td></tr></table></figure><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    r := gin.Default()</span><br><span class="line"></span><br><span class="line">    r.GET(<span class="string">&quot;/hello&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        name := c.Query(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">        age := c.DefaultQuery(<span class="string">&quot;age&quot;</span>)</span><br><span class="line">        c.JSON(<span class="number">200</span>, gin.H&#123;<span class="string">&quot;msg&quot;</span>: <span class="string">&quot;Hello &quot;</span> + name + <span class="string">&quot;, you&#x27;re &quot;</span> + age&#125;)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    r.Run(<span class="string">&quot;:9090&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/2988503917018.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/2988503917018.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="age 给了值"></p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/5990713787204.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/5990713787204.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="age 没给值"></p><h3 id="获取-POST-表单参数"><a href="#获取-POST-表单参数" class="headerlink" title="获取 POST 表单参数"></a>获取 POST 表单参数</h3><p>POST 请求的参数不会显式的携带在URL中，而是包裹在请求体 Body 中，是通过表单提交的。</p><p>可以通过 <code>gin.Context.Postform()</code> 或 <code>gin.Context.DefaultPostform()</code> 两种方法获取。</p><p>同样他们的区别仅在于一个需要填入默认值。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Context)</span> <span class="title">PostForm</span><span class="params">(key <span class="keyword">string</span>)</span> <span class="title">string</span>;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Context)</span> <span class="title">DefaultPostForm</span><span class="params">(key, defaultValue <span class="keyword">string</span>)</span> <span class="title">string</span>;</span></span><br></pre></td></tr></table></figure><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    r := gin.Default()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// http://127.0.0.1:9090/login</span></span><br><span class="line">    r.POST(<span class="string">&quot;/login&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        user := c.DefaultPostForm(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;admin&quot;</span>)</span><br><span class="line">        pass := c.PostForm(<span class="string">&quot;pass&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> user == <span class="string">&quot;Boii&quot;</span> &amp;&amp; pass == <span class="string">&quot;123&quot;</span> &#123;</span><br><span class="line">            c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">                <span class="string">&quot;code&quot;</span>: <span class="number">2001</span>,</span><br><span class="line">                <span class="string">&quot;msg&quot;</span>:  <span class="string">&quot;登录成功&quot;</span>,</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        c.YAML(http.StatusOK, gin.H&#123;</span><br><span class="line">            <span class="string">&quot;code&quot;</span>: <span class="number">4001</span>,</span><br><span class="line">            <span class="string">&quot;msg&quot;</span>:  <span class="string">&quot;登录失败&quot;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    r.Run(<span class="string">&quot;:9090&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/783508891344.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/783508891344.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h3 id="处理其他格式的请求参数"><a href="#处理其他格式的请求参数" class="headerlink" title="处理其他格式的请求参数"></a>处理其他格式的请求参数</h3><p>除了URL中的参数、表单提交的参数，在客户端发起 HTTP 请求时还可以使用 JSON、XML、YAML 等格式。</p><p>获取这些格式的参数，可以通过 <code>gin.Context.Bind()</code> 来获取，</p><p>Bind() 有一系列的方法：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Context)</span> <span class="title">Bind</span><span class="params">(obj <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">error</span>;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Context)</span> <span class="title">BindJSON</span><span class="params">(obj <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">error</span>;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Context)</span> <span class="title">BindXML</span><span class="params">(obj <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">error</span>;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Context)</span> <span class="title">BindQuery</span><span class="params">(obj <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">error</span>;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Context)</span> <span class="title">BindYAML</span><span class="params">(obj <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">error</span>;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Context)</span> <span class="title">BindHeader</span><span class="params">(obj <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">error</span>;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Context)</span> <span class="title">BindUri</span><span class="params">(obj <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">error</span>;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Context)</span> <span class="title">MustBindWith</span><span class="params">(obj <span class="keyword">interface</span>&#123;&#125;, b binding.Binding)</span> <span class="title">error</span>;</span></span><br></pre></td></tr></table></figure><p>显然，要解析请求中什么类型的数据就调用什么方法，参数 <code>obj</code> 需要我们传入一个结构体变量，用于装载解析后的数据。</p><p>结构体每个字段都需要有 tag，否则会解析失败。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> UserInfo <span class="keyword">struct</span> &#123;</span><br><span class="line">    User <span class="keyword">string</span></span><br><span class="line">    Pass <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> u UserInfo</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    r := gin.Default()</span><br><span class="line"></span><br><span class="line">    r.POST(<span class="string">&quot;/login&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        c.BindJSON(&amp;u)</span><br><span class="line">        c.JSON(<span class="number">200</span>, gin.H&#123;</span><br><span class="line">            <span class="string">&quot;user&quot;</span>: u.User,</span><br><span class="line">            <span class="string">&quot;pass&quot;</span>: u.Pass,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    r.Run(<span class="string">&quot;:9090&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/320000449262.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/320000449262.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>上面的例子可以解析 HTTP 请求中通过 JSON 携带的数据。</p><h4 id="Bind"><a href="#Bind" class="headerlink" title="Bind()"></a>Bind()</h4><p>如果想根据请求中的 <code>content-type</code> 属性来选择，可以使用 <code>Bind()</code> 方法，该方法会</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// gin 源码</span></span><br><span class="line"><span class="comment">// context.go</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Bind checks the Content-Type to select a binding engine automatically,</span></span><br><span class="line"><span class="comment">// Depending the &quot;Content-Type&quot; header different bindings are used:</span></span><br><span class="line"><span class="comment">//     &quot;application/json&quot; --&gt; JSON binding</span></span><br><span class="line"><span class="comment">//     &quot;application/xml&quot;  --&gt; XML binding</span></span><br><span class="line"><span class="comment">// otherwise --&gt; returns an error.</span></span><br><span class="line"><span class="comment">// It parses the request&#x27;s body as JSON if Content-Type == &quot;application/json&quot; using JSON or XML as a JSON input.</span></span><br><span class="line"><span class="comment">// It decodes the json payload into the struct specified as a pointer.</span></span><br><span class="line"><span class="comment">// It writes a 400 error and sets Content-Type header &quot;text/plain&quot; in the response if input is not valid.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Context)</span> <span class="title">Bind</span><span class="params">(obj <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    b := binding.Default(c.Request.Method, c.ContentType())</span><br><span class="line">    <span class="keyword">return</span> c.MustBindWith(obj, b)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// gin 源码</span></span><br><span class="line"><span class="comment">// binding.go</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Default returns the appropriate Binding instance based on the HTTP method</span></span><br><span class="line"><span class="comment">// and the content type.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Default</span><span class="params">(method, contentType <span class="keyword">string</span>)</span> <span class="title">Binding</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> method == http.MethodGet &#123;</span><br><span class="line">        <span class="keyword">return</span> Form</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> contentType &#123;</span><br><span class="line">    <span class="keyword">case</span> MIMEJSON:</span><br><span class="line">        <span class="keyword">return</span> JSON</span><br><span class="line">    <span class="keyword">case</span> MIMEXML, MIMEXML2:</span><br><span class="line">        <span class="keyword">return</span> XML</span><br><span class="line">    <span class="keyword">case</span> MIMEPROTOBUF:</span><br><span class="line">        <span class="keyword">return</span> ProtoBuf</span><br><span class="line">    <span class="keyword">case</span> MIMEMSGPACK, MIMEMSGPACK2:</span><br><span class="line">        <span class="keyword">return</span> MsgPack</span><br><span class="line">    <span class="keyword">case</span> MIMEYAML:</span><br><span class="line">        <span class="keyword">return</span> YAML</span><br><span class="line">    <span class="keyword">case</span> MIMEMultipartPOSTForm:</span><br><span class="line">        <span class="keyword">return</span> FormMultipart</span><br><span class="line">    <span class="keyword">default</span>: <span class="comment">// case MIMEPOSTForm:</span></span><br><span class="line">        <span class="keyword">return</span> Form</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到，context 中的 <code>Bind()</code> 方法调用了 <code>binding.Default()</code> 方法;</p><p>在 <code>binding.Default()</code> 方法中，如果请求方式是 GET 则返回 Form，否则的话，根据请求中的 <code>content-type</code> 属性返回对应的格式。</p><p>接着会调用 <code>gin.Context.MustBindWith(obj, b) -&gt; gin.Context.ShouldBindWith(obj, b) -&gt; b.Bind()</code>；</p><p>到 <code>b.Bind()</code> 这里的时候，会根据 <code>b</code> 的类型调用各自的 <code>Bind()</code> 方法。</p><p>例如 JSON 的话会调用 <code>jsonBinding.Bind()</code> 方法，然后在里面调用 <code>decodeJSON()</code> 方法。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/638857661664.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/638857661664.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h3 id="一次解析多个参数"><a href="#一次解析多个参数" class="headerlink" title="一次解析多个参数"></a>一次解析多个参数</h3><p>上面登录的栗子中，我们简简单单的获取了两个参数，所以可以用两次 <code>Postform()</code> 方法。</p><p>但是当参数多起来的时候，这种方式并不是很好。好在 gin 还提供另外的方法方便我们一次解析多个参数。</p><p>要一次解析多个参数，我们需要一个 <strong>结构体</strong> 来装载这些参数的值，然后将结构体传给 <code>gin.Context.Bind()</code> 、 <code>gin.Context.ShouldBind()</code> 、 <code>gin.Context.ShouldBindQuery()</code> 等方法。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Context)</span> <span class="title">ShouldBind</span><span class="params">(obj <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">error</span>;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Context)</span> <span class="title">ShouldBindQuery</span><span class="params">(obj <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">error</span>;</span></span><br></pre></td></tr></table></figure><p>要注意的是，我们定义的这个结构体每个字段都需要有 tag，否则会解析失败。</p><p>例如：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    r := gin.Default()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">type</span> UserInfo <span class="keyword">struct</span> &#123;</span><br><span class="line">        User <span class="keyword">string</span> <span class="string">`form:&quot;user&quot;`</span></span><br><span class="line">        Pass <span class="keyword">string</span> <span class="string">`form:&quot;pass&quot;`</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// http://127.0.0.1:9090/login</span></span><br><span class="line">    r.POST(<span class="string">&quot;/login&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        <span class="keyword">var</span> u UserInfo</span><br><span class="line">        c.ShouldBind(&amp;u)</span><br><span class="line">        c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">            <span class="string">&quot;code&quot;</span>: <span class="number">2001</span>,</span><br><span class="line">            <span class="string">&quot;msg&quot;</span>:  <span class="string">&quot;登录成功&quot;</span>,</span><br><span class="line">            <span class="string">&quot;user&quot;</span>: u.User,</span><br><span class="line">            <span class="string">&quot;pass&quot;</span>: u.Pass,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    r.Run(<span class="string">&quot;:9090&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/5790709568721.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/5790709568721.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="><br>效果是一样的。</p><h2 id="解析路由路径中的参数"><a href="#解析路由路径中的参数" class="headerlink" title="解析路由路径中的参数"></a>解析路由路径中的参数</h2><h3 id="gin-Context-Param"><a href="#gin-Context-Param" class="headerlink" title="gin.Context.Param()"></a>gin.Context.Param()</h3><p>路由路径有时候并不固定，而是根据实际情况变化的。</p><p>例如下面的栗子，不同的用户有不同的ID，要获取这个ID，需要用到 <code>gin.Context.Param()</code> 方法，填入冒号通配符后面的变量 <code>id</code> 即可。</p><p>在使用 PUT、DELETE 等请求方法的时候是修改、删除某条记录的目的，这需要在路径中指定一个关键值（如 <code>id</code>），这里就可以用像下面这样去解析。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    r := gin.Default()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// http://127.0.0.1:9090/user/10086</span></span><br><span class="line">    r.PUT(<span class="string">&quot;/user/:id&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        userId := c.Param(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">        c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">            <span class="string">&quot;code&quot;</span>: <span class="number">2001</span>,</span><br><span class="line">            <span class="string">&quot;msg&quot;</span>:  <span class="string">&quot;ID is &quot;</span> + userId,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    r.Run(<span class="string">&quot;:9090&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/3683906512884.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/3683906512884.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h3 id="gin-Context-Params"><a href="#gin-Context-Params" class="headerlink" title="gin.Context.Params"></a>gin.Context.Params</h3><p>除了<code>Param()</code>，还可以使用 <code>Params.Get()</code>、<code>Params.ByName()</code> 去获取想要的参数。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    r := gin.Default()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// http://127.0.0.1:9090/Boii/18/1234567</span></span><br><span class="line">    r.GET(<span class="string">&quot;/params/:name/:age/:tele&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        params := c.Params</span><br><span class="line"></span><br><span class="line">        name, _ := params.Get(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">        age     := params.ByName(<span class="string">&quot;age&quot;</span>)</span><br><span class="line">        tele    := c.Param(<span class="string">&quot;tele&quot;</span>)</span><br><span class="line"></span><br><span class="line">        c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: name,</span><br><span class="line">            <span class="string">&quot;age&quot;</span>:  age,</span><br><span class="line">            <span class="string">&quot;tele&quot;</span>: tele,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    r.Run(<span class="string">&quot;:9090&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/1504620189883.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/1504620189883.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
          <category> Framework </category>
          
      </categories>
      
      
        <tags>
            
            <tag> gin </tag>
            
            <tag> request </tag>
            
            <tag> response </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gin [1-返回数据]</title>
      <link href="posts/1937010b"/>
      <url>posts/1937010b</url>
      
        <content type="html"><![CDATA[<p>Gin 返回数据格式</p><span id="more"></span><h1 id="返回"><a href="#返回" class="headerlink" title="返回"></a>返回</h1><p>在接收到请求，经过一番处理之后，我们需要返回结果，也就是响应请求。</p><p>响应请求的格式有 &gt;= 5种格式：</p><ul><li>[]byte</li><li>string</li><li>JSON</li><li>XML</li><li>YAML</li><li>protobuf</li><li>Template</li></ul><h2 id="byte-方式"><a href="#byte-方式" class="headerlink" title="[]byte 方式"></a>[]byte 方式</h2><p>返回字节切片格式时，需要使用 <code>gin.Context.Writer</code> 的 <code>Write</code> 方法，将字节切片作为参数传入即可，无需填写状态码。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    r := gin.Default()</span><br><span class="line"></span><br><span class="line">    r.GET(<span class="string">&quot;/byte&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        fullpath := <span class="string">&quot;请求路径： &quot;</span> + c.FullPath()</span><br><span class="line"></span><br><span class="line">        c.Writer.Write([]<span class="keyword">byte</span>(fullpath))</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    r.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/745417048783.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/745417048783.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="byte 的返回结果"></p><h2 id="string-方式"><a href="#string-方式" class="headerlink" title="string 方式"></a>string 方式</h2><p>使用 string 方式则方便许多，直接使用 <code>gin.Context</code> 的 <code>String</code> 方法；</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Context)</span> <span class="title">String</span><span class="params">(code <span class="keyword">int</span>, format <span class="keyword">string</span>, values ...<span class="keyword">interface</span>&#123;&#125;)</span>;</span></span><br></pre></td></tr></table></figure><p>参数含义为<code>状态码、格式字符串、值</code>。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    r := gin.Default()</span><br><span class="line"></span><br><span class="line">    r.GET(<span class="string">&quot;/byte&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        fullpath := <span class="string">&quot;请求路径： &quot;</span> + c.FullPath()</span><br><span class="line"></span><br><span class="line">        c.String(<span class="number">200</span>, <span class="string">&quot;请求路径: %s&quot;</span>, c.FullPath())</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    r.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/1050203606306.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/1050203606306.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="string 返回结果"></p><h2 id="JSON-格式"><a href="#JSON-格式" class="headerlink" title="JSON 格式"></a>JSON 格式</h2><p>最常用的就是返回 JSON 格式，方法时使用 <code>gin.Context</code> 的 <code>JSON</code> 方法：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Context)</span> <span class="title">JSON</span><span class="params">(code <span class="keyword">int</span>, obj <span class="keyword">interface</span>&#123;&#125;)</span>;</span></span><br></pre></td></tr></table></figure><p>参数含义为 <code>状态码、数据</code></p><p>返回的数据可以用 <code>map[string]interface&#123;&#125;</code> 来装载，而 gin 贴心的为这个类型做了定义 <code>gin.H</code>。<br>可以直接使用 <code>gin.H</code>，这样就不用写长长一串了。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    r := gin.Default()</span><br><span class="line"></span><br><span class="line">    r.GET(<span class="string">&quot;/json1&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 方法1 使用 map[string]interface&#123;&#125;，即 gin.H</span></span><br><span class="line">        data := gin.H&#123;</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Boii&quot;</span>,</span><br><span class="line">            <span class="string">&quot;age&quot;</span>:  <span class="number">17</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        c.JSON(http.StatusOK, data)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    r.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>除了 <code>gin.H</code>，我们还可以使用结构体来装载我们的数据。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    r := gin.Default()</span><br><span class="line"></span><br><span class="line">    r.GET(<span class="string">&quot;/json2&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 方法2 使用结构体</span></span><br><span class="line">        data := <span class="keyword">struct</span> &#123;</span><br><span class="line">            Name <span class="keyword">string</span> <span class="string">`json:&quot;name&quot;`</span></span><br><span class="line">            Age  <span class="keyword">int</span>    <span class="string">`json:&quot;age&quot;`</span></span><br><span class="line">        &#125;&#123;<span class="string">&quot;Boii&quot;</span>, <span class="number">18</span>&#125;</span><br><span class="line">        c.JSON(http.StatusOK, data)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    r.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/872328395398.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/872328395398.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Json 结果"></p><h2 id="YAML-格式"><a href="#YAML-格式" class="headerlink" title="YAML 格式"></a>YAML 格式</h2><p>yaml 也是一种很好用的格式，近年来也开始逐渐兴起</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Context)</span> <span class="title">YAML</span><span class="params">(code <span class="keyword">int</span>, obj <span class="keyword">interface</span>&#123;&#125;)</span>;</span></span><br></pre></td></tr></table></figure><p>参数含义为 <code>状态码、数据</code>，基本和JSON是一样的，数据可以使用 <code>gin.H</code> 也可以使用结构体。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    r := gin.Default()</span><br><span class="line"></span><br><span class="line">    r.GET(<span class="string">&quot;/json1&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 方法1 使用 map[string]interface&#123;&#125;，即 gin.H</span></span><br><span class="line">        data := gin.H&#123;</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Boii&quot;</span>,</span><br><span class="line">            <span class="string">&quot;age&quot;</span>:  <span class="number">17</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        c.YAML(http.StatusOK, data)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    r.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>除了 <code>gin.H</code>，我们还可以使用结构体来装载我们的数据。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    r := gin.Default()</span><br><span class="line"></span><br><span class="line">    r.GET(<span class="string">&quot;/json2&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 方法2 使用结构体</span></span><br><span class="line">        data := <span class="keyword">struct</span> &#123;</span><br><span class="line">            Name <span class="keyword">string</span> <span class="string">`json:&quot;name&quot;`</span></span><br><span class="line">            Age  <span class="keyword">int</span>    <span class="string">`json:&quot;age&quot;`</span></span><br><span class="line">        &#125;&#123;<span class="string">&quot;Boii&quot;</span>, <span class="number">18</span>&#125;</span><br><span class="line">        c.YAML(http.StatusOK, data)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    r.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/4617055721149.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/4617055721149.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="yaml 结果"></p><h2 id="XML-格式"><a href="#XML-格式" class="headerlink" title="XML 格式"></a>XML 格式</h2><p>还有一种也是很常用的格式是 XML，但是这种只能使用 <code>gin.H</code>，不能使用结构体装载数据。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Context)</span> <span class="title">XML</span><span class="params">(code <span class="keyword">int</span>, obj <span class="keyword">interface</span>&#123;&#125;)</span>;</span></span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    r := gin.Default()</span><br><span class="line"></span><br><span class="line">    r.GET(<span class="string">&quot;/xml&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        data := gin.H&#123;</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Boii&quot;</span>,</span><br><span class="line">            <span class="string">&quot;age&quot;</span>: <span class="number">18</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        c.XML(http.StatusOK, data)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    r.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/5324325669553.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/vx_images/5324325669553.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="XML 结果"></p>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
          <category> Framework </category>
          
      </categories>
      
      
        <tags>
            
            <tag> YAML </tag>
            
            <tag> gin </tag>
            
            <tag> Json </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Golang [进阶] 19-reflect</title>
      <link href="posts/c8c5007f"/>
      <url>posts/c8c5007f</url>
      
        <content type="html"><![CDATA[<p>反射的操作</p><span id="more"></span><h1 id="2-reflect"><a href="#2-reflect" class="headerlink" title="2-reflect"></a>2-reflect</h1><blockquote><p>官方Doc中<strong>Rob Pike</strong>定义：<br>Reflection in computing is the ability of a program to examine its own structure, particularly through types; it’s a form of metaprogramming. It’s also a great source of confusion.</p><p>在计算机领域，反射是一种让程序——主要是通过类型——理解其自身结构的一种能力。它是元编程的组成之一，同时它也是一大引人困惑的难题。</p></blockquote><blockquote><p><strong>维基百科</strong>定义：<br>在计算机科学中，反射是指计算机程序在运行时（Run time）可以访问、检测和修改它本身状态或行为的一种能力。用比喻来说，反射就是程序在运行的时候能够“观察”并且修改自己的行为。</p></blockquote><blockquote><p><strong>《Go 语言圣经》</strong>中这样定义：<br>Go 语言提供了一种机制在运行时更新变量和检查它们的值、调用它们的方法，但是在编译时并不知道这些变量的具体类型，这称为反射机制。</p></blockquote><ul><li>反射应用场景<ol><li>由于没约定好，或者传入的类型很多、这些类型不能统一表示，导致不确定函数参数类型，就需要用反射来确定类型。</li><li>需要根据某些条件，如用户的输入，来决定调用哪个函数，则需要在运行期动态地执行函数。</li></ol></li><li>不建议用反射的理由<ol><li>反射代码难以阅读，降低代码可读性。</li><li>静态语言的优势之一在于编译期就能发现一些类型错误，而反射这种运行期的怪物会导致这一优势的失去。包含反射的代码很可能运行很久，才会出错，而且经常是直接 <code>panic</code>，造成严重后果。</li><li>反射对性能影响较大，相比正常代码慢出一两个数量级。</li></ol></li></ul><h2 id="相关基础"><a href="#相关基础" class="headerlink" title="相关基础"></a>相关基础</h2><h3 id="Golang-的类型"><a href="#Golang-的类型" class="headerlink" title="Golang 的类型"></a>Golang 的类型</h3><p>Golang 的类型：</p><ul><li>变量包括<code>（type，value）</code>两部分</li><li><em>type</em> 包括 <em>static type</em> 和 <em>concrete type</em>。<ul><li><em>static type</em> 就是在编码时看得见的类型，如：int、string</li><li><em>concrete type</em> 是 runtime 系统看得见的类型。</li></ul></li><li>类型能否断言成功，取决于变量的 <em>concrete type</em>。因此，一个 reader 变量如果它的 <em>concrete type</em> 实现了 write 方法，reader 也可以被断言为 writer。</li></ul><h3 id="静态类型和动态类型"><a href="#静态类型和动态类型" class="headerlink" title="静态类型和动态类型"></a>静态类型和动态类型</h3><p>在反射的概念中，编译时就知道的变量类型叫<strong>静态类型</strong>，运行时才知道的变量类型叫<strong>动态类型</strong>。</p><ul><li><p>静态类型：变量声明时赋予的类型。</p>  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Myint <span class="keyword">int</span>    <span class="comment">// int 就是静态类型，type 是 static type</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> A <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name <span class="keyword">string</span>   <span class="comment">// string 就是静态类型，type 是 static type</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> i *<span class="keyword">int</span>        <span class="comment">// *int 就是静态类型，type 是 static type</span></span><br></pre></td></tr></table></figure></li><li><p>动态类型：运行时给这个变量赋值时，这个值的类型。如果值为 <code>nil</code> 则没有动态类型。<br>  一个变量的动态类型在运行时可能改变，则主要依赖于它的赋值，前提是这个变量是接口类型。</p>  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> A <span class="keyword">interface</span>&#123;&#125;    <span class="comment">// 静态类型 interface&#123;&#125;</span></span><br><span class="line">A = <span class="number">10</span>               <span class="comment">// 静态类型 interface&#123;&#125;    动态类型 int</span></span><br><span class="line">A = <span class="string">&quot;String&quot;</span>         <span class="comment">// 静态类型 interface&#123;&#125;    动态类型 string</span></span><br><span class="line"><span class="keyword">var</span> M *<span class="keyword">int</span></span><br><span class="line">A = M                <span class="comment">// 静态类型 interface&#123;&#125;    动态类型 *int</span></span><br></pre></td></tr></table></figure></li></ul><div class="note info"><p>Golang 的反射就是建立在类型之上的。<br>Golang 变量的指定类型是静态的，在创建变量的时候类型就已经确定，如指定 <code>int、string</code>，所以称之为 <em>static type</em>。<br>Golang 变量的指定类型是 interface 类型相关的，则类型在运行期才能确定，所以称之为 <em>concrete type</em>。</p><p>只有 interface 类型才有反射一说。</p></div><h3 id="interface-类型"><a href="#interface-类型" class="headerlink" title="interface 类型"></a>interface 类型</h3><p>Golang 是通过接口实现的，任何 <strong>接口值</strong> 都是由一个 <strong>实际类型</strong> 和 <strong>实际类型的值</strong> 两个部分组成的。</p><p>每个 interface 变量都有一个对应的 <em>pair</em>，<em>pair</em> 中记录了 type 的类型和值：</p><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">pair</span> -&gt; (concrete <span class="keyword">type</span>, value)</span><br></pre></td></tr></table></figure><p><code>concrete type</code> 是实际变量的类型，<code>concrete value</code> 是实际变量的值。<br>一个 interface 变量包含了 2 个指针，一个指向实际值的类型，一个指向实际值。</p><ul><li><p>eg：打开文件会返回一个 <code>*os.File</code> 变量。</p>  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">f, err := os.OpenFile(<span class="string">&quot;/home/abc.txt&quot;</span>, os.O_RDWR, <span class="number">0777</span>)</span><br><span class="line"><span class="keyword">var</span> r io.Reader = f</span><br></pre></td></tr></table></figure><p>  接口变量 r 的 <em>pair</em> 信息记录如下：<code>(f, *os.File)</code>。</p><p>  <em>pair</em> 在接口变量管道连续赋值过程中是不变的，将接口变量 r 赋值给另一个接口变量 w，他们的 <em>pair</em> 是相同的。</p>  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> w io.Writer = r.(io.Writer)</span><br></pre></td></tr></table></figure><p>  接口变量 w 的 <em>pair</em> 信息记录如下：<code>(f, *os.File)</code>。即使 w 是空接口类型， pair 也是不变的。</p></li></ul><div class="note info"><p>interface及其pair的存在，是Golang中实现反射的前提，理解了pair，就更容易理解反射。<br>反射就是用来检测存储在接口变量内部<code>(类型concrete type, 值value)</code> pair对的一种机制。</p></div><h2 id="反射的使用"><a href="#反射的使用" class="headerlink" title="反射的使用"></a>反射的使用</h2><ul><li>reflect包提供了几个重要类型和函数：<ul><li><strong>reflect.Type接口</strong>表示接口值的”具体类型”；<code>reflect.TypeOf()</code>函数返回类型的名称，也就是 <em>pair</em> 中的 type</li><li><strong>reflect.Value结构</strong>表示接口值的”具体类型的值”；<code>reflect.ValueOf()</code>函数返回具体类型的值，也就是 <em>pair</em> 中的 value</li></ul></li></ul><ol><li>先有一个接口类型的变量</li><li>把接口变量转化成 <code>reflect</code> 对象（<code>reflect.Type</code> 或 <code>reflect.Value</code>）</li><li>根据不同情况调用不同的函数</li></ol><p>最简单的基本使用：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;reflect&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> x <span class="keyword">float64</span> = <span class="number">1.23</span></span><br><span class="line"></span><br><span class="line">    t := reflect.TypeOf(x)<span class="comment">/* 实例到type */</span></span><br><span class="line">    v := reflect.ValueOf(x)<span class="comment">/* 实例到value */</span></span><br><span class="line">    fmt.Println(t)         <span class="comment">// float64</span></span><br><span class="line">    fmt.Println(v)         <span class="comment">// 1.23</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="reflect-Type"><a href="#reflect-Type" class="headerlink" title="reflect.Type"></a>reflect.Type</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Type <span class="keyword">interface</span> &#123;</span><br><span class="line">    <span class="comment">// Kind返回该接口的具体分类</span></span><br><span class="line">    Kind() Kind</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Name返回该类型在自身包内的类型名，如果是未命名类型会返回&quot;&quot;</span></span><br><span class="line">    Name() <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// PkgPath返回类型的包路径，即明确指定包的import路径，如&quot;encoding/base64&quot;</span></span><br><span class="line">    <span class="comment">// 如果类型为内建类型(string, error)或未命名类型(*T, struct&#123;&#125;, []int)，会返回&quot;&quot;</span></span><br><span class="line">    PkgPath() <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回类型的字符串表示。该字符串可能会使用短包名（如用base64代替&quot;encoding/base64&quot;）</span></span><br><span class="line">    <span class="comment">// 也不保证每个类型的字符串表示不同。如果要比较两个类型是否相等，请直接用Type类型比较。</span></span><br><span class="line">    String() <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回要保存一个该类型的值需要多少字节；类似unsafe.Sizeof</span></span><br><span class="line">    Size() <span class="keyword">uintptr</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回当从内存中申请一个该类型值时，会对齐的字节数</span></span><br><span class="line">    Align() <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回当该类型作为结构体的字段时，会对齐的字节数</span></span><br><span class="line">    FieldAlign() <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 判断相关 */</span></span><br><span class="line">    <span class="comment">// 如果该类型实现了u代表的接口，会返回真</span></span><br><span class="line">    Implements(u Type) <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果该类型的值可以直接赋值给u代表的类型，返回真</span></span><br><span class="line">    AssignableTo(u Type) <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如该类型的值可以转换为u代表的类型，返回真</span></span><br><span class="line">    ConvertibleTo(u Type) <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 类型相关 */</span></span><br><span class="line">    <span class="comment">// 返回该类型的字位数。如果该类型的Kind不是Int、Uint、Float或Complex，会panic</span></span><br><span class="line">    Bits() <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回array类型的长度，如非数组类型将panic</span></span><br><span class="line">    Len() <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回该类型的元素类型，如果该类型的Kind不是Array、Chan、Map、Ptr或Slice，会panic</span></span><br><span class="line">    Elem() Type</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回map类型的键的类型。如非映射类型将panic</span></span><br><span class="line">    Key() Type</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回一个channel类型的方向，如非通道类型将会panic</span></span><br><span class="line">    ChanDir() ChanDir</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 结构体相关 */</span></span><br><span class="line">    <span class="comment">// 返回struct类型的字段数（匿名字段算作一个字段），如非结构体类型将panic</span></span><br><span class="line">    NumField() <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回struct类型的第i个字段的类型，如非结构体或者i不在[0, NumField())内将会panic</span></span><br><span class="line">    Field(i <span class="keyword">int</span>) StructField</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回索引序列指定的嵌套字段的类型，</span></span><br><span class="line">    <span class="comment">// 等价于用索引中每个值链式调用本方法，如非结构体将会panic</span></span><br><span class="line">    FieldByIndex(index []<span class="keyword">int</span>) StructField</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回该类型名为name的字段（会查找匿名字段及其子字段），</span></span><br><span class="line">    <span class="comment">// 布尔值说明是否找到，如非结构体将panic</span></span><br><span class="line">    FieldByName(name <span class="keyword">string</span>) (StructField, <span class="keyword">bool</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回该类型第一个字段名满足函数match的字段，布尔值说明是否找到，如非结构体将会panic</span></span><br><span class="line">    FieldByNameFunc(match <span class="function"><span class="keyword">func</span><span class="params">(<span class="keyword">string</span>)</span> <span class="title">bool</span>) <span class="params">(StructField, <span class="keyword">bool</span>)</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回该类型的方法public方法的数目</span></span><br><span class="line">    <span class="comment">// 匿名字段的方法会被计算；主体类型的方法会屏蔽匿名字段的同名方法；</span></span><br><span class="line">    <span class="comment">// 匿名字段导致的歧义方法会滤除</span></span><br><span class="line">    NumMethod() <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回该类型方法集中的第i个方法，i不在[0, NumMethod())范围内时，将导致panic</span></span><br><span class="line">    <span class="comment">// 对非接口类型T或*T，返回值的Type字段和Func字段描述方法的未绑定函数状态</span></span><br><span class="line">    <span class="comment">// 对接口类型，返回值的Type字段描述方法的签名，Func字段为nil</span></span><br><span class="line">    Method(<span class="keyword">int</span>) Method</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据方法名返回该类型方法集中的方法，使用一个布尔值说明是否发现该方法</span></span><br><span class="line">    <span class="comment">// 对非接口类型T或*T，返回值的Type字段和Func字段描述方法的未绑定函数状态</span></span><br><span class="line">    <span class="comment">// 对接口类型，返回值的Type字段描述方法的签名，Func字段为nil</span></span><br><span class="line">    MethodByName(<span class="keyword">string</span>) (Method, <span class="keyword">bool</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 函数相关 */</span></span><br><span class="line">    <span class="comment">// 如果函数类型的最后一个输入参数是&quot;...&quot;形式的参数，IsVariadic返回真</span></span><br><span class="line">    <span class="comment">// 如果这样，t.In(t.NumIn() - 1)返回参数的隐式的实际类型（声明类型的切片）</span></span><br><span class="line">    <span class="comment">// 如非函数类型将panic</span></span><br><span class="line">    IsVariadic() <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回func类型的参数个数，如果不是函数，将会panic</span></span><br><span class="line">    NumIn() <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回func类型的返回值个数，如果不是函数，将会panic</span></span><br><span class="line">    NumOut() <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回func类型的第i个参数的类型，如非函数或者i不在[0, NumIn())内将会panic</span></span><br><span class="line">    In(i <span class="keyword">int</span>) Type</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回func类型的第i个返回值的类型，如非函数或者i不在[0, NumOut())内将会panic</span></span><br><span class="line">    Out(i <span class="keyword">int</span>) Type</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Kind</strong> 有 <code>slice、map、ptr、struct、interface、string、Array、Funtcion、int</code> 或其他基本类型组成。<br><strong>Kind</strong> 和 <strong>Type</strong> 之间要做好区分。</p><p>如：在 <code>main()</code> 中定义 <code>type Person struct &#123;&#125;</code>，那么 <strong>Kind</strong> 就是 <code>struct</code>，<strong>Type</strong> 就是 <code>main.Person</code>。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">    name <span class="keyword">string</span></span><br><span class="line">    age  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    pers := person&#123;<span class="string">&quot;Boii&quot;</span>, <span class="number">18</span>&#125;</span><br><span class="line">    t := reflect.TypeOf(pers)</span><br><span class="line">    v := reflect.ValueOf(pers)</span><br><span class="line">    fmt.Println(v)             <span class="comment">// &#123;Boii 18&#125;</span></span><br><span class="line">    fmt.Println(t)             <span class="comment">// main.person</span></span><br><span class="line">    fmt.Println(t.Name())      <span class="comment">// person</span></span><br><span class="line">    fmt.Println(t.Kind())      <span class="comment">// struct</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="reflect-Value"><a href="#reflect-Value" class="headerlink" title="reflect.Value"></a>reflect.Value</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类型相关</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">Addr</span><span class="params">()</span> <span class="title">Value</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">Bool</span><span class="params">()</span> <span class="title">bool</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">Bytes</span><span class="params">()</span> []<span class="title">byte</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">Complex</span><span class="params">()</span> <span class="title">complex128</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">Int</span><span class="params">()</span> <span class="title">int64</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">Slice</span><span class="params">(i, j <span class="keyword">int</span>)</span> <span class="title">Value</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">Slice3</span><span class="params">(i, j, k <span class="keyword">int</span>)</span> <span class="title">Value</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">String</span><span class="params">()</span> <span class="title">string</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">Uint</span><span class="params">()</span> <span class="title">uint64</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">Pointer</span><span class="params">()</span> <span class="title">uintptr</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">UnsafeAddr</span><span class="params">()</span> <span class="title">uintptr</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">Kind</span><span class="params">()</span> <span class="title">Kind</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">Type</span><span class="params">()</span> <span class="title">Type</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">InterfaceData</span><span class="params">()</span> [2]<span class="title">uintptr</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数相关</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">Call</span><span class="params">(in []Value)</span> []<span class="title">Value</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">CallSlice</span><span class="params">(in []Value)</span> []<span class="title">Value</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断相关</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">CanAddr</span><span class="params">()</span> <span class="title">bool</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">CanInterface</span><span class="params">()</span> <span class="title">bool</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">CanSet</span><span class="params">()</span> <span class="title">bool</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">IsNil</span><span class="params">()</span> <span class="title">bool</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">IsValid</span><span class="params">()</span> <span class="title">bool</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">IsZero</span><span class="params">()</span> <span class="title">bool</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">OverflowComplex</span><span class="params">(x <span class="keyword">complex128</span>)</span> <span class="title">bool</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">OverflowFloat</span><span class="params">(x <span class="keyword">float64</span>)</span> <span class="title">bool</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">OverflowInt</span><span class="params">(x <span class="keyword">int64</span>)</span> <span class="title">bool</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">OverflowUint</span><span class="params">(x <span class="keyword">uint64</span>)</span> <span class="title">bool</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 转换相关</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">Convert</span><span class="params">(t Type)</span> <span class="title">Value</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">Interface</span><span class="params">()</span> <span class="params">(i <span class="keyword">interface</span>&#123;&#125;)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">Elem</span><span class="params">()</span> <span class="title">Value</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// struct 相关</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">NumField</span><span class="params">()</span> <span class="title">int</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">NumMethod</span><span class="params">()</span> <span class="title">int</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">Field</span><span class="params">(i <span class="keyword">int</span>)</span> <span class="title">Value</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">FieldByIndex</span><span class="params">(index []<span class="keyword">int</span>)</span> <span class="title">Value</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">FieldByName</span><span class="params">(name <span class="keyword">string</span>)</span> <span class="title">Value</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">FieldByNameFunc</span><span class="params">(match <span class="keyword">func</span>(<span class="keyword">string</span>)</span> <span class="title">bool</span>) <span class="title">Value</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">Method</span><span class="params">(i <span class="keyword">int</span>)</span> <span class="title">Value</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">MethodByName</span><span class="params">(name <span class="keyword">string</span>)</span> <span class="title">Value</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Array、Slice 相关</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">Index</span><span class="params">(i <span class="keyword">int</span>)</span> <span class="title">Value</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Map 相关</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">MapIndex</span><span class="params">(key Value)</span> <span class="title">Value</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">MapKeys</span><span class="params">()</span> []<span class="title">Value</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">MapRange</span><span class="params">()</span> *<span class="title">MapIter</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Array、Slice、Map 相关</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">Cap</span><span class="params">()</span> <span class="title">int</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">Len</span><span class="params">()</span> <span class="title">int</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 通道相关</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">Recv</span><span class="params">()</span> <span class="params">(x Value, ok <span class="keyword">bool</span>)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">Send</span><span class="params">(x Value)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">TryRecv</span><span class="params">()</span> <span class="params">(x Value, ok <span class="keyword">bool</span>)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">TrySend</span><span class="params">(x Value)</span> <span class="title">bool</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">Close</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 改值相关</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">Set</span><span class="params">(x Value)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">SetBool</span><span class="params">(x <span class="keyword">bool</span>)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">SetBytes</span><span class="params">(x []<span class="keyword">byte</span>)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">SetCap</span><span class="params">(n <span class="keyword">int</span>)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">SetComplex</span><span class="params">(x <span class="keyword">complex128</span>)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">SetFloat</span><span class="params">(x <span class="keyword">float64</span>)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">SetInt</span><span class="params">(x <span class="keyword">int64</span>)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">SetLen</span><span class="params">(n <span class="keyword">int</span>)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">SetMapIndex</span><span class="params">(key, elem Value)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">SetPointer</span><span class="params">(x unsafe.Pointer)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">SetString</span><span class="params">(x <span class="keyword">string</span>)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">SetUint</span><span class="params">(x <span class="keyword">uint64</span>)</span></span></span><br></pre></td></tr></table></figure><p><code>reflect</code>中的结构体主要包括：<em>Type，Value，ChanDir，Kind，MapIter，Method，SelectCase，SelectDir，SliceHeader，StringHeader，StructField，StructTag，ValueError</em> 等。其中，Type 和 Value 之前已经介绍过了。</p><ul><li><code>ChanDir</code>：管道的方向，有三个值：<strong>RecvDir / SendDir / BothDir</strong>，分别为 <strong>接受，发送，双向</strong>；</li><li><code>Kind</code>：Type中的类型信息，包括：Invalid, Bool, Int, Int8, Int16, Int32, Int64, Uint, Uint8, Uint16, Uint32, Uint64, Uintptr, Float32, Float64, Complex64, Complex128, Array, Chan, Func, Interface, Map, Ptr, Slice, String, Struct, UnsafePointer，</li><li><code>MapIter</code>：Map的迭代器，包括三个方法：<strong>Key、Value、Next</strong>；</li><li><code>Method</code>：描述方法的信息，包括：<strong>方法名，包路径，类型，函数，所处的下标</strong>；</li><li><code>SelectCase</code>：描述select 操作的信息，<strong>case的方向SelectDir，使用的Channel，发送的值Send</strong>；</li><li><code>SelectDir</code>：描述SelectCase中的方向，有三个值：<strong>SelectSend / SelectRecv / SelectDefault</strong></li><li><code>SliceHeader</code>：描述切片Slice的信息，包括<strong>指针，长度，容量</strong>；</li><li><code>StringHeader</code>：描述字符串string的信息，包括<strong>指针，长度</strong>；</li><li><code>StructField</code>：描述结构体中的域field中的信息，包括：<strong>域名，包路径，类型，标签Tag，在结构体中的偏移量offset，Type.FieldByIndex中的下标index，是否是匿名</strong>；</li><li><code>StructTag</code>：描述标签信息，有两个方法：<strong>Get、Lookup</strong>；</li><li><code>ValueError</code>：在调用一个Value不支持的方法时会报错，并记录到ValueError中。</li></ul><h2 id="反射API"><a href="#反射API" class="headerlink" title="反射API"></a>反射API</h2><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20210213215422285_5740.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20210213215422285_5740.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>上图很好的概括了 所有的API</p><p><code>Type</code> 表示 <code>reflect</code> 的 <code>Type</code> 类型： <code>reflect.Type</code><br><code>Value</code> 表示 <code>reflect</code> 的 <code>Value</code> 类型： <code>reflect.Value</code><br><code>interface&#123;&#125;</code> 表示接口实例、任意类型<br><code>Special Type</code> 表示其他特殊类型</p><ul><li><strong>Type -&gt; Value</strong>：通过 <code>reflect</code> 包的静态方法 <code>New()、NewAt()、Zero()</code></li><li><strong>Value -&gt; Type</strong>：通过 <code>reflect对象</code>的 <code>Type()</code> 方法</li><li><strong>interface{} -&gt; Type</strong>：通过 <code>reflect</code> 包的静态方法 <code>TypeOf()</code></li><li><strong>interface{} -&gt; Value</strong>：通过 <code>reflect</code> 包的静态方法 <code>ValueOf()</code></li><li>**Value -&gt; interface{}**：通过  <code>reflect对象</code>的 <code>Interface()</code> 方法，得到是一个静态类型</li></ul><h3 id="从-接口实例-获取-Type"><a href="#从-接口实例-获取-Type" class="headerlink" title="从 接口实例 获取 Type"></a>从 接口实例 获取 Type</h3><div class="note info"><p><strong>interface{} -&gt; Type</strong>：通过 <code>reflect</code> 包的静态方法 <code>TypeOf()</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TypeOf</span><span class="params">(i <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">Type</span></span></span><br></pre></td></tr></table></figure></div><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x <span class="keyword">int</span> = <span class="number">10</span></span><br><span class="line">t := reflect.TypeOf(x)</span><br><span class="line"></span><br><span class="line">fmt.Printf(<span class="string">&quot;t的值：%v   \n&quot;</span>, t)    <span class="comment">// int</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;t的类型：%T \n&quot;</span>, t)    <span class="comment">// *reflect.rtype</span></span><br></pre></td></tr></table></figure><h3 id="从-接口实例-获取-Value"><a href="#从-接口实例-获取-Value" class="headerlink" title="从 接口实例 获取 Value"></a>从 接口实例 获取 Value</h3><div class="note info"><p><strong>interface{} -&gt; Value</strong>：通过 <code>reflect</code> 包的静态方法 <code>ValueOf()</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ValueOf</span><span class="params">(i <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">Value</span></span></span><br></pre></td></tr></table></figure></div><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x <span class="keyword">int</span> = <span class="number">10</span></span><br><span class="line">v := reflect.ValueOf(x)</span><br><span class="line"></span><br><span class="line">fmt.Printf(<span class="string">&quot;t的值：%v \n&quot;</span>, v)<span class="comment">// 10</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;t的类型：%T \n&quot;</span>, v)  <span class="comment">// reflect.Value</span></span><br></pre></td></tr></table></figure><h3 id="从-Type-获取-Value"><a href="#从-Type-获取-Value" class="headerlink" title="从 Type 获取 Value"></a>从 Type 获取 Value</h3><div class="note info"><p><strong>Type -&gt; Value</strong>：通过 <code>reflect</code> 包的静态方法 <code>New()、NewAt()、Zero()</code></p><p>Type 里面只有类型信息，所以直接从一个 Type 接口变量里面是无法获得实例的 Value 的，但可以通过该 Type 构建一个新实例的 Value。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//New 返回的是一个 Value，该 Value 的 type 为 PtrTo(typ)，即 Value 的 Type 是指定 typ 的指针类型</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">New</span><span class="params">(typ Type)</span> <span class="title">Value</span></span></span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Zero 返回的是一个 typ 类型的零佳，注意返回的 Value 不能寻址，位不可改变</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Zero</span><span class="params">(typ Type)</span> <span class="title">Value</span></span></span><br></pre></td></tr></table></figure><p>如果知道一个类型值的底层存放地址，则还有一个函数是可以依据 type 和该地址值恢复出 Value 的：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewAt</span><span class="params">(typ Type, p unsafe.Pointer)</span> <span class="title">Value</span></span></span><br></pre></td></tr></table></figure></div><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x <span class="keyword">int</span> = <span class="number">10</span></span><br><span class="line">t := reflect.TypeOf(x)</span><br><span class="line">newX := reflect.New(t)     <span class="comment">// Type -&gt; Value</span></span><br><span class="line">zeroX := reflect.Zero(t)   <span class="comment">// Type -&gt; Value</span></span><br><span class="line"></span><br><span class="line">fmt.Println(newX)          <span class="comment">// 0xc000012090</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;%v \n&quot;</span>, newX)  <span class="comment">// 0xc000012090</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;%T \n&quot;</span>, newX)  <span class="comment">// reflect.Value</span></span><br><span class="line"></span><br><span class="line">fmt.Println(zeroX)         <span class="comment">// 0</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;%v \n&quot;</span>, zeroX) <span class="comment">// 0</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;%T \n&quot;</span>, zeroX) <span class="comment">// reflect.Value</span></span><br></pre></td></tr></table></figure><h3 id="从-Value-获取-Type"><a href="#从-Value-获取-Type" class="headerlink" title="从 Value 获取 Type"></a>从 Value 获取 Type</h3><div class="note info"><p><strong>Value -&gt; Type</strong>：通过 <code>reflect对象</code>的 <code>Type()</code> 方法</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">Type</span><span class="params">()</span> <span class="title">Type</span></span></span><br></pre></td></tr></table></figure></div><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x <span class="keyword">int</span> = <span class="number">10</span></span><br><span class="line">v := reflect.ValueOf(x)</span><br><span class="line"></span><br><span class="line">t := v.Type()                     <span class="comment">// value -&gt; type</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;t的值：%v   \n&quot;</span>, t)    <span class="comment">// int</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;t的类型：%T \n&quot;</span>, t)    <span class="comment">// *reflect.rtype</span></span><br></pre></td></tr></table></figure><h3 id="从-Value-获取-接口实例"><a href="#从-Value-获取-接口实例" class="headerlink" title="从 Value 获取 接口实例"></a>从 Value 获取 接口实例</h3><div class="note info"><p>**Value -&gt; interface{}**：通过  <code>reflect对象</code>的 <code>Interface()</code> 方法，得到是一个静态类型</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//该方法最通用，用来将 Value 转换为空接口，该空接口内部存放具体类型实例</span></span><br><span class="line"><span class="comment">//可以使用接口类型查询去还原为具体的类型</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">Interface</span><span class="params">()</span> （<span class="title">i</span> <span class="title">interface</span></span>&#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//Value 自身也提供丰富的方法，直接将 Value 转换为简单类型实例，如果类型不匹配，则直接引起 panic</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">Bool</span> <span class="params">()</span> <span class="title">bool</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">Float</span><span class="params">()</span> <span class="title">float64</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">Int</span><span class="params">()</span> <span class="title">int64</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">Uint</span><span class="params">()</span> <span class="title">uint64</span></span></span><br></pre></td></tr></table></figure></div><p>eg1：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x <span class="keyword">int</span> = <span class="number">10</span></span><br><span class="line">v := reflect.ValueOf(x)</span><br><span class="line"></span><br><span class="line">iInt := v.Interface()</span><br><span class="line">vType := iInt.(<span class="keyword">int</span>)</span><br><span class="line">vInt := v.Int()</span><br><span class="line"></span><br><span class="line">fmt.Println(iInt)            <span class="comment">// 10</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;%T \n&quot;</span>, iInt)    <span class="comment">// int</span></span><br><span class="line">fmt.Println(vType)           <span class="comment">// 10</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;%T \n&quot;</span>, vType)   <span class="comment">// int</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fmt.Println(vInt)            <span class="comment">// 10</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;%T \n&quot;</span>, vInt)    <span class="comment">// int64</span></span><br></pre></td></tr></table></figure><p>eg2：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;reflect&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> x <span class="keyword">float64</span> = <span class="number">1.23</span></span><br><span class="line"></span><br><span class="line">    t := reflect.TypeOf(x)<span class="comment">// 获得 reflect.Type  对象</span></span><br><span class="line">    v := reflect.ValueOf(x)<span class="comment">// 获得 reflect.Value 对象</span></span><br><span class="line">    fmt.Println(t)          <span class="comment">// float64</span></span><br><span class="line">    fmt.Println(v)          <span class="comment">// 1.23</span></span><br><span class="line">    fmt.Println(v.Kind())   <span class="comment">// float64</span></span><br><span class="line">    fmt.Println(v.Type())   <span class="comment">// float64/* value 到 type */</span></span><br><span class="line">    fmt.Println(v.Float())  <span class="comment">// 1.23    /* value 到 实例 */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* value 到 实例 */</span></span><br><span class="line">    v = reflect.ValueOf(x)                 <span class="comment">// 接口类型变量 -&gt; 反射类型对象</span></span><br><span class="line">    convertV := v.Interface().(<span class="keyword">float64</span>)    <span class="comment">// 反射类型对象 -&gt; 接口类型变量, 可以理解为 强制转换</span></span><br><span class="line">    fmt.Println(convertV)    <span class="comment">// 1.23</span></span><br><span class="line"></span><br><span class="line">    p := reflect.ValueOf(&amp;x)</span><br><span class="line">    convertP := p.Interface().(*<span class="keyword">float64</span>)</span><br><span class="line">    fmt.Println(convertP)    <span class="comment">// 0xc000012090</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="指针类型-与-值类型的转换"><a href="#指针类型-与-值类型的转换" class="headerlink" title="指针类型 与 值类型的转换"></a>指针类型 与 值类型的转换</h3><ul><li><p><strong>指针 -&gt; 值</strong>：<code>t.Elem()</code>，t 只可以是引用类型</p></li><li><p><strong>指针 -&gt; 值</strong>：<code>v.Elem()</code>，v 只可以是指针</p>  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// t 必须是 Array、Chan、Map、Ptr、Slice，否则会引起 panic</span></span><br><span class="line"><span class="comment">// Elem 返回的是其内部元素的 Type</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *rtype)</span> <span class="title">Elem</span><span class="params">()</span> <span class="title">Type</span></span></span><br></pre></td></tr></table></figure><p>  eg：</p>  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> x <span class="keyword">int</span> = <span class="number">10</span></span><br><span class="line">    <span class="keyword">var</span> s []<span class="keyword">int</span> = []<span class="keyword">int</span>&#123;<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TypeOf：只接受引用类型</span></span><br><span class="line">    t1 := reflect.TypeOf(s)</span><br><span class="line">    te1 := t1.Elem()</span><br><span class="line">    fmt.Println(te1)         <span class="comment">// int</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%T \n&quot;</span>, te1) <span class="comment">// *reflect.rtype</span></span><br><span class="line"></span><br><span class="line">    t2 := reflect.TypeOf(&amp;s)</span><br><span class="line">    te2 := t2.Elem()</span><br><span class="line">    fmt.Println(te2)         <span class="comment">// []int</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%T \n&quot;</span>, te2) <span class="comment">// *reflect.rtype</span></span><br><span class="line"></span><br><span class="line">    t3 := reflect.TypeOf(x)</span><br><span class="line">    te3 := t3.Elem() <span class="comment">// panic: reflect: Elem of invalid type int</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    t4 := reflect.TypeOf(&amp;x)</span><br><span class="line">    te4 := t4.Elem()</span><br><span class="line">    fmt.Println(te4)         <span class="comment">// int</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%T \n&quot;</span>, te4) <span class="comment">// *reflect.rtype</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ValueOf：只接受prt类型</span></span><br><span class="line">    v1 := reflect.ValueOf(s)</span><br><span class="line">    ve1 := v1.Elem() <span class="comment">// panic: reflect: call of reflect.Value.Elem on slice Value</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    v2 := reflect.ValueOf(&amp;s)</span><br><span class="line">    ve2 := v2.Elem()</span><br><span class="line">    fmt.Println(ve2)         <span class="comment">// [10 20 30]</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%T \n&quot;</span>, ve2) <span class="comment">// reflect.Value</span></span><br><span class="line"></span><br><span class="line">    v3 := reflect.ValueOf(x)</span><br><span class="line">    ve3 := v3.Elem() <span class="comment">// panic: reflect: call of reflect.Value.Elem on int Value</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    v4 := reflect.ValueOf(&amp;x)</span><br><span class="line">    ve4 := v4.Elem()</span><br><span class="line">    fmt.Println(ve4)         <span class="comment">// 10</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%T \n&quot;</span>, ve4) <span class="comment">// reflect.Value</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><ul><li><p><strong>值 -&gt; 指针</strong>：<code>PtrTo(t)</code></p>  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PtrTo 返回的是指向 t 的指针型 Type</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">PtrTo</span><span class="params">(t Type)</span> <span class="title">Type</span></span></span><br></pre></td></tr></table></figure><p>  eg：</p>  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> x <span class="keyword">int</span> = <span class="number">10</span></span><br><span class="line">    <span class="keyword">var</span> s []<span class="keyword">int</span> = []<span class="keyword">int</span>&#123;<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>&#125;</span><br><span class="line"></span><br><span class="line">    xt := reflect.TypeOf(x)</span><br><span class="line">    st := reflect.TypeOf(s)</span><br><span class="line"></span><br><span class="line">    px := reflect.PtrTo(xt)</span><br><span class="line">    ps := reflect.PtrTo(st)</span><br><span class="line"></span><br><span class="line">    fmt.Println(px) <span class="comment">// *int</span></span><br><span class="line">    fmt.Println(ps) <span class="comment">// *[]int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="Value-的可修改性"><a href="#Value-的可修改性" class="headerlink" title="Value 的可修改性"></a>Value 的可修改性</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过 CanSet 判断是否能修改</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">CanSet</span><span class="params">()</span> <span class="title">bool</span></span> &#123;&#125;</span><br><span class="line"><span class="comment">//通过 Set 进行修改</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">Set</span><span class="params">(x Value)</span></span> &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">SetBool</span><span class="params">(x <span class="keyword">bool</span>)</span></span> &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">SetBytes</span><span class="params">(x []<span class="keyword">byte</span>)</span></span> &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">SetCap</span><span class="params">(n <span class="keyword">int</span>)</span></span> &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">SetComplex</span><span class="params">(x <span class="keyword">complex128</span>)</span></span> &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">SetFloat</span><span class="params">(x <span class="keyword">float64</span>)</span></span> &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">SetInt</span><span class="params">(x <span class="keyword">int64</span>)</span></span> &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">SetLen</span><span class="params">(n <span class="keyword">int</span>)</span></span> &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">SetMapIndex</span><span class="params">(key, elem Value)</span></span> &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">SetPointer</span><span class="params">(x unsafe.Pointer)</span></span> &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">SetString</span><span class="params">(x <span class="keyword">string</span>)</span></span> &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">SetUint</span><span class="params">(x <span class="keyword">uint64</span>)</span></span> &#123;&#125;</span><br></pre></td></tr></table></figure><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> x <span class="keyword">int</span> = <span class="number">10</span></span><br><span class="line">    <span class="keyword">var</span> s []<span class="keyword">int</span> = []<span class="keyword">int</span>&#123;<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>&#125;</span><br><span class="line"></span><br><span class="line">    vpx := reflect.ValueOf(&amp;x)</span><br><span class="line">    vepx := vpx.Elem()</span><br><span class="line">    <span class="keyword">if</span> vepx.CanSet() == <span class="literal">true</span> &#123;    <span class="comment">// CanSet 判断</span></span><br><span class="line">        vepx.SetInt(<span class="number">20</span>)           <span class="comment">// Set 设置</span></span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(x) <span class="comment">// 20</span></span><br><span class="line"></span><br><span class="line">    vps := reflect.ValueOf(&amp;s)</span><br><span class="line">    veps := vps.Elem()</span><br><span class="line">    <span class="keyword">if</span> veps.CanSet() == <span class="literal">true</span> &#123;    <span class="comment">// CanSet 判断</span></span><br><span class="line">        veps.Index(<span class="number">1</span>).SetInt(<span class="number">345</span>) <span class="comment">// Index 获取元素，然后设置</span></span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(s) <span class="comment">// [10 345 30]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="反射结构体"><a href="#反射结构体" class="headerlink" title="反射结构体"></a>反射结构体</h3><p>结构体相比基本类型稍微多一点步骤。</p><p>第一步，传入结构体指针，获取可修改的 <code>reflect</code> 对象<br>第二步，使用 <code>Elem()</code> 获得字段列表<br>第三步，使用 <code>Field()</code>系列方法 或 <code>Method()</code> 系列方法，获得指定字段或方法<br>第四步，使用 <code>Set()</code>系列方法修改数值 或 使用 <code>Call()</code> 调用结构体方法</p><p>结构体的 <code>Type</code> 是 <code>main.person</code><br>结构体的 <code>Kind</code> 是 <code>struct</code><br>结构体的 <code>Name</code> 是 <code>person</code></p><p><code>NumField()</code> 可以获得结构体字段的数量<br><code>NumMethod()</code> 可以获得结构体方法的数量，但只能获取 public 方法<br><code>Field(idx)</code> 可以通过下标获得指定的字段<br><code>FieldByName(fieldName)</code> 可以通过字段名字获得指定的字段<br><code>Method(idx)</code> 可以通过下标获得指定的方法<br><code>MethodByName(methodName)</code> 可以通过方法名获得指定的方法<br><code>NumIn()</code> 可以获得参数个数<br><code>NumOut()</code> 可以获得返回值个数</p><h4 id="访问操作"><a href="#访问操作" class="headerlink" title="访问操作"></a>访问操作</h4><p>eg：访问结构体的字段和方法</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;reflect&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> person <span class="keyword">struct</span> &#123;</span><br><span class="line">    name <span class="keyword">string</span></span><br><span class="line">    Age  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p person)</span> <span class="title">Eat</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;eat&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p person)</span> <span class="title">Run</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;run&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p person)</span> <span class="title">gogogo</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;go&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    pers := person&#123;<span class="string">&quot;Boii&quot;</span>, <span class="number">18</span>&#125;</span><br><span class="line">    t := reflect.TypeOf(pers)</span><br><span class="line">    v := reflect.ValueOf(pers)</span><br><span class="line">    fmt.Println(v)             <span class="comment">// &#123;Boii 18&#125;</span></span><br><span class="line">    fmt.Println(t)             <span class="comment">// main.person</span></span><br><span class="line">    fmt.Println(t.Name())      <span class="comment">// person</span></span><br><span class="line">    fmt.Println(t.Kind())      <span class="comment">// struct</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取字段</span></span><br><span class="line">    <span class="comment">// &#123; Name   PkgPath  Type   Tag  Offset Index  Anonymous&#125;</span></span><br><span class="line">    <span class="comment">// &#123; name    main   string         0     [0]     false&#125;</span></span><br><span class="line">    <span class="comment">// &#123; Age     main    int           16    [1]     false&#125;</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; t.NumField(); i++ &#123;</span><br><span class="line">        field := t.Field(i)</span><br><span class="line">        value := v.Field(i)</span><br><span class="line">        fmt.Printf(<span class="string">&quot;字段名称: %s\t字段类型: %s\t字段数值: %v\n&quot;</span>, field.Name, field.Type, value)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 字段名称: name  字段类型: string 字段数值: Boii</span></span><br><span class="line">    <span class="comment">// 字段名称: Age   字段类型: int    字段数值: 18</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; v.NumField(); i++ &#123;</span><br><span class="line">        fmt.Println(v.Field(i))</span><br><span class="line">        <span class="comment">// Boii</span></span><br><span class="line">        <span class="comment">// 18</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取方法，t.NumMethod() 只能获取到 public 方法</span></span><br><span class="line">    <span class="comment">// &#123;Name  PkgPath           Type                          Func                  Index&#125;</span></span><br><span class="line">    <span class="comment">// &#123;Eat            func(main.person, string)  &lt;func(main.person, string) Value&gt;   0&#125;</span></span><br><span class="line">    <span class="comment">// &#123;Run            func(main.person)          &lt;func(main.person) Value&gt;           1&#125;</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; t.NumMethod(); i++ &#123;</span><br><span class="line">        method := t.Method(i)</span><br><span class="line">        fmt.Printf(<span class="string">&quot;方法名称: %s\t方法类型: %v\n&quot;</span>, method.Name, method.Type)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 方法名称: Eat   方法类型: func(main.person)</span></span><br><span class="line">    <span class="comment">// 方法名称: Run   方法类型: func(main.person)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; v.NumMethod(); i++ &#123;</span><br><span class="line">        fmt.Println(v.Method(i))</span><br><span class="line">        <span class="comment">// 0x433600</span></span><br><span class="line">        <span class="comment">// 0x433600</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="修改操作"><a href="#修改操作" class="headerlink" title="修改操作"></a>修改操作</h4><p>如果想要对结构体的字段等进行修改，需要传入结构体指针来获得 <code>reflect</code> 对象。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;reflect&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> person <span class="keyword">struct</span> &#123;</span><br><span class="line">    name <span class="keyword">string</span></span><br><span class="line">    Age  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p person)</span> <span class="title">Eat</span><span class="params">(food <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;eat&quot;</span>, food)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p person)</span> <span class="title">Run</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;run&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p person)</span> <span class="title">go</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;go&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    pers := person&#123;<span class="string">&quot;Boii&quot;</span>, <span class="number">18</span>&#125;</span><br><span class="line">    v := reflect.ValueOf(&amp;pers).Elem()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// panic: reflect: reflect.Value.SetString using value obtained using unexported field</span></span><br><span class="line">    v.FieldByName(<span class="string">&quot;name&quot;</span>).SetString(<span class="string">&quot;Eva&quot;</span>)    <span class="comment">// 传入结构体指针以后，Field 只能访问到 public 字段</span></span><br><span class="line"></span><br><span class="line">    v.Field(<span class="number">1</span>).SetInt(<span class="number">20</span>)</span><br><span class="line">    fmt.Println(pers) <span class="comment">// &#123;Boii 20&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用有参方法</span></span><br><span class="line">    v.Method(<span class="number">0</span>).Call([]reflect.Value&#123;reflect.ValueOf(<span class="string">&quot;apple&quot;</span>)&#125;) <span class="comment">// eat apple</span></span><br><span class="line">    <span class="comment">// 调用无参方法</span></span><br><span class="line">    v.Method(<span class="number">1</span>).Call(<span class="literal">nil</span>)                                       <span class="comment">// run</span></span><br><span class="line">    v.Method(<span class="number">1</span>).Call(<span class="built_in">make</span>([]reflect.Value, <span class="number">0</span>))                  <span class="comment">// run</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过结构体指针获得的 <code>reflect</code> 对象，要注意3点</p><ol><li>需要 <code>Elem()</code> 方法获取到元素列表</li><li>只能访问到 public 的 字段和方法</li></ol><p>通过 <code>Call()</code> 可以调用结构体的方法，<br>如果无参，可以传入 <code>nil</code> 或者空切片<br>如果有参，需传入Value切片 <code>[]reflect.Value</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//没有参数，直接写nil</span></span><br><span class="line">.Call(<span class="literal">nil</span>)</span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line">args1 := <span class="built_in">make</span>([]reflect.Value, <span class="number">0</span>)</span><br><span class="line">.Call(args1)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 有参数</span></span><br><span class="line">args2 := []reflect.Value&#123; reflect.ValueOf(<span class="string">&quot;反射机制&quot;</span>), reflect.ValueOf(<span class="number">100</span>), ...&#125;</span><br><span class="line">.Call(args2)</span><br></pre></td></tr></table></figure><h3 id="反射调用函数"><a href="#反射调用函数" class="headerlink" title="反射调用函数"></a>反射调用函数</h3><p>反射调用函数和 调用方法其实差不多，可以通过函数名获得 <code>reflect</code> 对象，使用 <code>Call()</code> 调用</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;reflect&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">//函数的反射</span></span><br><span class="line">    f1 := fun1</span><br><span class="line">    value := reflect.ValueOf(f1)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Kind : %s , Type : %s\n&quot;</span>, value.Kind(), value.Type()) <span class="comment">//Kind : func , Type : func()</span></span><br><span class="line"></span><br><span class="line">    value2 := reflect.ValueOf(fun2)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Kind : %s , Type : %s\n&quot;</span>, value2.Kind(), value2.Type()) <span class="comment">//Kind : func , Type : func(int, string)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//通过反射调用函数</span></span><br><span class="line">    value.Call(<span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line">    args := []reflect.Value&#123;reflect.ValueOf(<span class="number">100</span>), reflect.ValueOf(<span class="string">&quot;hello&quot;</span>)&#125;</span><br><span class="line">    value2.Call(args)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fun1</span><span class="params">()</span></span>&#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;我是函数fun1()，无参的。。&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fun2</span><span class="params">(i <span class="keyword">int</span>, s <span class="keyword">string</span>)</span></span>&#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;我是函数fun2()，有参数。。&quot;</span>,i,s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
          <category> Adavanced </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Golang [进阶] 18-并发安全</title>
      <link href="posts/65501a4c"/>
      <url>posts/65501a4c</url>
      
        <content type="html"><![CDATA[<p>并发安全</p><span id="more"></span><h1 id="1-并发安全"><a href="#1-并发安全" class="headerlink" title="1-并发安全"></a>1-并发安全</h1><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20210210160730868_457.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20210210160730868_457.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="串行、并行、并发"></p><h2 id="竞态"><a href="#竞态" class="headerlink" title="竞态"></a>竞态</h2><p><strong>竞态</strong> 是指多个 <code>goroutine</code> 按某些交错顺序执行时，争抢使用同一份临界资源，导致程序无法给出正确的结果。<br><strong>串行程序</strong>中（一个程序只有一个 <code>goroutine</code>），程序中各个步骤的执行顺序由程序逻辑决定，所以单个 <code>goroutine</code> 不会引发竞态问题。<br><strong>并发程序</strong>中（一个程序有多个 <code>goroutine</code>），每个 <code>goroutine</code> 的执行顺序是不一样的，因此可能会带来竞态问题。</p><p>例如：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> x <span class="keyword">int64</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>_000_000; i++ &#123;</span><br><span class="line">        x = x + <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    add()</span><br><span class="line">    add()</span><br><span class="line">    fmt.Println(x)    <span class="comment">// 10_000_000</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这是一个串行程序，所以最终的结果是正确的。</p><p>下面开启新的 <code>goroutine</code> 执行 <code>add()</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">    x <span class="keyword">int64</span></span><br><span class="line">    wg sync.WaitGroup</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> wg.Done()</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>_000_000; i++ &#123;</span><br><span class="line">        x = x + <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    wg.Add(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> add()</span><br><span class="line">    <span class="keyword">go</span> add()</span><br><span class="line">    fmt.Println(x)    <span class="comment">// 5_872_265</span></span><br><span class="line"></span><br><span class="line">    wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>从打印结果可以看出结果并不正确，这是因为 3 个 <code>goroutine</code> 争抢着使用 <em>x</em> 这个临界资源，有可能最终的 x 的结果是正确的，但是<code>main()</code> 提前抢到资源就打印出来了，也有可能两个 <code>子goroutine</code> 争抢时导致 <em>x</em> 被写乱了（发生了竞态）。</p><h2 id="避免竞态"><a href="#避免竞态" class="headerlink" title="避免竞态"></a>避免竞态</h2><ul><li>第一种：不要修改变量。这种可以，但不现实，因为实际业务中必然涉及同时读写同一个变量的场景。只能说尽量避免。</li><li>第二种：上锁</li></ul><p>上锁可以很好的解决竞态问题，但是会有些许性能上的损失。</p><blockquote><p>发生竞态的主要原因是因为：多个 <code>goroutine</code> 争抢读写同一个临界资源。这个临界资源可以是打印机、全局变量等等。</p></blockquote><p>举个栗子，<br>一个人就是一个 <code>goroutine</code>，公共卫生间就是一种临界资源，同一时刻只能有一个人使用（一个临界资源，同一时刻只能有一个 <code>goroutine</code> 读写 ）。多个人同时争抢一个公共卫生间肯定出问题。</p><p>所以卫生间要加个锁，进去使用的人上锁，使用完了开锁。<br>使用临界资源的 <code>goroutine</code> 给临界资源上锁，使用完了把锁释放。</p><p>Golang 中的 <code>sync</code> 包提供了 <code>Mutex</code> 和 <code>RWMutex</code> 两种锁。</p><h3 id="sync-Mutex-互斥锁"><a href="#sync-Mutex-互斥锁" class="headerlink" title="sync.Mutex 互斥锁"></a>sync.Mutex 互斥锁</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Mutex <span class="keyword">struct</span> &#123;</span><br><span class="line">    state <span class="keyword">int32</span></span><br><span class="line">    sema  <span class="keyword">uint32</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *Mutex)</span> <span class="title">Lock</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *Mutex)</span> <span class="title">Unlock</span><span class="params">()</span></span> &#123;&#125;</span><br></pre></td></tr></table></figure><p><code>Mutex</code> 非常简单，只有<code>Lock()</code> 和 <code>Unlock()</code> 两个方法。</p><blockquote><p><strong>加锁</strong></p><ul><li><code>Lock()</code> 用于加锁</li><li>加锁规则：<ul><li>如果互斥锁已经被上锁了，则加锁操作阻塞，直到互斥锁被解锁以后才能上锁。</li><li>如果互斥锁没有被上锁，那么上锁成功。</li></ul>  <strong>解锁</strong></li><li><code>Unlock()</code> 用于解锁</li><li>解锁规则：释放互斥锁</li></ul></blockquote><h4 id="上锁"><a href="#上锁" class="headerlink" title="上锁"></a>上锁</h4><p>下面我们对上面的例子中，争抢临界资源的部分上锁。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">    x    <span class="keyword">int64</span></span><br><span class="line">    wg   sync.WaitGroup</span><br><span class="line">    lock sync.Mutex</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> wg.Done()</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>_000_000; i++ &#123;</span><br><span class="line">        lock.Lock()   <span class="comment">// 加锁</span></span><br><span class="line">        x = x + <span class="number">1</span></span><br><span class="line">        lock.Unlock() <span class="comment">// 解锁</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    wg.Add(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> add()</span><br><span class="line">    <span class="keyword">go</span> add()</span><br><span class="line">    fmt.Println(x)    <span class="comment">// 10_000_000</span></span><br><span class="line"></span><br><span class="line">    wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如此一来，不管哪个 <code>子goroutine</code> 得到运行的机会，别的 <code>goroutine</code> 都不能访问临界资源，得等到上了锁的 <code>goroutine</code> 释放，别的 <code>goroutine</code> 才能访问。</p><h4 id="延迟解锁"><a href="#延迟解锁" class="headerlink" title="延迟解锁"></a>延迟解锁</h4><p>如果一个 <code>goroutine</code> 上了锁之后忘记释放锁，别的 <code>goroutine</code> 是永远拿不到锁的，还会导致死锁。<br>在复杂的代码中，很难确定所有分支中的 <code>Lock()</code> 和 <code>Unlock()</code> 成对出现，所以，最好养成<strong>锁成对写、延迟解锁</strong>的习惯。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x <span class="keyword">int</span></span><br><span class="line"><span class="keyword">var</span> lock sync.Mutex</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">()</span></span> &#123;</span><br><span class="line">    lock.Lock() <span class="comment">// 上锁</span></span><br><span class="line">    x = x + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">defer</span> lock.Unlock() <span class="comment">// 延迟解锁，在函数运行结束之后会自动解锁</span></span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="sync-RWMutex-读写互斥锁"><a href="#sync-RWMutex-读写互斥锁" class="headerlink" title="sync.RWMutex 读写互斥锁"></a>sync.RWMutex 读写互斥锁</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> RWMutex <span class="keyword">struct</span> &#123;</span><br><span class="line">    w           Mutex  <span class="comment">// held if there are pending writers</span></span><br><span class="line">    writerSem   <span class="keyword">uint32</span> <span class="comment">// semaphore for writers to wait for completing readers</span></span><br><span class="line">    readerSem   <span class="keyword">uint32</span> <span class="comment">// semaphore for readers to wait for completing writers</span></span><br><span class="line">    readerCount <span class="keyword">int32</span>  <span class="comment">// number of pending readers</span></span><br><span class="line">    readerWait  <span class="keyword">int32</span>  <span class="comment">// number of departing readers</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 写锁</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rw *RWMutex)</span> <span class="title">Lock</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rw *RWMutex)</span> <span class="title">Unlock</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line"><span class="comment">// 读锁</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rw *RWMutex)</span> <span class="title">RLock</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rw *RWMutex)</span> <span class="title">RUnlock</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rw *RWMutex)</span> <span class="title">RLocker</span><span class="params">()</span> <span class="title">Locker</span></span> &#123;&#125;</span><br></pre></td></tr></table></figure><p>读写互斥锁适用于<strong>读多写少</strong>的场景。因为在使用 <code>Mutex</code> 互斥锁的时候，不管是因为要去读上的锁还是要去写上的锁，只要一上了锁，别的 <code>goroutine</code> 就不能上锁，也不能读写。</p><p>于是在 读多写少 的场景下，导致少量写操作时，也不能读。所以这种场景要使用 <strong>读写互斥锁</strong>。</p><blockquote><p><strong>写锁</strong></p><ul><li><code>Lock()</code> 函数用于上写锁</li><li><code>Unlock()</code> 函数用于解写锁</li><li>加锁规则：<ul><li>如果当前的读写锁被上锁了，则 加写锁 操作阻塞直到读写锁被释放</li><li>如果当前的读写锁没有被锁，则 加写锁 成功</li></ul></li><li>释放规则：直接释放</li></ul></blockquote><blockquote><p><strong>读锁</strong></p><ul><li><code>RLock()</code> 函数用于上读锁</li><li><code>RUnlock()</code> 函数用于解读锁</li><li>加锁规则：<ul><li>如果当前的读写锁 没有被锁，则 加读锁 操作成功</li><li>如果当前的读写锁 被上了读锁，则 加读锁 操作成功</li><li>如果当前的读写锁 被上了写锁，则 加读锁 操作阻塞，直到读写锁被释放</li></ul></li></ul></blockquote><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;sync&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">    x      <span class="keyword">int64</span></span><br><span class="line">    wg     sync.WaitGroup</span><br><span class="line">    rwlock sync.RWMutex <span class="comment">// 读写锁</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">read</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> wg.Done()</span><br><span class="line"></span><br><span class="line">    rwlock.RLock() <span class="comment">// 加读锁</span></span><br><span class="line">    time.Sleep(time.Millisecond)</span><br><span class="line">    fmt.Println(x)</span><br><span class="line">    <span class="keyword">defer</span> rwlock.RUnlock() <span class="comment">// 解读锁</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">write</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> wg.Done()</span><br><span class="line"></span><br><span class="line">    rwlock.Lock() <span class="comment">// 加写锁</span></span><br><span class="line">    time.Sleep(time.Millisecond * <span class="number">5</span>)</span><br><span class="line">    x = x + <span class="number">1</span></span><br><span class="line">    <span class="keyword">defer</span> rwlock.Unlock() <span class="comment">// 解写锁</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    start := time.Now()</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">        wg.Add(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">go</span> write()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++ &#123;</span><br><span class="line">        wg.Add(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">go</span> read()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    wg.Wait()</span><br><span class="line">    fmt.Println(time.Now().Sub(start))</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// --------------------------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line">...</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">215.9568</span>ms</span><br></pre></td></tr></table></figure><h3 id="Mutex-和-RWMutex-的选择"><a href="#Mutex-和-RWMutex-的选择" class="headerlink" title="Mutex 和 RWMutex 的选择"></a>Mutex 和 RWMutex 的选择</h3><ul><li>仅在绝大部分goroutine都在<strong>获取读锁并且锁竞争比较激烈时</strong>（即，goroutine一般都需要等待后才能获到锁），RWMutex才有优势</li><li>否则，<strong>一般使用Mutex即可</strong></li></ul><h2 id="sync-Once"><a href="#sync-Once" class="headerlink" title="sync.Once"></a>sync.Once</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Once <span class="keyword">struct</span> &#123;</span><br><span class="line">    done <span class="keyword">uint32</span></span><br><span class="line">    m    Mutex</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(o *Once)</span> <span class="title">Do</span><span class="params">(f <span class="keyword">func</span>()</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> atomic.LoadUint32(&amp;o.done) == <span class="number">0</span> &#123;</span><br><span class="line">        o.doSlow(f)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(o *Once)</span> <span class="title">doSlow</span><span class="params">(f <span class="keyword">func</span>()</span>)</span> &#123;</span><br><span class="line">    o.m.Lock()</span><br><span class="line">    <span class="keyword">defer</span> o.m.Unlock()</span><br><span class="line">    <span class="keyword">if</span> o.done == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">defer</span> atomic.StoreUint32(&amp;o.done, <span class="number">1</span>)</span><br><span class="line">        f()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>Once</code> 是一个结构体，里面有一把 <code>Mutex</code> 锁 <em>m</em>，还有一个 <code>done</code> 标志位用来标记 <code>f</code> 是否执行过了。（0未执行，1已执行）</li><li><code>Once</code> 只有一个 <code>Do()</code> 方法，其中检查了一下标志位，如果为 0 表示 <code>f</code> 未执行过，调用 <code>doSlow()</code>；非 0 表示执行过了，直接返回<br>  <code>doSlow()</code> 中，先是上锁，然后检查 <code>done</code> 标志位，看看 <code>f</code> 是否执行过，如果没有执行，就执行，然后标志位置为 1。</li></ul><p>用 <code>sync.Once</code> 写一个单例模式：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> person <span class="keyword">struct</span> &#123;</span><br><span class="line">    name <span class="keyword">string</span></span><br><span class="line">    age  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">    p *person</span><br><span class="line">    once sync.Once</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造方法使用 Once 的 Do 方法实现</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewSinglePerson</span><span class="params">(name <span class="keyword">string</span>, age <span class="keyword">int</span>)</span> *<span class="title">person</span></span> &#123;</span><br><span class="line">    once.Do(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        p = &amp;person&#123;name, age&#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> p</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    p1 := NewSinglePerson(<span class="string">&quot;Boii&quot;</span>, <span class="number">18</span>)</span><br><span class="line">    p2 := NewSinglePerson(<span class="string">&quot;Eva&quot;</span>, <span class="number">20</span>)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%p\n&quot;</span>, p1)<span class="comment">// 0xc0000044a0</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%p\n&quot;</span>, p2)  <span class="comment">// 0xc0000044a0</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%v\n&quot;</span>, p1) <span class="comment">// &amp;&#123;Boii 18&#125;</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%v\n&quot;</span>, p2) <span class="comment">// &amp;&#123;Boii 18&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="sync-Map"><a href="#sync-Map" class="headerlink" title="sync.Map"></a>sync.Map</h2><div class="note info"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Map <span class="keyword">struct</span> &#123;</span><br><span class="line">    mu Mutex</span><br><span class="line">    read atomic.Value <span class="comment">// readOnly</span></span><br><span class="line">    dirty <span class="keyword">map</span>[<span class="keyword">interface</span>&#123;&#125;]*entry</span><br><span class="line">    misses <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// set</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *Map)</span> <span class="title">Store</span><span class="params">(key, value <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// get</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *Map)</span> <span class="title">Load</span><span class="params">(key <span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(value <span class="keyword">interface</span>&#123;&#125;, ok <span class="keyword">bool</span>)</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *Map)</span> <span class="title">Delete</span><span class="params">(key <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;&#125;</span><br><span class="line"><span class="comment">// 先加载看，有再删除</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *Map)</span> <span class="title">LoadAndDelete</span><span class="params">(key <span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(value <span class="keyword">interface</span>&#123;&#125;, loaded <span class="keyword">bool</span>)</span></span> &#123;&#125;</span><br><span class="line"><span class="comment">// 先加载看，没有再存，有就不存</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *Map)</span> <span class="title">LoadOrStore</span><span class="params">(key, value <span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(actual <span class="keyword">interface</span>&#123;&#125;, loaded <span class="keyword">bool</span>)</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *Map)</span> <span class="title">Range</span><span class="params">(f <span class="keyword">func</span>(key, value <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">bool</span>)</span> &#123;&#125;</span><br></pre></td></tr></table></figure><p>Golang 中内置的 map 不是并发安全的，在对 map 并发写的时候会出现问题。</p><p>Golang 的 <code>sync</code> 包中提供了一个开箱即用的并发安全版map：<code>sync.Map</code>。</p><p>开箱即用，即表示不需要 <code>make()</code> 函数初始化就能直接使用，同时内置了诸如 <code>Store、Load、Delete、Range</code> 等操作。</p></div><p>先看对内置 map 并发写会发生什么。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> m = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>)</span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">get</span><span class="params">(key <span class="keyword">string</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> m[key]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">set</span><span class="params">(key <span class="keyword">string</span>, value <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    m[key] = value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">call</span> <span class="params">(n <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> wg.Done()</span><br><span class="line">    key := strconv.Itoa(n)</span><br><span class="line">    set(key, n)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;k=:%v,v:=%v\n&quot;</span>, key, get(key))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">20</span>; i++ &#123;</span><br><span class="line">        wg.Add(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">go</span> call(i)</span><br><span class="line">    &#125;</span><br><span class="line">    wg.Wait()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// -------------------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line">fatal error: k=:<span class="number">0</span>,v:=<span class="number">0</span></span><br><span class="line">concurrent <span class="keyword">map</span> writes</span><br><span class="line">k=:<span class="number">19</span>,v:=<span class="number">19</span></span><br><span class="line">fatal error: concurrent <span class="keyword">map</span> writes</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>采用 并发安全版：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"><span class="keyword">var</span> sm = sync.Map&#123;&#125;    <span class="comment">// 声明 sync.Map 变量</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">call</span><span class="params">(n <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> wg.Done()</span><br><span class="line"></span><br><span class="line">    key := strconv.Itoa(n)</span><br><span class="line"></span><br><span class="line">    sm.Store(key, n)         <span class="comment">// 写</span></span><br><span class="line">    value, _ := sm.Load(key) <span class="comment">// 读</span></span><br><span class="line"></span><br><span class="line">    fmt.Printf(<span class="string">&quot;k=:%v,v:=%v\n&quot;</span>, key, value)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">20</span>; i++ &#123;</span><br><span class="line">        wg.Add(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">go</span> call(i)</span><br><span class="line">    &#125;</span><br><span class="line">    wg.Wait()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// -------------------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line">k=:<span class="number">19</span>,v:=<span class="number">19</span></span><br><span class="line">k=:<span class="number">10</span>,v:=<span class="number">10</span></span><br><span class="line">k=:<span class="number">11</span>,v:=<span class="number">11</span></span><br><span class="line">k=:<span class="number">2</span>,v:=<span class="number">2</span>  </span><br><span class="line">k=:<span class="number">15</span>,v:=<span class="number">15</span></span><br><span class="line">k=:<span class="number">3</span>,v:=<span class="number">3</span>  </span><br><span class="line">k=:<span class="number">12</span>,v:=<span class="number">12</span></span><br><span class="line">k=:<span class="number">0</span>,v:=<span class="number">0</span>  </span><br><span class="line">k=:<span class="number">13</span>,v:=<span class="number">13</span></span><br><span class="line">k=:<span class="number">18</span>,v:=<span class="number">18</span></span><br><span class="line">k=:<span class="number">14</span>,v:=<span class="number">14</span></span><br><span class="line">k=:<span class="number">6</span>,v:=<span class="number">6</span>  </span><br><span class="line">k=:<span class="number">4</span>,v:=<span class="number">4</span>  </span><br><span class="line">k=:<span class="number">5</span>,v:=<span class="number">5</span>  </span><br><span class="line">k=:<span class="number">8</span>,v:=<span class="number">8</span></span><br><span class="line">k=:<span class="number">7</span>,v:=<span class="number">7</span></span><br><span class="line">k=:<span class="number">9</span>,v:=<span class="number">9</span></span><br><span class="line">k=:<span class="number">1</span>,v:=<span class="number">1</span></span><br><span class="line">k=:<span class="number">17</span>,v:=<span class="number">17</span></span><br><span class="line">k=:<span class="number">16</span>,v:=<span class="number">16</span></span><br></pre></td></tr></table></figure><h2 id="原子操作"><a href="#原子操作" class="headerlink" title="原子操作"></a>原子操作</h2><p>代码中的加锁操作因为涉及内核态的上下文切换会比较耗时、代价比较高。<br>针对基本数据类型我们还可以使用原子操作来保证并发安全，因为原子操作是 Go 语言提供的方法它在用户态就可以完成，<br>因此性能比加锁操作更好。Go语言中原子操作由内置的标准库 <code>sync/atomic</code> 提供。</p><h3 id="atomic-包"><a href="#atomic-包" class="headerlink" title="atomic 包"></a>atomic 包</h3><table><thead><tr><th align="left">读取操作</th></tr></thead><tbody><tr><td align="left">func LoadInt32(addr *int32) (val int32)</td></tr><tr><td align="left">func LoadInt64(addr *int64) (val int64)</td></tr><tr><td align="left">func LoadPointer(addr *unsafe.Pointer) (val unsafe.Pointer)</td></tr><tr><td align="left">func LoadUint32(addr *uint32) (val uint32)</td></tr><tr><td align="left">func LoadUint64(addr *uint64) (val uint64)</td></tr><tr><td align="left">func LoadUintptr(addr *uintptr) (val uintptr)</td></tr></tbody></table><table><thead><tr><th align="left">写入操作</th></tr></thead><tbody><tr><td align="left">func StoreInt32(addr *int32, val int32)</td></tr><tr><td align="left">func StoreInt64(addr *int64, val int64)</td></tr><tr><td align="left">func StorePointer(addr *unsafe.Pointer, val unsafe.Pointer)</td></tr><tr><td align="left">func StoreUint32(addr *uint32, val uint32)</td></tr><tr><td align="left">func StoreUint64(addr *uint64, val uint64)</td></tr><tr><td align="left">func StoreUintptr(addr *uintptr, val uintptr)</td></tr></tbody></table><table><thead><tr><th align="left">修改操作</th></tr></thead><tbody><tr><td align="left">func AddInt32(addr *int32, delta int32) (new int32)</td></tr><tr><td align="left">func AddInt64(addr *int64, delta int64) (new int64)</td></tr><tr><td align="left">func AddUint32(addr *uint32, delta uint32) (new uint32)</td></tr><tr><td align="left">func AddUint64(addr *uint64, delta uint64) (new uint64)</td></tr><tr><td align="left">func AddUintptr(addr *uintptr, delta uintptr) (new uintptr)</td></tr></tbody></table><table><thead><tr><th align="left">交换操作</th></tr></thead><tbody><tr><td align="left">func SwapInt32(addr *int32, new int32) (old int32)</td></tr><tr><td align="left">func SwapInt64(addr *int64, new int64) (old int64)</td></tr><tr><td align="left">func SwapPointer(addr *unsafe.Pointer, new unsafe.Pointer) (old unsafe.Pointer)</td></tr><tr><td align="left">func SwapUint32(addr *uint32, new uint32) (old uint32)</td></tr><tr><td align="left">func SwapUint64(addr *uint64, new uint64) (old uint64)</td></tr><tr><td align="left">func SwapUintptr(addr *uintptr, new uintptr) (old uintptr)</td></tr></tbody></table><table><thead><tr><th align="left">比较并交换操作</th></tr></thead><tbody><tr><td align="left">func CompareAndSwapInt32(addr *int32, old, new int32) (swapped bool)</td></tr><tr><td align="left">func CompareAndSwapInt64(addr *int64, old, new int64) (swapped bool)</td></tr><tr><td align="left">func CompareAndSwapPointer(addr *unsafe.Pointer, old, new unsafe.Pointer) (swapped bool)</td></tr><tr><td align="left">func CompareAndSwapUint32(addr *uint32, old, new uint32) (swapped bool)</td></tr><tr><td align="left">func CompareAndSwapUint64(addr *uint64, old, new uint64) (swapped bool)</td></tr><tr><td align="left">func CompareAndSwapUintptr(addr *uintptr, old, new uintptr) (swapped bool)</td></tr></tbody></table><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;sync&quot;</span></span><br><span class="line">    <span class="string">&quot;sync/atomic&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">    lock    sync.Mutex</span><br><span class="line">    x, y, z <span class="keyword">int64</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 非并发安全版</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">()</span></span> &#123;</span><br><span class="line">    x++</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加锁版</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mutexAdd</span><span class="params">()</span></span> &#123;</span><br><span class="line">    lock.Lock()</span><br><span class="line">    <span class="keyword">defer</span> lock.Unlock()</span><br><span class="line">    y++</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 原子版</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">atomicAdd</span><span class="params">()</span></span> &#123;</span><br><span class="line">    atomic.AddInt64(&amp;z, <span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(f <span class="keyword">func</span>()</span>) <span class="title">time</span>.<span class="title">Duration</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line">    start := time.Now()</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++ &#123;</span><br><span class="line">        wg.Add(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">            <span class="keyword">defer</span> wg.Done()</span><br><span class="line">            f()</span><br><span class="line">        &#125;()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    wg.Wait()</span><br><span class="line">    <span class="keyword">return</span> time.Now().Sub(start)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;非并发安全版:&quot;</span>, x, test(add))</span><br><span class="line">    fmt.Println(<span class="string">&quot;加锁版:&quot;</span>, y, test(mutexAdd))</span><br><span class="line">    fmt.Println(<span class="string">&quot;原子操作版 :&quot;</span>, z, test(atomicAdd))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// -------------------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line">非并发安全版: <span class="number">9604</span>  <span class="number">4.9936</span>ms</span><br><span class="line">加锁版     : <span class="number">10000</span> <span class="number">3.9898</span>ms</span><br><span class="line">原子操作版 : <span class="number">10000</span> <span class="number">2.9909</span>ms</span><br></pre></td></tr></table></figure><p>从结果可以看出，非并发安全版连结果都不对，加锁版安全，原子版安全且效率更高。</p><p><code>atomic</code> 包提供了底层的原子级内存操作，对于同步算法的实现很有用。这些函数必须谨慎地保证正确使用。除了某些特殊的底层应用，使用通道或者sync包的函数/类型实现同步更好。</p>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
          <category> Adavanced </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Golang [进阶] 17-Channel</title>
      <link href="posts/e3c7a27f"/>
      <url>posts/e3c7a27f</url>
      
        <content type="html"><![CDATA[<p>不要通过共享内存来通信，而应该通过通信来共享内存</p><span id="more"></span><h1 id="1-channel"><a href="#1-channel" class="headerlink" title="1-channel"></a>1-channel</h1><div class="note warning"><p><strong>注意：通道 channel 是引用类型！！！</strong></p></div><p><strong><code>channel</code> 的作用</strong>：<br>单纯的并发执行函数的没有意义的。函数间需要交换数据才能体现并发执行的意义。<br>就像 OS 的并发性和共享性，没有并发谈不上共享，没有共享并发没有意义。<br>所以 <code>channel</code> 就是用在 <code>goroutine</code> 之间的通信上的。</p><blockquote><p>Communicate through shared memory rather than through shared memory.  —– Golang</p><p>Golang 提倡<strong>通过通信共享内存而不是通过共享内存实现通信</strong>。</p></blockquote><p><code>goroutine</code> 是程序并发的执行体，<code>channel</code> 就是它们之间的通信管道。<br><code>channel</code> 有时候简写为：<code>chan</code>，遵循 <strong>FIFO 先进先出</strong> 的规则，保证了收发数据的顺序。<br>每一个 <code>chan</code> 都是一个具体类型的管道，即声明 <code>channel</code> 时需要为其指定元素类型。</p><h2 id="创建-channel"><a href="#创建-channel" class="headerlink" title="创建 channel"></a>创建 channel</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> identifier <span class="keyword">chan</span> T</span><br><span class="line">identifier = <span class="built_in">make</span>(<span class="keyword">chan</span> T[, size])</span><br><span class="line"></span><br><span class="line">identifier := <span class="built_in">make</span>(<span class="keyword">chan</span> T[, size])    <span class="comment">// 短声明</span></span><br></pre></td></tr></table></figure><ol><li><code>chan</code> 的创建需要 <code>make()</code> 分配内存才能使用。单纯的声明时，默认值为 <code>nil</code>。</li><li>分配内存时可以指定通道大小，也就是这条管子的容量。</li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> ch <span class="keyword">chan</span> <span class="keyword">int</span>          <span class="comment">// 声明通道变量</span></span><br><span class="line">    fmt.Println(ch)          <span class="comment">// nil</span></span><br><span class="line">    ch = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)      <span class="comment">// 无缓冲区，分配内存</span></span><br><span class="line">    fmt.Println(ch)          <span class="comment">// 0xc0000d4000</span></span><br><span class="line"></span><br><span class="line">    ch2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">2</span>) <span class="comment">// 有缓冲区</span></span><br><span class="line">    fmt.Println(ch2)         <span class="comment">// 0xc0000d5000</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对于无缓冲的通道：一次发送、一次接收，都是阻塞的<br>对于有缓冲的通道：<strong>发送</strong>-&gt;缓冲区满了，才会阻塞；<strong>接收</strong>-&gt;缓冲区空了，才会阻塞。</p><p>无缓冲通道就好像快递员送快递，只能当面送给你，你签收之前他就一直阻塞在那里。<br>有缓冲通道就好像有了快递柜，放到快递柜里等你自己来拿。快递柜满了快递员也只能等着，阻塞在那里。</p><h2 id="操作-channel"><a href="#操作-channel" class="headerlink" title="操作 channel"></a>操作 channel</h2><p>通道有 <strong>发送（通道读入数据）</strong>、<strong>接收（通道写出数据）</strong>、<strong>关闭</strong> 三种操作</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br></pre></td></tr></table></figure><div class="note info"><p>发送和接收有点容易混淆，可以这么记：<strong>左发右收、左写右读</strong>。通道在左边：向通道发送；通道在右边：从通道接收</p></div><h3 id="发送"><a href="#发送" class="headerlink" title="发送"></a>发送</h3><p>将一个值发送到通道中（通道写入一个值）。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ch &lt;- <span class="number">10</span>    <span class="comment">// 把 10 发送到 ch 中</span></span><br></pre></td></tr></table></figure><h3 id="接收"><a href="#接收" class="headerlink" title="接收"></a>接收</h3><p>从一个通道中接收值（通道读出一个值）。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x := &lt;-ch     <span class="comment">// 从 ch 中接收值并赋值给变量 x</span></span><br><span class="line">&lt;- ch         <span class="comment">// 从 ch 中接收值，忽略结果</span></span><br></pre></td></tr></table></figure><h3 id="关闭"><a href="#关闭" class="headerlink" title="关闭"></a>关闭</h3><p>调用内置函数 <code>close()</code> 来关闭通道。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">close</span>(ch)</span><br></pre></td></tr></table></figure><ul><li>已关闭的通道仍然可以获取数据直到通道为空</li><li>已关闭的通道数据取完只会接收到零值</li><li>已关闭的通道再发送值会导致 <code>panic</code></li><li>关闭已经关闭的通道会导致 <code>panic</code>，最好用 <code>new(sync.Once).Do(func() &#123; close(ch) &#125;)</code> 关闭</li></ul><p>关于关闭通道需要注意的事情是：</p><ul><li>只有在通知接收方goroutine所有的数据都发送完毕的时候才需要关闭通道。</li><li>通道是可以被垃圾回收机制回收的，它和关闭文件是不一样的，在结束操作之后关闭文件是必须要做的，但关闭通道不是必须的。</li></ul><h4 id="判断通道是否被关闭"><a href="#判断通道是否被关闭" class="headerlink" title="判断通道是否被关闭"></a>判断通道是否被关闭</h4><p><code>x, ok := &lt;-ch</code><br>从通道中接收值时，会返回两个值：一个是数据，一个是通道开启状态。通道被关闭后 <code>ok</code> 为 <code>false</code>。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">3</span>)</span><br><span class="line">    ch &lt;- <span class="number">10</span></span><br><span class="line">    ch &lt;- <span class="number">20</span></span><br><span class="line">    ch &lt;- <span class="number">30</span></span><br><span class="line">    <span class="built_in">close</span>(ch)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        x, ok := &lt;-ch</span><br><span class="line">        <span class="keyword">if</span> !ok &#123;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        fmt.Println(x)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="number">20</span></span><br><span class="line"><span class="number">30</span></span><br></pre></td></tr></table></figure><h3 id="单向通道"><a href="#单向通道" class="headerlink" title="单向通道"></a>单向通道</h3><p>有时候我们会将通道作为参数在多个任务函数之间传递，通常我们在不同的任务函数中使用通道都会对其进行限制，如只能发送或接收。</p><p>上面介绍的都是<strong>双向通道</strong>，接下来我们使用<strong>单向通道</strong>可以处理这种情况（<strong>单向通道</strong>也常用于参数）。</p><ul><li><strong><code>&lt;-chan T</code></strong> 是一个<strong>只读</strong>单向通道，只能从通道中读取数据，通道可以执行<strong>接收</strong>操作但不能执行发送操作。</li><li><strong><code>chan&lt;- T</code></strong> 是一个<strong>只写</strong>单项通道，只能向通道中写入数据，通道可以执行<strong>发送</strong>操作但不能执行读取操作。</li><li>在函数传参及任何赋值操作中可以将双向通道转换为单向通道，但反过来不可以。</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">producer</span><span class="params">(out <span class="keyword">chan</span>&lt;- <span class="keyword">int</span>)</span></span> &#123;    <span class="comment">// 生产者，只能向通道写入数据</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">100</span>; i++ &#123;</span><br><span class="line">        out &lt;- i</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">close</span>(out)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">consumer</span><span class="params">(in &lt;-<span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;    <span class="comment">// 消费者，只能从通道读取数据</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="keyword">range</span> in &#123;</span><br><span class="line">        fmt.Println(i)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">100</span>)</span><br><span class="line">    <span class="keyword">go</span> producer(ch)</span><br><span class="line">    <span class="keyword">go</span> consumer(ch)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="通道总结"><a href="#通道总结" class="headerlink" title="通道总结"></a>通道总结</h2><p><code>channel</code> 常见异常总结：</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20210211100625576_17942.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20210211100625576_17942.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>关闭已经关闭的<code>channel</code>也会引发<code>panic</code>。</p><h2 id="worker-pool"><a href="#worker-pool" class="headerlink" title="worker pool"></a>worker pool</h2><p><code>Worker Pool</code> 是一种模型，其中固定数量的 <em>m</em> 个 worker，通过 worker 队列中的 <em>n</em> 个任务工作。<br>worker 一直排在队列中，直到 worker 完成其当前任务并提出新任务为止。<br>在 Golang 中 worker 使用 <code>goroutine</code> 实现，任务使用通道实现。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">worker</span><span class="params">(id <span class="keyword">int</span>, jobs &lt;-<span class="keyword">chan</span> <span class="keyword">int</span>, results <span class="keyword">chan</span>&lt;- <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> j := <span class="keyword">range</span> jobs &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;worker:&quot;</span>, id, <span class="string">&quot;start job:&quot;</span>, j)</span><br><span class="line">        time.Sleep(time.Second)</span><br><span class="line">        fmt.Println(<span class="string">&quot;worker:&quot;</span>, id, <span class="string">&quot;end job:&quot;</span>, j)</span><br><span class="line">        results &lt;- j * <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    jobs := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">100</span>)</span><br><span class="line">    results := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 开启3个goroutine</span></span><br><span class="line">    <span class="keyword">for</span> w := <span class="number">1</span>; w &lt;= <span class="number">3</span>; w++ &#123;</span><br><span class="line">        <span class="keyword">go</span> worker(w, jobs, results)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 5个任务</span></span><br><span class="line">    <span class="keyword">for</span> j := <span class="number">1</span>; j &lt;= <span class="number">5</span>; j++ &#123;</span><br><span class="line">        jobs &lt;- j</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">close</span>(jobs)</span><br><span class="line">    <span class="comment">// close(results)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> a := <span class="number">1</span>; a &lt;= <span class="number">5</span>; a++ &#123;</span><br><span class="line">        fmt.Println(&lt;-results)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="select-多路复用"><a href="#select-多路复用" class="headerlink" title="select 多路复用"></a>select 多路复用</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> communication clause:</span><br><span class="line">        statements</span><br><span class="line">    <span class="keyword">case</span> communication clause:</span><br><span class="line">        statements</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">default</span>:    <span class="comment">/* 可选 */</span></span><br><span class="line">        statements</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>唯一一个可用的通道会被选择。</li><li>如果多个通道可用，会随机公平地选择一个，其他不会执行。</li><li>如果没有通道可用，default 情况将被执行。<ul><li>如果没有 default，select 将会阻塞，直到某个通道可以运行；Golang 不会重新对 channel 或 值进行求值。</li></ul></li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        ch &lt;- <span class="number">10</span></span><br><span class="line">        fmt.Println(<span class="string">&quot;数据已写入&quot;</span>)</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">select</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> x := &lt;-ch:</span><br><span class="line">        fmt.Println(<span class="string">&quot;数据已读出:&quot;</span>, x)</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;default..&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ---------------------------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line"><span class="keyword">default</span>..</span><br></pre></td></tr></table></figure><p>由于 <code>goroutine</code> 来不及启动完成，<code>select</code> 就执行了，此时 <code>case</code> 不满足，所以运行 <code>default</code>。<br>如果 <code>select</code> 之前睡眠一下，给 <code>goroutine</code> 点时间，就可以运行到 <code>case</code> 了。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        ch &lt;- <span class="number">10</span></span><br><span class="line">        fmt.Println(<span class="string">&quot;数据已写入&quot;</span>)</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    time.Sleep(<span class="number">500</span> * time.Millisecond)</span><br><span class="line">    <span class="keyword">select</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> x := &lt;-ch:</span><br><span class="line">        fmt.Println(<span class="string">&quot;数据已读出:&quot;</span>, x)</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;default..&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ---------------------------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line">数据已写入</span><br><span class="line">数据已读出: <span class="number">10</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
          <category> Adavanced </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Golang [进阶] 16-并发</title>
      <link href="posts/a6eafc24"/>
      <url>posts/a6eafc24</url>
      
        <content type="html"><![CDATA[<p>并发</p><span id="more"></span><h1 id="0-并发"><a href="#0-并发" class="headerlink" title="0-并发"></a>0-并发</h1><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20210210160730868_457.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20210210160730868_457.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="串行、并行、并发"></p><h2 id="goroutine"><a href="#goroutine" class="headerlink" title="goroutine"></a>goroutine</h2><p>Golang 并发通过 <code>goroutine</code> 实现，类似于线程，属于用户态的线程。<br><code>goroutine</code> 开销非常小，所以一个程序开辟数千个都没问题。</p><p>Golang 在语言层面已经内置了调度和上下文切换的机制，会智能地将 <code>goroutine</code> 种的任务合理地分配给每个CPU。</p><p>当需要让某个任务并发的执行时，只要把这个任务包装成一个函数，开启一个 <code>goroutine</code> 去执行这个函数即可。</p><h2 id="主-goroutine"><a href="#主-goroutine" class="headerlink" title="主 goroutine"></a>主 goroutine</h2><p><code>main()</code> 函数自己本身就处于 <code>主 goroutine</code>。<br><code>主 goroutine</code> 结束的时候，其他执行完毕的、未执行完毕的 <code>子 goroutine</code> 也会一并被结束。</p><p><code>主 goroutine</code> 的任务：</p><ol><li><strong>设定每个 <code>goroutine</code> 所能申请的栈空间的最大尺寸</strong>。<br>在 32 位系统中最大尺寸为 250MB，64 位系统中最大尺寸为 1GB。如果某个 <code>goroutine</code> 的占空间尺寸大于这个限制，则运行时系统会引发一个栈溢出（Stack Overflow）的 <code>panic</code>，随后这个程序也会终止。</li><li><strong>执行初始化工作</strong>：<ol><li>创建一个特殊的 <code>defer</code> 语句，用于<code>主 goroutine</code> 退出时做必要的善后处理。因为 <code>主 goroutine</code> 也可能非正常结束。</li><li>启动专用于 <code>GC(Garbage Clean)</code> 的 <code>goroutine</code>，并设置 GC 可用的标识。</li><li>执行 <code>main</code> 包中的 <code>init()</code> 函数。</li><li>执行 <code>main()</code> 函数。</li></ol></li><li>在 <code>main()</code> 函数结束后，<strong>检查 <code>主 goroutine</code> 是否引发了运行时 panic</strong>，并进行必要的处理。</li><li>最后，<strong>结束自己及当前进程的运行</strong>。</li></ol><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>一个 <code>goroutine</code> 必对应一个函数，可以创建多个 <code>goroutine</code> 去执行相同的函数。<br>只需要在函数调用处加上 <code>go</code> 关键字修饰，即可为一个函数创建一个 <code>goroutine</code>。</p><h3 id="单个goroutine"><a href="#单个goroutine" class="headerlink" title="单个goroutine"></a>单个goroutine</h3><p>串行程序：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hello</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    hello()</span><br><span class="line">    fmt.Println(<span class="string">&quot;Main Function&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ---------------------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line">Hello World</span><br><span class="line">Main Function</span><br></pre></td></tr></table></figure><p><code>goroutine</code> 并发程序：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hello</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">go</span> hello()    <span class="comment">// 为 hello() 开启一个 goroutine</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;Main Function&quot;</span>)</span><br><span class="line">    time.Sleep(time.Second)    <span class="comment">// 让主程序休眠一下</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ---------------------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line">Hello World</span><br><span class="line">Main Function</span><br></pre></td></tr></table></figure><h3 id="多个goroutine"><a href="#多个goroutine" class="headerlink" title="多个goroutine"></a>多个goroutine</h3><p>在单个 <code>goroutine</code> 的例子中，为了防止 <code>主 goroutine</code> 快于 <code>子 goroutine</code> 完成，导致 <code>子 goroutine</code> 来不及完成就退出程序，在 <code>main()</code> 中添加了一条 <code>time.Sleep()</code>。虽然暂时可以解决这个问题，但是不优雅，也不科学。</p><div class="note info"><p>所以我们需要使用 <code>sync.WaitGroup</code> 来同步多个 <code>goroutine</code>。</p></div><p>使用步骤：</p><ol><li>声明一个 <code>sync.WaitGroup</code> 对象</li><li>添加一个计数器</li><li>调用 <code>Wait()</code> 等待</li><li>在 <code>goroutine</code> 中 <code>defer</code> 修饰 <code>sync.WaitGroup</code> 的 <code>Done()</code> 方法</li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup    <span class="comment">// 声明一个 WaitGroup 对象</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    wg.Add(<span class="number">10</span>)    <span class="comment">// 添加一个计数器</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">        <span class="keyword">go</span> hello(i)</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Main Function&quot;</span>)</span><br><span class="line">    wg.Wait()    <span class="comment">// 等待计数器归零再往下走</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hello</span><span class="params">(i <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> wg.Done()    <span class="comment">// 计数器 -1</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;Hello &quot;</span>, i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// -------------------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line">Hello  <span class="number">1</span></span><br><span class="line">Hello  <span class="number">2</span></span><br><span class="line">Hello  <span class="number">3</span></span><br><span class="line">Hello  <span class="number">4</span></span><br><span class="line">Main Function</span><br><span class="line">Hello  <span class="number">9</span></span><br><span class="line">Hello  <span class="number">6</span></span><br><span class="line">Hello  <span class="number">7</span></span><br><span class="line">Hello  <span class="number">8</span></span><br><span class="line">Hello  <span class="number">0</span></span><br><span class="line">Hello  <span class="number">5</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
          <category> Adavanced </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>计算机网络 [1-物理层]</title>
      <link href="posts/81730e0e"/>
      <url>posts/81730e0e</url>
      
        <content type="html"><![CDATA[<p>梦开始的地方</p><span id="more"></span><h1 id="1-物理层"><a href="#1-物理层" class="headerlink" title="1-物理层"></a>1-物理层</h1><blockquote><p>物理层解决如何在连接各种计算机的传输媒体上<strong>传输数据比特流</strong>，而不是指具体的传输媒体。</p></blockquote><p>主要任务：确定与传输媒体接口相关的一些特性 -&gt; 定义标准</p><ol><li><p><strong>机械特性</strong>：定义物理连接的特性，规定物理连接时所采用的规格、接口形状、<code>引线数目</code>、<code>引脚数量</code>和排列情况。</p><p> <img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/408/NET/RJ45.jpeg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/408/NET/RJ45.jpeg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></li><li><p><strong>电气特性</strong>：规定传输二进制位时，线路上信号的<code>电压范围</code>、阻抗匹配、传输<code>速率</code>和<code>距离</code>限制等。</p><p> 如：某网络在物理层规定，用<code>+10v ～ +15v</code>表示二进制 0, 用<code>-10v ～ -15v</code>表示二进制 1，电线长度 &lt; 15m</p></li><li><p><strong>功能特性</strong>：指明某条线上出现的某一电平表示何种意义，接口部件的信号线的用途。</p><p> 如：描述一个物理层接口引脚处于高电平时的含义。</p></li><li><p><strong>规程特性</strong>：也叫过程特性，定义各条物理线路的<code>工作规程</code>和<code>时序关系</code>。</p></li></ol><h3 id="典型的数据通信模型"><a href="#典型的数据通信模型" class="headerlink" title="典型的数据通信模型"></a>典型的数据通信模型</h3><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/408/NET/20210717144541.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/408/NET/20210717144541.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>通信的目的是<strong>传送消息</strong>。</p><ul><li><p>数据：传送信息的实体，通常是有意义的符号序列。</p></li><li><p>信号：数据的电气/电磁的表现，是数据在传输过程中的存在形式。</p><ul><li>数字信号：代表消息的参数取值是离散的。<img no-lazy class="inline" src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/408/NET/20210717150845.png" style="height:40px;"/></li><li>模拟信号：代表消息的参数取值是连续的。<img no-lazy class="inline" src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/408/NET/20210717150844.png" style="height:40px;"/></li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> 408 </category>
          
          <category> NET </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 计算机网络 </tag>
            
            <tag> 物理层 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Golang [基础] 15-单元测试</title>
      <link href="posts/d0d1ce"/>
      <url>posts/d0d1ce</url>
      
        <content type="html"><![CDATA[<p>单元测试的创建与使用</p><span id="more"></span><h1 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h1><p>Golang 的单元测试依赖 <code>go test</code> 命令，编写测试代码和编写普通代码一样，只需要遵循一定的规则即可。</p><p><code>go test</code> 命令是一个按照一定约定和组织的测试代码的驱动程序。</p><blockquote><p>所有以 <code>_text.go</code> 为后缀的源代码文件都是 <code>go test</code> 测试的一部分，不会被 <code>go build</code> 编译到可执行文件中；</p></blockquote><p>测试文件 <code>xxx_test.go</code> 中有三种类型函数：<code>单元测试函数</code>、<code>基准测试函数</code>、<code>示例函数</code>.</p><table><thead><tr><th>类型</th><th>前缀</th><th>格式</th><th>作用</th></tr></thead><tbody><tr><td>单元测试函数</td><td>Test</td><td>TestTTT(t *testing.T)</td><td>测试程序的逻辑性为是否正确</td></tr><tr><td>基准测试函数</td><td>Benchmark</td><td>BenchmarkBBB(b *testing.B)</td><td>测试程序的性能</td></tr><tr><td>示例函数</td><td>Example</td><td>ExampleEEE()</td><td>为文档提供示例</td></tr></tbody></table><p>在 <code>go test</code> 命令执行的过程中，会遍历所有 <code>_text.go</code> 文件中所有带有上述前缀的函数，生成一个临时 <code>main</code> 包用于调用相应的测试函数，然后编译、运行、报告测试结果、清理临时文件。</p><h2 id="go-test-命令"><a href="#go-test-命令" class="headerlink" title="go test 命令"></a>go test 命令</h2><p>基本命令是 <code>go test</code>，有很多参数可选，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go <span class="built_in">test</span> [build/flags] [packages] [build/<span class="built_in">test</span> flags &amp; <span class="built_in">test</span> binary flags]</span><br></pre></td></tr></table></figure><ul><li><p>flags:<br>  <code>-v</code>: 打印测试过程<br>  <code>-cover</code>: 打印测试覆盖率<br>  <code>-bench</code>: 执行基准测试<br>  …</p></li><li><p>packages: packages 也就是要执行测试的文件，有两种模式：<code>当前目录模式（local directory mode）</code> 和 <code>包列表模式（package list mode）</code></p><ul><li><p><strong>当前目录模式</strong>：没有填写具体的包名时就是这个模式。</p><p>  比如执行命令 <code>go test</code> 或 <code>go test -v</code> 时，就是这种模式。</p><p>  这种模式下会执行当前目录下的 <code>*_test.go</code> 文件的测试用例。</p><p>  默认不开启缓存，也就是不会缓存上次测试的结果。</p></li><li><p><strong>包列表模式</strong>：填写了具体的包名时就是这个模式。</p><p>  比如执行命令 <code>go test .</code>、<code>go test ./.../...</code> 或 <code>go test package_name</code></p><p>  这种模式下会执行指定的包中的测试文件。</p><p>  默认开启缓存，也就是会缓存上次测试的结果。可以通过 <code>-count=1</code> 关闭缓存。</p></li></ul></li></ul><h2 id="单元测试-1"><a href="#单元测试-1" class="headerlink" title="单元测试"></a>单元测试</h2><h3 id="基本格式"><a href="#基本格式" class="headerlink" title="基本格式"></a>基本格式</h3><ol><li>测试函数必须以 <code>Test</code> 开头</li><li>测试函数参数必须包含一个形参 <code>*testing.T</code></li><li>测试函数没有返回值</li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestFib</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestSiztFmt</span><span class="params">(t *testing.T, n <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>参数 <code>t</code> 用于报告测试成功、失败、日志等信息，其包含如下方法：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *T)</span> <span class="title">Error</span><span class="params">(args ...<span class="keyword">interface</span>&#123;&#125;)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *T)</span> <span class="title">Errorf</span><span class="params">(format <span class="keyword">string</span>, args ...<span class="keyword">interface</span>&#123;&#125;)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *T)</span> <span class="title">Fail</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *T)</span> <span class="title">FailNow</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *T)</span> <span class="title">Failed</span><span class="params">()</span> <span class="title">bool</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *T)</span> <span class="title">Fatal</span><span class="params">(args ...<span class="keyword">interface</span>&#123;&#125;)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *T)</span> <span class="title">Fatalf</span><span class="params">(format <span class="keyword">string</span>, args ...<span class="keyword">interface</span>&#123;&#125;)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *T)</span> <span class="title">Log</span><span class="params">(args ...<span class="keyword">interface</span>&#123;&#125;)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *T)</span> <span class="title">Logf</span><span class="params">(format <span class="keyword">string</span>, args ...<span class="keyword">interface</span>&#123;&#125;)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *T)</span> <span class="title">Name</span><span class="params">()</span> <span class="title">string</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *T)</span> <span class="title">Parallel</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *T)</span> <span class="title">Run</span><span class="params">(name <span class="keyword">string</span>, f <span class="keyword">func</span>(t *T)</span>) <span class="title">bool</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *T)</span> <span class="title">Skip</span><span class="params">(args ...<span class="keyword">interface</span>&#123;&#125;)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *T)</span> <span class="title">SkipNow</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *T)</span> <span class="title">Skipf</span><span class="params">(format <span class="keyword">string</span>, args ...<span class="keyword">interface</span>&#123;&#125;)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *T)</span> <span class="title">Skipped</span><span class="params">()</span> <span class="title">bool</span></span></span><br></pre></td></tr></table></figure><h3 id="最简单的单元测试"><a href="#最简单的单元测试" class="headerlink" title="最简单的单元测试"></a>最简单的单元测试</h3><p>编写一个斐波那契数列，然后编写单元测试。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fib.go</span></span><br><span class="line"><span class="keyword">package</span> fib</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Fib</span><span class="params">(n <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">2</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> n</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Fib(n<span class="number">-1</span>) + Fib(n<span class="number">-2</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fib_test.go</span></span><br><span class="line"><span class="keyword">package</span> fib</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;testing&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 单元测试函数，以 Test开头</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestFib</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> (</span><br><span class="line">        input    = <span class="number">7</span><span class="comment">// 输入数据</span></span><br><span class="line">        expected = <span class="number">13</span><span class="comment">// 期望结果</span></span><br><span class="line">    )</span><br><span class="line">    actual := Fib(input)<span class="comment">// 程序执行结果</span></span><br><span class="line">       <span class="comment">// 如果与期望结果不一致，则输出错误提示。</span></span><br><span class="line">    <span class="keyword">if</span> actual != expected &#123;</span><br><span class="line">        t.Errorf(<span class="string">&quot;Fib(%d) = %d; expected %d&quot;</span>, input, actual, expected)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go <span class="built_in">test</span></span></span><br><span class="line">PASS</span><br><span class="line">ok      goTest  0.002s</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">pwd</span></span></span><br><span class="line">~/---FILE---/---CODE/GoProject/playground/goTest</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> tree -L 2 .</span></span><br><span class="line">goTest</span><br><span class="line">├── fib.go</span><br><span class="line">├── fib_test.go</span><br><span class="line">└── go.mod</span><br></pre></td></tr></table></figure><p>这是测试通过的结果，如果我们的 <code>Fib()</code> 写错了，则会输出与期望值不同的结果，并报告错误。</p><p>现在将 <code>Fib()</code> 稍微修改一下，测试文件不动，再次执行 <code>go test</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fib.go</span></span><br><span class="line"><span class="keyword">package</span> fib</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Fib</span><span class="params">(n <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">2</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> n</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// return Fib(n-1) + Fib(n-2)</span></span><br><span class="line">    <span class="keyword">return</span> Fib(n<span class="number">-1</span>) + Fib(n<span class="number">-1</span>)<span class="comment">// 修改一下</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go <span class="built_in">test</span></span></span><br><span class="line">--- FAIL: TestFib (0.00s)</span><br><span class="line">    fib_test.go:12: Fib(7) = 64; expected 13</span><br><span class="line">FAIL</span><br><span class="line">exit status 1</span><br><span class="line">FAIL    goTest  0.002s</span><br></pre></td></tr></table></figure><h3 id="测试组"><a href="#测试组" class="headerlink" title="测试组"></a>测试组</h3><p>单单测试一个例子不够，我们需要多测试几种情况，才能更好的保证我们程序的健壮性。</p><p>在单元测试函数里，我们可以按照测试用例定义一个结构体，然后创建一个结构体切片，将测试用例都放在里面。</p><p>遍历这个切片就可以测试这一整组测试用例。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fib_test.go</span></span><br><span class="line"><span class="keyword">package</span> fib</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;testing&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestFib</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    <span class="keyword">type</span> test <span class="keyword">struct</span> &#123; <span class="comment">// 定义一个测试用例结构体</span></span><br><span class="line">        in   <span class="keyword">int</span></span><br><span class="line">        want <span class="keyword">int</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 创建一个结构体切片存放所有测试用例</span></span><br><span class="line">    tests := []test&#123;</span><br><span class="line">        &#123;in: <span class="number">7</span>, want: <span class="number">13</span>&#125;,</span><br><span class="line">        &#123;in: <span class="number">10</span>, want: <span class="number">55</span>&#125;,</span><br><span class="line">        &#123;in: <span class="number">1</span>, want: <span class="number">1</span>&#125;,</span><br><span class="line">        &#123;in: <span class="number">2</span>, want: <span class="number">1</span>&#125;,</span><br><span class="line">        &#123;in: <span class="number">-1</span>, want: <span class="number">-1</span>&#125;,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 遍历结构体切片，逐一测试每个测试用例</span></span><br><span class="line">    <span class="keyword">for</span> _, tc := <span class="keyword">range</span> tests &#123;</span><br><span class="line">        <span class="keyword">if</span> got := Fib(tc.in); got != tc.want &#123;</span><br><span class="line">            t.Errorf(<span class="string">&quot;Fib(%d) = %d; expected %d&quot;</span>, tc.in, got, tc.want)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>定义测试用例结构体</li><li>创建测试用例结构体切片，放置所有测试用例</li><li>遍历切片逐一测试每个测试用例</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 测试成功</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> go <span class="built_in">test</span></span></span><br><span class="line">PASS</span><br><span class="line">ok      goTest  0.002s</span><br></pre></td></tr></table></figure><p>接着修改 <code>Fib()</code> 让其出错，再进行测试</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 测试失败</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> go <span class="built_in">test</span></span></span><br><span class="line">--- FAIL: TestFib (0.00s)</span><br><span class="line">    fib_test.go:21: Fib(7) = 64; expected 13</span><br><span class="line">    fib_test.go:21: Fib(10) = 512; expected 55</span><br><span class="line">    fib_test.go:21: Fib(2) = 2; expected 1</span><br><span class="line">FAIL</span><br><span class="line">exit status 1</span><br><span class="line">FAIL    goTest  0.002s</span><br></pre></td></tr></table></figure><h3 id="子测试"><a href="#子测试" class="headerlink" title="子测试"></a>子测试</h3><p>测试组在测试用例少的时候还比较好处理，但是用例多起来的时候就没法直接看出是哪些用例不通过了，所以我们可以使用官方提供的子测试。</p><p>还是一样定义一个测试用例结构体，但接着我们不是创建结构体切片，而是创建结构体 map 存放所有测试用例，遍历结构体 map，逐一调用 <code>t.Run()</code> 来测试每一个测试用例。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fib_test.go</span></span><br><span class="line"><span class="keyword">package</span> fib</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;testing&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestFib</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    <span class="keyword">type</span> test <span class="keyword">struct</span> &#123; <span class="comment">// 定义一个测试用例结构体</span></span><br><span class="line">        in   <span class="keyword">int</span></span><br><span class="line">        want <span class="keyword">int</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 创建一个结构体切片存放所有测试用例</span></span><br><span class="line">    tests := <span class="keyword">map</span>[<span class="keyword">string</span>]test&#123;</span><br><span class="line">        <span class="string">&quot;case7&quot;</span>:         &#123;in: <span class="number">7</span>, want: <span class="number">13</span>&#125;,</span><br><span class="line">        <span class="string">&quot;case10&quot;</span>:        &#123;in: <span class="number">10</span>, want: <span class="number">55</span>&#125;,</span><br><span class="line">        <span class="string">&quot;case1&quot;</span>:         &#123;in: <span class="number">1</span>, want: <span class="number">1</span>&#125;,</span><br><span class="line">        <span class="string">&quot;case2&quot;</span>:         &#123;in: <span class="number">2</span>, want: <span class="number">1</span>&#125;,</span><br><span class="line">        <span class="string">&quot;case_negative&quot;</span>: &#123;in: <span class="number">-1</span>, want: <span class="number">-1</span>&#125;,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> name, tc := <span class="keyword">range</span> tests &#123;</span><br><span class="line">        t.Run(name, <span class="function"><span class="keyword">func</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">            <span class="keyword">if</span> got := Fib(tc.in); got != tc.want &#123;</span><br><span class="line">                t.Errorf(<span class="string">&quot;Fib(%d) = %d; expected %d&quot;</span>, tc.in, got, tc.want)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>t.Run()</code> 接受两个参数，一个是测试用例的名字，也就是 map 中的 key，另一个是一个 <code>func(t *testing.T)</code> 函数，在函数中写上具体的测试代码。</p><p>执行时带上 <code>-v</code> 参数，可以很直观看出哪些用例通过了 (PASS) 哪些没通过 (FAIL)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go <span class="built_in">test</span> -v</span></span><br><span class="line">=== RUN   TestFib</span><br><span class="line">=== RUN   TestFib/case7</span><br><span class="line">    fib_test.go:22: Fib(7) = 64; expected 13</span><br><span class="line">=== RUN   TestFib/case10</span><br><span class="line">    fib_test.go:22: Fib(10) = 512; expected 55</span><br><span class="line">=== RUN   TestFib/case1</span><br><span class="line">=== RUN   TestFib/case2</span><br><span class="line">    fib_test.go:22: Fib(2) = 2; expected 1</span><br><span class="line">=== RUN   TestFib/case_negative</span><br><span class="line">--- FAIL: TestFib (0.00s)</span><br><span class="line">    --- FAIL: TestFib/case7 (0.00s)</span><br><span class="line">    --- FAIL: TestFib/case10 (0.00s)</span><br><span class="line">    --- PASS: TestFib/case1 (0.00s)</span><br><span class="line">    --- FAIL: TestFib/case2 (0.00s)</span><br><span class="line">    --- PASS: TestFib/case_negative (0.00s)</span><br><span class="line">FAIL</span><br><span class="line">exit status 1</span><br><span class="line">FAIL    goTest  0.002s</span><br></pre></td></tr></table></figure><p>执行时带上 <code>-run</code> 参数还可以指定运行哪一个测试用例</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go <span class="built_in">test</span> . -v -run=TestFib/case7</span></span><br><span class="line">=== RUN   TestFib</span><br><span class="line">=== RUN   TestFib/case7</span><br><span class="line">    fib_test.go:22: Fib(7) = 64; expected 13</span><br><span class="line">--- FAIL: TestFib (0.00s)</span><br><span class="line">    --- FAIL: TestFib/case7 (0.00s)</span><br><span class="line">FAIL</span><br><span class="line">exit status 1</span><br><span class="line">FAIL    goTest  0.002s</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> go <span class="built_in">test</span> . -v -run=Fib/case_negative</span></span><br><span class="line">=== RUN   TestFib</span><br><span class="line">=== RUN   TestFib/case_negative</span><br><span class="line">--- PASS: TestFib (0.00s)</span><br><span class="line">    --- PASS: TestFib/case_negative (0.00s)</span><br><span class="line">PASS</span><br><span class="line">ok      goTest  0.002s</span><br></pre></td></tr></table></figure><p><code>-run=RegExp</code>， <code>-run</code> 参数后带的是一个正则表达式，但是一般都像这样使用：<code>-run=X/Y</code>，其中：</p><ul><li><p>X 是 <code>TestAAA</code> 中的 <code>AAA</code>，或者直接写全: <code>TestAAA</code> ，</p></li><li><p>Y 是测试用例结构体 map 的 key。如上面例子中 <code>-run=Fib/case_negative</code> 的 <code>case_negative</code> 就是 key。</p></li></ul><h3 id="覆盖率"><a href="#覆盖率" class="headerlink" title="覆盖率"></a>覆盖率</h3><p>覆盖率就是你的代码被测试用例覆盖的百分比。通常这个覆盖指 <a href="https://en.wikipedia.org/wiki/Code_coverage">语句覆盖</a>。</p><p>输出覆盖率有两种方式：<code>-cover</code>、<code>-coverprofile=outfile</code></p><ul><li>使用 <code>-cover</code> 可以打印代码覆盖率。</li><li>使用 <code>-coverprofile</code> 可以将更详细的覆盖信息输出到指定文件中。</li></ul><p><strong>-cover</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go <span class="built_in">test</span> -cover</span></span><br><span class="line">PASS</span><br><span class="line">coverage: 100.0% of statements</span><br><span class="line">ok      goTest  0.002s</span><br></pre></td></tr></table></figure><p><strong>-coverprofile</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go <span class="built_in">test</span> -coverprofile=fib.cover</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> tree -L 2 .</span></span><br><span class="line">goTest</span><br><span class="line">├── fib.cover</span><br><span class="line">├── fib.go</span><br><span class="line">├── fib_test.go</span><br><span class="line">└── go.mod</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> go tool cover -html=fib.cover</span></span><br></pre></td></tr></table></figure><p>使用 <code>go tool cover -html=制定文件</code> 命令会打开默认浏览器显示具体的覆盖率信息。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20210623230022.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20210623230022.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>如上图，绿色表示被覆盖的语句，红色表示未被覆盖的语句，灰色表示未追踪的语句。</p><h2 id="基准测试"><a href="#基准测试" class="headerlink" title="基准测试"></a>基准测试</h2><h3 id="基本格式-1"><a href="#基本格式-1" class="headerlink" title="基本格式"></a>基本格式</h3><ol><li>测试函数必须以 <code>Benchmark</code> 开头</li><li>测试函数参数只能包含一个形参 <code>*testing.B</code></li><li>测试函数没有返回值</li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkFib</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkSiztFmt</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>参数 <code>t</code> 用于报告测试成功、失败、日志等信息，其包含如下方法：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *B)</span> <span class="title">Error</span><span class="params">(args ...<span class="keyword">interface</span>&#123;&#125;)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *B)</span> <span class="title">Errorf</span><span class="params">(format <span class="keyword">string</span>, args ...<span class="keyword">interface</span>&#123;&#125;)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *B)</span> <span class="title">Fail</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *B)</span> <span class="title">FailNow</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *B)</span> <span class="title">Failed</span><span class="params">()</span> <span class="title">bool</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *B)</span> <span class="title">Fatal</span><span class="params">(args ...<span class="keyword">interface</span>&#123;&#125;)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *B)</span> <span class="title">Fatalf</span><span class="params">(format <span class="keyword">string</span>, args ...<span class="keyword">interface</span>&#123;&#125;)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *B)</span> <span class="title">Log</span><span class="params">(args ...<span class="keyword">interface</span>&#123;&#125;)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *B)</span> <span class="title">Logf</span><span class="params">(format <span class="keyword">string</span>, args ...<span class="keyword">interface</span>&#123;&#125;)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *B)</span> <span class="title">Name</span><span class="params">()</span> <span class="title">string</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *B)</span> <span class="title">ReportAllocs</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *B)</span> <span class="title">ResetTimer</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *B)</span> <span class="title">Run</span><span class="params">(name <span class="keyword">string</span>, f <span class="keyword">func</span>(b *B)</span>) <span class="title">bool</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *B)</span> <span class="title">RunParallel</span><span class="params">(body <span class="keyword">func</span>(*PB)</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *B)</span> <span class="title">SetBytes</span><span class="params">(n <span class="keyword">int64</span>)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *B)</span> <span class="title">SetParallelism</span><span class="params">(p <span class="keyword">int</span>)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *B)</span> <span class="title">Skip</span><span class="params">(args ...<span class="keyword">interface</span>&#123;&#125;)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *B)</span> <span class="title">SkipNow</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *B)</span> <span class="title">Skipf</span><span class="params">(format <span class="keyword">string</span>, args ...<span class="keyword">interface</span>&#123;&#125;)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *B)</span> <span class="title">Skipped</span><span class="params">()</span> <span class="title">bool</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *B)</span> <span class="title">StartTimer</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *B)</span> <span class="title">StopTimer</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure><h3 id="最简单的基准测试"><a href="#最简单的基准测试" class="headerlink" title="最简单的基准测试"></a>最简单的基准测试</h3><p>编写一个容量格式化函数，然后编写对应的基准测试函数。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sizefmt.go</span></span><br><span class="line"><span class="keyword">package</span> sizefmt</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;strconv&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sizeFmt</span><span class="params">(bit <span class="keyword">int64</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">const</span> (<span class="comment">// 定义几个数量级</span></span><br><span class="line">        _        = <span class="literal">iota</span></span><br><span class="line">        KB <span class="keyword">int64</span> = <span class="number">1</span> &lt;&lt; (<span class="number">10</span>*<span class="literal">iota</span> + <span class="number">3</span>)</span><br><span class="line">        MB</span><br><span class="line">        GB</span><br><span class="line">    )</span><br><span class="line">    sizeFloat := <span class="keyword">float64</span>(bit)</span><br><span class="line">    unit := <span class="string">&quot;b&quot;</span></span><br><span class="line">    <span class="keyword">switch</span> &#123;<span class="comment">// 根据 bit 参数的大小格式化不同的单位</span></span><br><span class="line">    <span class="keyword">case</span> bit &lt; KB:</span><br><span class="line">        <span class="keyword">return</span> strconv.FormatInt(bit, <span class="number">10</span>) + unit</span><br><span class="line">    <span class="keyword">case</span> bit &gt;= KB &amp;&amp; bit &lt; MB:</span><br><span class="line">        sizeFloat /= <span class="number">1</span> &lt;&lt; <span class="number">10</span></span><br><span class="line">        unit = <span class="string">&quot;K&quot;</span></span><br><span class="line">    <span class="keyword">case</span> bit &gt;= MB &amp;&amp; bit &lt; GB:</span><br><span class="line">        sizeFloat /= <span class="number">1</span> &lt;&lt; <span class="number">20</span></span><br><span class="line">        unit = <span class="string">&quot;M&quot;</span></span><br><span class="line">    <span class="keyword">case</span> bit &gt;= GB:</span><br><span class="line">        sizeFloat /= <span class="number">1</span> &lt;&lt; <span class="number">30</span></span><br><span class="line">        unit = <span class="string">&quot;G&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> strconv.FormatFloat(sizeFloat, <span class="string">&#x27;f&#x27;</span>, <span class="number">2</span>, <span class="number">64</span>) + unit</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后编写基准测试函数。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sizefmt_test.go</span></span><br><span class="line"><span class="keyword">package</span> sizefmt</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;testing&quot;</span></span><br><span class="line"><span class="comment">// 基准测试函数以 Benchmark 开头</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkSizefmt</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ &#123;<span class="comment">// b.N 不是一个固定的值，它会不断迭代</span></span><br><span class="line">        sizeFmt(<span class="number">1</span>&lt;&lt;<span class="number">20</span> + <span class="number">554</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在 for 循环中使用到了一个 <code>b.N</code>，这个变量 不是一个固定的值，它会从 1 不断的迭代，例如 1、2、5、10、20、50…，保证基准测试函数的执行时间至少超过 1 秒钟。这样得到的数据才比较有参考性。</p><p>从 1 开始是保证被测试函数 <code>sizeFmt</code> 至少没问题能跑得动。</p><p>使用 <code>-bench=RegExp</code> 来指定只执行基准测试。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go <span class="built_in">test</span> . -bench=Sizefmt</span></span><br><span class="line">goos: linux</span><br><span class="line">goarch: amd64</span><br><span class="line">pkg: goTest</span><br><span class="line">cpu: Intel(R) Core(TM) i5-7300HQ CPU @ 2.50GHz</span><br><span class="line">BenchmarkSizefmt-4       3589545               330.4 ns/op</span><br><span class="line">PASS</span><br><span class="line">ok      goTest  1.528s</span><br></pre></td></tr></table></figure><ul><li>goos: 当前操作系统</li><li>goarch: 当前芯片架构</li><li>pkg: 基准测试函数所在的包</li><li>cpu: 当前机器上 CPU 信息</li><li><code>BenchmarkSizefmt-4</code>: 对 <code>sizeFmt</code> 函数进行基准测试，当前 <code>GOMAXPROCS</code> 的值，这个对于开发基准测试很重要。</li><li><code>3589545</code>: 执行了3百多万次</li><li><code>330.4 ns/op</code>: 在这3百多万次调用里平均每次调用 <code>sizeFmt</code> 函数耗时 330.4 纳秒。</li><li><code>PASS</code>: 用于基准测试的用例执行通过</li><li><code>ok      goTest  1.528s</code>: 共耗时 1.528 秒</li></ul><p>使用 <code>-benchmem</code> 参数可以获得内存分配的统计数据</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go <span class="built_in">test</span> . -bench=Sizefmt -benchmem</span></span><br><span class="line">goos: linux</span><br><span class="line">goarch: amd64</span><br><span class="line">pkg: goTest</span><br><span class="line">cpu: Intel(R) Core(TM) i5-7300HQ CPU @ 2.50GHz</span><br><span class="line">BenchmarkSizefmt-4   3589545 330.4 ns/op40 B/op3 allocs/op</span><br><span class="line">PASS</span><br><span class="line">ok      goTest  1.528s</span><br></pre></td></tr></table></figure><ul><li><code>40 B/op</code>: 平均每次调用 <code>sizeFmt</code> 函数占用 40 个字节</li><li><code>3 allocs/op</code>: 每次调用 <code>sizeFmt</code> 需要申请 3 次内存</li></ul><h3 id="性能比较函数"><a href="#性能比较函数" class="headerlink" title="性能比较函数"></a>性能比较函数</h3><p>上述例子我们得到的是给定例子的绝对耗时，但有些问题，例如斐波那契数列，数量不多的时候耗时还不会太长，但是当计算到 40 左右的时候就已经慢的不行了。</p><p>现在我们想要知道，当 <code>Fib(n)</code> 的 n 为 1、10、20、40、45 的时候他们的性能。</p><p>于是我们可以编写一个基准测试函数，不仅接受 <code>b *testing.B</code>，还接受另外一个参数 <code>n</code>，然后编写几个基准测试函数来测试。如下：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fib.go</span></span><br><span class="line"><span class="keyword">package</span> fib</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Fib</span><span class="params">(n <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">2</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> n</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Fib(n<span class="number">-1</span>) + Fib(n<span class="number">-2</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fib_test.go</span></span><br><span class="line"><span class="keyword">package</span> fib</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;testing&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 把原本的基准函数变成小写开头，这样 -bench=Fib 的时候也不会直接匹配到</span></span><br><span class="line"><span class="comment">// 然后带上一个参数 n</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">benchmarkFib</span><span class="params">(b *testing.B, n <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ &#123;</span><br><span class="line">        fib(n)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 编写几个不同 n 的基准测试函数，每次去调用原本的基准测试函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkFib1</span><span class="params">(b *testing.B)</span></span>  &#123; benchmarkFib(b, <span class="number">1</span>) &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkFib10</span><span class="params">(b *testing.B)</span></span> &#123; benchmarkFib(b, <span class="number">10</span>) &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkFib20</span><span class="params">(b *testing.B)</span></span> &#123; benchmarkFib(b, <span class="number">20</span>) &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkFib40</span><span class="params">(b *testing.B)</span></span> &#123; benchmarkFib(b, <span class="number">40</span>) &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkFib45</span><span class="params">(b *testing.B)</span></span> &#123; benchmarkFib(b, <span class="number">45</span>) &#125;</span><br></pre></td></tr></table></figure><p>然后执行命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go <span class="built_in">test</span> -bench=Fib -benchmem</span></span><br><span class="line">goos: linux</span><br><span class="line">goarch: amd64</span><br><span class="line">pkg: goTest</span><br><span class="line">cpu: Intel(R) Core(TM) i5-7300HQ CPU @ 2.50GHz</span><br><span class="line">BenchmarkFibGreedy1-4    457008499         2.601 ns/op   0 B/op    0 allocs/op</span><br><span class="line">BenchmarkFibGreedy10-4   2589387           462.6 ns/op   0 B/op    0 allocs/op</span><br><span class="line">BenchmarkFibGreedy20-4   19940             57224 ns/op   0 B/op    0 allocs/op</span><br><span class="line">BenchmarkFibGreedy40-4   2         865527961 ns/op   0 B/op    0 allocs/op</span><br><span class="line">BenchmarkFibGreedy45-4   1            9598796528 ns/op   0 B/op    0 allocs/op</span><br><span class="line">PASS</span><br><span class="line">ok      goTest  17.082s</span><br></pre></td></tr></table></figure><p>可以看出，n 比较少的时候，执行的次数比较多，每次耗费的时间也不多。当 n 超过 40 以后，机器有点受不了了， 45 仅仅只执行了一次，还耗时 9 秒多。</p><p>主要的原因是采用了递归求斐波那契数列，调用栈很快就爆满了。</p><p>得到性能数据信息以后，我们就得知这个 <code>Fib</code> 在 n 稍大时效果不理想，应做改进。</p><p>递归属于分治法中的一种，我们可以换成动态规划来解决这个问题。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fib.go</span></span><br><span class="line"><span class="keyword">package</span> fib</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用递归求斐波那契数列</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fibDAC</span><span class="params">(n <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">2</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> n</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> fibDAC(n<span class="number">-1</span>) + fibDAC(n<span class="number">-2</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用动态规划求</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fibDP</span><span class="params">(n <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">2</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> n</span><br><span class="line">    &#125;</span><br><span class="line">    slice := <span class="built_in">make</span>([]<span class="keyword">int</span>, n)</span><br><span class="line">    slice[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">    slice[<span class="number">1</span>] = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">2</span>; i &lt; n; i++ &#123;</span><br><span class="line">        slice[i] = slice[i<span class="number">-1</span>] + slice[i<span class="number">-2</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> slice[n<span class="number">-1</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fib_test.go</span></span><br><span class="line"><span class="keyword">package</span> fib</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;testing&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">benchmarkFibDAC</span><span class="params">(b *testing.B, n <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ &#123;</span><br><span class="line">        fibDAC(n)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkFibDAC1</span><span class="params">(b *testing.B)</span></span>  &#123; benchmarkFibDAC(b, <span class="number">1</span>) &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkFibDAC10</span><span class="params">(b *testing.B)</span></span> &#123; benchmarkFibDAC(b, <span class="number">10</span>) &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkFibDAC20</span><span class="params">(b *testing.B)</span></span> &#123; benchmarkFibDAC(b, <span class="number">20</span>) &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkFibDAC40</span><span class="params">(b *testing.B)</span></span> &#123; benchmarkFibDAC(b, <span class="number">40</span>) &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkFibDAC45</span><span class="params">(b *testing.B)</span></span> &#123; benchmarkFibDAC(b, <span class="number">45</span>) &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">benchmarkFibDP</span><span class="params">(b *testing.B, n <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ &#123;</span><br><span class="line">        fibDP(n)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkFibDP1</span><span class="params">(b *testing.B)</span></span>    &#123; benchmarkFibDP(b, <span class="number">1</span>) &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkFibDP10</span><span class="params">(b *testing.B)</span></span>   &#123; benchmarkFibDP(b, <span class="number">10</span>) &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkFibDP100</span><span class="params">(b *testing.B)</span></span>  &#123; benchmarkFibDP(b, <span class="number">100</span>) &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkFibDP1000</span><span class="params">(b *testing.B)</span></span> &#123; benchmarkFibDP(b, <span class="number">1000</span>) &#125;</span><br></pre></td></tr></table></figure><p>执行测试：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go <span class="built_in">test</span> -bench=FibDP -benchmem</span></span><br><span class="line">goos: linux</span><br><span class="line">goarch: amd64</span><br><span class="line">pkg: goTest</span><br><span class="line">cpu: Intel(R) Core(TM) i5-7300HQ CPU @ 2.50GHz</span><br><span class="line">BenchmarkFibDP1-4       1000000000   0.4029 ns/op     0 B/op   0 allocs/op</span><br><span class="line">BenchmarkFibDP10-4      20096688      51.87 ns/op    80 B/op   1 allocs/op</span><br><span class="line">BenchmarkFibDP100-4     3030915       380.3 ns/op   896 B/op   1 allocs/op</span><br><span class="line">BenchmarkFibDP1000-4    328071         3656 ns/op  8192 B/op   1 allocs/op</span><br><span class="line">PASS</span><br><span class="line">ok      goTest  5.356s</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> go <span class="built_in">test</span> -bench=FibDAC -benchmem</span></span><br><span class="line">goos: linux</span><br><span class="line">goarch: amd64</span><br><span class="line">pkg: goTest</span><br><span class="line">cpu: Intel(R) Core(TM) i5-7300HQ CPU @ 2.50GHz</span><br><span class="line">BenchmarkFibGreedy1-4    457008499         2.601 ns/op   0 B/op    0 allocs/op</span><br><span class="line">BenchmarkFibGreedy10-4   2589387           462.6 ns/op   0 B/op    0 allocs/op</span><br><span class="line">BenchmarkFibGreedy20-4   19940             57224 ns/op   0 B/op    0 allocs/op</span><br><span class="line">BenchmarkFibGreedy40-4   2         865527961 ns/op   0 B/op    0 allocs/op</span><br><span class="line">BenchmarkFibGreedy45-4   1            9598796528 ns/op   0 B/op    0 allocs/op</span><br><span class="line">PASS</span><br><span class="line">ok      goTest  17.082s</span><br></pre></td></tr></table></figure><p>上面 FibDP 是对动态规划实现的基准测试，下面 FibDAC 是对递归实现的基准测试。可以看到差距十分巨大。</p><p><strong>注意不要拿 b.N 当参数</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误示范1</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkFibWrong</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> n := <span class="number">0</span>; n &lt; b.N; n++ &#123;</span><br><span class="line">        Fib(n)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 错误示范2</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkFibWrong2</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line">    Fib(b.N)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="重置时间"><a href="#重置时间" class="headerlink" title="重置时间"></a>重置时间</h3><p><code>b.ResetTime()</code> 可以重置计时器，也就是这句语句前面的耗时不计入。所以可以执行一些不参与时间测试的工作，然后 <code>b.ResetTimer()</code>.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkFib</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Start Benchmark test of Fib()&quot;</span>)</span><br><span class="line">    time.Sleep(time.Second)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;b.N; i++ &#123;</span><br><span class="line">        Fib(<span class="number">10</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="并行测试"><a href="#并行测试" class="headerlink" title="并行测试"></a>并行测试</h3><h2 id="TestMain、Setup-和-Teardown"><a href="#TestMain、Setup-和-Teardown" class="headerlink" title="TestMain、Setup 和 Teardown"></a>TestMain、Setup 和 Teardown</h2><h3 id="TestMain-基本格式"><a href="#TestMain-基本格式" class="headerlink" title="TestMain 基本格式"></a>TestMain 基本格式</h3><ol><li>函数名为 <code>TestMain</code></li><li>函数参数必须包含一个形参 <code>*testing.M</code></li><li>函数没有返回值</li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestMain</span><span class="params">(m *testing.M)</span></span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>参数 <code>m</code> 用于启动测试，启动方法如下：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *M)</span> <span class="title">Run</span><span class="params">()</span> <span class="params">(code <span class="keyword">int</span>)</span></span></span><br></pre></td></tr></table></figure><p>有时候遇到测试之前需要做一些初始化工作或者测试之后需要做一些收尾工作，就可以用 <code>TestMain()</code> 。</p><p>如果测试文件中包含<code>TestMain()</code>，那么生成的测试将调用 <code>TestMain(m)</code>，而不是直接其他运行测试。</p><p><code>m.Run()</code> 被调用后，将会运行测试文件中所有的测试函数。</p><p><code>TestMain</code> 运行在主 goroutine 中 , 可以在调用 <code>m.Run</code> 前后做任何 Setup 和 Teardown 。</p><p>注意，在 <code>TestMain</code> 函数的最后，应该使用 <code>m.Run</code> 的返回值作为参数去调用 <code>os.Exit</code>。</p><p>另外，在调用 <code>TestMain</code> 时 , <code>flag.Parse</code> 并没有被调用。</p><p>所以，如果 <code>TestMain</code> 依赖于 command-line 标志（包括 <code>testing</code> 包的标志），则应该显式地调用 <code>flag.Parse</code>。注意，这里的依赖是指，若 <code>TestMain</code> 函数内需要用到 command-line 标志，则必须显式地调用 <code>flag.Parse</code>，否则不需要，因为 <code>m.Run</code> 中调用 <code>flag.Parse</code>。</p><h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fib.go</span></span><br><span class="line"><span class="keyword">package</span> fib</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Fib</span><span class="params">(n <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">2</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> n</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Fib(n<span class="number">-1</span>) + Fib(n<span class="number">-2</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fib_test.go</span></span><br><span class="line"><span class="keyword">package</span> fib</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;testing&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 单元测试函数，以 Test开头</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestFib</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> (</span><br><span class="line">        input    = <span class="number">7</span><span class="comment">// 输入数据</span></span><br><span class="line">        expected = <span class="number">13</span><span class="comment">// 期望结果</span></span><br><span class="line">    )</span><br><span class="line">    actual := Fib(input)  <span class="comment">// 程序执行结果</span></span><br><span class="line">    <span class="keyword">if</span> actual != expected &#123;  <span class="comment">// 如果与期望结果不一致，则输出错误提示。</span></span><br><span class="line">        t.Errorf(<span class="string">&quot;Fib(%d) = %d; expected %d&quot;</span>, input, actual, expected)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setup</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;设置一些东西&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">teardown</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;清理一些东西&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestMain</span><span class="params">(m *testing.M)</span></span> &#123;</span><br><span class="line">    setup()</span><br><span class="line">    code := m.Run()</span><br><span class="line">    teardown()</span><br><span class="line">    os.Exit(code)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ go <span class="built_in">test</span></span><br><span class="line">设置一些东西</span><br><span class="line">PASS</span><br><span class="line">清理一些东西</span><br><span class="line">ok      goTest  0.002s</span><br></pre></td></tr></table></figure><h3 id="子测试的-Setup-和-Teardown"><a href="#子测试的-Setup-和-Teardown" class="headerlink" title="子测试的 Setup 和 Teardown"></a>子测试的 Setup 和 Teardown</h3><p>有时候不只是全局进行测试的时候需要 Setup 和 Teardown，有可能每个子测试在测试的时候也需要 Setup 和 Teardown。那可以对 Setup 和 Teardown 尝试以下这种优雅的写法：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setup</span><span class="params">()</span> <span class="title">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Setup&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;Teardown&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后在子测试中这样使用：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestFibDP</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    <span class="comment">// 1 1 2 3 5 8 13 21 34 55</span></span><br><span class="line">    tests := <span class="keyword">map</span>[<span class="keyword">string</span>]test&#123;</span><br><span class="line">        <span class="string">&quot;case1&quot;</span>: &#123;<span class="number">1</span>, <span class="number">1</span>&#125;,</span><br><span class="line">        <span class="string">&quot;case2&quot;</span>: &#123;<span class="number">2</span>, <span class="number">1</span>&#125;,</span><br><span class="line">        <span class="string">&quot;case3&quot;</span>: &#123;<span class="number">3</span>, <span class="number">2</span>&#125;,</span><br><span class="line">        <span class="string">&quot;case4&quot;</span>: &#123;<span class="number">7</span>, <span class="number">13</span>&#125;,</span><br><span class="line">        <span class="string">&quot;case9&quot;</span>: &#123;<span class="number">9</span>, <span class="number">34</span>&#125;,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> name, tc := <span class="keyword">range</span> tests &#123;</span><br><span class="line">        t.Run(name, <span class="function"><span class="keyword">func</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">            teardown := setup()</span><br><span class="line">            <span class="keyword">defer</span> teardown()</span><br><span class="line">            <span class="keyword">if</span> got := fibDP(tc.in); got != tc.want &#123;</span><br><span class="line">                t.Errorf(<span class="string">&quot;want: %v, got: %v&quot;</span>, tc.want, got)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                fmt.Println(<span class="string">&quot;yes!!!&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>效果如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">$ go <span class="built_in">test</span> -run=FibDP -v                                                                                     ──(日,7月11)─┘</span><br><span class="line">=== RUN   TestFibDP</span><br><span class="line">=== RUN   TestFibDP/case1</span><br><span class="line">Setup</span><br><span class="line">yes!!!</span><br><span class="line">Teardown</span><br><span class="line">=== RUN   TestFibDP/case2</span><br><span class="line">Setup</span><br><span class="line">yes!!!</span><br><span class="line">Teardown</span><br><span class="line">=== RUN   TestFibDP/case3</span><br><span class="line">Setup</span><br><span class="line">yes!!!</span><br><span class="line">Teardown</span><br><span class="line">=== RUN   TestFibDP/case4</span><br><span class="line">Setup</span><br><span class="line">yes!!!</span><br><span class="line">Teardown</span><br><span class="line">=== RUN   TestFibDP/case9</span><br><span class="line">Setup</span><br><span class="line">yes!!!</span><br><span class="line">Teardown</span><br><span class="line">--- PASS: TestFibDP (0.00s)</span><br><span class="line">    --- PASS: TestFibDP/case1 (0.00s)</span><br><span class="line">    --- PASS: TestFibDP/case2 (0.00s)</span><br><span class="line">    --- PASS: TestFibDP/case3 (0.00s)</span><br><span class="line">    --- PASS: TestFibDP/case4 (0.00s)</span><br><span class="line">    --- PASS: TestFibDP/case9 (0.00s)</span><br><span class="line">PASS</span><br><span class="line">ok      goTest  0.002s</span><br></pre></td></tr></table></figure><hr><p>参考：</p><p>[李文周博客] : <a href="https://www.liwenzhou.com/posts/Go/16_test/#autoid-3-1-0">https://www.liwenzhou.com/posts/Go/16_test/#autoid-3-1-0</a></p>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
          <category> Basic </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Golang [基础] 14-错误与异常</title>
      <link href="posts/b2fbd54c"/>
      <url>posts/b2fbd54c</url>
      
        <content type="html"><![CDATA[<p>错误与异常的处理</p><span id="more"></span><h1 id="错误与异常"><a href="#错误与异常" class="headerlink" title="错误与异常"></a>错误与异常</h1><blockquote><p>意料之中的叫<strong>错误</strong><br>意料之外的叫<strong>异常</strong></p><p>错误：是指可能出现问题的地方出现了问题，比如打开一个文件时失败，这种情况是在意料之中的。<br>异常：是指不应该出现问题的地方出现了问题，比如引用了空指针，这种情况在人们的意料之外。<br>所以错误是业务过程的一部分，而异常不是。</p></blockquote><h2 id="错误"><a href="#错误" class="headerlink" title="错误"></a>错误</h2><blockquote><p>Go 中错误是一种类型。<br>错误用内置的 <code>error</code>类型表示。和 <code>int、float64</code> 是等价的。</p><p><code>error</code> 是一个接口，接口是一种类型，所以说 <code>error</code> 是一种类型。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> error <span class="keyword">interface</span> &#123;</span><br><span class="line">4Error() <span class="keyword">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>error</code>类型可以存储错误值，从函数中返回等等。</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    f, err := os.Open(<span class="string">&quot;test.txt&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(err)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 根据f进行文件读写</span></span><br><span class="line">    fmt.Println(f.Name(), <span class="string">&quot;opened successfully&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="抛出错误"><a href="#抛出错误" class="headerlink" title="抛出错误"></a>抛出错误</h3><p>在编写桩模块供人调用时，我们不知道调用者会传进来什么参数，所以我们需要对传进来的参数做判断。<br>如果发生错误我们需要进行处理，或者<strong>抛出错误</strong>。</p><p>要抛出错误，那得先会创建错误。</p><p>创建错误有两种方式：</p><ol><li>通过 <code>errors</code> 包的 <code>New()</code> 函数创建：<code>func New(errMsg string) error</code></li><li>通过 <code>fmt</code> 包的 <code>Errorf()</code> 函数创建：<code>func Errorf(format string, a ...interface&#123;&#125;) error</code></li></ol><p>创建错误</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">errors.New(<span class="keyword">string</span>)</span><br><span class="line">fmt.Errorf(<span class="keyword">string</span>, ...<span class="keyword">interface</span>&#123;&#125;)</span><br></pre></td></tr></table></figure><p>这两种方式区别在于：<br><code>fmt.Errorf()</code> 可以使用格式化字符来返回错误信息，而 <code>errors.New()</code> 不能。</p><p>eg：</p><ol><li><p><code>errors.New()</code>：</p> <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">div</span><span class="params">(a, b <span class="keyword">float64</span>)</span> <span class="params">(<span class="keyword">float64</span>, error)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, errors.New(<span class="string">&quot;除数小于0&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a / b, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> 调用的效果：</p> <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fmt.Println(div(<span class="number">10</span>, <span class="number">0</span>))    <span class="comment">// 除数小于0</span></span><br></pre></td></tr></table></figure></li><li><p><code>fmt.Errorf()</code>：</p> <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">div</span><span class="params">(a, b <span class="keyword">float64</span>)</span> <span class="params">(<span class="keyword">float64</span>, error)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, fmt.Errorf(<span class="string">&quot;错误码: [%d] \t 除数小于0&quot;</span>, <span class="number">100</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a / b, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> 调用的效果：</p> <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fmt.Println(div(<span class="number">10</span>, <span class="number">0</span>))    <span class="comment">// 0 错误码: [100]          除数小于0</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="捕获错误"><a href="#捕获错误" class="headerlink" title="捕获错误"></a>捕获错误</h3><p>当我们写驱动模块的时候，在调用桩模块时有可能返回错误，我们可以通过判断 最后一个返回值 err （最后一个返回值返回错误类型，这是约定俗成的）来判断是否有返回错误。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    quotient, err := div(<span class="number">10</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;    <span class="comment">// 捕获错误</span></span><br><span class="line">        fmt.Println(err)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(quotient)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="自定义错误"><a href="#自定义错误" class="headerlink" title="自定义错误"></a>自定义错误</h3><p>简简单单的 <code>Error.New()</code> 和 <code>fmt.Errorf()</code> 有时候并不能满足我们的需求，所以我们还得自定义错误。</p><p>自定义错误分为三步：</p><ol><li>创建一个结构体</li><li>实现 <code>error</code> 接口</li><li>定义其他方法</li></ol><p>其中第一步和第二步是必选的，第三步是可选的。</p><p>eg：</p><p>自定义错误</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建一个结构体</span></span><br><span class="line"><span class="keyword">type</span> dataError <span class="keyword">struct</span> &#123;</span><br><span class="line">    Err    <span class="keyword">string</span></span><br><span class="line">    height <span class="keyword">int</span></span><br><span class="line">    weight <span class="keyword">int</span></span><br><span class="line">    age    <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 实现 error 接口，使 dataError 成为 error 类型</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d *dataError)</span> <span class="title">Error</span><span class="params">()</span> <span class="title">string</span></span> &#123; <span class="keyword">return</span> d.Err &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义其他方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d *dataError)</span> <span class="title">heightNegativeError</span><span class="params">()</span> <span class="title">bool</span></span> &#123; <span class="keyword">return</span> d.height &lt; <span class="number">0</span> &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d *dataError)</span> <span class="title">weightNegativeError</span><span class="params">()</span> <span class="title">bool</span></span> &#123; <span class="keyword">return</span> d.weight &lt; <span class="number">0</span> &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d *dataError)</span> <span class="title">ageNegativeError</span><span class="params">()</span> <span class="title">bool</span></span> &#123; <span class="keyword">return</span> d.age &lt;= <span class="number">0</span> &#125;</span><br></pre></td></tr></table></figure><p>抛出错误</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> status = <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    SUCCESS = <span class="literal">true</span>  <span class="comment">// SUCCESS 验证通过</span></span><br><span class="line">    FAIL    = <span class="literal">false</span><span class="comment">// FAIL    验证未通过</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">    height <span class="keyword">int</span></span><br><span class="line">    weight <span class="keyword">int</span></span><br><span class="line">    age    <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 验证不通过时，抛出错误</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">variety</span><span class="params">(p Person)</span> <span class="params">(status, error)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> p.height &lt; <span class="number">0</span> || p.weight &lt; <span class="number">0</span> || p.age &lt; <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> FAIL, &amp;dataError&#123;<span class="string">&quot;数据有误&quot;</span>, p.height, p.weight, p.age&#125;    <span class="comment">// 抛出错误</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> SUCCESS, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>捕获错误</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    p := Person&#123;<span class="number">178</span>, <span class="number">120</span>, <span class="number">-18</span>&#125;</span><br><span class="line">    s, err := variety(p)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;    <span class="comment">// 捕获错误</span></span><br><span class="line">        fmt.Println(<span class="string">&quot;Error:&quot;</span>, err)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(s, p)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出结果：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go run main.go</span></span><br><span class="line">Error: 数据有误</span><br></pre></td></tr></table></figure><p>如果捕获到了错误，而我们又想进一步判断是什么错误，需要用到 <strong>类型断言</strong>。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    p := Person&#123;<span class="number">178</span>, <span class="number">120</span>, <span class="number">-18</span>&#125;</span><br><span class="line">    s, err := variety(p)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;    <span class="comment">// 捕获错误</span></span><br><span class="line">        <span class="keyword">if</span> ins, ok := err.(*dataError); ok &#123;    <span class="comment">// 类型断言，判断是哪种错误</span></span><br><span class="line">            <span class="keyword">switch</span> &#123;    <span class="comment">// 捕获后的处理，可以打印错误信息，也可以取个绝对值等其他操作。</span></span><br><span class="line">            <span class="keyword">case</span> ins.heightNegativeError(): ins.Err = <span class="string">&quot;身高为负&quot;</span></span><br><span class="line">            <span class="keyword">case</span> ins.weightNegativeError(): ins.Err = <span class="string">&quot;体重为负&quot;</span></span><br><span class="line">            <span class="keyword">case</span> ins.ageNegativeError():    ins.Err = <span class="string">&quot;年龄为负&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">            fmt.Println(<span class="string">&quot;Error:&quot;</span>, ins)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(s, p)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出结果：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go run main.go</span></span><br><span class="line">Error: 年龄为负</span><br></pre></td></tr></table></figure><h2 id="异常"><a href="#异常" class="headerlink" title="异常"></a>异常</h2><p>当一个程序遇到意料之外的错误时，应该抛出异常，停止程序的运行。<br>Go 中引入两个内置函数 <code>panic()</code> 和 <code>recover()</code> 来出发和终止异常处理流程，同时引入关键字 <code>defer</code> 来延迟执行延迟函数。</p><h3 id="复习一下-defer"><a href="#复习一下-defer" class="headerlink" title="复习一下 defer"></a>复习一下 defer</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fn</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;start&quot;</span>)</span><br><span class="line">    <span class="keyword">defer</span> fmt.Println(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">defer</span> fmt.Println(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">defer</span> fmt.Println(<span class="number">3</span>)</span><br><span class="line">    fmt.Println(<span class="string">&quot;end&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ---------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line">start</span><br><span class="line">end</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure><p>先 <code>defer</code> 的后执行，后 <code>defer</code> 的先执行</p><h3 id="panic"><a href="#panic" class="headerlink" title="panic"></a>panic</h3><ol><li>内置函数</li><li>发生 <code>panic</code> 的情况有两种：<ol><li>手动抛出，即编写 <code>panic</code> 语句</li><li>程序发生错误由系统抛出。</li></ol></li><li>如果函数中出现了 <code>panic</code> 语句，则不会继续执行 <code>panic</code> 下面的代码，而是会逆序执行 <code>defer</code> 修饰的函数，然后返回调用处</li><li>如果一路都没有遇到 <code>recover()</code>，则一路传递回所在协程的起点，然后该协程结束，终止其他所有协程（包括主协程）。</li><li>最终整个 goroutine 退出，报告错误。</li></ol><p><code>panic</code> 的签名如下：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">panic</span><span class="params">(v <span class="keyword">interface</span>&#123;&#125;)</span></span></span><br></pre></td></tr></table></figure><p><code>panic</code> 中接受一个任何类型的参数，可以传递一个错误消息的字符串，也可以传递一个错误码。</p><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fn</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;start&quot;</span>)</span><br><span class="line">    <span class="keyword">defer</span> fmt.Println(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">defer</span> fmt.Println(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">panic</span>(<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">defer</span> fmt.Println(<span class="number">3</span>)</span><br><span class="line">    fmt.Println(<span class="string">&quot;end&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> fmt.Println(<span class="string">&quot;main defer...&quot;</span>)</span><br><span class="line">    fn()</span><br><span class="line">    fmt.Println(<span class="string">&quot;After fn()...&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ---------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line">start</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line">main <span class="keyword">defer</span>...</span><br><span class="line"><span class="built_in">panic</span>: <span class="number">100</span></span><br><span class="line"></span><br><span class="line">goroutine <span class="number">1</span> [running]:</span><br><span class="line">main.fn()    e:/---CODE/GO/root/src/boii.xyz/study/Helloworld/main.<span class="keyword">go</span>:<span class="number">19</span> +<span class="number">0x166</span></span><br><span class="line">main.main()  e:/---CODE/GO/root/src/boii.xyz/study/Helloworld/main.<span class="keyword">go</span>:<span class="number">26</span> +<span class="number">0x27</span></span><br><span class="line">exit status <span class="number">2</span></span><br></pre></td></tr></table></figure><p>可以看出发生 <code>panic</code> 之后，在 <code>panic</code> 之前 <code>defer</code> 的代码依然会逆序执行，然后回到调用处。<br>上面的例子执行完 <code>fn()</code> 中 <code>defer</code> 函数后，便返回了 <code>main()</code> 函数，<br>接着执行 早在调用 <code>fn()</code> 之前就 <code>defer</code> 的 打印语句，然后就终止程序了。</p><div class="note done"><p>结论：<code>defer函数</code>的执行 优先于 <code>panic</code></p></div><h3 id="recover"><a href="#recover" class="headerlink" title="recover"></a>recover</h3><ol><li>内置函数</li><li>用来终止一个协程中的 panicking 行为，捕获 <code>panic</code>，从而影响应用的行为。</li><li><code>recover</code> 需要用 <code>defer</code> 修饰。</li><li>一般的调用建议：<ol><li>在 defer 函数中，通过 <code>recover</code> 来终止一个 协程的 panicking 过程，从而恢复正常代码的执行</li><li>可以获取通过 <code>panic</code> 传递的 <code>error</code></li></ol></li></ol><p>简而言之，go中可以抛出一个 <code>panic</code>的异常，然后在 <code>defer</code> 中通过 <code>recover</code> 捕获这个异常，然后正常处理。</p><div class="note warning"><p>Q：为什么 <code>recover</code> 需要 <code>defer</code> 修饰？<br>A：因为发生 <code>panic</code> 后，只会执行 <code>defer</code> 修饰的函数，然后返回函数调用处。<br>      而 <code>recover</code> 是专门用来恢复 <code>panic</code> 的，所以必须用  <code>defer</code> 修饰 <code>recover</code>，<br>      且 <code>recover</code> 需放置在出现或可能出现 <code>panic</code> 的地方<strong>之前</strong>，否则一旦发生 <code>panic</code>，程序控制流就开始往回走，<code>panic</code> 下   方的任何代码包括 <code>defer</code> 修饰的地方也不会执行，这样就捕获不到 <code>panic</code> 了。</p></div><p>eg：<br>发生数组下标越界，没有 <code>recover</code>时</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">traverse</span><span class="params">(a [5]<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt;= <span class="number">5</span>; i++ &#123;</span><br><span class="line">        fmt.Println(a[i])</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(<span class="string">&quot;under for&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> fmt.Println(<span class="string">&quot;main defer...&quot;</span>)</span><br><span class="line"></span><br><span class="line">    a := [<span class="number">5</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;</span><br><span class="line">    traverse(a)</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;After div()...&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ---------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line">main <span class="keyword">defer</span>...</span><br><span class="line"><span class="built_in">panic</span>: runtime error: index out of <span class="keyword">range</span> [<span class="number">5</span>] with length <span class="number">5</span></span><br><span class="line"></span><br><span class="line">goroutine <span class="number">1</span> [running]:</span><br><span class="line">main.traverse(<span class="number">0x1</span>, <span class="number">0x2</span>, <span class="number">0x3</span>, <span class="number">0x4</span>, <span class="number">0x5</span>)</span><br><span class="line">        e:/---CODE/GO/root/src/boii.xyz/study/Helloworld/main.<span class="keyword">go</span>:<span class="number">17</span> +<span class="number">0xbe</span></span><br><span class="line">main.main()</span><br><span class="line">        e:/---CODE/GO/root/src/boii.xyz/study/Helloworld/main.<span class="keyword">go</span>:<span class="number">25</span> +<span class="number">0x105</span></span><br><span class="line">exit status <span class="number">2</span></span><br></pre></td></tr></table></figure><p>最后的 <code>exit status 2</code>说明程序是非正常退出的。</p><p>下面是使用了 <code>recover</code> 的效果</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">traverse</span><span class="params">(a [5]<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> msg := <span class="built_in">recover</span>(); msg != <span class="literal">nil</span> &#123;</span><br><span class="line">            fmt.Println(msg)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt;= <span class="number">5</span>; i++ &#123;    <span class="comment">// 这里会发生数组下标越界，引发panic</span></span><br><span class="line">        fmt.Println(a[i])</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(<span class="string">&quot;under for&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> fmt.Println(<span class="string">&quot;main defer...&quot;</span>)</span><br><span class="line"></span><br><span class="line">    a := [<span class="number">5</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;</span><br><span class="line">    traverse(a)</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;After div()...&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ---------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line">runtime error: index out of <span class="keyword">range</span> [<span class="number">5</span>] with length <span class="number">5</span></span><br><span class="line">After div()...</span><br><span class="line">main <span class="keyword">defer</span>...</span><br></pre></td></tr></table></figure><p>可以看到，发生数组下标越界时，程序会引发 <code>panic</code>，然后开始执行 <code>defer</code> 函数；<br>在 <code>defer</code> 函数里遇到了 <code>recover</code>，使得程序恢复正常运行，打印了错误信息后，回到主函数继续执行<br>但是我们会发现虽然被 <code>recover</code> 恢复了，但是 for 循环下面的 语句依然不会执行。</p><div class="note done"><p>结论：<br><code>recover</code> 必须用 <code>defer</code> 修饰<br><code>recover</code> 必须放在可能引发 <code>panic</code> 的地方之前<br>即使 <code>recover</code> 了，在函数里，引发 <code>panic</code> 的地方下面那些代码依然没有机会运行。</p></div><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20210207173528135_25602.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20210207173528135_25602.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
          <category> Basic </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Golang [基础] 13-面向对象</title>
      <link href="posts/88c693c7"/>
      <url>posts/88c693c7</url>
      
        <content type="html"><![CDATA[<p>Golang 模拟面向对象的实现</p><span id="more"></span><h1 id="13-面向对象"><a href="#13-面向对象" class="headerlink" title="13-面向对象"></a>13-面向对象</h1><p>面向对象三大特性：封装、继承、多态</p><p>Golang 没有类的概念，也没有面向对象的概念。<br>准确的说，面向对象、封装、继承、多态、抽象等等，这些都是编程思想，不同的语言实现这些特性的方式不同。<br>例如 <code>Java</code>，用的是类 <code>class</code>，访问修饰符 <code>public、protected、default、private</code> 等来实现；<br>在 Golang 中，用的是结构体 <code>struct</code>、标识符首字母大小写 等来实现。</p><div class="note quote"><p>面向过程、面向对象、一切皆对象、一切皆文件 等诸如此类的概念，<br>在学习之初可能会成为初学者的一道坎，也可能是帮助新手更快入门的好帮手；<br>等到学到一定程度以后，这些思想能帮助我们快速解决一些问题，也可能开始禁锢我们的思想；<br>善于变通者会慢慢看透本质，脱离这些思想的枷锁，对编程形成自己的认知。<br>变通者和不变通者的区别在于：是否愿意深入底层（汇编、组原等等），是否愿意摒弃语言执念。</p></div><ol><li><strong>封装</strong><ul><li>封装也叫<strong>信息隐藏、数据访问保护</strong>。通过暴露有限的访问接口，外部仅能通过类提供的方式来访问内部信息或数据。</li><li>需要编程语言提供权限访问控制语法来支持。如：<ul><li>Java 中的 <code>public、protected、private</code></li><li>Python 中标识符的双下划线前缀 <code>__xxx</code>或<code>__slots__</code> 白名单</li><li>Golang 中标识符首字母大小写。</li></ul></li><li>封装存在的意义，<ul><li>一方面是保护数据不被随意修改，提高代码可维护性；</li><li>一方面是仅暴露有限的必要接口，提高易用性。</li></ul></li></ul></li><li><strong>抽象</strong><ul><li>封装讲的是如何隐藏信息、保护数据，抽象讲的就是如何隐藏的具体实现。</li><li>抽象可以通过接口类或者抽象类来实现，但不需要特殊的语法机制来支持。</li><li>抽象存在的意义，<ul><li>一方是是提高代码的可扩展性、维护性，修改实现不需要修改定义，减少代码改动范围；</li><li>另一方面，抽象也是处理复杂系统的有效手段，能有效过滤掉不必关注的信息。</li></ul></li></ul></li><li><strong>继承</strong><ul><li>继承是用来表示类之间的 <code>is-a</code> 和 <code>has-a</code> 的关系，分为两种模式：单继承和多继承。</li><li>单继承表示一个子类只能继承一个父类，多继承表示一个子类可以继承多个父类。</li><li>需要编程语言提供特殊语法机制来支持。如：<ul><li>Java 中的 <code>extends</code> 关键字</li><li>Python 中类名后的括号</li><li>Go 中的结构体嵌套</li></ul></li><li>继承存在的意义，是用来解决代码复用的问题。</li></ul></li><li><strong>多态</strong><ul><li>多态是指子类可以替代父类。在实际代码运行过程中，调用子类的方法实现。</li><li>需要编程语言提供特殊语法机制来支持。如：继承、接口、duck-typing。</li><li>多态可以提高代码的扩展性和复用性，是很多设计模式、设计原则、编程技巧的代码实现的基础。</li></ul></li></ol><h2 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h2><p>在 Java 等面向对象中，会将一类事物抽象出<code>属性</code>和<code>行为</code>，并通过语言层面限定 <code>访问性</code>。</p><p>属性 使用基本数据类型或复合类型描述；<br>行为 通过函数描述，并称之为<code>方法</code>；<br><code>属性+方法</code>组成一个类<code>class</code>；<br>访问性各个语言实现不同。</p><p>在 Go 中没有类的概念，<br>而是将事物的 <strong>属性</strong> 使用基本数据类型或复合数据类型 <strong>封装在结构体中</strong>，<br>而 <strong>行为</strong> 是通过 <strong>给函数限定调用者的方式</strong> 实现。<br><strong>访问性</strong> 是通过首字母大写为 <code>public</code>，首字母小写为 <code>private</code>。</p><p>这种限定了调用者的函数，我们称之为<strong>方法</strong>。<br>而拥有方法的结构体，我将其称之为<strong>类</strong>。</p><div class="note info"><p>Golang 中，<strong>类 = 结构体 + 限定调用者的函数 + 访问性</strong></p></div><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// class A</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> A <span class="keyword">struct</span> &#123;</span><br><span class="line">    fieldA</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a A)</span> <span class="title">aMethod</span><span class="params">()</span></span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h3><p>Go 不支持像 Java 那样的构造函数，但是可以通过 <code>标识符首字母大小写 + 工厂函数</code> 实现构造函数。</p><p>一般分为4步：</p><ol><li>将结构体、字段的首字母小写</li><li>结构体所在的包提供一个工厂模式的函数，首字母大写，模拟一个构造函数。按照规范，构造函数的名字以 <code>new</code> 或 <code>New</code> 开头。<strong>注意返回值必须是结构体指针</strong>，因为结构体是值类型。</li><li>提供首字母大写的 Get 方法，用于获取属性的值，建议命名规则：属性名首字母大写，如属性 <code>sex</code> 的 Get 方法为 <code>Sex()</code>、属性 <code>name</code> 的 Get 方法为 <code>Name()</code>。</li><li>提供首字母大写的 Set 方法，用于设置属性的值，建议命名规则：Set+属性名首字母大写，如属性 <code>sex</code> 的 Set 方法为 <code>SetSex()</code>、属性 <code>name</code> 的 Set 方法为 <code>SetName()</code>。</li></ol><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> person <span class="keyword">struct</span> &#123;</span><br><span class="line">    name <span class="keyword">string</span></span><br><span class="line">    age  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 写一个工厂函数，首字母大写，其他方就可以访问，相当于构造函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewPerson</span> <span class="params">(name <span class="keyword">string</span>, age <span class="keyword">int</span>)</span> *<span class="title">person</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> age &lt;= <span class="number">0</span> || name == <span class="string">&quot;&quot;</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line">    <span class="keyword">return</span> &amp;person&#123;name, age&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get 方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p person)</span> <span class="title">Name</span><span class="params">()</span> <span class="title">string</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> p.name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p person)</span> <span class="title">Age</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> p.age</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Set 方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p person)</span> <span class="title">SetName</span><span class="params">(name <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> name == <span class="string">&quot;&quot;</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">    p.name = name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p person)</span> <span class="title">SetAge</span><span class="params">(age <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> age &lt;= <span class="number">0</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">    p.age = age</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// 然后这样创建对象：</span></span><br><span class="line">    p := NewPerson(<span class="string">&quot;Boii&quot;</span>, <span class="number">18</span>)</span><br><span class="line">    fmt.Println(p)    <span class="comment">// &amp;&#123;Boii 18&#125;</span></span><br><span class="line"></span><br><span class="line">    p.Name()           <span class="comment">// Boii</span></span><br><span class="line">    p.SetAge(<span class="number">20</span>)    <span class="comment">// p.age == 20</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="toString-NaN"><a href="#toString-NaN" class="headerlink" title="toString"></a>toString</h3><p>在面向对象中，每个类默认继承自 Object，打印一个对象的时候，会调用这个对象的 <code>toString()</code> 方法，如果这个对象没有重写 <code>toString()</code>，会找其父类，一层层往上，找到了执行 <code>toString()</code>，找不到就执行 Object 的 <code>toString()</code>。</p><p>想要打印对象信息，<br>在 Java 中是 <code>.toString()</code>，<br>在 Python 中是 <code>.__str__()</code></p><div class="note info"><p><strong>在 Go 中是 <code>.String()</code></strong></p></div><p>在 Go 中，可以通过 <code>%v</code> 打印结构体信息。<br><code>fmt.Printf(&quot;%v \n&quot;, t)</code> 这句话等价于 <code>fmt.Printf(&quot;%v \n&quot;, t.String())</code>，也等价于 <code>fmt.Println(t)</code>。<br>那么想要打印结构体信息时按照自己想法来，就可以为结构体写一个 <code>String()</code> 方法。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> car <span class="keyword">struct</span> &#123;</span><br><span class="line">    band  <span class="keyword">string</span></span><br><span class="line">    model <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c car)</span> <span class="title">String</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> c.band + <span class="string">&quot;-&quot;</span> + <span class="string">&quot;c.model&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    c1 := &amp;car&#123;<span class="string">&quot;Benz&quot;</span>, <span class="string">&quot;S600&quot;</span>&#125;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%v \n&quot;</span>, c1)      <span class="comment">// Benz-S600</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%v \n&quot;</span>, c1.String())  <span class="comment">// Benz-S600</span></span><br><span class="line">    fmt.Println(c1)                   <span class="comment">// Benz-S600</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h2><p>面向对象中的继承性：<br>如果两个类 class 存在继承关系，其中一个是子类，另一个作为父类，那么：</p><ol><li>子类可以直接访问父类的属性和方法</li><li>子类可以新增自己的属性和方法</li><li>子类可以重写父类的方法（override，就是将父类已有的方法，重新实现）</li></ol><p>Golang 语法上不支持继承，但是通过结构体嵌套却可以实现继承，而且可以多继承，<br>且通过 匿名字段 和 非匿名字段 还可以进一步区分 <code>is-a</code> 继承关系 和 <code>has-a</code> 聚合关系</p><p>Golang 的结构体嵌套：</p><h3 id="模拟继承性：is-a"><a href="#模拟继承性：is-a" class="headerlink" title="模拟继承性：is - a"></a>模拟继承性：is - a</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Base <span class="keyword">struct</span> &#123;</span><br><span class="line">    fieldB</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> Son <span class="keyword">struct</span> &#123;</span><br><span class="line">    fieldS</span><br><span class="line">    Base <span class="comment">// 匿名字段，模拟的是 继承关系</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b Base)</span> <span class="title">baseMethod</span><span class="params">()</span></span> &#123; <span class="comment">// A的方法</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;base method&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s Son)</span> <span class="title">sonMethod</span><span class="params">()</span></span> &#123; <span class="comment">// B的方法</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;son method&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    base := Base&#123;&#125;</span><br><span class="line">    son := Son&#123;&#125;</span><br><span class="line"></span><br><span class="line">    base.fieldB     <span class="comment">// 正确使用</span></span><br><span class="line">    son.fieldS      <span class="comment">// 正确使用</span></span><br><span class="line">    son.fieldB      <span class="comment">// 正确使用</span></span><br><span class="line">    son.Base.fieldB <span class="comment">// 正确使用</span></span><br><span class="line">    base.fieldS     <span class="comment">// !报错</span></span><br><span class="line">    base.Son.fieldS <span class="comment">// !报错</span></span><br><span class="line"></span><br><span class="line">    base.baseMethod()     <span class="comment">// 正确使用</span></span><br><span class="line">    son.sonMethod()       <span class="comment">// 正确使用</span></span><br><span class="line">    son.baseMethod()      <span class="comment">// 正确使用</span></span><br><span class="line">    son.Base.baseMethod() <span class="comment">// 正确使用</span></span><br><span class="line">    base.sonMethod()      <span class="comment">// !报错</span></span><br><span class="line">    base.Son.sonMethod()  <span class="comment">// !报错</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="模拟聚合关系：has-a"><a href="#模拟聚合关系：has-a" class="headerlink" title="模拟聚合关系：has - a"></a>模拟聚合关系：has - a</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> C <span class="keyword">struct</span> &#123;</span><br><span class="line">    fieldC</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> D <span class="keyword">struct</span> &#123;</span><br><span class="line">    fieldD</span><br><span class="line">    c C    <span class="comment">// 非匿名字段，模拟的是 聚合关系</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c C)</span> <span class="title">cMethod</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;C method&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">d := D&#123;...&#125;</span><br><span class="line"></span><br><span class="line">d.fieldC      <span class="comment">// !报错</span></span><br><span class="line">d.C.fieldC    <span class="comment">// !报错</span></span><br><span class="line">d.c.fieldC    <span class="comment">// 正确使用</span></span><br><span class="line">d.c.cMethod() <span class="comment">// 正确使用</span></span><br></pre></td></tr></table></figure><h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>在结构体中嵌套了其他结构体，会出现两种情况，一种是 is - a 的关系，一种的 has - a 的关系。</p><p>is - a 是一种继承关系，子类可以直接使用父类（被嵌套类）的变量，如上面例子中的 <code>b.fieldA</code><br>has - a 是一种聚合关系，当前类使用聚合类（被嵌套类）的变量必须通过聚合类的名字，如上面例子中的 <code>d.c.fieldC</code>，其他两种方式会报错。</p><h2 id="多态"><a href="#多态" class="headerlink" title="多态"></a>多态</h2><p>Golang 中的多态是通过 接口 和 Duck-typing 实现的。</p><p><code>Duck-typing</code> 也是一种编程思想：只要一个东西看起来像鸭子，走路像鸭子，吃起来像鸭子…，那它就是鸭子。<br>反映在编程语言中就是，只要一个结构体或者一个类，具有某个方法的具体实现，那它就可以被我这个函数/方法接受。</p><p>Golang 中的接口是非侵入式的，不像<code>Java</code> 那样需要显式的在类声明中加上 <code>implement xxer</code>，<br>Golang 不需要结构体显示的声明实现某个接口，只要你这个结构体有我这个接口所有方法的具体实现，那这个结构体就实现是我这个接口，就是我的实现类，就是我这种类型。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Aer <span class="keyword">interface</span> &#123;</span><br><span class="line">    show() <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> X <span class="keyword">struct</span> &#123;&#125;</span><br><span class="line"><span class="keyword">type</span> Y <span class="keyword">struct</span> &#123;&#125;</span><br><span class="line"><span class="keyword">type</span> Z <span class="keyword">struct</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(x X)</span> <span class="title">show</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;I&#x27;m X&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(x X)</span> <span class="title">add</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(x Y)</span> <span class="title">show</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;I&#x27;m Y&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">PrintStruct</span><span class="params">(a Aer)</span></span>&#123;</span><br><span class="line">    fmt.Println(a.show())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    x := X&#123;&#125;</span><br><span class="line">    y := Y&#123;&#125;</span><br><span class="line">    z := Z&#123;&#125;</span><br><span class="line"></span><br><span class="line">    PrintStruct(x)    <span class="comment">// I&#x27;m X</span></span><br><span class="line">    PrintStruct(y)    <span class="comment">// I&#x27;m Y</span></span><br><span class="line">    PrintStruct(z)    <span class="comment">// !报错, 因为 Z 没有实现 Aer 的方法 show()，不是 Aer 类型</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="重写"><a href="#重写" class="headerlink" title="重写"></a>重写</h3><p><strong>重写</strong>，说大白话就是：爹有的，儿子不满意，儿子自己来。</p><p>Golang 中通过嵌套结构体模拟继承，如果子结构体有和父结构体 <strong>同名同参的方法</strong>，则称作重写。</p><p>Golang 中不支持同名不同参。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> base <span class="keyword">struct</span> &#123;    <span class="comment">// 父类</span></span><br><span class="line">    name <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> son <span class="keyword">struct</span> &#123;    <span class="comment">// 子类</span></span><br><span class="line">    base             <span class="comment">// 继承了父类</span></span><br><span class="line">    age <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b base)</span> <span class="title">say</span><span class="params">()</span></span> &#123;    <span class="comment">// 父类方法</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;Base said.&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b base)</span> <span class="title">run</span><span class="params">()</span></span> &#123;    <span class="comment">// 父类方法</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;Base ran.&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s son)</span> <span class="title">say</span><span class="params">()</span></span> &#123;    <span class="comment">// 子类方法，重写了父类方法</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;Son said.&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    b := base&#123;<span class="string">&quot;Eva&quot;</span>&#125;            <span class="comment">// 实例化父类</span></span><br><span class="line">    s := son&#123;base&#123;<span class="string">&quot;Boii&quot;</span>&#125;, <span class="number">64</span>&#125;  <span class="comment">// 实例化子类</span></span><br><span class="line">    b.say()         <span class="comment">// Base said.</span></span><br><span class="line">    s.say()         <span class="comment">// Son said.</span></span><br><span class="line">    b.run()         <span class="comment">// Base ran.</span></span><br><span class="line">    s.run()         <span class="comment">// Base ran.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="举个栗子"><a href="#举个栗子" class="headerlink" title="举个栗子"></a>举个栗子</h2><h3 id="Java实现"><a href="#Java实现" class="headerlink" title="Java实现"></a>Java实现</h3><p>现在我们用 Java 来定义一个类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dog</span></span>&#123;</span><br><span class="line">    <span class="comment">// 属性</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构造函数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Dog</span><span class="params">(String name, <span class="keyword">int</span> age)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// getter</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// setter</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String newName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = newName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> newAge)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = newAge;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// toString</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name + <span class="string">&quot;-&quot;</span> + <span class="keyword">this</span>.age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上就是用 Java 定义的一个最简单的类了。类中有<code>属性</code>、<code>构造函数</code>、<code>getter 和 setter</code> 和 <code>toString()</code>。</p><p>使用的时候是这样子的：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Dog doge = <span class="keyword">new</span> Dog(<span class="string">&quot;Doge&quot;</span>, <span class="number">2</span>);</span><br><span class="line">System.out.println(doge.getName());    <span class="comment">// Doge</span></span><br><span class="line">System.out.println(doge.getAge());     <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line">doge.setAge(<span class="number">3</span>);</span><br><span class="line">System.out.println(doge.getAge());     <span class="comment">// 3</span></span><br><span class="line">System.out.println(doge)               <span class="comment">// Doge-3</span></span><br></pre></td></tr></table></figure><h3 id="Go-实现"><a href="#Go-实现" class="headerlink" title="Go 实现"></a>Go 实现</h3><p>下面我们来看看用 Go 怎么做：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//$GOPATH/src/dog/myDog.go</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> dog</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;strconv&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义 Dog 结构体，包含了属性</span></span><br><span class="line"><span class="keyword">type</span> dog <span class="keyword">struct</span> &#123;</span><br><span class="line">    name <span class="keyword">string</span></span><br><span class="line">    age  <span class="keyword">int8</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewDog</span><span class="params">(name <span class="keyword">string</span>, age <span class="keyword">int8</span>)</span> *<span class="title">dog</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;dog&#123;name, age&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// getter</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d *dog)</span> <span class="title">Name</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> d.name</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d *dog)</span> <span class="title">Age</span><span class="params">()</span> <span class="title">int8</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> d.age</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// setter</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d *dog)</span> <span class="title">SetName</span><span class="params">(newName <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    d.name = newName</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d *dog)</span> <span class="title">SetAge</span><span class="params">(newAge <span class="keyword">int8</span>)</span></span> &#123;</span><br><span class="line">    d.age = newAge</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// toString</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d *dog)</span> <span class="title">String</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> d.name + <span class="string">&quot;-&quot;</span> + strconv.Itoa(<span class="keyword">int</span>(d.age))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>同样实现了<code>属性</code>、<code>构造函数</code>、<code>getter 和 setter</code>。</p><p>使用的时候是这样子的：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//$GOPATH/src/Hello/main.go</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;dog&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    doge := NewDog(<span class="string">&quot;Doge&quot;</span>, <span class="number">2</span>)</span><br><span class="line">    fmt.Println(doge.Name()) <span class="comment">// Doge</span></span><br><span class="line">    fmt.Println(doge.GetAge())  <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line">    doge.SetAge(<span class="number">3</span>)</span><br><span class="line">    fmt.Println(doge.Age()) <span class="comment">// 3</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%v \n&quot;</span>, doge)  <span class="comment">// Doge-3</span></span><br><span class="line">    fmt.Println(doge) <span class="comment">// Doge-3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="抽象类"><a href="#抽象类" class="headerlink" title="抽象类"></a>抽象类</h2><p>抽象类其实和接口的性质是一样的，但是又多了一些具体的实现。</p><p>当一个接口中的某些方法，所有子类的实现都一样时，可以换成抽象类来实现，将这些共同的实现写在抽象类中，剩下不同的实现续集保持抽象。</p><h3 id="以-Java-为栗"><a href="#以-Java-为栗" class="headerlink" title="以 Java 为栗"></a>以 Java 为栗</h3><p>eg：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义一个抽象类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 实现共同方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="keyword">this</span>.name() + <span class="string">&quot; is running!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义抽象方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title">kind</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 继承抽象类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">cat</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 实现抽象方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">kind</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;cat&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 继承抽象类</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> class dog extends <span class="title">Animal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 实现抽象方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">kind</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;dog&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面抽象了一个动物类 <code>Animal</code>，我们实现了共同的方法 <code>run()</code>，并定义了需要子类自己实现的抽象方法 <code>kind()</code>。</p><p>接着定义了两个具体类 <code>cat</code> 和 <code>dog</code> 继承 <code>Animal</code>，并各自具体实现抽象方法 <code>kind()</code>。</p><h3 id="Go-实现抽象类"><a href="#Go-实现抽象类" class="headerlink" title="Go 实现抽象类"></a>Go 实现抽象类</h3><p>Go 并没有抽象类的概念，但是通过 <code>struct</code> 和 <code>interface</code> 可以实现出抽象类。</p><p>思考一下：Java 中抽象类和接口的区别在哪？</p><p>其实就是抽象类中需要具体实现一些 <span class='p blue'>公共方法</span>，剩下的那些抽象方法，用 Java 中的接口实现也是一样的。</p><p>只不过 Java 有抽象类的概念，可以优雅的实现。</p><p>那么我们也可以在 Golang 中，定义一个接口IAer，接口中定义一些抽象方法；</p><p>然后定义一个 Aer 作为公共的结构体（类），由它来实现公共的部分</p><p>然后其他结构体嵌套这个公共结构体，并实现接口 IAer 的方法，这样就能达到与抽象类相同的效果。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象类 -- start</span></span><br><span class="line"><span class="keyword">type</span> IAnimal <span class="keyword">interface</span> &#123;</span><br><span class="line">    kind() <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Animal <span class="keyword">struct</span> &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *Animal)</span> <span class="title">run</span><span class="params">(this IAnimal)</span></span> &#123;    <span class="comment">// !注意这里接受的是接口变量</span></span><br><span class="line">    fmt.Println(this.kind + <span class="string">&quot;is running.&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 抽象类 -- end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 继承抽象类</span></span><br><span class="line"><span class="keyword">type</span> cat <span class="keyword">struct</span> &#123; Animal &#125;</span><br><span class="line"><span class="comment">// 实现抽象方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *cat)</span> <span class="title">kind</span><span class="params">()</span> <span class="title">string</span></span> &#123; <span class="keyword">return</span> <span class="string">&quot;cat&quot;</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 继承抽象类</span></span><br><span class="line"><span class="keyword">type</span> dog <span class="keyword">struct</span> &#123; Animal &#125;</span><br><span class="line"><span class="comment">// 实现抽象方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d *dog)</span> <span class="title">kind</span><span class="params">()</span> <span class="title">string</span></span> &#123; <span class="keyword">return</span> <span class="string">&quot;dog&quot;</span> &#125;</span><br></pre></td></tr></table></figure><p>接口定义抽象方法，公共结构体实现公共方法，其他要继承象类的子类只要<span class='p yellow'>匿名嵌套</span>公共结构体即可</p><p>另外在公共结构体实现公共方法时，其至少接收一个接口类型的参数，这个参数相当于<code>this</code>。</p><p>调用：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    c := &amp;cat&#123;&#125;</span><br><span class="line">    c.run(c)</span><br><span class="line"></span><br><span class="line">    d := &amp;dog&#123;&#125;</span><br><span class="line">    d.run(d)</span><br><span class="line">    fmt.Println(<span class="string">&quot;kind(): &quot;</span>, d.kind())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat <span class="keyword">is</span> <span class="built_in">running</span></span><br><span class="line">dog <span class="keyword">is</span> <span class="built_in">running</span></span><br><span class="line">kind(): dog</span><br></pre></td></tr></table></figure><h3 id="小结-1"><a href="#小结-1" class="headerlink" title="小结"></a>小结</h3><p>Golang 中实现抽象类：</p><ol><li>抽象的方法放在接口中</li><li>公共的方法定义一个公共结构体去实现，需要用到 this 的地方使用接口变量</li><li>继承抽象类的子类要做两件事：<ul><li>匿名嵌套公共结构体</li><li>实现接口中的所有方法</li></ul></li><li>在调用公共方法时，需要将子类自己传进去。</li></ol><h2 id="泛型"><a href="#泛型" class="headerlink" title="泛型"></a>泛型</h2><p>据说在 Go 1.17 出</p><h2 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h2><ul><li><p>饿汉式：</p>  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> singleton <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> single *singleton = <span class="built_in">new</span>(singleton)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetPersonInstance</span><span class="params">()</span> *<span class="title">singleton</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> single</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  测试一下</p>  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s3 := GetPersonInstance()</span><br><span class="line">    s4 := GetPersonInstance()</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%p\n&quot;</span>, s3) <span class="comment">// 0x104d5b8</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%p\n&quot;</span>, s4) <span class="comment">// 0x104d5b8</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>懒汉式：</p>  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> singleton <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> single *singleton</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetPersonInstance</span><span class="params">()</span> *<span class="title">singleton</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> single == <span class="literal">nil</span> &#123;</span><br><span class="line">        single = <span class="built_in">new</span>(singleton)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> single</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  测试一下</p>  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s3 := GetPersonInstance()</span><br><span class="line">    s4 := GetPersonInstance()</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%p\n&quot;</span>, s3) <span class="comment">// 0x104d5b8</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%p\n&quot;</span>, s4) <span class="comment">// 0x104d5b8</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>使用 sync.Once 实现的懒汉式：</p>  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> singleton <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">    single *singleton</span><br><span class="line">    once   sync.Once</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetPersonInstance</span><span class="params">()</span> *<span class="title">singleton</span></span> &#123;</span><br><span class="line">    once.Do(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        single = <span class="built_in">new</span>(singleton)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> single</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  测试一下：</p>  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s1 := GetPersonInstance()</span><br><span class="line">    s2 := GetPersonInstance()</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%p\n&quot;</span>, s1) <span class="comment">// 0xdbd5b8</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%p\n&quot;</span>, s2) <span class="comment">// 0xdbd5b8</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
          <category> Basic </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Golang [基础] 12-接口</title>
      <link href="posts/19a13983"/>
      <url>posts/19a13983</url>
      
        <content type="html"><![CDATA[<p>接口的创建与使用</p><span id="more"></span><h1 id="12-接口"><a href="#12-接口" class="headerlink" title="12-接口"></a>12-接口</h1><p>Go 中的接口 <code>interface </code>是一种类型，一种抽象的类型。</p><p><code>interface</code> 是一组方法的集合，是 <code>dack-type programming</code> 的一种体现。<br>接口做的事情就像是定义一个协议（规则），只要一台机器具有洗衣服和甩干的功能，我就称其为洗衣机。<br>接口不关心属性（数据），只关心行为（方法）。</p><p><strong>只要一个结构体 X 实现了接口 A 中所有的方法，就称这个结构体 X 为接口 A 的实现类，称结构体 X 实现了接口 A。还可称结构体 X 是 A 类型。</strong></p><div class="note warning"><p><strong>为了保护你的Go语言职业生涯，请牢记接口（interface）是一种类型。</strong></p></div><h2 id="定义接口"><a href="#定义接口" class="headerlink" title="定义接口"></a>定义接口</h2><p>基本语法如下：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> identifier <span class="keyword">interface</span> &#123;</span><br><span class="line">    methodName1([param])[(<span class="keyword">return</span>)]</span><br><span class="line">    methodName2([param])[(<span class="keyword">return</span>)]</span><br><span class="line">    methodName3([param])[(<span class="keyword">return</span>)]</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>identifier</code>：接口名，命名时按照规范应该加上 <code>er</code>，如 有字符串功能的 <code>Stringer</code>、有读取功能的 <code>Reader</code>。<br><code>methodName</code>：方法名</p><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> USBer <span class="keyword">interface</span> &#123;</span><br><span class="line">    start()</span><br><span class="line">    end()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="实现接口"><a href="#实现接口" class="headerlink" title="实现接口"></a>实现接口</h2><p>实现接口：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义一个接口</span></span><br><span class="line"><span class="keyword">type</span> USBer <span class="keyword">interface</span> &#123;</span><br><span class="line">    start()</span><br><span class="line">    end()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 定义一个结构体</span></span><br><span class="line"><span class="keyword">type</span> Mouse <span class="keyword">struct</span> &#123;</span><br><span class="line">    name  <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现两个接口中的方法，接收者为结构体 Mouse，这样 Mouse 就是一个实现类</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m Mouse)</span> <span class="title">start</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(m.name, <span class="string">&quot;starts working.&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m Mouse)</span> <span class="title">end</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(m.name, <span class="string">&quot;end working.&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结构体 <code>Mouse</code> 实现了 <code>USBer</code> 的所有方法 <code>start()</code> 和 <code>end()</code>，所以 <code>Mouse</code> 就是 <code>USBer</code> 的一个实现类。</p><h2 id="使用接口"><a href="#使用接口" class="headerlink" title="使用接口"></a>使用接口</h2><p>实现了接口的结构体（实现类）和没实现接口的结构体，区别在于<br>当一个函数需要传递一个接口类型的参数时，可以传递一个接口变量进去，也可以传一个实现类对象进去。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(usb USBer)</span></span> &#123;    <span class="comment">// 需要传递一个接口类型的参数</span></span><br><span class="line">    usb.start()</span><br><span class="line">    usb.end()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    m1 := Mouse&#123;<span class="string">&quot;罗技&quot;</span>&#125;</span><br><span class="line">    test(m1)    <span class="comment">// 传递一个实现类对象</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> u1 USBer = m1</span><br><span class="line">    test(u1)    <span class="comment">// 传递一个接口变量</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="note warning"><p>注意，<br>接口变量使用之前，需要先赋一个实现类对象。<br>接口变量可以调用接口中的方法，但不可以调用实现类的属性和方法</p></div><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个接口</span></span><br><span class="line"><span class="keyword">type</span> iUSBer <span class="keyword">interface</span> &#123;</span><br><span class="line">    start()</span><br><span class="line">    end()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 定义一个结构体</span></span><br><span class="line"><span class="keyword">type</span> Mouse <span class="keyword">struct</span> &#123;</span><br><span class="line">    name  <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现两个接口中的方法，接收者为结构体 Mouse，这样 Mouse 就是一个实现类</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m Mouse)</span> <span class="title">start</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(m.name, <span class="string">&quot;starts working.&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m Mouse)</span> <span class="title">end</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(m.name, <span class="string">&quot;end working.&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义结构体 Mouse 自己的方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m Mouse)</span> <span class="title">selfMethod</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(m.name, <span class="string">&quot;selfMethod&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个测试方法，需要接收一个 USB 接口变量。可以传递 USB 变量，也可以传递 USB 实现类的对象</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(usb iUSBer)</span></span> &#123;    <span class="comment">// 需要传递一个接口类型的参数</span></span><br><span class="line">    usb.start()</span><br><span class="line">    usb.end()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    m1 := Mouse&#123;<span class="string">&quot;罗技&quot;</span>&#125;</span><br><span class="line">    <span class="comment">// Mouse是一个实现类，可以传递实现类对象给 test()</span></span><br><span class="line">    test(m1)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 接口变量使用之前要先赋一个实现类对象</span></span><br><span class="line">    <span class="keyword">var</span> u1 iUSBer = m1</span><br><span class="line">    <span class="comment">// 传递一个接口变量给 test()</span></span><br><span class="line">    test(u1)</span><br><span class="line"></span><br><span class="line">    m1.start()           <span class="comment">// 罗技 starts working.</span></span><br><span class="line">    m1.end()             <span class="comment">// 罗技 end working.</span></span><br><span class="line">    m1.selfMethod()      <span class="comment">// 罗技 selfMethod</span></span><br><span class="line"></span><br><span class="line">    u1.start()           <span class="comment">// 罗技 starts working.</span></span><br><span class="line">    u1.end()             <span class="comment">// 罗技 end working.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// u1.selfMethod()   // 错误，接口变量不可以调用实现类的方法</span></span><br><span class="line">    <span class="comment">// u1.name           // 错误，接口变量不可以调用实现类的属性</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="空接口"><a href="#空接口" class="headerlink" title="空接口"></a>空接口</h2><p>不包含任何方法的接口，称为空接口。<br>我们可以认为 任意类型都实现了空接口</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> T <span class="keyword">interface</span> &#123;&#125;</span><br></pre></td></tr></table></figure><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> T <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> person <span class="keyword">struct</span> &#123;</span><br><span class="line">    name <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> t1 T = person&#123;<span class="string">&quot;Boii&quot;</span>&#125;</span><br><span class="line"><span class="keyword">var</span> t2 T = <span class="string">&quot;str&quot;</span></span><br><span class="line"><span class="keyword">var</span> t3 T = <span class="number">100</span></span><br><span class="line"><span class="keyword">var</span> t4 T = []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line"></span><br><span class="line">fmt.Println(t1)    <span class="comment">// &#123;Boii&#125;</span></span><br><span class="line">fmt.Println(t2)    <span class="comment">// str</span></span><br><span class="line">fmt.Println(t3)    <span class="comment">// 100</span></span><br><span class="line">fmt.Println(t4)    <span class="comment">// [1 2 3]</span></span><br></pre></td></tr></table></figure><div class="note info"><p>空接口的作用在于 <strong>任意类型</strong>。<br>当我们想要接受一个任意类型的参数，或者定义一个接收任意类型的容器，都可以使用空接口来代替。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span> <span class="params">(a <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test(<span class="string">&quot;string&quot;</span>)</span><br><span class="line">test(<span class="number">123</span>)</span><br><span class="line">test([]<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a := []<span class="keyword">interface</span>&#123;&#125;&#123;<span class="number">1</span>, <span class="number">3</span>, <span class="string">&quot;str&quot;</span>, <span class="literal">true</span>&#125;</span><br><span class="line">fmt.Println(a)    <span class="comment">// &#123;1 3 str true&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> T <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">b := []T&#123;<span class="number">1</span>, <span class="number">3</span>, <span class="string">&quot;str&quot;</span>, <span class="literal">true</span>&#125;</span><br><span class="line">fmt.Println(b)    <span class="comment">// &#123;1 3 str true&#125;</span></span><br></pre></td></tr></table></figure></div><h2 id="接口嵌套"><a href="#接口嵌套" class="headerlink" title="接口嵌套"></a>接口嵌套</h2><p>接口中不仅可以定义方法签名，还可以定义其他的接口。这种方式我们称为<strong>接口嵌套</strong>。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接口A</span></span><br><span class="line"><span class="keyword">type</span> A <span class="keyword">interface</span> &#123;</span><br><span class="line">    method1()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接口B</span></span><br><span class="line"><span class="keyword">type</span> B <span class="keyword">interface</span> &#123;</span><br><span class="line">    method2()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接口C，嵌套了接口 A 和 B</span></span><br><span class="line"><span class="keyword">type</span> C <span class="keyword">interface</span> &#123;</span><br><span class="line">    A</span><br><span class="line">    B</span><br><span class="line">    method3()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 结构体</span></span><br><span class="line"><span class="keyword">type</span> person <span class="keyword">struct</span> &#123;</span><br><span class="line">    name <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p person)</span> <span class="title">method1</span><span class="params">()</span></span> &#123; <span class="comment">// 使 person 成为 接口A 的实现类</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p person)</span> <span class="title">method2</span><span class="params">()</span></span> &#123; <span class="comment">// 使 person 成为 接口B 的实现类</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p person)</span> <span class="title">method3</span><span class="params">()</span></span> &#123; <span class="comment">// 使 person 成为 接口C 的实现类，前提是实现了前面两个</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>嵌套了接口，不仅要实现接口本身的方法，还要实现接口中的嵌套接口的方法，才能认为实现了最外侧的接口。</p><p>如上面例子，person 要成为 C 的实现类，不仅要实现 C 的 <code>method3()</code> 方法，还得实现 A 的 <code>method1()</code> 和 B 的<code>method2()</code>。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    p := person&#123;<span class="string">&quot;Boii&quot;</span>&#125;</span><br><span class="line">    p.method1()</span><br><span class="line">    p.method2()</span><br><span class="line">    p.method3()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> a1 A = p</span><br><span class="line">    a1.method1()</span><br><span class="line">    <span class="comment">// a1.method2() // !报错</span></span><br><span class="line">    <span class="comment">// a1.method3() // !报错</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> b1 B = p</span><br><span class="line">    b1.method2()</span><br><span class="line">    <span class="comment">// b1.method1() // !报错</span></span><br><span class="line">    <span class="comment">// b1.method3() // !报错</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> c1 C = p</span><br><span class="line">    c1.method1() <span class="comment">// 正确</span></span><br><span class="line">    c1.method2() <span class="comment">// 正确</span></span><br><span class="line">    c1.method3() <span class="comment">// 正确</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> a2 A = c1   <span class="comment">// 接口C变量看成是接口A类型，这是可以的</span></span><br><span class="line">    a2.method1()    <span class="comment">// 但是只能调用接口A的 method1()</span></span><br><span class="line">    <span class="comment">// a2.method2() // !报错</span></span><br><span class="line">    <span class="comment">// a2.method3() // !报错</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> c2 C = a1   <span class="comment">// !报错，接口A变量看成是接口C类型，这是错误的</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="接口断言"><a href="#接口断言" class="headerlink" title="接口断言"></a>接口断言</h2><p>设 定义了一个接口A，还有两个结构体 X、Y，两个结构体都实现了接口A，当一个函数或方法想要接收 X 或 Y 两种类型时，可以将形参设置为 接口A 类型，这样传递的时候不管是 X 的对象还是 Y 的对象都可以传递进来。</p><p>【Q】：那如果在方法或函数里，我需要确定到底是 X 还是 Y 怎么办？</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> A <span class="keyword">interface</span> &#123;</span><br><span class="line">    aMethod()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> X <span class="keyword">struct</span> &#123;</span><br><span class="line">    name <span class="keyword">string</span></span><br><span class="line">    age  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Y <span class="keyword">struct</span> &#123;</span><br><span class="line">    name <span class="keyword">string</span></span><br><span class="line">    sex  <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现接口A</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(x X)</span> <span class="title">aMethod</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;I am &quot;</span>, x)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(y Y)</span> <span class="title">aMethod</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;I am&quot;</span>, y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个接收 X 和 Y 对象的函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(a A)</span></span> &#123;</span><br><span class="line">    a.aMethod()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>【A】：这时候我们需要用到接口类型断言来确定传进来的到底是 x 还是 y。</p><ul><li>方式1：<ol><li><code>instance := 接口对象.(实际类型)</code>，这种不安全，会引发 panic()</li><li><code>instance, ok := 接口对象.(实际类型)</code>，这种就安全。接口对象是实际类型时，ok 为 true</li></ol></li><li>方式2：switch  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> instance := 接口对象.(<span class="keyword">type</span>) &#123;</span><br><span class="line"><span class="keyword">case</span> 实际类型<span class="number">1</span>: ...</span><br><span class="line"><span class="keyword">case</span> 实际类型<span class="number">2</span>: ...</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>于是在 <code>test()</code> 函数中我们可以这样写：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span> <span class="params">(a A)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ins, ok := a.(X); ok &#123;</span><br><span class="line">        fmt.Println(ins.age)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ins, ok := a.(Y); ok &#123;</span><br><span class="line">        fmt.Println(ins.sex)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>或者这样写：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义一个接收 X 和 Y 对象的函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(a A)</span></span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> ins := a.(<span class="keyword">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> X:</span><br><span class="line">        fmt.Println(ins.age)</span><br><span class="line">    <span class="keyword">case</span> Y:</span><br><span class="line">        fmt.Println(ins.sex)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="值类型实现-VS-指针类型实现"><a href="#值类型实现-VS-指针类型实现" class="headerlink" title="值类型实现 VS 指针类型实现"></a>值类型实现 VS 指针类型实现</h2><p>我们先定义一个接口，和两个结构体</p><p>然后分别使用 值类型 和 指针类型 实现接口</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Aer <span class="keyword">interface</span> &#123;</span><br><span class="line">    method()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> X <span class="keyword">struct</span> &#123;&#125;</span><br><span class="line"><span class="keyword">type</span> Y <span class="keyword">struct</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 值类型实现</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(x X)</span> <span class="title">method</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 指针类型实现</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(y *Y)</span> <span class="title">method</span><span class="params">()</span></span> &#123;&#125;</span><br></pre></td></tr></table></figure><p>此时实现接口的是 <code>X</code> 类型 和 <code>*Y</code> 类型。</p><p>接着我们来使用一下：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    x := X&#123;&#125;</span><br><span class="line">    y := Y&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> a1 Aer = x    <span class="comment">// a1 可以接收 x 类型</span></span><br><span class="line">    <span class="keyword">var</span> a2 Aer = &amp;x   <span class="comment">// a2 可以接收 *X 类型</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> a3 Aer = y    <span class="comment">// !报错，a3 不可以接收 y 类型</span></span><br><span class="line">    <span class="keyword">var</span> a4 Aer = &amp;y   <span class="comment">// a4 可以接收 *y 类型</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在使用值类型实现接口之后，不管是 <code>X 结构体类型</code> 还是 <code>*X 结构体指针类型</code>，都可以赋值给该接口变量。<br>因为在 Go 语言中有对指针类型变量求值的语法糖，X 指针 <code>&amp;x</code> 内部会自动求值。<br><code>var a2 Aer = &amp;x</code> 会变成 <code>var a2 Aer = *(&amp;x)</code>。</p><p>而 Y 是用指针类型实现的，所以只能传递指针 <code>&amp;y</code> 给 Aer 接口变量。</p>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
          <category> Basic </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Golang [基础] 11-包</title>
      <link href="posts/6239436b"/>
      <url>posts/6239436b</url>
      
        <content type="html"><![CDATA[<p>包的使用</p><span id="more"></span><h1 id="11-包"><a href="#11-包" class="headerlink" title="11-包"></a>11-包</h1><p>在工程化的Go语言开发项目中，Go语言的源码复用是建立在包（package）基础之上的。本文介绍了Go语言中如何定义包、如何导出包的内容及如何导入其他包。</p><p>包（package）是多个 Go 源码的集合，是一种高级的代码复用方案，例如 Go 就提供了很多内置包，如<code>fmt</code>、<code>os</code>、<code>io</code>等。</p><h2 id="定义包"><a href="#定义包" class="headerlink" title="定义包"></a>定义包</h2><p>一个包可以简单理解为一个存放 <code>.go</code> 文件的目录。<br>该目录下面所有的go文件都要再代码第一行添加 <code>package 包名</code>，声明该文件归属的包。</p><p><strong>注意</strong>：</p><ol><li>一个目录下面直接包含的文件只能归属一个 <code>package</code></li><li>同一个 <code>package</code> 的文件不能放在多个目录下</li><li>包名可以不和目录名一样，但不能包含 <code>-</code> 符号</li><li><code>main 包</code> 为程序的入口包，这种包编译后会得到一个可执行文件</li><li>编译不含 <code>main 包</code> 的源代码不会得到可执行文件</li></ol><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">demo</span><br><span class="line">├── utils</span><br><span class="line">│   ├── calc<span class="selector-class">.go</span>     <span class="comment">// package utils</span></span><br><span class="line">│   └── data<span class="selector-class">.go</span>     <span class="comment">// package utils</span></span><br><span class="line">├── log</span><br><span class="line">│   ├── debug<span class="selector-class">.go</span>    <span class="comment">// package log</span></span><br><span class="line">│   └── info<span class="selector-class">.go</span>     <span class="comment">// package log</span></span><br><span class="line">├── <span class="selector-tag">main</span><span class="selector-class">.go</span>    <span class="comment">// package main</span></span><br><span class="line">└── test<span class="selector-class">.go</span>    <span class="comment">// package main</span></span><br></pre></td></tr></table></figure><h2 id="可见性"><a href="#可见性" class="headerlink" title="可见性"></a>可见性</h2><p>在一个包中引用另外一个包里的标识符（变量、函数、类型等），该标识符必须是对外可见的，即首字母大写的。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> model</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">100</span>    <span class="comment">// 首字母小写，外部包不可见，只能在当前包内使用</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> PI = <span class="number">3.14</span>    <span class="comment">// 首字母大写，外部包可见，可在其他包中使用</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> person <span class="keyword">struct</span> &#123;    <span class="comment">// 首字母小写，外部包不可见，只能在当前包内使用</span></span><br><span class="line">    Name <span class="keyword">string</span>    <span class="comment">// 首字母大写，外部包可见，可在其他包中使用</span></span><br><span class="line">    age  <span class="keyword">int8</span>      <span class="comment">// 仅限包内访问的字段</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Payer <span class="keyword">interface</span> &#123;    <span class="comment">// 首字母大写，外部包可见，可在其他包中使用</span></span><br><span class="line">    init()    <span class="comment">// 仅限包内访问的方法</span></span><br><span class="line">    Pay()     <span class="comment">// 可在保外访问的方法</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span><span class="params">(x, y <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;    <span class="comment">// 首字母大写，外部包可见，可在其他包中使用</span></span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">age</span><span class="params">()</span></span> &#123;    <span class="comment">// 首字母小写，外部包不可见，只能在当前包内使用</span></span><br><span class="line">    <span class="keyword">var</span> Age = <span class="number">18</span>    <span class="comment">// 函数局部变量，外部包不可见，只能在当前函数内使用</span></span><br><span class="line">    fmt.Println(age)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="导入包"><a href="#导入包" class="headerlink" title="导入包"></a>导入包</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;包的路径&quot;</span></span><br></pre></td></tr></table></figure><p><strong>注意</strong>：</p><ol><li>import 语句通常放在文件开头、包声明语句下面。</li><li>包的路径需要双引号括起来</li><li>包名是从 <code>$GOPATH/src/</code> 后面开始计算的，使用 <code>/</code> 分割路径，这是绝对路径；也可以使用相对路径</li><li>禁止互相导包</li></ol><h3 id="单行导入"><a href="#单行导入" class="headerlink" title="单行导入"></a>单行导入</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;包1&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;包2&quot;</span></span><br></pre></td></tr></table></figure><h3 id="多行导入"><a href="#多行导入" class="headerlink" title="多行导入"></a>多行导入</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;包1&quot;</span></span><br><span class="line">    <span class="string">&quot;包2&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="GO-MODULE-模式下导入自己的包"><a href="#GO-MODULE-模式下导入自己的包" class="headerlink" title="GO MODULE 模式下导入自己的包"></a>GO MODULE 模式下导入自己的包</h3><p>使用 Go Module 模式管理包时，如果想导入自己写的包，路径应为 <code>module名/路径...</code></p><p>eg：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">├── go<span class="selector-class">.mod</span>     <span class="comment">// module Stack</span></span><br><span class="line">├── <span class="selector-tag">main</span><span class="selector-class">.go</span>    <span class="comment">// package main</span></span><br><span class="line">└── seqStack</span><br><span class="line">    └── SeqStack<span class="selector-class">.go</span>    <span class="comment">// package seqStack</span></span><br></pre></td></tr></table></figure><p>从项目根目录下开始，有一个 <code>main.go</code> 文件，还有一个子包 <code>seqStack</code>。<br>现在我想在 <code>main.go</code> 中使用 <code>SeqStack.go</code> 中的函数，需要在 <code>main.go</code> 中导入 <code>seqStack</code> 这个包。</p><p>分为以下三步：</p><ol><li>在 <code>go.mod</code> 中写下：</li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">module Stack    <span class="comment">// 声明 module 名</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> <span class="number">1.16</span></span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>SeqStack.go</code> 中声明：</li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> seqStack    <span class="comment">// 声明子包名</span></span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><ol start="3"><li>在 <code>main.go</code> 中导入：</li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main    <span class="comment">// 声明 main 包</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;Stack/seqStack&quot;</span>    <span class="comment">// 正确导入</span></span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><h2 id="别名"><a href="#别名" class="headerlink" title="别名"></a>别名</h2><p>导包的时候，可以给包设置别名。常用于处理包名太长或包名冲突的情况。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> 别名 <span class="string">&quot;包的路径&quot;</span></span><br></pre></td></tr></table></figure><h3 id="单行"><a href="#单行" class="headerlink" title="单行"></a>单行</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="keyword">import</span> t <span class="string">&quot;tcp404.com/study/go/test&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(t.Add(<span class="number">10</span>, <span class="number">20</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="多行"><a href="#多行" class="headerlink" title="多行"></a>多行</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    . <span class="string">&quot;fmt&quot;</span>    <span class="comment">// 使用 . 作为别名，则使用时可以省略包名</span></span><br><span class="line">    t <span class="string">&quot;tcp404.com/study/go/test&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Println(t.Add(<span class="number">10</span>, <span class="number">20</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="省略包名"><a href="#省略包名" class="headerlink" title="省略包名"></a>省略包名</h3><p>在给包起别名的时候，别名为 <code>.</code> ，在后面使用时可以直接使用包中的变量和方法等，不需要加包名。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> . <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Println(<span class="string">&quot;Hello!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="init-初始化函数"><a href="#init-初始化函数" class="headerlink" title="init() 初始化函数"></a>init() 初始化函数</h2><blockquote><ul><li>Go 在执行导包之前，会自动触发包内的 <code>init()</code> 函数的调用。</li><li><code>init()</code> 没有参数也没有返回值，自动被调用，不能主动调用，<code>main()</code> 也是。</li><li>一个包内的<code>init()</code> 可以有多个，<code>main()</code> 只能有一个。</li><li>一个包可以被多个包导入，但是 <code>init()</code> 只会执行一次。</li><li>包内多个 <code>init()</code> 的执行顺序不固定，目前（Go 1.16.5）是按照文件名升序，a最先执行，z最后执行。</li></ul></blockquote><p>每个 <code>.go</code> 文件都可以有自己的 <code>init()</code> ，</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 全局变量</span></span><br><span class="line"><span class="keyword">var</span> age <span class="keyword">int8</span> = <span class="number">18</span></span><br><span class="line"><span class="keyword">const</span> E = <span class="number">2.78</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// init函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(E)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>一个包中的执行顺序为：<br><strong>1. 全局声明(const -&gt; var) -&gt; 2. init() -&gt; 3. main()</strong></p></blockquote><p>多个包有导入关系时，init() 执行顺序：从main 包开始，按照 main 包的 <strong>import 的顺序 广度优先</strong> 一层层往下找<br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20201125164650876_22585.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20201125164650876_22585.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h2 id="匿名导包"><a href="#匿名导包" class="headerlink" title="匿名导包"></a>匿名导包</h2><p>有时候只想导入一个包执行一下它的 <code>init()</code> 函数，并不使用包里的东西，可以使用匿名导包。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> _ <span class="string">&quot;包的路径&quot;</span></span><br></pre></td></tr></table></figure><p>匿名导入的包与其他方式导入的包一样都会被编译到可执行文件中。</p>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
          <category> Basic </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Golang [基础] 10-结构体</title>
      <link href="posts/ff53e8a4"/>
      <url>posts/ff53e8a4</url>
      
        <content type="html"><![CDATA[<p>结构体的创建与使用</p><span id="more"></span><h1 id="10-结构体"><a href="#10-结构体" class="headerlink" title="10-结构体"></a>10-结构体</h1><p>Go语言中没有“类”的概念，也不支持“类”的继承等面向对象的概念。Go语言中通过结构体的内嵌再配合接口比面向对象具有更高的扩展性和灵活性。</p><p>当我们想表示一些事物时，我们可以用基本数据类型表示其各项基本属性，通过结构体将其组合起来。在 Go 中可以通过 <code>struct</code> 实现面向对象。</p><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><div class="note warning"><p><strong>注意：结构体是值类型！！！</strong></p></div><p>使用 <code>type</code> 和 <code>struct</code> 来定义结构体。</p><p>基本语法如下：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> structT <span class="keyword">struct</span> &#123;</span><br><span class="line">    field1 T</span><br><span class="line">    field2 T</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>structT</code>：标识只定义结构体名称，同一包内不能重复。<br><code>field</code>：结构的基本属性的名字，结构体中的字段名不能重复<br><code>T</code>：字段的具体类型</p><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> person <span class="keyword">struct</span> &#123;</span><br><span class="line">    name <span class="keyword">string</span></span><br><span class="line">    age <span class="keyword">int8</span></span><br><span class="line">    city <span class="keyword">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>同类型字段可以写在一行</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> person <span class="keyword">struct</span> &#123;</span><br><span class="line">    name, city <span class="keyword">string</span></span><br><span class="line">    age <span class="keyword">int8</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过以上代码，我们就可以得到一个 <code>person</code> 的自定义类型，它有 <code>name</code>、<code>age</code>、<code>city</code> 三个字段，表示人的姓名、年龄、城市三个属性。<br>这样就可以通过 <code>person</code> 这个结构体很方便的在程序中表示和存储人的信息了。</p><blockquote><p>在定义结构体时，建议各个字段按字段类型从小到大排序，有助于<a href="https://segmentfault.com/a/1190000017527311">内存对齐</a>。<br>类型大小参考<a href="https://blog.csdn.net/mr_pro/article/details/113820586">《数据类型》一章</a></p></blockquote><p>Go 内置的基本数据类型用来描述一个值，而结构体用来描述一组值，本质上是一种聚合型数据类型。<br>一个结构体就像 Java 中的一个类，不过 Java 中的类还有构造函数、方法等，这些 Go 的结构体一样可以实现，方式有些不同</p><h2 id="实例化"><a href="#实例化" class="headerlink" title="实例化"></a>实例化</h2><p>只有当结构体实例化时，才会真正地分配内存。即必须实例化后才能使用结构体的字段。<br>结构体本身也是一种数据类型，我们可以像声明基本数据类型一样声明结构体</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 方式1</span></span><br><span class="line"><span class="keyword">var</span> identifier structT</span><br><span class="line">identifier.field1 = value1</span><br><span class="line">identifier.field2 = value2</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p><code>identifier</code>：结构体实例名称<br><code>structT</code>：结构体类型<br><code>field</code>：结构体字段</p><h3 id="方式1：基本实例化"><a href="#方式1：基本实例化" class="headerlink" title="方式1：基本实例化"></a>方式1：基本实例化</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> person <span class="keyword">struct</span> &#123;</span><br><span class="line">    name <span class="keyword">string</span></span><br><span class="line">    city <span class="keyword">string</span></span><br><span class="line">    age <span class="keyword">int8</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// 方式1</span></span><br><span class="line">    <span class="keyword">var</span> p1 person</span><br><span class="line">    p1.city = <span class="string">&quot;SWA&quot;</span></span><br><span class="line">    p1.name = <span class="string">&quot;Boii&quot;</span></span><br><span class="line"></span><br><span class="line">    fmt.Printf(<span class="string">&quot;p1 = %v \n&quot;</span>, p1)<span class="comment">// p1 = &#123;Boii 0 SWA&#125;</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;p1 = %#v \n&quot;</span>, p1)<span class="comment">// p1 = main.person&#123;name:&quot;Boii&quot;, age:0, city:&quot;SWA&quot;&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>仔细观察：</p><ul><li>方式1声明以后逐一给每个字段赋值，可以结构体中定义字段时的顺序，没有赋值的字段默认为零值</li><li>方式2 和 方式3在赋值的时候需要所有字段都赋值，且需要按顺序。</li><li>通过<code>.</code>可以访问结构体中的字段，例如<code>p1.city</code>.</li></ul><h3 id="方式2：new-T-结构体指针"><a href="#方式2：new-T-结构体指针" class="headerlink" title="方式2：new(T) 结构体指针"></a>方式2：new(T) 结构体指针</h3><p>通过 <code>new()</code> 可以对结构体实例化，得到的是结构体指针，其各个字段都为零值。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> person <span class="keyword">struct</span> &#123;</span><br><span class="line">    name <span class="keyword">string</span></span><br><span class="line">    city <span class="keyword">string</span></span><br><span class="line">    age  <span class="keyword">int8</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> p1 = <span class="built_in">new</span>(person)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%T \n&quot;</span>, p1)      <span class="comment">// *main.person</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;p1 = %#v \n&quot;</span>, p1) <span class="comment">// p1 = &amp;main.person&#123;name:&quot;&quot;, age:0, city:&quot;&quot;&#125;</span></span><br><span class="line">    </span><br><span class="line">    p1.name = <span class="string">&quot;Boii&quot;</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;p1 = %#v \n&quot;</span>, p1) <span class="comment">// p1 = &amp;main.person&#123;name:&quot;Boii&quot;, age:0, city:&quot;&quot;&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>注意</strong>：Go 中的结构体指针可以直接使用<code>.</code>来访问结构体成员。<br><code>p1.name = &quot;Boii&quot;</code> 相当于 <code>(*p1).name = &quot;Boii&quot;</code>，这是 Go 的语法糖。</p><h3 id="方式3：-amp-T-取结构体地址"><a href="#方式3：-amp-T-取结构体地址" class="headerlink" title="方式3：&amp;T{} 取结构体地址"></a>方式3：&amp;T{} 取结构体地址</h3><p>使用 <code>&amp;</code> 对结构体取地址操作相当于对该结构体类型进行了一次 <code>new</code>实例化操作。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> person <span class="keyword">struct</span> &#123;</span><br><span class="line">    name <span class="keyword">string</span></span><br><span class="line">    city <span class="keyword">string</span></span><br><span class="line">    age  <span class="keyword">int8</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> p2 = &amp;person&#123;<span class="string">&quot;Boii&quot;</span>, <span class="number">10</span>, <span class="string">&quot;SWA&quot;</span>&#125;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%T \n&quot;</span>, p2)       <span class="comment">// *main.person</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;p2 = %#v \n&quot;</span>, p2) <span class="comment">// p = &amp;main.person&#123;name:&quot;Boii&quot;, age:10, city:&quot;SWA&quot;&#125;</span></span><br><span class="line"></span><br><span class="line">    p3 := &amp;person&#123;&#125;</span><br><span class="line">    p3.name = <span class="string">&quot;Candy&quot;</span></span><br><span class="line">    p3.age = <span class="number">10</span></span><br><span class="line">    p3.city = <span class="string">&quot;SWA&quot;</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%T \n&quot;</span>, p3)       <span class="comment">// *main.person</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;p3 = %#v \n&quot;</span>, p3) <span class="comment">// p = &amp;main.person&#123;name:&quot;Candy&quot;, age:10, city:&quot;SWA&quot;&#125;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>所以：<code>new(Type)</code> 和 <code>&amp;Type&#123;&#125;</code> 是等价的。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20201122164056342_11482.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20201122164056342_11482.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20201122164122020_21432.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20201122164122020_21432.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h3 id="匿名结构体"><a href="#匿名结构体" class="headerlink" title="匿名结构体"></a>匿名结构体</h3><p>在定义一些临时数据结构等场景下还可以使用匿名结构体。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// 定义匿名结构体</span></span><br><span class="line">    <span class="comment">// 字段之间用 分号 隔开</span></span><br><span class="line">    <span class="keyword">var</span> user <span class="keyword">struct</span>&#123;name <span class="keyword">string</span>; age <span class="keyword">int8</span>&#125;</span><br><span class="line">    <span class="comment">// 通过结构体实例使用匿名结构体</span></span><br><span class="line">    user.name = <span class="string">&quot;Boii&quot;</span></span><br><span class="line">    user.age = <span class="number">18</span></span><br><span class="line"></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%v \n&quot;</span>, user)  <span class="comment">// &#123;Boii 18&#125;</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%#v \n&quot;</span>, user) <span class="comment">// struct &#123; name string; age int8 &#125;&#123;name:&quot;Boii&quot;, age:18&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 相同类型可以简写</span></span><br><span class="line">    <span class="keyword">var</span> stu <span class="keyword">struct</span>&#123;name <span class="keyword">string</span>; ID, age <span class="keyword">int</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 规范写法</span></span><br><span class="line">    <span class="keyword">var</span> stud <span class="keyword">struct</span> &#123;</span><br><span class="line">        name    <span class="keyword">string</span></span><br><span class="line">        ID, age <span class="keyword">int</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><p>结构体没有初始化的时候，成员变量都是对应类型的零值，这点在上面的例子中已经有所体现。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> stu <span class="keyword">struct</span> &#123;</span><br><span class="line">    name <span class="keyword">string</span></span><br><span class="line">    age  <span class="keyword">int8</span></span><br><span class="line">    ID   <span class="keyword">int8</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> s1 stu</span><br><span class="line">    fmt.Printf(<span class="string">&quot;s1 = %#v \n&quot;</span>, s1) <span class="comment">// s1 = main.stu&#123;name:&quot;&quot;, age:0, ID:0&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="使用键值对的方式初始化"><a href="#使用键值对的方式初始化" class="headerlink" title="使用键值对的方式初始化"></a>使用键值对的方式初始化</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">identifier := structT&#123;</span><br><span class="line">    field1: value1,</span><br><span class="line">    field2: value2,</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> identifier = structT&#123;</span><br><span class="line">    field1: value1,</span><br><span class="line">    field2: value2,</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">s2 := stu&#123;</span><br><span class="line">    name: <span class="string">&quot;Boii&quot;</span>,</span><br><span class="line">    age:  <span class="number">18</span>,</span><br><span class="line">&#125;</span><br><span class="line">fmt.Printf(<span class="string">&quot;s2 = %#v \n&quot;</span>, s2) <span class="comment">// s2 = main.stu&#123;name:&quot;Boii&quot;, age:18, ID:0&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> s3 = stu&#123;</span><br><span class="line">    name: <span class="string">&quot;Eva&quot;</span>,</span><br><span class="line">    age:  <span class="number">18</span>,</span><br><span class="line">&#125;</span><br><span class="line">fmt.Printf(<span class="string">&quot;s3 = %#v \n&quot;</span>, s3) <span class="comment">// s3 = main.stu&#123;name:&quot;Eva&quot;, age:18, ID:0&#125;</span></span><br></pre></td></tr></table></figure><p>使用键值对的方式可以不按结构体定义时字段的顺序，可以不初始化每一个字段，没被初始化的字段就默认为零值。<br>注意最后一个字段也要加上逗号<code>,</code>。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">s3 := &amp;stu&#123;</span><br><span class="line">    age: <span class="number">18</span>,</span><br><span class="line">    ID:  <span class="number">101</span>,</span><br><span class="line">&#125;</span><br><span class="line">fmt.Printf(<span class="string">&quot;s3 = %#v \n&quot;</span>, s3) <span class="comment">// s3 = &amp;main.stu&#123;name:&quot;&quot;, age:18, ID:101&#125;</span></span><br></pre></td></tr></table></figure><p>也可以对结构体指针进行键值对初始化</p><h3 id="使用值列表的方式初始化"><a href="#使用值列表的方式初始化" class="headerlink" title="使用值列表的方式初始化"></a>使用值列表的方式初始化</h3><p>初始化结构体的时候可以简写，不写键，只写值。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">identifier := structT&#123;</span><br><span class="line">    value1,</span><br><span class="line">    value2,</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> identifier = structT&#123;</span><br><span class="line">    value1,</span><br><span class="line">    value2,</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">s4 := stu&#123;</span><br><span class="line">    <span class="string">&quot;Boii&quot;</span>,</span><br><span class="line">    <span class="number">18</span>,</span><br><span class="line">    <span class="number">102</span>,</span><br><span class="line">&#125;</span><br><span class="line">fmt.Printf(<span class="string">&quot;s4 = %#v \n&quot;</span>, s4) <span class="comment">// s4 = main.stu&#123;name:&quot;Boii&quot;, age:18, ID:102&#125;</span></span><br></pre></td></tr></table></figure><p>使用这种要注意：</p><ol><li>必须初始化结构体里所有字段</li><li>初始值填充顺序必须和字段在结构体中声明的顺序一致</li><li>不能和键值对的初始化方式混用</li></ol><h3 id="一点细节"><a href="#一点细节" class="headerlink" title="一点细节"></a>一点细节</h3><p>初始化时，如果值写成多行，则最后一个也要带上逗号 <code>,</code> ;<br>如果写成一行，则最后一个可以不带逗号 <code>,</code> ; 也可以带上逗号。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">    name <span class="keyword">string</span></span><br><span class="line">    age  <span class="keyword">int</span></span><br><span class="line">    sex  <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    p1 := Person&#123;</span><br><span class="line">        <span class="string">&quot;Boii&quot;</span>,</span><br><span class="line">        <span class="number">18</span>,</span><br><span class="line">        <span class="string">&quot;male&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    p2 := Person&#123;</span><br><span class="line">        name: <span class="string">&quot;Boii&quot;</span>,</span><br><span class="line">        sex:  <span class="string">&quot;male&quot;</span>,</span><br><span class="line">        age:  <span class="number">18</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    p3 := Person&#123; <span class="string">&quot;Boii&quot;</span>, <span class="number">18</span>, <span class="string">&quot;male&quot;</span> &#125;</span><br><span class="line"></span><br><span class="line">    p4 := Person&#123; name: <span class="string">&quot;Boii&quot;</span>, sex: <span class="string">&quot;male&quot;</span>, age: <span class="number">18</span>, &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="方法和接收者"><a href="#方法和接收者" class="headerlink" title="方法和接收者"></a>方法和接收者</h2><p>例如下面的通式，方法名前面的<strong>接收者变量和接收者类型</strong>，就是一种限定。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(接收者变量 接收者类型)</span> 方法名<span class="params">(参数列表)</span> <span class="params">(返回参数)</span></span> &#123;</span><br><span class="line">    方法体</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对比：函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> 函数名<span class="params">(参数列表)</span> <span class="params">(返回参数)</span></span> &#123;</span><br><span class="line">    函数体</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>接收者指的就是被允许调用的调用者</strong>。注意理解：下面将以接收者代替调用者的说法。</p><ul><li><strong>接收者变量</strong>：命名时，官方建议使用接收者类型首个字母小写。eg：<code>p Person</code>、<code>c Connector</code></li><li><strong>接收者类型</strong>：接收者类型和参数相似，可以是指针类型或非指针类型</li><li><strong>方法名、参数列表、返回参数</strong>：具体格式与函数定义相同</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Dog 结构体</span></span><br><span class="line"><span class="keyword">type</span> Dog <span class="keyword">struct</span> &#123;</span><br><span class="line">    name <span class="keyword">string</span></span><br><span class="line">    age  <span class="keyword">int8</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewDog 构造函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewDog</span><span class="params">(name <span class="keyword">string</span>, age <span class="keyword">int8</span>)</span> *<span class="title">Dog</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;Dog&#123;name, age&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Run Dog奔跑的方法</span></span><br><span class="line"><span class="comment">// 限定了 Dog 结构体类型才可以调用此方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d Dog)</span> <span class="title">Run</span><span class="params">(distance <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%d 岁的狗狗 %s 跑了 %d 米\n&quot;</span>, d.age, d.name, distance)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    boby := NewDog(<span class="string">&quot;Boby&quot;</span>, <span class="number">2</span>)</span><br><span class="line">    boby.Run(<span class="number">100</span>)</span><br><span class="line">    doge := Dog&#123;<span class="string">&quot;Doge&quot;</span>, <span class="number">3</span>&#125;</span><br><span class="line">    doge.Run(<span class="number">12</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// -------------------------------------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line"><span class="number">2</span> 岁的狗狗 Boby 跑了 <span class="number">100</span> 米</span><br><span class="line"><span class="number">3</span> 岁的狗狗 Doge 跑了 <span class="number">12</span> 米</span><br></pre></td></tr></table></figure><h3 id="指针类型的接收者"><a href="#指针类型的接收者" class="headerlink" title="指针类型的接收者"></a>指针类型的接收者</h3><blockquote><p>如果指定指针类型的接收者，在方法内修改接收者的成员变量，则<strong>结束方法后修改依然有效</strong>。</p></blockquote><p>例如我们为 <code>Dog</code> 添加一个 <code>setAge</code> 方法：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d *Dog)</span> <span class="title">SetAge</span><span class="params">(newAge <span class="keyword">int8</span>)</span></span> &#123;</span><br><span class="line">    d.age = newAge</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    boby := NewDog(<span class="string">&quot;Boby&quot;</span>, <span class="number">2</span>)</span><br><span class="line">    fmt.Println(boby.age) <span class="comment">// 2</span></span><br><span class="line">    boby.SetAge(<span class="number">10</span>)</span><br><span class="line">    fmt.Println(boby.age) <span class="comment">// 10</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="值类型的接收者"><a href="#值类型的接收者" class="headerlink" title="值类型的接收者"></a>值类型的接收者</h3><blockquote><p>当方法作用于值类型接收者时，Go 会在运行时将接收者的值复制一份。不过<strong>在方法内对接收者的修改只是对副本的修改</strong>，不会影响接收者。</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d Dog)</span> <span class="title">SetAge</span><span class="params">(newAge <span class="keyword">int8</span>)</span></span> &#123;</span><br><span class="line">    d.age = newAge</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    boby := NewDog(<span class="string">&quot;Boby&quot;</span>, <span class="number">2</span>)</span><br><span class="line">    fmt.Println(boby.age) <span class="comment">// 2</span></span><br><span class="line">    boby.SetAge(<span class="number">10</span>)</span><br><span class="line">    fmt.Println(boby.age) <span class="comment">// 2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="任意类型添加方法"><a href="#任意类型添加方法" class="headerlink" title="任意类型添加方法"></a>任意类型添加方法</h3><p>在 Go 中，接收者类型可以是任何类型，不仅仅是结构体，任何类型都可以拥有方法。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Status <span class="keyword">int</span>    <span class="comment">// 自定义类型</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s Status)</span> <span class="title">say</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;OK&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> s Status</span><br><span class="line">    s.say()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>注意</strong>： 非本地类型不能定义方法，也就是说我们不能给别的包的类型定义方法。</p></blockquote><h2 id="内存布局"><a href="#内存布局" class="headerlink" title="内存布局"></a>内存布局</h2><p>在 Go 中，结构体和它所包含的数据在内存中是以连续块的形式存在的，即使结构体中嵌套了结构体也一样。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> person <span class="keyword">struct</span> &#123;</span><br><span class="line">    name <span class="keyword">string</span></span><br><span class="line">    age  <span class="keyword">int8</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> stu1 <span class="keyword">struct</span> &#123;</span><br><span class="line">    ID     <span class="keyword">int8</span></span><br><span class="line">    info   person</span><br><span class="line">    depart <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> stu2 <span class="keyword">struct</span> &#123;</span><br><span class="line">    ID     <span class="keyword">int8</span></span><br><span class="line">    info   *person</span><br><span class="line">    depart <span class="keyword">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20201123131640736_15271.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20201123131640736_15271.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h2 id="匿名字段"><a href="#匿名字段" class="headerlink" title="匿名字段"></a>匿名字段</h2><p>Go 中的结构体允许声明时只有类型而没有名字，这样的字段叫做匿名字段</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> stu <span class="keyword">struct</span> &#123;</span><br><span class="line">    <span class="keyword">string</span></span><br><span class="line">    <span class="keyword">int8</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s1 := stu&#123;</span><br><span class="line">        <span class="string">&quot;Boii&quot;</span>,</span><br><span class="line">        <span class="number">18</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%#v\n&quot;</span>, s1)         <span class="comment">// main.stu&#123;string:&quot;Boii&quot;, int8:18&#125;</span></span><br><span class="line">    fmt.Println(s1.<span class="keyword">string</span>, s1.<span class="keyword">int8</span>) <span class="comment">// Boii 18</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>匿名字段默认采用类型作为字段名，同一个结构体中一种类型只能有一个匿名字段。</p></blockquote><p>所以上面的结构体等价于：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> stu <span class="keyword">struct</span> &#123;</span><br><span class="line">    <span class="keyword">string</span> <span class="keyword">string</span></span><br><span class="line">    <span class="keyword">int8</span>   <span class="keyword">int8</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="嵌套结构体"><a href="#嵌套结构体" class="headerlink" title="嵌套结构体"></a>嵌套结构体</h2><p>嵌套结构体，简单说就是套娃</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> person <span class="keyword">struct</span> &#123;</span><br><span class="line">    name <span class="keyword">string</span></span><br><span class="line">    age  <span class="keyword">int8</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 娃娃2</span></span><br><span class="line"><span class="keyword">type</span> stu <span class="keyword">struct</span> &#123;</span><br><span class="line">    ID     <span class="keyword">int8</span></span><br><span class="line">    info   person  <span class="comment">// 套娃娃1</span></span><br><span class="line">    depart <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    stuA := stu&#123;</span><br><span class="line">        ID: <span class="number">101</span>,</span><br><span class="line">        info: person&#123;</span><br><span class="line">            <span class="string">&quot;Alice&quot;</span>,</span><br><span class="line">            <span class="number">18</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        depart: <span class="string">&quot;CA&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%#v\n&quot;</span>, stuA) <span class="comment">// main.stu&#123;ID:1, info:main.person&#123;name:&quot;Boii&quot;, age:18&#125;, depart:&quot;CA&quot;&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果结构体太大，担心开销的话，可以用结构体指针</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 娃娃1</span></span><br><span class="line"><span class="keyword">type</span> person <span class="keyword">struct</span> &#123;</span><br><span class="line">    name <span class="keyword">string</span></span><br><span class="line">    age  <span class="keyword">int8</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 娃娃2</span></span><br><span class="line"><span class="keyword">type</span> stu2 <span class="keyword">struct</span> &#123;</span><br><span class="line">    ID     <span class="keyword">int8</span></span><br><span class="line">    info   *person <span class="comment">// 套娃娃1的指针</span></span><br><span class="line">    depart <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    stuB := stu2&#123;</span><br><span class="line">        ID: <span class="number">102</span>,</span><br><span class="line">        info: &amp;person&#123;</span><br><span class="line">            <span class="string">&quot;Boii&quot;</span>,</span><br><span class="line">            <span class="number">20</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        depart: <span class="string">&quot;SE&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%#v\n&quot;</span>, stuB) <span class="comment">// main.stu2&#123;ID:1, info:(*main.person)(0xc0000044a0), depart:&quot;CA&quot;&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>用结构体和结构体指针的差别如下图：<br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20201123131640736_15271.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20201123131640736_15271.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>显然当结构体较大的时候，使用结构体指针的操作开销会很小。</p><h3 id="嵌套结构体的匿名字段"><a href="#嵌套结构体的匿名字段" class="headerlink" title="嵌套结构体的匿名字段"></a>嵌套结构体的匿名字段</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> addr <span class="keyword">struct</span> &#123;</span><br><span class="line">    province <span class="keyword">string</span></span><br><span class="line">    city     <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> user <span class="keyword">struct</span> &#123;</span><br><span class="line">    name <span class="keyword">string</span></span><br><span class="line">    age  <span class="keyword">int8</span></span><br><span class="line">    addr <span class="comment">// 匿名字段</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> userA user</span><br><span class="line">    userA.name = <span class="string">&quot;Boii&quot;</span></span><br><span class="line">    userA.age = <span class="number">18</span></span><br><span class="line">    userA.addr.province = <span class="string">&quot;GD&quot;</span> <span class="comment">// 匿名字段默认使用类型名作为字段名</span></span><br><span class="line">    userA.city = <span class="string">&quot;SWA&quot;</span>         <span class="comment">// 匿名字段可以省略</span></span><br><span class="line"></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%#v \n&quot;</span>, userA) <span class="comment">// main.user&#123;name:&quot;Boii&quot;, age:18, addr:main.addr&#123;province:&quot;GD&quot;, city:&quot;SWA&quot;&#125;&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="嵌套结构体命名冲突"><a href="#嵌套结构体命名冲突" class="headerlink" title="嵌套结构体命名冲突"></a>嵌套结构体命名冲突</h3><p>当嵌套结构体出现命名冲突的时候，只要不省略，把关系链写清楚就没事了。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> addr <span class="keyword">struct</span> &#123;</span><br><span class="line">    province   <span class="keyword">string</span></span><br><span class="line">    city       <span class="keyword">string</span></span><br><span class="line">    createTime <span class="keyword">string</span>    <span class="comment">// 命名冲突</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> user <span class="keyword">struct</span> &#123;</span><br><span class="line">    name       <span class="keyword">string</span></span><br><span class="line">    age        <span class="keyword">int8</span></span><br><span class="line">    addr       <span class="comment">// 匿名字段</span></span><br><span class="line">    createTime <span class="keyword">string</span>    <span class="comment">// 命名冲突</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> userA user</span><br><span class="line">    userA.name = <span class="string">&quot;Boii&quot;</span></span><br><span class="line">    userA.age = <span class="number">18</span></span><br><span class="line">    userA.addr.province = <span class="string">&quot;GD&quot;</span></span><br><span class="line">    userA.city = <span class="string">&quot;SWA&quot;</span></span><br><span class="line">    <span class="comment">// 命名冲突字段</span></span><br><span class="line">    userA.createTime = <span class="string">&quot;2020&quot;</span>        <span class="comment">// 关系链写清楚</span></span><br><span class="line">    userA.addr.createTime = <span class="string">&quot;2021&quot;</span>   <span class="comment">// 关系链写清楚</span></span><br><span class="line"></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%#v \n&quot;</span>, userA)</span><br><span class="line">    <span class="comment">// main.user&#123;name:&quot;Boii&quot;, age:18, addr:main.addr&#123;province:&quot;GD&quot;, city:&quot;SWA&quot;, createTime:&quot;2021&quot;&#125;, createTime:&quot;2020&quot;&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="结构体的继承"><a href="#结构体的继承" class="headerlink" title="结构体的继承"></a>结构体的继承</h2><p>在面向对象中，继承指的是子类可以拥有父类所有非私有属性和方法。</p><p>Go 中使用结构体嵌套也可以实现其他编程语言中面向对象的继承。<br>方法是通过在 “子结构体” 中嵌套 “父结构体” ，这样 “子结构体” 就拥有 “父结构体” 的属性了</p><p>结合上面 “嵌套结构体的匿名字段” 中的例子，无命名冲突时，可以通过 <code>子结构体实例.父结构体属性</code>调用的特性，可以很容易的编写出适合 “子结构体” 的方法。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// animal 动物</span></span><br><span class="line"><span class="keyword">type</span> animal <span class="keyword">struct</span> &#123;</span><br><span class="line">    name <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// dog 狗</span></span><br><span class="line"><span class="keyword">type</span> dog <span class="keyword">struct</span> &#123;</span><br><span class="line">    variety <span class="keyword">string</span></span><br><span class="line">    *animal <span class="comment">// 子结构体嵌套父结构体实现继承，必须使用匿名字段</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d *dog)</span> <span class="title">bark</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// dog 没有 name 属性，但是内嵌的 animal 有</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%s 正在汪汪汪~&quot;</span>, d.name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    doge := &amp;dog&#123;</span><br><span class="line">        variety: <span class="string">&quot;Doge&quot;</span>,</span><br><span class="line">        animal: &amp;animal&#123; <span class="comment">// 注意嵌套的是结构体指针</span></span><br><span class="line">            name: <span class="string">&quot;Boby&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">    doge.bark() <span class="comment">// Boby 正在汪汪汪~</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="结构体标签-Tag"><a href="#结构体标签-Tag" class="headerlink" title="结构体标签 Tag"></a>结构体标签 Tag</h2><p><code>Tag</code> 是结构体的元信息，可以在运行的时候通过反射机制读取。所以只有首字母大写的可被导出的变量能被反射读取，转成JSON。<br><code>Tag</code> 在结构体字段的后方定义，由一对<strong>反引号</strong>包起来。</p><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> person <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name <span class="keyword">string</span> <span class="string">`json:&quot;name&quot;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>一个 Tag 由一个或多个键值对组成。</li><li><strong>键值对</strong>之间使用空格分隔</li><li><strong>键</strong>与<strong>值</strong>之间使用冒号分隔，不能有空格</li><li>值使用双引号括起来。</li><li>值为 <code>-</code> 时该字段不会被序列化</li></ul><p>编写 <code>Tag</code> 时必须严格遵守键值对的规则。结构体标签的解析容错能力很差，写错了编译期和运行期都不会提示任何错误，反射也无法正确取值。</p><h2 id="结构体序列化"><a href="#结构体序列化" class="headerlink" title="结构体序列化"></a>结构体序列化</h2><p><strong>序列化（struct -&gt; JSON）</strong>：结构体对象 转成 JSON格式字符串<br><strong>反序列化（JSON -&gt; struct）</strong>：JSON格式字符串 转成 结构体对象</p><p>使用 <code>encoding/json</code> 完成。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;encoding/json&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 序列化函数，struct -&gt; JSON</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Marshal</span><span class="params">(v <span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">([]<span class="keyword">byte</span>, error)</span></span> &#123;&#125;</span><br><span class="line"><span class="comment">// 反序列化函数，JSON -&gt; struct</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Unmarshal</span><span class="params">(data []<span class="keyword">byte</span>, v <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">error</span></span> &#123;&#125;</span><br></pre></td></tr></table></figure><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 序列化 encode：把结构体变量 -&gt; json格式的字符串</span></span><br><span class="line"><span class="comment">// 2. 反序列化 decode：json格式的字符串 -&gt; 结构体变量</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> person <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name <span class="keyword">string</span> <span class="string">`json:&quot;name&quot; db:&quot;name&quot; ini:&quot;name&quot;`</span></span><br><span class="line">    Age  <span class="keyword">int</span>    <span class="string">`json:&quot;age&quot;`</span></span><br><span class="line">    Sex  <span class="keyword">string</span></span><br><span class="line">    Addr <span class="keyword">string</span> <span class="string">`json:&quot;-&quot;`</span>    <span class="comment">// value 为 &quot;-&quot; 时不序列化</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    p1 := person&#123;<span class="string">&quot;Boii&quot;</span>, <span class="number">18</span>, <span class="string">&quot;male&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 序列化 */</span></span><br><span class="line">    b, err := json.Marshal(p1)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(err)</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(<span class="keyword">string</span>(b)) <span class="comment">// &#123;&quot;name&quot;:&quot;Boii&quot;,&quot;age&quot;:18,&quot;Sex&quot;:&quot;male&quot;&#125;</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%T \n&quot;</span>, b) <span class="comment">// []uint8</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 反序列化 */</span></span><br><span class="line">    str := <span class="string">`&#123;&quot;name&quot;:&quot;Eva&quot;,&quot;age&quot;:18&#125;`</span></span><br><span class="line">    <span class="keyword">var</span> p2 person</span><br><span class="line">    json.Unmarshal([]<span class="keyword">byte</span>(str), &amp;p2)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%#v \n&quot;</span>, p2) <span class="comment">// main.person&#123;Name:&quot;Eva&quot;, Age:18, Sex:&quot;&quot;&#125;</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%T \n&quot;</span>, p2)  <span class="comment">// main.person</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>序列化时，key 会优先选择字段的 Tag 中指定的 key</p><div class="note warning"><p><strong>结构体中非 public 的字段不会被序列化</strong></p></div><h2 id="结构体的深浅拷贝"><a href="#结构体的深浅拷贝" class="headerlink" title="结构体的深浅拷贝"></a>结构体的深浅拷贝</h2><div class="note info"><p>深拷贝：即<strong>为新的对象分配了内存</strong>，对新对象的修改不会影响旧对象<br>浅拷贝：即<strong>复制了旧对象的地址</strong>，对新对象的修改会影响旧对象</p><p>值类型都是深拷贝<br>引用类型都是浅拷贝</p></div><p>看懂以上两句话，结构体的深浅拷贝就很容易实现了</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">    name <span class="keyword">string</span></span><br><span class="line">    age  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// 结构体的深拷贝</span></span><br><span class="line">    person1 := Person&#123;<span class="string">&quot;Boii&quot;</span>, <span class="number">18</span>&#125;</span><br><span class="line">    person2 := person1   <span class="comment">// 深拷贝</span></span><br><span class="line">    fmt.Println(person1) <span class="comment">// &#123;Boii 18&#125;</span></span><br><span class="line">    fmt.Println(person2) <span class="comment">// &#123;Boii 18&#125;</span></span><br><span class="line"></span><br><span class="line">    person2.age = <span class="number">20</span></span><br><span class="line"></span><br><span class="line">    fmt.Println(person1) <span class="comment">// &#123;Boii 18&#125;</span></span><br><span class="line">    fmt.Println(person2) <span class="comment">// &#123;Boii 20&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 结构体的浅拷贝</span></span><br><span class="line">    person3 := &amp;person1 <span class="comment">// 浅拷贝</span></span><br><span class="line">    person3.age = <span class="number">20</span></span><br><span class="line">    fmt.Println(person1) <span class="comment">// &#123;Boii 20&#125;</span></span><br><span class="line">    fmt.Println(person3) <span class="comment">// &amp;&#123;Boii 20&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结构体是值类型，直接赋值的时候是深拷贝，赋值一个指针则是浅拷贝</p>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
          <category> Basic </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Golang [基础] 9-指针</title>
      <link href="posts/237b56c2"/>
      <url>posts/237b56c2</url>
      
        <content type="html"><![CDATA[<p>指针的创建与使用</p><span id="more"></span><h1 id="9-指针"><a href="#9-指针" class="headerlink" title="9-指针"></a>9-指针</h1><p>区别于C/C++中的指针，Go中的指针不能进行偏移和运算，是安全指针，</p><p>任何程序数据载入内存后，在内存都有他们的地址，这就是指针。<br>为了保存一个数据在内存中的地址，我们就需要指针。</p><p>Go 中的指针操作非常简单：<code>&amp;</code>取地址符、<code>*</code>根据地址取值。</p><h2 id="定义指针、指针取地址"><a href="#定义指针、指针取地址" class="headerlink" title="定义指针、指针取地址"></a>定义指针、指针取地址</h2><div class="note warning"><p><strong>注意：指针是值类型！！！</strong></p></div><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> identifier *T</span><br><span class="line"><span class="keyword">var</span> identifier *T = &amp;variable</span><br><span class="line">identifier := &amp;variable</span><br></pre></td></tr></table></figure><p><code>identifier</code>：指针名、<code>T</code>指针基类型、<code>*T</code>某类型指针、<code>variable</code>：变量、<code>&amp;variable</code>：取变量地址</p><p>Go 中的值类型（int、float、bool、string、数组、struct结构体）都有对应类型指针，如 <code>*int、*float、*string、*bool、*[5]int</code>。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    i := <span class="number">1</span></span><br><span class="line">    <span class="keyword">var</span> p *<span class="keyword">int</span> = &amp;i</span><br><span class="line"></span><br><span class="line">    fmt.Printf(<span class="string">&quot;i:     %d \n&quot;</span>, i)   <span class="comment">// i:    1 </span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;iaddr: %p \n&quot;</span>, &amp;i)     <span class="comment">// addr: 0xc000012090 </span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;p:     %p \n&quot;</span>, p)      <span class="comment">// p:    0xc000012090</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;paddr: %p \n&quot;</span>, &amp;p)     <span class="comment">// addr: 0xc000006028 </span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;pint Type: %T \n&quot;</span>, p)  <span class="comment">// pint Type: *int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20201126192904446_12246.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20201126192904446_12246.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h2 id="指针取值"><a href="#指针取值" class="headerlink" title="指针取值"></a>指针取值</h2><p>定义指针之后，就可以对指针进行操作了。<br>指针的操作有两种：<code>&amp;</code>取地址、<code>*</code>根据地址取值</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 指针取值</span></span><br><span class="line">    a := <span class="number">10</span></span><br><span class="line">    b := &amp;a</span><br><span class="line">    fmt.Println(b)  <span class="comment">// b 中保存着 a 的地址</span></span><br><span class="line">    fmt.Println(&amp;a) <span class="comment">// 取 a 的地址</span></span><br><span class="line">    fmt.Println(a)  <span class="comment">// a 的值</span></span><br><span class="line">    fmt.Println(*b) <span class="comment">// 取 b</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ------------------------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line"><span class="number">0xc000012090</span></span><br><span class="line"><span class="number">0xc000012090</span></span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="number">10</span></span><br></pre></td></tr></table></figure><p>取地址操作符<code>&amp;</code>和取值操作符<code>*</code>是一对互补操作符，<code>&amp;</code>取出地址，<code>*</code>根据地址取出地址指向的值。</p><p>变量、指针地址、指针变量、取地址、取值的相互关系和特性如下：</p><ul><li>对变量进行取地址（&amp;）操作，可以获得这个变量的指针变量。</li><li>指针变量的值是指针地址。</li><li>对指针变量进行取值（*）操作，可以获得指针变量指向的原变量的值。</li></ul><h2 id="结构体指针"><a href="#结构体指针" class="headerlink" title="结构体指针"></a>结构体指针</h2><p>结构体指针访问结构体字段 同 结构体变量访问结构体字段一样，使用 <code>.</code> 点操作符，Go 没有 <code>-&gt;</code> 操作符。</p><p>eg:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;    <span class="comment">// 定义结构体</span></span><br><span class="line">    name <span class="keyword">string</span></span><br><span class="line">    age  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Boii := User &#123;    <span class="comment">// 定义结构体变量</span></span><br><span class="line">    name: <span class="string">&quot;Boii&quot;</span>,</span><br><span class="line">    age:  <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">p := &amp;Boii    <span class="comment">// 定义结构体指针</span></span><br><span class="line"></span><br><span class="line">fmt.Println(p.name)    <span class="comment">// 用 . 点操作符访问成员 Boii</span></span><br></pre></td></tr></table></figure><h2 id="指针做形参"><a href="#指针做形参" class="headerlink" title="指针做形参"></a>指针做形参</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fn1</span><span class="params">(x <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    x = <span class="number">100</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fn2</span><span class="params">(x *<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    *x = <span class="number">100</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> a <span class="keyword">int</span> = <span class="number">10</span></span><br><span class="line">    fn1(a)</span><br><span class="line">    fmt.Println(a) <span class="comment">// 10</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> b *<span class="keyword">int</span> = &amp;a</span><br><span class="line">    fn2(b)</span><br><span class="line">    fmt.Println(a) <span class="comment">// 100</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="指针做返回值"><a href="#指针做返回值" class="headerlink" title="指针做返回值"></a>指针做返回值</h2><p>Go 允许使用“栈逃逸”机制将局部变量的空间分配在堆上。<br>使用这种机制，需要返回指针</p><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(a, b <span class="keyword">int</span>)</span> *<span class="title">int</span></span> &#123;</span><br><span class="line">    sum := a + b</span><br><span class="line">    <span class="keyword">return</span> &amp;sum</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    psum := add(<span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line">    fmt.Println(psum)  <span class="comment">// 0xc000012090</span></span><br><span class="line">    fmt.Println(*psum) <span class="comment">// 30</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="new-和-make"><a href="#new-和-make" class="headerlink" title="new 和 make"></a>new 和 make</h2><h3 id="new"><a href="#new" class="headerlink" title="new"></a>new</h3><p>new 是一个内置函数，它的函数签名如下：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">new</span><span class="params">(Type)</span> *<span class="title">Type</span></span></span><br></pre></td></tr></table></figure><p><code>Type</code> 表示类型，new函数只接收一个参数，这个参数只能是类型<br><code>*Type</code> 表示类型指针，new 函数返回一个指向该类型内存地址的指针</p><p>new函数可以接受所有类型，使用new函数可以得到类型的指针，并且这个指针指向的内存地址中存着该类型的零值。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    a := <span class="built_in">new</span>(<span class="keyword">int</span>)</span><br><span class="line">    b := <span class="built_in">new</span>([<span class="number">5</span>]<span class="keyword">int</span>)</span><br><span class="line">    c := <span class="built_in">new</span>([]<span class="keyword">string</span>)</span><br><span class="line">    d := <span class="built_in">new</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">string</span>)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;a type: %T \n&quot;</span>, a) <span class="comment">// a type: *int</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;b type: %T \n&quot;</span>, b) <span class="comment">// b type: *[5]int</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;c type: %T \n&quot;</span>, c) <span class="comment">// c type: *[]string</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;d type: %T \n&quot;</span>, d) <span class="comment">// d type: *map[int]string</span></span><br><span class="line"></span><br><span class="line">    fmt.Println(*a) <span class="comment">// 0</span></span><br><span class="line">    fmt.Println(*b) <span class="comment">// [0 0 0 0 0]</span></span><br><span class="line">    fmt.Println(*c) <span class="comment">// []</span></span><br><span class="line">    fmt.Println(*d) <span class="comment">// map[]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>new 函数会开辟一块空间，然后把这块空间的地址返回出去，这样外面的指针变量（a、b、c、d）就可以操作了。<br>如果仅仅只是声明一个指针变量，而没有开辟内存空间，这个指针变量是无法使用的。</p><ul><li>以下为错误示例：</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> i *<span class="keyword">int</span></span><br><span class="line">    fmt.Println(i)</span><br><span class="line">    *i = <span class="number">10</span>    <span class="comment">// 这里会引发 panic</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ------------------------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line">&lt;<span class="literal">nil</span>&gt;</span><br><span class="line"><span class="built_in">panic</span>: runtime error: invalid memory address or <span class="literal">nil</span> pointer dereference</span><br><span class="line">[signal <span class="number">0xc0000005</span> code=<span class="number">0x1</span> addr=<span class="number">0x0</span> pc=<span class="number">0x97581b</span>]</span><br><span class="line"></span><br><span class="line">goroutine <span class="number">1</span> [running]:</span><br><span class="line">main.main()</span><br><span class="line">    e:/---CODE/GO/src/Hello/main.<span class="keyword">go</span>:<span class="number">23</span> +<span class="number">0x7b</span></span><br><span class="line">exit status <span class="number">2</span></span><br></pre></td></tr></table></figure><p>从上面例子可以看到，声明了一个指针，默认值为 <code>nil</code>。<br>在没有分配内存的情况下去使用指针，会导致 <code>panic</code>。</p><ul><li>以下为正确示例：</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> i *<span class="keyword">int</span>     <span class="comment">// 声明一个指针变量</span></span><br><span class="line">    fmt.Println(i)    <span class="comment">// &lt;nil&gt; | 默认值为 nil</span></span><br><span class="line">    i = <span class="built_in">new</span>(<span class="keyword">int</span>)    <span class="comment">// 给这个指针分配内存</span></span><br><span class="line">    *i = <span class="number">10</span>    <span class="comment">// 存个值进去</span></span><br><span class="line">    fmt.Println(i)    <span class="comment">// 0xc000012098 | 已经有内存空间了</span></span><br><span class="line">    fmt.Println(*i)     <span class="comment">// 10 | 正常~~</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="make"><a href="#make" class="headerlink" title="make"></a>make</h3><p>make 也是用于分配内存，但是只能用于<code>slice切片、map字典、chan通道</code>的内存创建，而且它返回的类型 就是这三个类型本身，因为这三种类型就是引用类型，所以没必要返回他们的指针了。</p><p>make 的函数签名如下：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">make</span><span class="params">(t Type, size ...IntegerType)</span> <span class="title">Type</span></span></span><br></pre></td></tr></table></figure><p>在使用 <code>slice、map、chan</code>的时候，都需要使用 make 进行初始化，然后才可以对它们进行操作</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    c := <span class="built_in">new</span>([]<span class="keyword">string</span>)</span><br><span class="line">    s := <span class="built_in">make</span>([]<span class="keyword">string</span>, <span class="number">10</span>)</span><br><span class="line">    d := <span class="built_in">new</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">string</span>)</span><br><span class="line">    e := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">string</span>)</span><br><span class="line"></span><br><span class="line">    fmt.Printf(<span class="string">&quot;c type: %T \n&quot;</span>, c) <span class="comment">// c type: *[]string    | string切片类型的指针</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;s type: %T \n&quot;</span>, s) <span class="comment">// s type: []string     | string切片</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;d type: %T \n&quot;</span>, d) <span class="comment">// d type: *map[int]string | map类型的指针</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;e type: %T \n&quot;</span>, e) <span class="comment">// e type: map[int]string  | map</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="new-和-make-的区别"><a href="#new-和-make-的区别" class="headerlink" title="new 和 make 的区别"></a>new 和 make 的区别</h3><ul><li>new 返回的是<strong>指针</strong>，make返回的是<strong>类型本身</strong></li><li>new 可以给所有类型的<strong>指针开辟空间</strong>，make 只能用于 <code>slice、map、chan</code>的<strong>初始化</strong></li></ul>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
          <category> Basic </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Golang [基础] 8-函数</title>
      <link href="posts/ce0db2d0"/>
      <url>posts/ce0db2d0</url>
      
        <content type="html"><![CDATA[<p>函数的创建与使用</p><span id="more"></span><h1 id="8-函数"><a href="#8-函数" class="headerlink" title="8-函数"></a>8-函数</h1><p>如果一个动作需要重复执行，那就应该把这个动作封装到函数中。</p><p>在 Go 中，函数是一等公民</p><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><div class="note warning"><p><strong>注意：函数是引用类型！！！</strong></p></div><p>Go 语言中函数的基本形式：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> 函数名<span class="params">(参数列表)</span><span class="params">(返回值)</span></span>&#123;</span><br><span class="line">    函数体</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>函数名：由字母、数字、下划线组成，但不能数字开头；同一个包内，函数名不能重名</li><li>参数：由参数变量和变量类型组成，多个参数使用<code>,</code> 分隔</li><li>返回值：由返回变量和变量类型，也可只写变量类型，多个返回值必须用<code>()</code>包裹，并用<code>,</code>分隔</li><li>函数体：实现指定功能的代码</li></ul><p>eg：求两数之和</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum</span><span class="params">(a <span class="keyword">int</span>, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>eg：无参数无返回值的函数</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sayHello</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Hello&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="调用"><a href="#调用" class="headerlink" title="调用"></a>调用</h2><p>通过<code>函数名(参数)</code>的方式调用，如果定义的函数没有要求参数，则调用时不需要给参数</p><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    res := sum(<span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line">    fmt.Println(res)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>调用有返回值的函数时可以不接受其返回值。</p><h2 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h2><h3 id="类型简写"><a href="#类型简写" class="headerlink" title="类型简写"></a>类型简写</h3><p>如果相邻变量类型相同，可以只写一个</p><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fn</span><span class="params">(x, y <span class="keyword">int</span>, p, q <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    fmt.Println(x, y, p, q)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>x 和 y 均为 int 型，x 后面就可省略；p 和 q 都是 string 型，p 后面就可以省略</p><h3 id="可变参数"><a href="#可变参数" class="headerlink" title="可变参数"></a>可变参数</h3><p>如果参数数量不固定，可以在类型前面加上<code>...</code>，但是只能接收这种类型的参数，且此时要注意类型简写的方法<br><strong>注意：</strong>和固定参数搭配时，可变参数要放在固定参数后面</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fn</span><span class="params">(x <span class="keyword">int</span>, y ...<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    fmt.Println(x)            <span class="comment">// 1</span></span><br><span class="line">    fmt.Println(y)            <span class="comment">// [2 3 5]</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%T \n&quot;</span>, y)    <span class="comment">// []int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>)</span><br><span class="line"><span class="comment">// 错误，只能传递int型：fn(1, 2, &quot;B&quot;, &quot;C&quot;)</span></span><br><span class="line"><span class="comment">// 错误，全都要int型：  fn(1, &quot;A&quot;, &quot;B&quot;, &quot;C&quot;)</span></span><br></pre></td></tr></table></figure><p>可变参数实际上是通过切片实现的</p><p>关于类型简写：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fn</span><span class="params">(x, y ...<span class="keyword">int</span>)</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fn</span><span class="params">(x ...<span class="keyword">int</span>)</span></span> &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fn</span><span class="params">(x <span class="keyword">int</span>, y ...<span class="keyword">int</span>)</span></span> &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fn</span><span class="params">(x, z <span class="keyword">int</span>, y ...<span class="keyword">int</span>)</span></span> &#123;&#125;</span><br></pre></td></tr></table></figure><p>关于可变参数位置</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fn</span><span class="params">(y ...<span class="keyword">int</span>, x <span class="keyword">int</span>)</span></span> &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fn</span><span class="params">(x <span class="keyword">int</span>, y ...<span class="keyword">int</span>, s <span class="keyword">string</span>)</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fn</span><span class="params">(x <span class="keyword">int</span>, y ...<span class="keyword">int</span>)</span></span> &#123;&#125;</span><br></pre></td></tr></table></figure><h2 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h2><h3 id="多返回值"><a href="#多返回值" class="headerlink" title="多返回值"></a>多返回值</h3><p>Go 中支持多返回值，如果有多个返回值时，必须用<code>()</code>包裹起来</p><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">calc</span><span class="params">(x, y <span class="keyword">int</span>)</span> <span class="params">(<span class="keyword">int</span>, <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y, x - y</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>调用之后可以接收返回值，也可以不接收，如果指向接收一个，另一个可以用匿名变量 <code>_</code> 去接</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 两个都接收</span></span><br><span class="line">sum, sub := calc(<span class="number">10</span>, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 两个都不接收</span></span><br><span class="line">calc(<span class="number">10</span>, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 只接收一个</span></span><br><span class="line">_, sub := calc(<span class="number">10</span>, <span class="number">5</span>)</span><br><span class="line">sum, _ := calc(<span class="number">10</span>, <span class="number">5</span>)</span><br></pre></td></tr></table></figure><h3 id="返回值命名"><a href="#返回值命名" class="headerlink" title="返回值命名"></a>返回值命名</h3><p>函数定义时可以给返回值命名，并在函数体中直接使用这些变量，最后通过<code>return</code> 返回</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">calc</span><span class="params">(x, y <span class="keyword">int</span>)</span> <span class="params">(sum, sub <span class="keyword">int</span>)</span></span>&#123;</span><br><span class="line">    sum = x + y</span><br><span class="line">    sub = x - y</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果给返回值命名了，但是又 return 了别的变量，以别的变量为准</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">calc</span><span class="params">(x, y <span class="keyword">int</span>)</span> <span class="params">(sum <span class="keyword">int</span>, diff <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    sum = x + y</span><br><span class="line">    diff = x - y</span><br><span class="line">    mul := x * y</span><br><span class="line">    div := x / y</span><br><span class="line">    <span class="keyword">return</span> mul, div</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fmt.Println(calc(<span class="number">10</span>, <span class="number">5</span>))    <span class="comment">// 50 2</span></span><br></pre></td></tr></table></figure><h2 id="函数进阶"><a href="#函数进阶" class="headerlink" title="函数进阶"></a>函数进阶</h2><h3 id="变量作用域"><a href="#变量作用域" class="headerlink" title="变量作用域"></a>变量作用域</h3><h3 id="函数类型"><a href="#函数类型" class="headerlink" title="函数类型"></a>函数类型</h3><p>函数可以有类型，使用关键字<code>type</code>可以定义一个函数类型</p><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> calculation <span class="function"><span class="keyword">func</span><span class="params">(<span class="keyword">int</span>, <span class="keyword">int</span>)</span> <span class="title">int</span></span></span><br></pre></td></tr></table></figure><p>上面的例子定义了一个 <code>calculation</code> 类型，它是一种函数类型，一种接收两个int参数返回一个int值的函数类型。<br>方式满足上面特点的函数都是 calculation 类型。</p><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(x <span class="keyword">int</span>, y <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sub</span><span class="params">(x, y <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x - y</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>add() 和 sub() 都是 calculation 类型，都可以赋值给 calculation 类型变量</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> c calculation</span><br><span class="line">c = add</span><br><span class="line"></span><br><span class="line">res := c(<span class="number">10</span>, <span class="number">5</span>)</span><br><span class="line">fmt.Println(res)    <span class="comment">// 15</span></span><br><span class="line"></span><br><span class="line">s := sub</span><br><span class="line">fmt.Println(s(<span class="number">20</span>, <span class="number">55</span>))    <span class="comment">// -35</span></span><br></pre></td></tr></table></figure><h3 id="函数变量"><a href="#函数变量" class="headerlink" title="函数变量"></a>函数变量</h3><p>在 Go 中，函数被看作是第一类值，这意味着函数像变量一样，有类型、有值，普通变量能做的事函数也能做。</p><p>例如函数类型的例子，即使不定义函数类型，也可以直接将函数赋值给变量</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(x, y <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    a := add</span><br><span class="line">    fmt.Println(a(<span class="number">10</span>, <span class="number">20</span>))    <span class="comment">// 30</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>调用 <code>nil</code> 的函数变量会导致 panic</li><li>函数变量的零值 <code>nil</code>，所以函数变量可以跟 <code>nil</code> 比较，但函数变量之间不能比较。</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> processFunc <span class="function"><span class="keyword">func</span><span class="params">(<span class="keyword">int</span>)</span> <span class="title">bool</span> // 声明一个函数类型</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isOdd</span><span class="params">(i <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123; <span class="comment">// 定义这种类型的函数</span></span><br><span class="line">    <span class="keyword">return</span> i%<span class="number">2</span> != <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isEven</span><span class="params">(i <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123; <span class="comment">// 定义这种类型的函数</span></span><br><span class="line">    <span class="keyword">return</span> i%<span class="number">2</span> == <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">filter</span><span class="params">(slice []<span class="keyword">int</span>, f processFunc)</span> []<span class="title">int</span></span> &#123; <span class="comment">// 接收这种类型的函数</span></span><br><span class="line">    <span class="keyword">var</span> res []<span class="keyword">int</span></span><br><span class="line">    <span class="keyword">for</span> _, v := <span class="keyword">range</span> slice &#123;</span><br><span class="line">        <span class="keyword">if</span> f(v) &#123;</span><br><span class="line">            res = <span class="built_in">append</span>(res, v)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">7</span>&#125;</span><br><span class="line">    fmt.Println(<span class="string">&quot;s = &quot;</span>, s) <span class="comment">// s =  [1 2 3 4 5 7]</span></span><br><span class="line"></span><br><span class="line">    odd := filter(s, isOdd)   <span class="comment">// 调用这种类型的函数</span></span><br><span class="line">    even := filter(s, isEven) <span class="comment">// 调用这种类型的函数</span></span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;Odd slice&quot;</span>, odd)   <span class="comment">// Odd slice [1 3 5 7]</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;Even slice&quot;</span>, even) <span class="comment">// Even slice [2 4]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="匿名函数"><a href="#匿名函数" class="headerlink" title="匿名函数"></a>匿名函数</h3><p>没有名字的函数就叫匿名函数<br>基本语法：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(函数)</span> <span class="params">(返回值)</span></span> &#123;</span><br><span class="line">    函数体</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>匿名函数没有函数名，所以需要变量来保存，或者作为立即执行函数</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// 将匿名函数保存到变量</span></span><br><span class="line">    add := <span class="function"><span class="keyword">func</span> <span class="params">(x, y <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">        <span class="keyword">return</span> x + y</span><br><span class="line">    &#125;</span><br><span class="line">    add(<span class="number">10</span>, <span class="number">20</span>)    <span class="comment">// 通过变量调用匿名函数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// 自执行函数：匿名函数定义完加()直接执行</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="params">(x, y <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">        fmt.Println(x + y)</span><br><span class="line">    &#125;(<span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="高阶函数"><a href="#高阶函数" class="headerlink" title="高阶函数"></a>高阶函数</h3><p>高阶函数分为 <code>函数作参数</code> 和 <code>函数作返回值</code></p><h4 id="函数作为参数"><a href="#函数作为参数" class="headerlink" title="函数作为参数"></a>函数作为参数</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 定义一个函数，使用函数作为参数</span></span><br><span class="line"><span class="comment">// @param x       int                 操作数1</span></span><br><span class="line"><span class="comment">// @param y       int                 操作数2</span></span><br><span class="line"><span class="comment">// @param operate func(int, int) int  操作函数</span></span><br><span class="line"><span class="comment">// @return        int                 经过操作函数操作的结果</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">calc</span> <span class="params">(x <span class="keyword">int</span>, y <span class="keyword">int</span>, operate <span class="keyword">func</span>(<span class="keyword">int</span>, <span class="keyword">int</span>)</span> <span class="title">int</span>) <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> operate(x, y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个操作函数</span></span><br><span class="line"><span class="comment">// @param  x 操作数1</span></span><br><span class="line"><span class="comment">// @param  y 操作数2</span></span><br><span class="line"><span class="comment">// @return 两个操作数相加的结果</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(x, y <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// 调用 calc 函数，把 add 函数传进去</span></span><br><span class="line">    res := calc(<span class="number">10</span>, <span class="number">20</span>, add)</span><br><span class="line">    fmt.Println(res)    <span class="comment">// 30</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="函数作为返回值"><a href="#函数作为返回值" class="headerlink" title="函数作为返回值"></a>函数作为返回值</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(x, y <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sub</span><span class="params">(x, y <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x - y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个函数，根据传入的操作符返回相应的操作函数</span></span><br><span class="line"><span class="comment">// @param s string 操作符</span></span><br><span class="line"><span class="comment">// @return func(int, int) int, error 操作函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">do</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="params">(<span class="keyword">func</span>(<span class="keyword">int</span>, <span class="keyword">int</span>)</span> <span class="title">int</span>, <span class="title">error</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> s &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;+&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> add, <span class="literal">nil</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;-&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> sub, <span class="literal">nil</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, errors.New(<span class="string">&quot;非法操作符&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fn, err := do(<span class="string">&quot;+&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(fn(<span class="number">10</span>, <span class="number">20</span>))    <span class="comment">// 20</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h4><blockquote><p>a <strong>closure</strong> is a record storing <strong>a function</strong> together with <strong>an environment</strong>.<br><strong>闭包</strong>是由<strong>函数</strong>和与其相关的引用<strong>环境</strong>组合而成的实体 。</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20201120192526963_12086.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20201120192526963_12086.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>闭包能将局部变量带出其作用域</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">adder</span><span class="params">()</span> <span class="title">func</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> x <span class="keyword">int</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">                x++</span><br><span class="line">                <span class="keyword">return</span> x</span><br><span class="line">            &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    i := adder()</span><br><span class="line">    fmt.Println(i()) <span class="comment">// 1</span></span><br><span class="line">    fmt.Println(i()) <span class="comment">// 2</span></span><br><span class="line">    fmt.Println(i()) <span class="comment">// 3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>相当于：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">adder</span><span class="params">()</span> <span class="title">func</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> x <span class="keyword">int</span></span><br><span class="line">    f := <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">        x++</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> f</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    i := adder()</span><br><span class="line">    i() <span class="comment">// 1</span></span><br><span class="line">    i() <span class="comment">// 2</span></span><br><span class="line">    i() <span class="comment">// 3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>等于说，在 <code>adder()</code> 中声明的变量<code>x</code>，本该在<code>adder()</code>调用完就被销毁，却被闭包带出了<code>x</code>的作用域（adder函数内），使得局部变量<code>x</code>没有被销毁。即局部变量<code>x</code>逃逸了，它的生命周期没有随着它的作用域结束而结束。</p><h3 id="defer-语句"><a href="#defer-语句" class="headerlink" title="defer 语句"></a>defer 语句</h3><p><strong>defer</strong> 就是延迟的意思，被 <code>defer</code> 关键字修饰的函数或方法会延迟执行。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;start&quot;</span>)</span><br><span class="line">    <span class="keyword">defer</span> fmt.Println(<span class="number">1</span>)</span><br><span class="line">    fmt.Println(<span class="string">&quot;end&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ---------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line">start</span><br><span class="line">end</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure><p>程序先执行第一句打印了 start，往下遇到 <code>defer</code>，于是把第二句先压入栈，然后继续执行第三句打印了 end。<br>再继续往下已经没有，函数准备结束；但是在结束之前需先出栈，也就执行了第二句，打印了 1。最后结束。</p><p>这就是 <code>defer</code> 语句。</p><div class="note info"><p>由于 <code>defer</code> 语句延迟调用的特性，所以 <code>defer</code> 语句能非常方便的处理资源释放的问题。比如：关闭文件、关闭数据库连接、资源清理、释放锁、记录时间等等。</p><p>eg ：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fn</span><span class="params">()</span></span> &#123;</span><br><span class="line">    f, err := os.Open(<span class="string">&quot;./main.go&quot;</span>)    <span class="comment">// 打开文件</span></span><br><span class="line">    <span class="keyword">defer</span> f.Close()                   <span class="comment">// 函数退出之前关闭文件</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmr.Println(err)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h4 id="多个-defer-的执行顺序"><a href="#多个-defer-的执行顺序" class="headerlink" title="多个 defer 的执行顺序"></a>多个 defer 的执行顺序</h4><p>当有多个 <code>defer</code>时，按照栈的方式执行。即先<code>defer</code>的后执行。<br>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fn</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;start&quot;</span>)</span><br><span class="line">    <span class="keyword">defer</span> fmt.Println(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">defer</span> fmt.Println(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">defer</span> fmt.Println(<span class="number">3</span>)</span><br><span class="line">    fmt.Println(<span class="string">&quot;end&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ---------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line">start</span><br><span class="line">end</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure><h4 id="defer-执行时机"><a href="#defer-执行时机" class="headerlink" title="defer 执行时机"></a>defer 执行时机</h4><p>Go 中的 <code>return</code>语句并不是原子操作，它分为 <strong>给返回值赋值</strong> 和 <strong>RET指令</strong>两步。<br>而 <code>defer</code> 语句执行的时机在返回值赋值之后，RET指令执行之前。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20201122103128567_27058.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20201122103128567_27058.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
          <category> Basic </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Golang [基础] 7-map</title>
      <link href="posts/d554428f"/>
      <url>posts/d554428f</url>
      
        <content type="html"><![CDATA[<p>键值对的创建与使用</p><span id="more"></span><h1 id="7-map"><a href="#7-map" class="headerlink" title="7-map"></a>7-map</h1><blockquote><p>map 是 Go 提供的一种映射关系容器，其内部使用<code>散列表(hash)</code>实现<br>map 是一种无序的基于 <code>key-value</code> 的数据结构<br>Go 中的 map 是引用类型，必须初始化才能使用。</p></blockquote><ul><li><p>key 可以是任意可用 <code>== 或 !=</code> 比较的类型，如：string、int、float</p></li><li><p>数组、切片不能作为 key</p></li><li><p>指针和接口类型可以作为 key</p></li><li><p>包含数组切片的结构体不能作为 key，只包含原生类型的结构体可以作为 key</p></li><li><p>如果结构体要作为 key 可以提供 <code>Key()</code> 和 <code>Hash()</code> 方法</p></li><li><p>value 可以是任意类型</p></li><li><p>通过 key 在map 中查找是很快的，但是还是比数组和切片慢100倍。如果性能很重要的话还是用切片来解决问题。</p></li><li><p>map可以用函数作为值，这样就可以用来做分支结构：用key来选择要执行的函数。</p></li></ul><h2 id="声明"><a href="#声明" class="headerlink" title="声明"></a>声明</h2><div class="note warning"><p><strong>注意：map 是引用类型！！！</strong></p></div><p>定义语法如下</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> map1 <span class="keyword">map</span>[keyT]valueT</span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例</span></span><br><span class="line"><span class="keyword">var</span> map1 <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span></span><br><span class="line"><span class="keyword">var</span> map2 <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">rune</span></span><br></pre></td></tr></table></figure><p>声明时不需要直到map长度，map是可以动态增长的<br>未初始化的map的值是 nil，需要使用 <code>make()</code> 函数来分配内存</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">make</span>(<span class="keyword">map</span>[keyT]valueT, <span class="built_in">cap</span>)</span><br></pre></td></tr></table></figure><p><code>cap</code> 是可选的，但是我们应该再初始化map的时候就为其指定一个合适的容量。</p><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> m1 <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">string</span></span><br><span class="line">    m2 := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">string</span>)</span><br><span class="line"></span><br><span class="line">    fmt.Println(m1)<span class="comment">// map[]</span></span><br><span class="line">    fmt.Println(m2)<span class="comment">// map[]</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%T \n&quot;</span>, m1)<span class="comment">// map[int]string</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%T \n&quot;</span>, m2)<span class="comment">// map[int]string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="声明并初始化"><a href="#声明并初始化" class="headerlink" title="声明并初始化"></a>声明并初始化</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    m1 := <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">string</span>&#123;</span><br><span class="line">        <span class="number">1</span>: <span class="string">&quot;Alice&quot;</span>,</span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;Boii&quot;</span>,</span><br><span class="line">        <span class="number">3</span>: <span class="string">&quot;Candy&quot;</span>,</span><br><span class="line">        <span class="number">4</span>: <span class="string">&quot;Danish&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(m1)            <span class="comment">// map[1:Alice 2:Boii 3:Candy 4:Danish]</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%T \n&quot;</span>, m1)    <span class="comment">// map[int]string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>注意：</strong>这种方式，每一对 <code>k-v</code>后面都要有<code>,</code>，<strong>最后一对也要有</strong></p><h2 id="单独赋值"><a href="#单独赋值" class="headerlink" title="单独赋值"></a>单独赋值</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    m1 := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">string</span>)</span><br><span class="line"></span><br><span class="line">    m1[<span class="number">1</span>] = <span class="string">&quot;Alice&quot;</span></span><br><span class="line">    m1[<span class="number">2</span>] = <span class="string">&quot;Boii&quot;</span></span><br><span class="line">    m1[<span class="number">5</span>] = <span class="string">&quot;Eva&quot;</span></span><br><span class="line"></span><br><span class="line">    fmt.Println(m1)    <span class="comment">// map[1:Alice 2:Boii 5:Eva]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="判断键是否存在"><a href="#判断键是否存在" class="headerlink" title="判断键是否存在"></a>判断键是否存在</h2><p>Go 中有个判断 map 中键是否存在的特殊写法，基本格式为：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">val, ok := <span class="keyword">map</span>[key]</span><br></pre></td></tr></table></figure><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    m1 := <span class="keyword">map</span>[<span class="keyword">byte</span>]<span class="keyword">string</span>&#123;</span><br><span class="line">        <span class="string">&#x27;a&#x27;</span>: <span class="string">&quot;Alice&quot;</span>,</span><br><span class="line">        <span class="string">&#x27;b&#x27;</span>: <span class="string">&quot;Boii&quot;</span>,</span><br><span class="line">        <span class="string">&#x27;c&#x27;</span>: <span class="string">&quot;Candy&quot;</span>,</span><br><span class="line">        <span class="string">&#x27;d&#x27;</span>: <span class="string">&quot;Danish&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    val, ok := m1[<span class="string">&#x27;a&#x27;</span>]</span><br><span class="line">    fmt.Println(val) <span class="comment">// Alice</span></span><br><span class="line">    fmt.Println(ok)  <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> val, ok := m1[<span class="string">&#x27;b&#x27;</span>]; ok &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;I got&quot;</span>, val)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;None.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="遍历"><a href="#遍历" class="headerlink" title="遍历"></a>遍历</h2><p>可以使用 <code>for...range</code> 遍历</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    m1 := <span class="keyword">map</span>[<span class="keyword">byte</span>]<span class="keyword">string</span>&#123;</span><br><span class="line">        <span class="string">&#x27;a&#x27;</span>: <span class="string">&quot;Alice&quot;</span>,</span><br><span class="line">        <span class="string">&#x27;b&#x27;</span>: <span class="string">&quot;Boii&quot;</span>,</span><br><span class="line">        <span class="string">&#x27;c&#x27;</span>: <span class="string">&quot;Candy&quot;</span>,</span><br><span class="line">        <span class="string">&#x27;d&#x27;</span>: <span class="string">&quot;Danish&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> k, v := <span class="keyword">range</span> m1 &#123;</span><br><span class="line">        fmt.Println(k, v)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>只想遍历 key 的时候可以</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> k := <span class="keyword">range</span> m1 &#123;</span><br><span class="line">    fmt.Println(k)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>只想遍历 value 的时候可以</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> _, v := <span class="keyword">range</span> m1 &#123;</span><br><span class="line">    fmt.Println(v)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="note warning"><p><strong>注意：</strong> 遍历 map 时元素顺序与添加键值对顺序无关。</p></div><h2 id="delete"><a href="#delete" class="headerlink" title="delete()"></a>delete()</h2><p>Go 的内建函数 <code>delete()</code> 可以从 map 中删除一对键值对，格式如下：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">delete</span>(<span class="keyword">map</span>, key)</span><br></pre></td></tr></table></figure><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    m1 := <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">byte</span>&#123;</span><br><span class="line">        <span class="number">1</span>: <span class="string">&#x27;A&#x27;</span>,</span><br><span class="line">        <span class="number">2</span>: <span class="string">&#x27;B&#x27;</span>,</span><br><span class="line">        <span class="number">3</span>: <span class="string">&#x27;C&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(m1)<span class="comment">// map[1:65 2:66 3:67]</span></span><br><span class="line">    <span class="built_in">delete</span>(m1, <span class="number">2</span>)</span><br><span class="line">    fmt.Println(m1)<span class="comment">// map[1:65 3:67]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="值为切片的map"><a href="#值为切片的map" class="headerlink" title="值为切片的map"></a>值为切片的map</h2><p>map 中 value 可以是任何类型，所以也可以是切片类型</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sm <span class="keyword">map</span>[keyT][]T</span><br><span class="line"></span><br><span class="line">sm := <span class="built_in">make</span>(<span class="keyword">map</span>[keyT][]T, <span class="built_in">cap</span>)</span><br><span class="line"></span><br><span class="line">sm := <span class="keyword">map</span>[keyT][]T&#123;initial value&#125;</span><br></pre></td></tr></table></figure><p><code>[]T</code>：某种类型的切片</p><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// 创建一个map, key 为 string, value 为 []int，容量为5</span></span><br><span class="line">    sliceMap1 := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>][]<span class="keyword">int</span>, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// var sliceMap1 map[string][]int 用这种声明方式也行</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 为 map 中每一对 k-v 初始化</span></span><br><span class="line">    sliceMap1[<span class="string">&quot;A&quot;</span>] = <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">3</span>, <span class="number">3</span>)</span><br><span class="line">    sliceMap1[<span class="string">&quot;B&quot;</span>] = <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">3</span>, <span class="number">3</span>)</span><br><span class="line">    sliceMap1[<span class="string">&quot;C&quot;</span>] = <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">3</span>, <span class="number">3</span>)</span><br><span class="line">    sliceMap1[<span class="string">&quot;D&quot;</span>] = <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">3</span>, <span class="number">3</span>)</span><br><span class="line">    sliceMap1[<span class="string">&quot;E&quot;</span>] = <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">3</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;1: &quot;</span>,sliceMap1)    <span class="comment">// 1:  map[A:[0 0 0] B:[0 0 0] C:[0 0 0] D:[0 0 0] E:[0 0 0]]</span></span><br><span class="line">    <span class="keyword">for</span> k, v := <span class="keyword">range</span> sliceMap1 &#123;</span><br><span class="line">        fmt.Println(k, v)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// A [0 0 0]</span></span><br><span class="line">    <span class="comment">// B [0 0 0]</span></span><br><span class="line">    <span class="comment">// C [0 0 0]</span></span><br><span class="line">    <span class="comment">// D [0 0 0]</span></span><br><span class="line">    <span class="comment">// E [0 0 0]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用这种方式初始化效果一样</span></span><br><span class="line">    sliceMap2 := <span class="keyword">map</span>[<span class="keyword">string</span>][]<span class="keyword">int</span>&#123;</span><br><span class="line">        <span class="string">&quot;A&quot;</span>: &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;,</span><br><span class="line">        <span class="string">&quot;B&quot;</span>: <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">3</span>),</span><br><span class="line">        <span class="string">&quot;C&quot;</span>: &#123;<span class="number">2</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">9</span>&#125;,</span><br><span class="line">        <span class="string">&quot;D&quot;</span>: <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">3</span>),</span><br><span class="line">        <span class="string">&quot;E&quot;</span>: <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">3</span>),</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(<span class="string">&quot;2: &quot;</span>,sliceMap2)    <span class="comment">// 2:  map[A:[1 2 3] B:[0 0 0] C:[2 4 0 9] D:[0 0 0] E:[0 0 0]]</span></span><br><span class="line">    <span class="keyword">for</span> k, v := <span class="keyword">range</span> sliceMap2 &#123;</span><br><span class="line">        fmt.Println(k, v)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// A [1 2 3]</span></span><br><span class="line">    <span class="comment">// B [0 0 0]</span></span><br><span class="line">    <span class="comment">// C [2 4 0 9]</span></span><br><span class="line">    <span class="comment">// D [0 0 0]</span></span><br><span class="line">    <span class="comment">// E [0 0 0]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="值为map的切片"><a href="#值为map的切片" class="headerlink" title="值为map的切片"></a>值为map的切片</h2><p>看起来好像有点绕，但是捋清楚就好办了<br><code>map[keyT]valT</code>是map类型，<code>[]T</code>是切片类型，那么<code>[]map[keyT]valT</code>就是map类型切片了</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类型定义</span></span><br><span class="line">[]<span class="keyword">map</span>[keyT]valT</span><br><span class="line"></span><br><span class="line"><span class="comment">// 声明</span></span><br><span class="line"><span class="keyword">var</span> identifier []<span class="keyword">map</span>[keyT]valT</span><br><span class="line"></span><br><span class="line"><span class="comment">// 声明并初始化</span></span><br><span class="line"><span class="keyword">var</span> identifier = []<span class="keyword">map</span>[keyT]valT&#123;</span><br><span class="line">    &#123;map1key1: val, map1key2: val, map1key3: val&#125;,</span><br><span class="line">    &#123;map2key1: val, map2key2: val, map2key3: val&#125;,</span><br><span class="line">    &#123;map3key1: val, map3key2: val, map3key3: val&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 声明并初始化</span></span><br><span class="line">identifier := []<span class="keyword">map</span>[keyT]valT&#123;</span><br><span class="line">    &#123;map1key1: val, map1key2: val, map1key3: val&#125;,</span><br><span class="line">    &#123;map2key1: val, map2key2: val, map2key3: val&#125;,</span><br><span class="line">    &#123;map3key1: val, map3key2: val, map3key3: val&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用make</span></span><br><span class="line">identifier := <span class="built_in">make</span>([]<span class="keyword">map</span>[keyT]valT, <span class="built_in">cap</span>)</span><br><span class="line">identifier[skey] = <span class="built_in">make</span>(<span class="keyword">map</span>[keyT]valT)</span><br><span class="line">identifier[skey][mkey] = val</span><br><span class="line">identifier[skey] = <span class="keyword">map</span>[keyT]valT&#123;mkey1: val, mkey2: val&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ms []<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">string</span></span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// 声明一个切片，map[int]string 类型的，并初始化</span></span><br><span class="line">    ms := []<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">string</span>&#123;</span><br><span class="line">        &#123;<span class="number">1</span>: <span class="string">&quot;A&quot;</span>, <span class="number">2</span>: <span class="string">&quot;B&quot;</span>, <span class="number">3</span>: <span class="string">&quot;C&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="number">4</span>: <span class="string">&quot;I&quot;</span>, <span class="number">6</span>: <span class="string">&quot;N&quot;</span>, <span class="number">9</span>: <span class="string">&quot;G&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="number">3</span>: <span class="string">&quot;R&quot;</span>, <span class="number">7</span>: <span class="string">&quot;Y&quot;</span>, <span class="number">5</span>: <span class="string">&quot;Q&quot;</span>&#125;,</span><br><span class="line">        <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">string</span>),</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> _, v := <span class="keyword">range</span> ms &#123;</span><br><span class="line">        fmt.Println(v)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// map[1:A 2:B 3:C]</span></span><br><span class="line">    <span class="comment">// map[4:I 6:N 9:G]</span></span><br><span class="line">    <span class="comment">// map[3:R 5:Q 7:Y]</span></span><br><span class="line">    <span class="comment">// map[]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// make 一个切片，类型为 map[int]string, 长度和容量都为 3</span></span><br><span class="line">    mapSlice := <span class="built_in">make</span>([]<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">string</span>, <span class="number">3</span>)</span><br><span class="line">    <span class="comment">// 为切片第一个元素创建一个 map，然后为其逐个添加 k-v</span></span><br><span class="line">    mapSlice[<span class="number">0</span>] = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">string</span>)</span><br><span class="line">    mapSlice[<span class="number">0</span>][<span class="number">1</span>] = <span class="string">&quot;A&quot;</span></span><br><span class="line">    mapSlice[<span class="number">0</span>][<span class="number">2</span>] = <span class="string">&quot;B&quot;</span></span><br><span class="line">    mapSlice[<span class="number">0</span>][<span class="number">3</span>] = <span class="string">&quot;C&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 为切片第二个元素 创建并初始化一个 map</span></span><br><span class="line">    mapSlice[<span class="number">1</span>] = <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">string</span>&#123;<span class="number">4</span>: <span class="string">&quot;I&quot;</span>, <span class="number">6</span>: <span class="string">&quot;N&quot;</span>, <span class="number">9</span>: <span class="string">&quot;G&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _, v := <span class="keyword">range</span> mapSlice &#123;</span><br><span class="line">        fmt.Println(v)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// map[1:A 2:B 3:C]</span></span><br><span class="line">    <span class="comment">// map[4:I 6:N 9:G]</span></span><br><span class="line">    <span class="comment">// map[]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="note warning"><p><strong>注意</strong></p><ul><li>Go 内置的 map 不是并发安全的，并发安全的 map 可以使用标准包 sync 中的 map</li><li>不要直接修改 map value 中某个成员的值。如果想修改 map value 中的某个成员的值，必须整体赋值。</li></ul><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">    name <span class="keyword">string</span></span><br><span class="line">    age  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    ma := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">rune</span>]User)</span><br><span class="line">    boii := User&#123;<span class="string">&quot;Boii&quot;</span>, <span class="number">18</span>&#125;</span><br><span class="line">    ma[<span class="string">&#x27;a&#x27;</span>] = boii</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ma[&#x27;a&#x27;].age = 19  // ERROR，不能通过 map 引用直接修改</span></span><br><span class="line"></span><br><span class="line">    boii.age = <span class="number">19</span></span><br><span class="line">    ma[<span class="string">&#x27;a&#x27;</span>] = boii<span class="comment">// 必须整体替换</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2><ol><li>写一个程序，统计一个字符串中每个单词出现的次数。比如：”how do you do” 中 how=1 do=2 you=1。</li></ol><p>思路：<br>先用 <code>strings.Split</code> 把单词切割出来<br>然后利用 map ，把单词作为 key，出现频次作为 value，遍历一下就能得到答案</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    str := <span class="string">&quot;how do you do I do not know how to tell you&quot;</span></span><br><span class="line">    strSplit := strings.Split(str, <span class="string">&quot; &quot;</span>)</span><br><span class="line">    strMap := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>)</span><br><span class="line">    <span class="keyword">for</span> _, word := <span class="keyword">range</span> strSplit &#123;</span><br><span class="line">        strMap[word] += <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(strMap)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// -----------------------------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line"><span class="keyword">map</span>[I:<span class="number">1</span> do:<span class="number">3</span> how:<span class="number">2</span> know:<span class="number">1</span> not:<span class="number">1</span> tell:<span class="number">1</span> to:<span class="number">1</span> you:<span class="number">2</span>]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
          <category> Basic </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Golang [基础] 6-slice</title>
      <link href="posts/6642a673"/>
      <url>posts/6642a673</url>
      
        <content type="html"><![CDATA[<p>面试高频考点：切片</p><span id="more"></span><h1 id="6-切片"><a href="#6-切片" class="headerlink" title="6-切片"></a>6-切片</h1><blockquote><p>切片是一个拥有相同数据类型元素的可变长度的序列。</p></blockquote><p>数组是<strong>固定</strong>长度，切片是<strong>可变</strong>长度<br>数组是<strong>值类型</strong>，切片是<strong>引用类型</strong></p><p>数组有很多局限性，切片非常灵活，支持自动扩容</p><p>切片内部结构包含 <code>地址</code>、<code>长度</code>、<code>容量</code>，一般用于快速操作一块数据集合。</p><h2 id="创建切片"><a href="#创建切片" class="headerlink" title="创建切片"></a>创建切片</h2><div class="note warning"><p><strong>注意：切片是引用类型！！！</strong></p></div><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 切片</span></span><br><span class="line"><span class="keyword">var</span> identifier []<span class="keyword">type</span></span><br><span class="line"><span class="keyword">var</span> identifier = []<span class="keyword">type</span>&#123;initial value&#125;</span><br><span class="line">identifier := []<span class="keyword">type</span>&#123;initial value&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数组</span></span><br><span class="line"><span class="keyword">var</span> identifier [<span class="built_in">len</span>]<span class="keyword">type</span></span><br><span class="line"><span class="keyword">var</span> identifier = [...]<span class="keyword">type</span>&#123;initial value&#125;</span><br></pre></td></tr></table></figure><p><code>identifier</code>：切片名、<code>type</code>：切片数据类型</p><p>::: alert-info<br>区别于数组，切片在定义时不用填写 len。<br>它和初始化数组时省略 len 不同，数组省略 len 时要写 <code>...</code>，切片啥也不用写。<br>:::</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> a []<span class="keyword">string</span> <span class="comment">// 声明一个字符串切片</span></span><br><span class="line">    <span class="keyword">var</span> b = []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125; <span class="comment">// 声明一个整型切片,并初始化</span></span><br><span class="line">    c := []<span class="keyword">bool</span>&#123;<span class="literal">false</span>, <span class="literal">true</span>&#125; <span class="comment">// 声明一个布尔型切片,并初始化</span></span><br><span class="line">    fmt.Println(a) <span class="comment">// []</span></span><br><span class="line">    fmt.Println(b) <span class="comment">// [1 2 3 4 5]</span></span><br><span class="line">    fmt.Println(c) <span class="comment">// [false, true]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Slice 的创建方式有三种：</p><ol><li>通过下标的方式获得数组或切片的一部分</li><li>使用字面量初始化新的切片</li><li>使用关键字 <code>make</code> 创建切片</li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">arr := [<span class="number">8</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>&#125;</span><br><span class="line"></span><br><span class="line">s1 := arr[<span class="number">2</span>:<span class="number">6</span>]<span class="comment">// 1. 通过下标基于数组或切片创建</span></span><br><span class="line">s2 := []<span class="keyword">int</span>&#123;<span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>&#125;<span class="comment">// 2. 通过字面量创建</span></span><br><span class="line">s3 := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">10</span>, <span class="number">20</span>)<span class="comment">// 3. 通过关键字 make 创建</span></span><br></pre></td></tr></table></figure><h3 id="基于数组创建"><a href="#基于数组创建" class="headerlink" title="基于数组创建"></a>基于数组创建</h3><p>切片底层是数组，当底层数组不够的时候，切片就会扩容。</p><p>上面的定义是创建一个匿名数组，让切片指向这个匿名数组，下面是基于数组定义切片</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">identifier := array[start_with:end:max]</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// 基于数组定义切片</span></span><br><span class="line">    arr := [<span class="number">8</span>]<span class="keyword">int</span>&#123;<span class="number">55</span>, <span class="number">56</span>, <span class="number">57</span>, <span class="number">58</span>, <span class="number">59</span>, <span class="number">60</span>, <span class="number">61</span>, <span class="number">62</span>&#125;</span><br><span class="line">    b := arr[<span class="number">1</span>:<span class="number">5</span>]          <span class="comment">// 其范围用数学表示为：[1,5) 从arr[1]取到arr[4]不包含arr[5]</span></span><br><span class="line">    fmt.Println(b)         <span class="comment">// [55 56 57 58 59]</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%T \n&quot;</span>, b) <span class="comment">// []int</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 切片再次切片</span></span><br><span class="line">    c := b[<span class="number">0</span>:<span class="built_in">len</span>(b)]       <span class="comment">// len(b)为5，所以取了b[0]、b[1]、b[2]、b[3]、b[4]，相当于复制一整个切片</span></span><br><span class="line">    fmt.Println(c)         <span class="comment">// [55 56 57 58 59]</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%T \n&quot;</span>, c) <span class="comment">// []int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>直接定义切片</strong>和<strong>指定数组定义切片</strong>的区别在于：</p><ol><li>直接定义切片会引用一个匿名数组，指定数组定义切片会引用指定数组</li><li>直接定义切片<code>长度=容量</code>，指定数组定义切片长度和容量视具体情况</li></ol><p>直接定义切片 ↓<br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20201117165416502_24200.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20201117165416502_24200.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="直接定义切片"></p><p>指定数组定义切片 ↓<br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20201117165435737_31154.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20201117165435737_31154.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="指定数组定义切片"></p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20201117165353576_15789.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20201117165353576_15789.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="指定数组定义切片"></p><div class="note yellow"><p>容量指的是从接片第一个元素到底层数组的最后一个元素<br>例如上面第三张图中：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">arr := [<span class="number">8</span>]<span class="keyword">int</span>&#123;<span class="number">55</span>, <span class="number">56</span>, <span class="number">57</span>, <span class="number">58</span>, <span class="number">59</span>, <span class="number">60</span>, <span class="number">61</span>, <span class="number">62</span>&#125;</span><br><span class="line">c := arr[<span class="number">3</span>:<span class="number">6</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">len</span>(c)    <span class="comment">// 3</span></span><br><span class="line"><span class="built_in">cap</span>(c)    <span class="comment">// 5</span></span><br></pre></td></tr></table></figure></div><h3 id="使用make-创建"><a href="#使用make-创建" class="headerlink" title="使用make()创建"></a>使用make()创建</h3><p>如果需要<strong>动态</strong>的创建一个切片，可以使用内置的<code>make()</code>函数<br>基本语法为：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">make</span>([]<span class="keyword">type</span>, <span class="built_in">len</span>, <span class="built_in">cap</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> identifier []<span class="keyword">type</span> = <span class="built_in">make</span>([]<span class="keyword">type</span>, <span class="built_in">len</span>, <span class="built_in">cap</span>)</span><br><span class="line">identifier := <span class="built_in">make</span>([]<span class="keyword">type</span>, <span class="built_in">len</span>, <span class="built_in">cap</span>)</span><br></pre></td></tr></table></figure><p><code>type</code>：切片数据类型、<code>len</code>：长度、<code>cap</code>：容量<br>cap 可以不填，默认和 len 相同</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// make函数构造切片</span></span><br><span class="line">    <span class="comment">// make([]type, len, cap)</span></span><br><span class="line"></span><br><span class="line">    d := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">4</span>, <span class="number">10</span>) <span class="comment">// 构造一个整型切片，填充5个元素，最大容量10</span></span><br><span class="line">    fmt.Println(d)         <span class="comment">// [0 0 0 0]</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%T \n&quot;</span>, d) <span class="comment">// []int</span></span><br><span class="line">    fmt.Println(<span class="built_in">len</span>(d))    <span class="comment">// 4</span></span><br><span class="line">    fmt.Println(<span class="built_in">cap</span>(d))    <span class="comment">// 10</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>动态就动态在于它能使用变量哈哈哈</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fn</span><span class="params">(a <span class="keyword">int</span>, b <span class="keyword">int</span>)</span> []<span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">make</span>([]<span class="keyword">int</span>, a, b)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="切片是引用类型"><a href="#切片是引用类型" class="headerlink" title="切片是引用类型"></a>切片是引用类型</h2><h3 id="判空"><a href="#判空" class="headerlink" title="判空"></a>判空</h3><p>检查切片是否为空，不能用 <code>s == nil</code>，而是应该使用 <code>len(s) == 0</code></p><blockquote><p>切片是一种引用类型，当它被声明的时候，没有指向任何数组，包括匿名数组也没有，此时切片中指针为 <code>nil</code></p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s []<span class="keyword">int</span>    <span class="comment">// s == nil</span></span><br></pre></td></tr></table></figure><p>当切片被初始化的时候，它就指向了一个数组，这时切片中的指针不为 <code>nil</code>。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s = []<span class="keyword">int</span>&#123;&#125;    <span class="comment">// s != nil</span></span><br></pre></td></tr></table></figure><h3 id="切片不能直接比较"><a href="#切片不能直接比较" class="headerlink" title="切片不能直接比较"></a>切片不能直接比较</h3><p>切片是一种引用类型，我们不能用 <code>==</code> 操作符来判断两个切片是否含有全部相等元素。<br>切片唯一合法的比较操作是和 <code>nil</code> 比较。</p><p> 一个<code>nil</code>值的切片并没有底层数组，一个<code>nil</code>值的切片的长度和容量都是0。<br> 但是我们不能说一个长度和容量都是0的切片一定是<code>nil</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s1 []<span class="keyword">int</span>         <span class="comment">//len(s1)=0; cap(s1)=0; s1==nil</span></span><br><span class="line">s2 := []<span class="keyword">int</span>&#123;&#125;        <span class="comment">//len(s2)=0; cap(s2)=0; s2!=nil</span></span><br><span class="line">s3 := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>) <span class="comment">//len(s3)=0; cap(s3)=0; s3!=nil</span></span><br></pre></td></tr></table></figure><p>所以要判断一个切片是否是空的，要是用<code>len(s) == 0</code>来判断，不应该使用<code>s == nil</code>来判断。</p><h3 id="切片的拷贝赋值"><a href="#切片的拷贝赋值" class="headerlink" title="切片的拷贝赋值"></a>切片的拷贝赋值</h3><p>下面的代码中演示了拷贝前后两个变量共享底层数组，对一个切片的修改会影响另一个切片的内容，这点需要特别注意。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s1 := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">3</span>) <span class="comment">//[0 0 0]</span></span><br><span class="line">    s2 := s1             <span class="comment">//将s1直接赋值给s2，s1和s2共用一个底层数组</span></span><br><span class="line">    s2[<span class="number">0</span>] = <span class="number">100</span></span><br><span class="line">    fmt.Println(s1) <span class="comment">//[100 0 0]</span></span><br><span class="line">    fmt.Println(s2) <span class="comment">//[100 0 0]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="切片遍历"><a href="#切片遍历" class="headerlink" title="切片遍历"></a>切片遍历</h2><p>切片的遍历方式和数组是一致的，支持索引遍历和<code>for range</code>遍历。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(s); i++ &#123;</span><br><span class="line">        fmt.Println(i, s[i])</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> index, value := <span class="keyword">range</span> s &#123;</span><br><span class="line">        fmt.Println(index, value)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="append"><a href="#append" class="headerlink" title="append()"></a>append()</h2><p>Go 中的内建函数 <code>append()</code> 可以为切片动态添加元素，可以一次添加一个或多个元素。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">append</span>(slice, elem_arr_or_slice)</span><br></pre></td></tr></table></figure><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;   <span class="comment">// [1 2 3 4 5]</span></span><br><span class="line">    s = <span class="built_in">append</span>(s, <span class="number">11</span>)<span class="comment">// [1 2 3 4 5 11]</span></span><br><span class="line">    s = <span class="built_in">append</span>(s, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>)   <span class="comment">// [1 2 3 4 5 11 12 13 14]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><code>append()</code> 第二个参数也可以是另一个切片，不过记得加上 <code>...</code></p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s2 := []<span class="keyword">int</span>&#123;<span class="number">55</span>, <span class="number">56</span>, <span class="number">57</span>&#125;</span><br><span class="line">    s = <span class="built_in">append</span>(s, s2...)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>注意：</strong> 通过var声明的零值切片可以在 <code>append()</code> 函数直接使用，无需初始化。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 正确</span></span><br><span class="line"><span class="keyword">var</span> s []<span class="keyword">int</span></span><br><span class="line">s = <span class="built_in">append</span>(s, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// X 没必要</span></span><br><span class="line"><span class="keyword">var</span> s = []<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">s = <span class="built_in">append</span>(s, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="comment">// X 没必要</span></span><br><span class="line"><span class="keyword">var</span> s = <span class="built_in">make</span>([]<span class="keyword">int</span>)</span><br><span class="line">s = <span class="built_in">append</span>(s, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure><h2 id="copy"><a href="#copy" class="headerlink" title="copy()"></a>copy()</h2><p>切片是引用类型，如果直接 <code>s1 = s2</code> ，其实是将 s2 中的数组地址赋值给 s1 的指针，s1 修改的时候 s2 也会受影响。<br>要实现真正的复制，需要使用内建函数 <code>copy()</code> 进行复制。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">copy</span>(destSlice, srcSlice)</span><br></pre></td></tr></table></figure><p><code>destSlice</code>：目标切片、<code>srcSlice</code>：数据来源切片</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s1 := []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;</span><br><span class="line">    s2 := []<span class="keyword">int</span>&#123;<span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>&#125;</span><br><span class="line">    <span class="built_in">copy</span>(s1, s2)</span><br><span class="line">    fmt.Println(s1)    <span class="comment">// [12 13 14 4]</span></span><br><span class="line">    fmt.Println(s2)    <span class="comment">// [12 13 14]</span></span><br><span class="line"></span><br><span class="line">    s3 := []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;</span><br><span class="line">    s4 := []<span class="keyword">int</span>&#123;<span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>&#125;</span><br><span class="line">    <span class="built_in">copy</span>(s4, s3)</span><br><span class="line">    fmt.Println(s3)    <span class="comment">// [1 2 3 4]</span></span><br><span class="line">    fmt.Println(s4)    <span class="comment">// [1 2 3]</span></span><br><span class="line"></span><br><span class="line">    s5 := []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;</span><br><span class="line">    s6 := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">4</span>)</span><br><span class="line">    <span class="built_in">copy</span>(s5, s6)</span><br><span class="line">    fmt.Println(s5)    <span class="comment">// [0 0 0 0]</span></span><br><span class="line">    fmt.Println(s6)    <span class="comment">// [0 0 0 0]</span></span><br><span class="line"></span><br><span class="line">    s7 := []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;</span><br><span class="line">    s8 := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">4</span>)</span><br><span class="line">    <span class="built_in">copy</span>(s8, s7)</span><br><span class="line">    fmt.Println(s7)    <span class="comment">// [1 2 3 4]</span></span><br><span class="line">    fmt.Println(s8)    <span class="comment">// [1 2 3 4]</span></span><br><span class="line">    s8[<span class="number">0</span>] = <span class="number">100</span></span><br><span class="line">    fmt.Println(s7)    <span class="comment">// [1 2 3 4]</span></span><br><span class="line">    fmt.Println(s8)    <span class="comment">// [100 2 3 4]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="语法"><a href="#语法" class="headerlink" title="[:] 语法"></a>[:] 语法</h2><p>这里需要说明一下，无论任何语言的 <code>[:]</code> 语法都是左闭右开的，用数学表达就是 $[start, end)$。</p><p>在 Python 中，<code>[:]</code>的语法规则是 <code>[low:high:step]</code>；</p><p>而在 Golang 中则是 <code>[low:high:max]</code>，其规则是：</p><p><code>0 &lt;= low &lt;= len(arr) &lt;= high &lt;= max &lt;= cap(arr)</code>。</p><ul><li><p><code>low </code>的取值在 <code>0 至 底层结构长度</code>，取底层结构长度时为空切片</p></li><li><p><code>high</code>的取值在<code>low 至 max</code>，取 low 时为空切片</p></li><li><p><code>max</code>的取值在<code>high 至 底层结构容量</code>，取 high 时新切片 len==cap</p></li></ul><p>举个栗子：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    a := [<span class="number">10</span>]<span class="keyword">int</span>&#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>&#125;</span><br><span class="line">    s := a[<span class="number">2</span>:<span class="number">6</span>:<span class="number">10</span>]<span class="comment">// [low:high:max]</span></span><br><span class="line"></span><br><span class="line">    fmt.Printf(<span class="string">&quot;a: %v\n&quot;</span>, a)          <span class="comment">// a: [0 1 2 3 4 5 6 7 8 9]</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;a len: %d\n&quot;</span>, <span class="built_in">len</span>(a)) <span class="comment">// a len: 10</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;a cap: %d\n&quot;</span>, <span class="built_in">cap</span>(a)) <span class="comment">// a cap: 10</span></span><br><span class="line"></span><br><span class="line">    fmt.Printf(<span class="string">&quot;s: %v\n&quot;</span>, s)          <span class="comment">// s: [2 3 4 5]</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;s len: %d\n&quot;</span>, <span class="built_in">len</span>(s)) <span class="comment">// s len: 4</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;s cap: %d\n&quot;</span>, <span class="built_in">cap</span>(s)) <span class="comment">// s cap: 8</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>总结一下就是</p><ul><li>新切片的容量 <code>cap(s) = max - low</code></li><li>新切片的长度 <code>len(s) = high - low</code></li><li><code>low 取值在 [0, len(arr)]</code></li><li><code>high 取值在 [low, max]</code></li><li><code>max 取值在 [hign, cap(arr)]</code></li></ul><h2 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h2><p>Go 并没有提供删除切片元素的方法，我们可以利用其本身的特性来删除元素<br>切片可以取自切片，那我们就将被删除元素之前的元素切下来，再把被删除元素之后的元素切下来，然后用<code>append()</code>拼接</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    a := []<span class="keyword">int</span>&#123;<span class="number">30</span>, <span class="number">31</span>, <span class="number">32</span>, <span class="number">33</span>, <span class="number">34</span>, <span class="number">35</span>, <span class="number">36</span>, <span class="number">37</span>&#125;</span><br><span class="line">    <span class="comment">// 删除下标为2的元素</span></span><br><span class="line">    a = <span class="built_in">append</span>(a[:<span class="number">2</span>], a[<span class="number">3</span>:]...)</span><br><span class="line">    fmt.Println(a)    <span class="comment">// [30, 31, 33, 34, 35, 36, 37]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>简单说就是 <code>a = append(a[:index], a[index+1:]...)</code></p><h2 id="其他操作"><a href="#其他操作" class="headerlink" title="其他操作"></a>其他操作</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// append slice</span></span><br><span class="line">slice = <span class="built_in">append</span>(slice, slice2...)</span><br><span class="line"> </span><br><span class="line"><span class="comment">// copy</span></span><br><span class="line">dest := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="built_in">len</span>(src))</span><br><span class="line"><span class="built_in">copy</span>(dest, src)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除多个连续的元素</span></span><br><span class="line">a = <span class="built_in">append</span>(a[:i], a[j:]...)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除一个元素 i</span></span><br><span class="line">a = <span class="built_in">append</span>(a[:i], a[i+<span class="number">1</span>:]...)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 扩展 j 个元素</span></span><br><span class="line">a = <span class="built_in">append</span>(a, <span class="built_in">make</span>([]T, j)...)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 插入元素 x 到 i 的位置上</span></span><br><span class="line">a = <span class="built_in">append</span>(a[:i], <span class="built_in">append</span>([]T&#123;x&#125;, a[i:]...)...)</span><br><span class="line"></span><br><span class="line"><span class="comment">// push，追加到尾部</span></span><br><span class="line">a = <span class="built_in">append</span>(a, x)</span><br><span class="line"></span><br><span class="line"><span class="comment">// pop，尾部弹出</span></span><br><span class="line">x, a = a[<span class="built_in">len</span>(a)<span class="number">-1</span>], a[:<span class="built_in">len</span>(a)<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// dequeue，队头出队</span></span><br><span class="line">x, a = a[<span class="number">0</span>], a[<span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line"><span class="comment">// enqueue，队尾入队</span></span><br><span class="line">a = <span class="built_in">append</span>(a, x)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// shift，头部取出</span></span><br><span class="line">x, a = a[<span class="number">0</span>], a[<span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line"><span class="comment">// unshift，头部加入</span></span><br><span class="line">a = <span class="built_in">append</span>([]T&#123;x&#125;, a...)</span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><strong>切片和数组</strong>之间有那么点像数据库中的 <strong>基本表和视图</strong>。<br>基本表是存储数据定义和数据的，视图只存储数据定义。所以基本表改变时视图也改变。<br>数组是存储定义和数据的，切片只存储定义。所以数组元素改变时切片也改变。</p><p>这个例子可能不是很贴切，但联系一下这句话：数组是值类型，切片是引用类型。<br>也就是说，数组是实实在在存数据的地方，切片只是对某个数组的引用，自己并没有数据。</p>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
          <category> Basic </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Golang [基础] 5-数组</title>
      <link href="posts/8961d743"/>
      <url>posts/8961d743</url>
      
        <content type="html"><![CDATA[<p>数组的定义与操作</p><span id="more"></span><h1 id="5-数组"><a href="#5-数组" class="headerlink" title="5-数组"></a>5-数组</h1><p>数组是同一种数据类型元素的集合。<br>在 Go 中 数组从声明时就确定，使用时可以修改数组成员，但不能修改数组大小。</p><h2 id="数组定义"><a href="#数组定义" class="headerlink" title="数组定义"></a>数组定义</h2><div class="note warning"><p><strong>注意：数组是值类型！！！</strong></p></div><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> identifier [<span class="built_in">len</span>]<span class="keyword">type</span></span><br></pre></td></tr></table></figure><p><code>identifier</code>：数组名、<code>len</code>：数组长度、<code>type</code>：数组类型</p><p>数组长度必须是常量，且一旦定义就不能更改。<br><code>[5]int</code>和<code>[10]int</code>是不同的类型。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr1 [<span class="number">5</span>]<span class="keyword">int</span></span><br><span class="line"><span class="keyword">var</span> arr2 [<span class="number">8</span>]<span class="keyword">int</span></span><br><span class="line">arr1 = arr2     <span class="comment">// 禁止这样做，因为此时 arr1 和 arr2 是不同的类型</span></span><br></pre></td></tr></table></figure><p>arr2 不可以赋值给 arr2，因为它俩类型不同，<br>如果换成 <code>var arr1 [5]int</code> 和 <code>var arr2 [5]int</code> 这样就可以。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> arr1 = [<span class="number">3</span>]<span class="keyword">int</span>&#123;<span class="number">12</span>, <span class="number">3</span>&#125;</span><br><span class="line">    <span class="keyword">var</span> arr2 [<span class="number">3</span>]<span class="keyword">int</span></span><br><span class="line"></span><br><span class="line">    arr2 = arr1</span><br><span class="line">    <span class="keyword">for</span> _, e := <span class="keyword">range</span> arr2 &#123;</span><br><span class="line">        fmt.Println(e)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ----------------------------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line"><span class="number">12</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure><h2 id="数组初始化"><a href="#数组初始化" class="headerlink" title="数组初始化"></a>数组初始化</h2><p>初始化方式有很多种</p><h3 id="方法1"><a href="#方法1" class="headerlink" title="方法1"></a>方法1</h3><p>使用初始化列表设置数组元素的值</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> identifier [<span class="built_in">len</span>]<span class="keyword">type</span></span><br><span class="line"><span class="keyword">var</span> identifier = [<span class="built_in">len</span>]<span class="keyword">type</span>&#123;initial list&#125;</span><br></pre></td></tr></table></figure><p>eg:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a [<span class="number">3</span>]<span class="keyword">int</span></span><br><span class="line"><span class="keyword">var</span> b = [<span class="number">3</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>&#125;</span><br><span class="line"><span class="keyword">var</span> c = [<span class="number">3</span>]<span class="keyword">string</span>&#123;<span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;Boii&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">fmt.Println(a)    <span class="comment">// [0 0 0]</span></span><br><span class="line">fmt.Println(b)    <span class="comment">// [1 2 0]</span></span><br><span class="line">fmt.Println(c)    <span class="comment">// [Alice Boii]</span></span><br></pre></td></tr></table></figure><h3 id="方法2"><a href="#方法2" class="headerlink" title="方法2"></a>方法2</h3><p>让编译器根据初始值个数自行推断数组长度</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> identifier = [...]<span class="keyword">type</span>&#123;initial list&#125;</span><br></pre></td></tr></table></figure><p>eg:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> b = [...]<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;</span><br><span class="line">fmt.Println(b)                    <span class="comment">// [1 2 3 4]</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;Type of b: %T \n&quot;</span>, b) <span class="comment">// Type of b: [4]int</span></span><br></pre></td></tr></table></figure><h3 id="方法3"><a href="#方法3" class="headerlink" title="方法3"></a>方法3</h3><p>通过指定索引值来初始化数组，数组长度为 <code>最大的下标+1</code><br>通过这种方式的可以不指定数组长度，如果指定了数组长度且没有更大的下标，则以指定长度为最大长度</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> identifier = [...]<span class="keyword">int</span>&#123;idx: elem, idx: elem&#125;</span><br></pre></td></tr></table></figure><p>eg:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    a := [...]<span class="keyword">int</span>&#123;<span class="number">1</span>: <span class="number">3</span>, <span class="number">5</span>: <span class="number">2</span>&#125;</span><br><span class="line">    b := [<span class="number">7</span>]<span class="keyword">int</span>&#123;<span class="number">0</span>: <span class="number">2</span>, <span class="number">4</span>: <span class="number">5</span>&#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println(a)    <span class="comment">// [0 3 0 0 0 2]</span></span><br><span class="line">    fmt.Println(b)    <span class="comment">// [2 0 0 0 5 0 0]</span></span><br><span class="line"></span><br><span class="line">    fmt.Printf(<span class="string">&quot;Type of a: %T \n&quot;</span>, a) <span class="comment">// Type of a: [6]int</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;Type of b: %T \n&quot;</span>, b) <span class="comment">// Type of b: [7]int</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// b := [3]int&#123;0: 2, 4: 5&#125;</span></span><br><span class="line">    <span class="comment">// 上面这句会报错，指定长度3，却又指定了索引4</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="数组遍历"><a href="#数组遍历" class="headerlink" title="数组遍历"></a>数组遍历</h2><p>数组遍历可以通过 <code>for</code> 循环，也可以通过 <code>for...range</code>，比较推荐 <code>for...range</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    str := [...]<span class="keyword">string</span>&#123;<span class="string">&quot;广州&quot;</span>, <span class="string">&quot;深圳&quot;</span>, <span class="string">&quot;东莞&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(str); i++ &#123;</span><br><span class="line">        fmt.Println(str[i])</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> idx, value := <span class="keyword">range</span> str &#123;</span><br><span class="line">        fmt.Println(idx, value)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="多维数组"><a href="#多维数组" class="headerlink" title="多维数组"></a>多维数组</h2><p>Go 中支持多维数组，这里以二维数组为例。</p><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    a := [<span class="number">3</span>][<span class="number">2</span>]<span class="keyword">string</span>&#123;</span><br><span class="line">        &#123;<span class="string">&quot;广东&quot;</span>, <span class="string">&quot;广州&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;浙江&quot;</span>, <span class="string">&quot;杭州&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;四川&quot;</span>, <span class="string">&quot;成都&quot;</span>&#125;,</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(a)          <span class="comment">// [[广东 广州] [浙江 杭州] [四川 成都]]</span></span><br><span class="line">    fmt.Println(a[<span class="number">1</span>][<span class="number">1</span>])    <span class="comment">// 支持索引取值： 杭州</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="遍历"><a href="#遍历" class="headerlink" title="遍历"></a>遍历</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    a := [<span class="number">3</span>][<span class="number">2</span>]<span class="keyword">string</span>&#123;</span><br><span class="line">        &#123;<span class="string">&quot;广东&quot;</span>, <span class="string">&quot;广州&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;浙江&quot;</span>, <span class="string">&quot;杭州&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;四川&quot;</span>, <span class="string">&quot;成都&quot;</span>&#125;,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _, v1 := <span class="keyword">range</span> a &#123;</span><br><span class="line">        <span class="keyword">for</span> _, v2 := <span class="keyword">range</span> v1 &#123;</span><br><span class="line">            fmt.Printf(<span class="string">&quot;%s \t&quot;</span>, v2)</span><br><span class="line">        &#125;</span><br><span class="line">        fmt.Println()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ----------------------------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line">广东 广州</span><br><span class="line">浙江 杭州</span><br><span class="line">四川 成都</span><br></pre></td></tr></table></figure><blockquote><p><strong>注意：</strong>多维数组只有第一层可以省略长度。<br>eg：</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 合法写法</span></span><br><span class="line">a := [...][<span class="number">2</span>]<span class="keyword">string</span>&#123;</span><br><span class="line">    &#123;<span class="string">&quot;广东&quot;</span>, <span class="string">&quot;广州&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;浙江&quot;</span>, <span class="string">&quot;杭州&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;四川&quot;</span>, <span class="string">&quot;成都&quot;</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 非法写法</span></span><br><span class="line">a := [...][...]<span class="keyword">string</span>&#123;</span><br><span class="line">    &#123;<span class="string">&quot;广东&quot;</span>, <span class="string">&quot;广州&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;浙江&quot;</span>, <span class="string">&quot;杭州&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;四川&quot;</span>, <span class="string">&quot;成都&quot;</span>&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="数组是值类型"><a href="#数组是值类型" class="headerlink" title="数组是值类型"></a>数组是值类型</h2><p>数组是值类型，赋值和传参会赋值整个数组。因此改变副本的值，不会改变本身的值。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">modifyArray</span><span class="params">(x [3]<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    x[<span class="number">0</span>] = <span class="number">100</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">modifyArray2</span><span class="params">(x [3][2]<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    x[<span class="number">2</span>][<span class="number">0</span>] = <span class="number">100</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    a := [<span class="number">3</span>]<span class="keyword">int</span>&#123;<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>&#125;</span><br><span class="line">    modifyArray(a) <span class="comment">//在modify中修改的是a的副本x</span></span><br><span class="line">    fmt.Println(a) <span class="comment">//[10 20 30]</span></span><br><span class="line">    b := [<span class="number">3</span>][<span class="number">2</span>]<span class="keyword">int</span>&#123;</span><br><span class="line">        &#123;<span class="number">1</span>, <span class="number">1</span>&#125;,</span><br><span class="line">        &#123;<span class="number">1</span>, <span class="number">1</span>&#125;,</span><br><span class="line">        &#123;<span class="number">1</span>, <span class="number">1</span>&#125;,</span><br><span class="line">    &#125;</span><br><span class="line">    modifyArray2(b) <span class="comment">//在modify中修改的是b的副本x</span></span><br><span class="line">    fmt.Println(b)  <span class="comment">//[[1 1] [1 1] [1 1]]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意：</p><ol><li>数组支持 <code>==</code>、<code>!=</code> 操作符，因为内存总是被初始化过的。</li><li><code>[len]*type</code> 表示指针数组，本质是<strong>数组</strong>，存放指针的数组</li><li><code>*[len]type</code> 表示数组指针，本质是<strong>指针</strong>，指向数组的指针</li></ol>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
          <category> Basic </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Golang [基础] 4-流程控制</title>
      <link href="posts/7ebc0a4"/>
      <url>posts/7ebc0a4</url>
      
        <content type="html"><![CDATA[<p>基本流程控制</p><span id="more"></span><h1 id="4-流程控制"><a href="#4-流程控制" class="headerlink" title="4-流程控制"></a>4-流程控制</h1><h2 id="分支结构"><a href="#分支结构" class="headerlink" title="分支结构"></a>分支结构</h2><h3 id="if-基本写法"><a href="#if-基本写法" class="headerlink" title="if 基本写法"></a>if 基本写法</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> 表达式<span class="number">1</span> &#123;</span><br><span class="line">    分支<span class="number">1</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> 表达式<span class="number">2</span> &#123;</span><br><span class="line">    分支<span class="number">2</span></span><br><span class="line">&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">    分支<span class="number">3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    score := <span class="number">65</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> score &gt;= <span class="number">90</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;A&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> score &gt; <span class="number">75</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;B&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;C&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="if-特殊写法"><a href="#if-特殊写法" class="headerlink" title="if 特殊写法"></a>if 特殊写法</h3><p>在 if 表达式之前添加一个执行语句，再根据变量值进行判断</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> score := <span class="number">65</span>; score &gt;= <span class="number">90</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;A&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> score &gt; <span class="number">75</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;B&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;C&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意上述代码中的 score 是在 if 语句中创建并初始化的，其作用域仅限于 if 语句块（包括同属的 else if 语句、else 语句）</p><p>但是如果声明是在 if 语句外，则其作用域不限于 if 语句中</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> score <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> score := <span class="number">65</span>; score &gt;= <span class="number">90</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;A&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> score &gt; <span class="number">75</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;B&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;C&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// score 在if外部声明，所以出了 if 依然有效</span></span><br><span class="line">    fmt.Println(score)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="switch-case"><a href="#switch-case" class="headerlink" title="switch case"></a>switch case</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> [判断变量] &#123;</span><br><span class="line">    <span class="keyword">case</span> 常量<span class="number">1</span> 或 表达式<span class="number">1</span>:</span><br><span class="line">        执行语句<span class="number">1</span></span><br><span class="line">    <span class="keyword">case</span> 常量<span class="number">2</span> 或 表达式<span class="number">2</span>:</span><br><span class="line">        执行语句<span class="number">2</span></span><br><span class="line">    <span class="keyword">case</span> 常量<span class="number">3</span> 或 表达式<span class="number">3</span>:</span><br><span class="line">        执行语句<span class="number">3</span></span><br><span class="line">    <span class="keyword">case</span> 常量<span class="number">4</span> 或 表达式<span class="number">4</span>:</span><br><span class="line">        执行语句<span class="number">4</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        执行语句N</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>一个switch 可有多个分支，但只能有一个<code>default 分支</code>，且 defalut 分支不是必须的。</p><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    num := <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> num &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;It is 1.&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;It is 2.&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;It is 3.&quot;</span>)</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;It is more than 3.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ----------------------------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line">It is <span class="number">2.</span></span><br></pre></td></tr></table></figure><p>一个分支可以有多个值，每个值之间用逗号分开</p><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> n := <span class="number">7</span>; n &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;Odd&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;Even&quot;</span>)</span><br><span class="line">    <span class="keyword">default</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>分支也可以用表达式，这时 switch 后面不需要跟判断变量</p><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    age := <span class="number">25</span></span><br><span class="line">    <span class="keyword">switch</span> &#123;    <span class="comment">// switch 后不带判断变量，则case 只能判断 true 或 false</span></span><br><span class="line">    <span class="keyword">case</span> age &lt; <span class="number">25</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;好好学习！&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> age &gt; <span class="number">25</span> &amp;&amp; age &lt; <span class="number">35</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;好好工作！&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> age &gt; <span class="number">60</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;好好享受！&quot;</span>)</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;好好活着！&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>或者</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> age := <span class="number">25</span>; &#123;</span><br><span class="line">    <span class="keyword">case</span> age &lt; <span class="number">25</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;好好学习！&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> age &gt; <span class="number">25</span> &amp;&amp; age &lt; <span class="number">35</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;好好工作！&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> age &gt; <span class="number">60</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;好好享受！&quot;</span>)</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;好好活着！&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>switch 中的 case 默认不会穿透，执行完这个 case 之后就跳出switch，但是可以使用 <code>fallthrough</code> 击穿 case。<br><code>fallthrough</code> 语句可以执行满足条件的 case 的下一个 case，这是为了兼容 C 语言中的 case 设计的。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">switchDemo5</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">&quot;a&quot;</span></span><br><span class="line">    <span class="keyword">switch</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> s == <span class="string">&quot;a&quot;</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;a&quot;</span>)</span><br><span class="line">        <span class="keyword">fallthrough</span></span><br><span class="line">    <span class="keyword">case</span> s == <span class="string">&quot;b&quot;</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;b&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> s == <span class="string">&quot;c&quot;</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;c&quot;</span>)</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;...&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ----------------------------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line">a</span><br><span class="line">b</span><br></pre></td></tr></table></figure><h2 id="循环结构"><a href="#循环结构" class="headerlink" title="循环结构"></a>循环结构</h2><h3 id="for-循环"><a href="#for-循环" class="headerlink" title="for 循环"></a>for 循环</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> 初始化语句; 条件语句; 迭代语句 &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>或</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">初始化语句</span><br><span class="line"><span class="keyword">for</span> 条件语句 &#123;</span><br><span class="line">    ...</span><br><span class="line">    迭代语句</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">    fmt.Println(i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>或</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">i := <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i &lt; <span class="number">5</span> &#123;</span><br><span class="line">    fmt.Println(i)</span><br><span class="line">    i++</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="无限循环"><a href="#无限循环" class="headerlink" title="无限循环"></a>无限循环</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">    循环体</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>for 循环可以通过 <code>break、continue、return、panic</code>语句强制退出循环。</p><h3 id="for-range-键值循环"><a href="#for-range-键值循环" class="headerlink" title="for range 键值循环"></a>for range 键值循环</h3><p>使用 <code>for range</code> 可以遍历数组、切片、字符串、map 和通道channel。</p><p>通过 <code>for range</code> 遍历的返回值有以下规律：</p><ol><li>数组、切片、字符串 返回<strong>索引</strong>和<strong>值</strong></li><li>map 返回<strong>键</strong>和<strong>值</strong></li><li>通道 channel 只返回<strong>通道内的值</strong></li></ol><p>基本语法为：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> idx, val := <span class="keyword">range</span> iter &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    numbers := [<span class="number">6</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i, x := <span class="keyword">range</span> numbers &#123;</span><br><span class="line">        fmt.Printf(<span class="string">&quot;第 %d 位 x 的值为 %d \n&quot;</span>,i ,x)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ----------------------------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line">第 <span class="number">0</span> 位 x 的值为 <span class="number">1</span></span><br><span class="line">第 <span class="number">1</span> 位 x 的值为 <span class="number">2</span></span><br><span class="line">第 <span class="number">2</span> 位 x 的值为 <span class="number">3</span></span><br><span class="line">第 <span class="number">3</span> 位 x 的值为 <span class="number">5</span></span><br><span class="line">第 <span class="number">4</span> 位 x 的值为 <span class="number">0</span></span><br><span class="line">第 <span class="number">5</span> 位 x 的值为 <span class="number">0</span></span><br></pre></td></tr></table></figure><p><strong>注意：</strong> <code>val</code> 始终为<code>iter</code>中对应索引的值拷贝，因此它一般只具有只读性质，对它所做的任何修改都不会影响到集合中原有的值。如果 <code>val</code> 为指针，则会产生指针的拷贝，依旧可以修改集合中的原值。</p><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    a, b, c := <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span></span><br><span class="line">    d, e, f := <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span></span><br><span class="line"></span><br><span class="line">    pointer := [<span class="number">3</span>]*<span class="keyword">int</span>&#123;&amp;a, &amp;b, &amp;c&#125;</span><br><span class="line">    valuer := [<span class="number">3</span>]<span class="keyword">int</span>&#123;d, e, f&#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println(a, b, c) <span class="comment">// 1 2 3</span></span><br><span class="line">    fmt.Println(d, e, f) <span class="comment">// 4 5 6</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _, p := <span class="keyword">range</span> pointer &#123;</span><br><span class="line">        *p = *p + <span class="number">10</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _, v := <span class="keyword">range</span> valuer &#123;</span><br><span class="line">        v = v + <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println(a, b, c) <span class="comment">// 11 12 13</span></span><br><span class="line">    fmt.Println(d, e, f) <span class="comment">// 4 5 6</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="goto-跳转"><a href="#goto-跳转" class="headerlink" title="goto 跳转"></a>goto 跳转</h3><p><code>goto语句</code> 通过标签进行代码间的无条件跳转。<br>标签即某一行第一个一冒号（<code>:</code>）结尾的单词,为了提升可读性，一般建议标签名称使用全大写。</p><p><code>goto语句</code>可以在快速跳出循环、避免重复退出上有一定的帮助。<br>Go 语言中使用 goto 语句能简化一些代码的实现过程。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">6</span> &#123;</span><br><span class="line">            <span class="keyword">goto</span> GOTOTAG</span><br><span class="line">        &#125;</span><br><span class="line">        fmt.Println(i)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">GOTOTAG:</span><br><span class="line">    fmt.Println(<span class="string">&quot;I&#x27;m break.&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ----------------------------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line">I<span class="string">&#x27;m break.</span></span><br></pre></td></tr></table></figure><hr><p>使用 goto 语句也可以实现循环，但是不建议这么做，因为滥用 goto 语句会写出意大利面条代码</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    a := <span class="number">1</span></span><br><span class="line">L:</span><br><span class="line">    <span class="keyword">if</span> a &lt; <span class="number">10</span> &#123;</span><br><span class="line">        fmt.Println(a)</span><br><span class="line">        a++</span><br><span class="line">        <span class="keyword">goto</span> L</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果您必须使用 goto，应当只使用正序的标签（<strong>标签位于 goto 语句之后</strong>），但注意标签和 goto 语句之间不能出现定义新变量的语句，否则会导致编译失败。</p><h3 id="break、continue"><a href="#break、continue" class="headerlink" title="break、continue"></a>break、continue</h3><p><strong>break</strong>：跳出整个循环<br><strong>continue</strong>：跳出本次循环</p><p>break 和 continue 语句后面都可以添加标签。<strong>不过标签必须位于 <code>for、switch、select</code>代码块之上。</strong><br>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">breakTag:</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">5</span> &#123;</span><br><span class="line">            <span class="keyword">break</span> breakTag</span><br><span class="line">        &#125;</span><br><span class="line">        fmt.Println(i)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ----------------------------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
          <category> Basic </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Golang [基础] 3-运算符</title>
      <link href="posts/5d7d558a"/>
      <url>posts/5d7d558a</url>
      
        <content type="html"><![CDATA[<p>内置操作符</p><span id="more"></span><h1 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h1><h2 id="官方定义的所有运算符"><a href="#官方定义的所有运算符" class="headerlink" title="官方定义的所有运算符"></a>官方定义的所有运算符</h2><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+    <span class="meta">&amp;     +=    &amp;=     &amp;&amp;    ==    !=    (    )</span></span><br><span class="line">-    <span class="string">|     -=    |=     ||    &lt;     &lt;=    [    ]</span></span><br><span class="line">*    ^     *=    ^=     &lt;-    &gt;     &gt;=    &#123;    &#125;</span><br><span class="line">/    &lt;&lt;    /=    &lt;&lt;=    ++    =     :=    ,    ;</span><br><span class="line">%    &gt;&gt;    %=    &gt;&gt;=    --    !     ...   .    :</span><br><span class="line">     <span class="meta">&amp;^          &amp;^=</span></span><br></pre></td></tr></table></figure><h2 id="算术运算符"><a href="#算术运算符" class="headerlink" title="算术运算符"></a>算术运算符</h2><table><thead><tr><th align="left">运算符</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">+</td><td align="left">加</td></tr><tr><td align="left">-</td><td align="left">减</td></tr><tr><td align="left">*</td><td align="left">乘</td></tr><tr><td align="left">/</td><td align="left">除</td></tr><tr><td align="left">%</td><td align="left">求余</td></tr></tbody></table><p>Go 中 <code>++</code> 和 <code>--</code> 是单独的语句，不是运算符。即 <code>a++</code> 后面不能有其他东西了，且只有后置，没有前置</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    a := <span class="number">10</span></span><br><span class="line">    a++          <span class="comment">// 正确，a的值为11</span></span><br><span class="line">    a++ + <span class="number">10</span>     <span class="comment">// 错误</span></span><br><span class="line">    ++a          <span class="comment">// 错误，只有后置自增和后置自减</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="关系运算符"><a href="#关系运算符" class="headerlink" title="关系运算符"></a>关系运算符</h2><table><thead><tr><th align="center">运算符</th><th align="left">描述</th></tr></thead><tbody><tr><td align="center">==</td><td align="left">等于</td></tr><tr><td align="center">!=</td><td align="left">不等于</td></tr><tr><td align="center">&gt;</td><td align="left">大于</td></tr><tr><td align="center">&gt;=</td><td align="left">大于等于</td></tr><tr><td align="center">&lt;</td><td align="left">小于</td></tr><tr><td align="center">&lt;=</td><td align="left">小于等于</td></tr></tbody></table><h2 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h2><table><thead><tr><th align="center">运算符</th><th align="left">描述</th></tr></thead><tbody><tr><td align="center">&amp;&amp;</td><td align="left">逻辑与</td></tr><tr><td align="center">||</td><td align="left">逻辑或</td></tr><tr><td align="center">!</td><td align="left">逻辑非</td></tr></tbody></table><h2 id="位运算符"><a href="#位运算符" class="headerlink" title="位运算符"></a>位运算符</h2><table><thead><tr><th align="center">运算符</th><th align="left">含义</th><th align="left"></th></tr></thead><tbody><tr><td align="center">&amp;</td><td align="left">按位与</td><td align="left">两位均为1才为1</td></tr><tr><td align="center">|</td><td align="left">按位或</td><td align="left">两位有一个为1就为1</td></tr><tr><td align="center">^</td><td align="left">按位异或</td><td align="left">两位不同则为1</td></tr><tr><td align="center">&lt;&lt;</td><td align="left">左移</td><td align="left">左移n位 == 乘以2的n次方，高位丢弃，低位补0</td></tr><tr><td align="center">&gt;&gt;</td><td align="left">右移</td><td align="left">右移n位 == 除以2的n次方，高位补0，低位丢弃</td></tr></tbody></table><h2 id="赋值运算符"><a href="#赋值运算符" class="headerlink" title="赋值运算符"></a>赋值运算符</h2><table><thead><tr><th align="left">运算符</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">=</td><td align="left">将右边赋值给左边</td></tr><tr><td align="left">+=</td><td align="left">相加后赋值</td></tr><tr><td align="left">-=</td><td align="left">相减后赋值</td></tr><tr><td align="left">*=</td><td align="left">相乘后赋值</td></tr><tr><td align="left">/=</td><td align="left">相除后赋值</td></tr><tr><td align="left">%=</td><td align="left">求余后赋值</td></tr><tr><td align="left">&amp;=</td><td align="left">按位与后赋值</td></tr><tr><td align="left">|=</td><td align="left">按位或后赋值</td></tr><tr><td align="left">^=</td><td align="left">按位异或后赋值</td></tr><tr><td align="left">&lt;&lt;=</td><td align="left">左移后赋值</td></tr><tr><td align="left">&gt;&gt;=</td><td align="left">右移后赋值</td></tr></tbody></table><h2 id="优先级"><a href="#优先级" class="headerlink" title="优先级"></a>优先级</h2><p>从高到低</p><table><thead><tr><th>分类</th><th>描述</th><th>关联性</th></tr></thead><tbody><tr><td>后缀</td><td><code>()</code> <code>[]</code> <code>.</code> <code>++</code> <code>--</code></td><td>左到右</td></tr><tr><td>一元</td><td><code>+</code> <code>-</code> <code>!</code> <code>~</code> <code>++</code> <code>--</code> <code>(type)</code> <code>*</code> <code>&amp;</code> <code>sizeof</code></td><td>右到左</td></tr><tr><td>乘除</td><td><code>*</code> <code>/</code> <code>%</code></td><td>左到右</td></tr><tr><td>加减</td><td><code>+</code> <code>-</code></td><td>左到右</td></tr><tr><td>移位</td><td><code>&lt;&lt;</code> <code>&gt;&gt;</code></td><td>左到右</td></tr><tr><td>关系</td><td><code>&lt;</code> <code>&lt;=</code> <code>&gt;</code> <code>&gt;=</code></td><td>左到右</td></tr><tr><td>相等</td><td><code>==</code> <code>!=</code></td><td>左到右</td></tr><tr><td>按位AND</td><td><code>&amp;</code></td><td>左到右</td></tr><tr><td>按位XOR</td><td><code>^</code></td><td>左到右</td></tr><tr><td>按位OR</td><td>`</td><td>`</td></tr><tr><td>逻辑AND</td><td><code>&amp;&amp;</code></td><td>左到右</td></tr><tr><td>逻辑OR</td><td>`</td><td></td></tr><tr><td>赋值</td><td><code>=</code> <code>+=</code> <code>-=</code> <code>*=</code> <code>/=</code> <code>%=</code> <code>&gt;&gt;=</code> <code>&lt;&lt;=</code> <code>&amp;=</code> <code>^=</code></td><td>右到左</td></tr><tr><td>逗号</td><td><code>,</code></td><td>左到右</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
          <category> Basic </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Golang [基础] 2-数据类型</title>
      <link href="posts/c6fec8a1"/>
      <url>posts/c6fec8a1</url>
      
        <content type="html"><![CDATA[<p>基础数据类型</p><span id="more"></span><h1 id="2-数据类型"><a href="#2-数据类型" class="headerlink" title="2-数据类型"></a>2-数据类型</h1><h2 id="整型"><a href="#整型" class="headerlink" title="整型"></a>整型</h2><p>整型分为两大类：<code>有符号</code>和<code>无符号</code></p><p>按长度分为：<code>int8</code>、<code>int16</code>、<code>int32</code>、<code>int64</code>；<code>uint8</code>、<code>uint16</code>、<code>uint32</code>、<code>uint64</code></p><table><thead><tr><th align="left">类型</th><th align="left">范围</th><th align="left">描述</th><th>对应C</th></tr></thead><tbody><tr><td align="left">int8</td><td align="left">-128~127</td><td align="left">有符号8位整型</td><td>byte</td></tr><tr><td align="left">int16</td><td align="left">-32768~32767</td><td align="left">有符号16位整型</td><td>short</td></tr><tr><td align="left">int32</td><td align="left">-2147483648~2147483647</td><td align="left">有符号32位整型</td><td>int</td></tr><tr><td align="left">int64</td><td align="left">-9223372036854775808~9223372036854775807</td><td align="left">有符号64位整型</td><td>long</td></tr><tr><td align="left">uint8</td><td align="left">0~255</td><td align="left">无符号8位整型</td><td>unsigned byte</td></tr><tr><td align="left">uint16</td><td align="left">0·65535</td><td align="left">无符号16位整型</td><td>unsigned short</td></tr><tr><td align="left">uint32</td><td align="left">0~4294967295</td><td align="left">无符号32位整型</td><td>unsigned int</td></tr><tr><td align="left">uint64</td><td align="left">0~18446744073709551615</td><td align="left">无符号64位整型</td><td>unsigned long</td></tr></tbody></table><h3 id="特殊整型"><a href="#特殊整型" class="headerlink" title="特殊整型"></a>特殊整型</h3><table><thead><tr><th align="left">类型</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">uint</td><td align="left">32位OS上就是uint32，64位OS上就是uint64</td></tr><tr><td align="left">int</td><td align="left">32位OS上就是int32，64位OS上就是int64</td></tr><tr><td align="left">uintptr</td><td align="left">无符号整型，用于存放一个指针</td></tr></tbody></table><blockquote><p><strong>注意</strong>：</p><p>在使用<code>int</code>和<code>uint</code>类型时，不能假定它是32位或64位的整型，而要考虑<code>int</code>和<code>uint</code>可能在不同平台上的差异。<br>在涉及到<strong>二进制传输、读写文件的结构描述</strong>时，为了保持文件的结构不会受到不同编译目标平台字节长度的影响，不要使用<code>int</code>和<code>uint</code>。</p></blockquote><h3 id="数字字面量语法"><a href="#数字字面量语法" class="headerlink" title="数字字面量语法"></a>数字字面量语法</h3><p>字面量语法使得开发者可以用 二进制、八进制、十六进制的格式定义数字</p><ul><li><code>v := 0b101110</code>，<strong>0b前缀</strong>；代表二进制的 101110，相当于八进制的56，十进制的46，十六进制的 2E</li><li><code>v := 0o56</code>，0o前缀；代表八进制的 56</li><li><code>v := 46</code>，<strong>无前缀</strong>；代表十进制的 46</li><li><code>v := 0x2e</code>，<strong>0x前缀</strong>；代表十六进制的 2E</li><li><code>v := 0x1p-2</code>，代表十六进制的 1 除以 $2^2$，也就是 0.25</li></ul><p>还可以用 <code>_</code> 来分隔数字。比如 <code>v := 1_000_000</code> 表示 v 的值等于 一百万 1000000。</p><p>借助 <code>Printf()</code> 可以将一个整数以不同进制形式展示</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    num := <span class="number">0</span>b101110</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%b \t %#b \n&quot;</span>, num, num)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%o \t\t %#o \n&quot;</span>, num, num)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%d \t\t %#d \n&quot;</span>, num, num)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%x \t\t %#x \t %#X \n&quot;</span>, num, num, num)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ----------------------------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line"><span class="number">101110</span>  <span class="number">0</span>b101110</span><br><span class="line"><span class="number">56</span>  <span class="number">056</span></span><br><span class="line"><span class="number">46</span>  <span class="number">46</span></span><br><span class="line"><span class="number">2</span>e  <span class="number">0x2e</span>  <span class="number">0X2E</span></span><br></pre></td></tr></table></figure><blockquote><p>整型支持算术运算和位操作，算术表达式和位操作表达式的结果还是整型</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a <span class="keyword">int</span> = <span class="number">1000</span> &gt;&gt; <span class="number">2</span></span><br></pre></td></tr></table></figure></blockquote><h2 id="浮点型"><a href="#浮点型" class="headerlink" title="浮点型"></a>浮点型</h2><p>Go 语言支持两种浮点型数：<code>float32</code>和<code>float64</code>。<br>这两种浮点型数据格式遵循 <code>IEEE754</code>标准：</p><ul><li><code>float32</code>的浮点数最大范围约为<code>3.4e38</code>，可以使用常量定义 <code>math.MaxFloat32</code></li><li><code>float64</code>的浮点数最大范围约为<code>1.8e308</code>，可以使用常量定义 <code>math.MaxFloat64</code></li></ul><p>打印浮点数时，可以使用占位符 <code>%f</code>:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;math&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%f \n&quot;</span>, math.Pi)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%.2f \n&quot;</span>, math.Pi)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ----------------------------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line"><span class="number">3.141593</span></span><br><span class="line"><span class="number">3.14</span></span><br></pre></td></tr></table></figure><blockquote><ol><li>浮点型字面量被自动类型推断为 float64 类型 <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">b := <span class="number">10.00</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;%T&quot;</span>, b)    <span class="comment">// float64</span></span><br></pre></td></tr></table></figure></li><li>计算机很难进行浮点数的精确表示和存储，因此两个浮点数之间不应该使用 <code>==</code> 或 <code>!=</code> 来比较，高精度科学计算应该使用 math 标准库</li></ol></blockquote><h2 id="复数"><a href="#复数" class="headerlink" title="复数"></a>复数</h2><p><code>complex64</code> 和 <code>complex128</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> c1 <span class="keyword">complex64</span> = <span class="number">1</span> + <span class="number">2i</span></span><br><span class="line"><span class="keyword">var</span> c2 <span class="keyword">complex128</span> = <span class="number">2</span> + <span class="number">3i</span></span><br><span class="line"></span><br><span class="line">fmt.Println(c1)</span><br><span class="line">fmt.Println(c2)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ----------------------------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line">(<span class="number">1</span>+<span class="number">2i</span>)</span><br><span class="line">(<span class="number">2</span>+<span class="number">3i</span>)</span><br></pre></td></tr></table></figure><p>复数有实部和虚部<br>complex64的实部和虚部为32位<br>complex128的实部和虚部为64位。</p><blockquote><p>Go 有三个内置函数处理复数</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> v = <span class="built_in">complex</span>(<span class="number">2.1</span>, <span class="number">3</span>) <span class="comment">// 构造一个复数 (2.1+3i)</span></span><br><span class="line">a := <span class="built_in">real</span>(v)            <span class="comment">// 返回复数实部 2.1</span></span><br><span class="line">b := <span class="built_in">imag</span>(v)            <span class="comment">// 返回复数虚部 3</span></span><br></pre></td></tr></table></figure></blockquote><h2 id="布尔值"><a href="#布尔值" class="headerlink" title="布尔值"></a>布尔值</h2><p>Go 语言中以 <code>bool</code> 类型进行声明布尔型，布尔型数据只有 <code>true</code> 和 <code>false</code> 两个值。</p><ol><li>布尔类型变量默认值为 false</li><li>Go 语言中<strong>不允许将整型强制转换为布尔型（integer !-&gt; bool）</strong></li><li>布尔型无法参与数值运算，无法与其他类型进行转换</li></ol><h2 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h2><p><strong>Go 语言中的字符串是原生数据类型</strong>，使用字符串就像使用其他原生数据类型（int、bool、float32等）一样<br>Go 语言中字符串内部实现使用 <code>UTF-8</code> 编码，这使得 go 不需要专门使用 UTF-8 字符集的文本进行编码和解码，可以在Go语言中直接添加非ASCII码字符</p><p>字符串是一种值类型，且值不可变；即创建某个文本后你无法再次修改这个文本的内容，即使你改变了，你会发现那已经不是原来的那串字符串了。<br>更深入的讲，字符串是<strong>字节的定长数组</strong>。</p><ol><li><p>Go 支持以下2种形式的字面值</p><ul><li>解释字符串<br>  该类字符串使用双括号 <code>&quot;&quot;</code> 引起来，其中转义字符（<code>\n、\r、 \t、 \\</code>）会被替换。<br>  eg：  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">str1 := <span class="string">&quot;Hello&quot;</span></span><br><span class="line">str2 := <span class="string">&quot;Boii&quot;</span></span><br></pre></td></tr></table></figure></li><li>非解释字符串<br>  该类字符串使用反引号括起来  **``**，支持换行<br>  eg：  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 下面的 \n 会被原样输出</span></span><br><span class="line">str := <span class="string">`This is a</span></span><br><span class="line"><span class="string">raw string \n`</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>**Go 中的字符串是根据长度限定，而非特殊字符 <code>\0</code>**。</p></li><li><p>string 类型的零值：长度为 0 的字符串，即空字符串 <code>&quot;&quot;</code></p></li><li><p>可以通过 <code>len()</code> 函数来获取字符串字符个数</p></li><li><p>字符串中的内容（纯字节）可以通过标准索引法来获取</p> <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    str := <span class="string">&quot;hello Boii&quot;</span></span><br><span class="line">    c1 := str[<span class="number">0</span>]</span><br><span class="line">    c4 := str[<span class="number">4</span>]</span><br><span class="line">    cEnd := str[<span class="built_in">len</span>(str)<span class="number">-1</span>]</span><br><span class="line">    fmt.Println(c1)        <span class="comment">// 104</span></span><br><span class="line">    fmt.Println(c4)        <span class="comment">// 111</span></span><br><span class="line">    fmt.Println(cEnd)      <span class="comment">// 105</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> 输出的是字符的 Ascii 码</p></li><li><p>字符串类型底层实现是一个二元的数据结构，一个是指向字节数组的起点，另一个是长度。<br> eg：</p> <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// runtime/string.go</span></span><br><span class="line"><span class="keyword">type</span> stringStruct <span class="keyword">struct</span> &#123;</span><br><span class="line">    str unsafe.Pointer    <span class="comment">// 指向底层字节数组的指针</span></span><br><span class="line">    <span class="built_in">len</span> <span class="keyword">int</span>               <span class="comment">// 字节数组长度</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>基于字符串创建的切片 和 原字符串 指向相同的 底层字符数组，一样不能修改，<strong>对字符串的切片操作返回的仍然是 string，而非 slice</strong>。</p> <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a := <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">b := a[<span class="number">0</span>:<span class="number">4</span>]</span><br><span class="line">c := a[<span class="number">1</span>:]</span><br><span class="line">fmt.Printf(<span class="string">&quot;b -&gt; %s, b -&gt; type: %T\n&quot;</span>, b, b) <span class="comment">// b -&gt; Hell, b -&gt; type: string</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;c -&gt; %s, c -&gt; type: %T\n&quot;</span>, c, c) <span class="comment">// c -&gt; ello World, c -&gt; type: string</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="字符串常用操作"><a href="#字符串常用操作" class="headerlink" title="字符串常用操作"></a>字符串常用操作</h3><table><thead><tr><th>方法</th><th>描述</th><th>返回值</th></tr></thead><tbody><tr><td>len(str)</td><td>求字符串长度</td><td>int</td></tr><tr><td>+ 或 fmt.Sprintf(“%s %s”, str1, str2)</td><td>拼接字符串</td><td>string</td></tr><tr><td>strings.Split(str, 分隔符)</td><td>分割字符串</td><td>[]string</td></tr><tr><td>strings.Contains(str, 目标内容)</td><td>判断str是否包含目标子串</td><td>bool</td></tr><tr><td>strings.HasPrefix(str, 目标内容)</td><td>判断str是否以目标内容开头</td><td>bool</td></tr><tr><td>strings.HasSuffix(str, 目标内容)</td><td>判断str是否以目标内容结尾</td><td>bool</td></tr><tr><td>strings.Index(str, 目标内容)</td><td>返回str第一次出现目标内容的首个字符的下标</td><td>int</td></tr><tr><td>strings.LastIndex(str, 目标内容)</td><td>返回str最后一次出现目标内容的首个字符的下标</td><td>int</td></tr><tr><td>strings.Join(strArr, 拼接符号)</td><td>返回用拼接符号拼接strArr的字符串</td><td>string</td></tr></tbody></table><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 求字符串长度</span></span><br><span class="line">    str1 := <span class="string">`hello Boii`</span></span><br><span class="line">    fmt.Println(<span class="built_in">len</span>(str1))    <span class="comment">// 10</span></span><br><span class="line">    str2 := <span class="string">&quot;Hello 中国&quot;</span></span><br><span class="line">    fmt.Println(<span class="built_in">len</span>(str2))    <span class="comment">// 12</span></span><br><span class="line"></span><br><span class="line">    fmt.Println()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 拼接字符串</span></span><br><span class="line">    fmt.Println(str1 + str2)  <span class="comment">// hello BoiiHello 中国</span></span><br><span class="line">    str3 := fmt.Sprintf(<span class="string">&quot;%s | %s&quot;</span>, str1, str2)</span><br><span class="line">    fmt.Println(str3)         <span class="comment">// hello Boii | Hello 中国</span></span><br><span class="line"></span><br><span class="line">    fmt.Println()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 字符串分割</span></span><br><span class="line">    str4 := <span class="string">`How do you do`</span></span><br><span class="line">    fmt.Println(strings.Split(str4, <span class="string">&quot; &quot;</span>))         <span class="comment">// [How do you do]</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%T \n&quot;</span>, strings.Split(str4, <span class="string">&quot; &quot;</span>)) <span class="comment">// []string</span></span><br><span class="line"></span><br><span class="line">    fmt.Println()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 判断是否包含</span></span><br><span class="line">    fmt.Println(strings.Contains(str4, <span class="string">&quot;do&quot;</span>))     <span class="comment">// true</span></span><br><span class="line">    <span class="comment">// 判断前缀</span></span><br><span class="line">    fmt.Println(strings.HasPrefix(str4, <span class="string">&quot;How&quot;</span>))   <span class="comment">// true</span></span><br><span class="line">    <span class="comment">// 判断后缀</span></span><br><span class="line">    fmt.Println(strings.HasSuffix(str4, <span class="string">&quot;How&quot;</span>))   <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">    fmt.Println()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 判断子串位置</span></span><br><span class="line">    fmt.Println(strings.Index(str4, <span class="string">&quot;do&quot;</span>))        <span class="comment">// 4</span></span><br><span class="line">    <span class="comment">// 最后子串出现的位置</span></span><br><span class="line">    fmt.Println(strings.LastIndex(str4, <span class="string">&quot;do&quot;</span>))    <span class="comment">// 11</span></span><br><span class="line"></span><br><span class="line">    fmt.Println()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// join</span></span><br><span class="line">    str5 := []<span class="keyword">string</span>&#123;<span class="string">&quot;how&quot;</span>, <span class="string">&quot;do&quot;</span>, <span class="string">&quot;you&quot;</span>, <span class="string">&quot;do&quot;</span>&#125;</span><br><span class="line">    fmt.Println(str5)                            <span class="comment">// [how do you do]</span></span><br><span class="line">    fmt.Println(strings.Join(str5, <span class="string">&quot;-&quot;</span>))         <span class="comment">// how-do-you-do</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="字符"><a href="#字符" class="headerlink" title="字符"></a>字符</h2><p>Go 的字符有以下两种：</p><ol><li>uint8类型，别名 byte，代表一个 ASCII 码字符</li><li>int32类型，别名 rune，代表一个 UTF-8 字符</li></ol><p><strong>注意：字符用单引号( ‘ ‘ )括起来</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> c1 <span class="keyword">byte</span> = <span class="string">&#x27;a&#x27;</span></span><br><span class="line">    <span class="keyword">var</span> c2 <span class="keyword">rune</span> = <span class="string">&#x27;a&#x27;</span></span><br><span class="line">    fmt.Println(c1, c2)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;c1 type: %T, c2 tpye: %T \n&quot;</span>, c1, c2)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ----------------------------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line"><span class="number">97</span> <span class="number">97</span></span><br><span class="line">c1 <span class="keyword">type</span>: <span class="keyword">uint8</span>, c2 tpye: <span class="keyword">int32</span></span><br></pre></td></tr></table></figure><p>在编写代码的时候，使用别名 byte、rune 可以使得代码更加清晰，不过这两个别名在经过编译后还是会还原成 unit8 和 int32。</p><p>当需要处理中文、日文或者中英混杂的字符时，则需要用到 rune 类型，因为 byte 型只有8位，只能显示 ASCII 码，而 rune 型有32位。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">`Hello 中国`</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(s); i++ &#123;</span><br><span class="line">        fmt.Printf(<span class="string">&quot;%v[%c]\t&quot;</span>, s[i], s[i])</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _, char := <span class="keyword">range</span> s &#123;</span><br><span class="line">        fmt.Printf(<span class="string">&quot;%v[%c]\t&quot;</span>, char, char)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ----------------------------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line"><span class="number">72</span>[H]<span class="number">101</span>[e]<span class="number">108</span>[l]<span class="number">108</span>[l]<span class="number">111</span>[o]<span class="number">32</span>[ ]<span class="number">228</span>[ä]<span class="number">184</span>[¸]<span class="number">173</span>[­]<span class="number">229</span>[å]<span class="number">155</span>[]<span class="number">189</span>[½]</span><br><span class="line"><span class="number">72</span>[H]<span class="number">101</span>[e]<span class="number">108</span>[l]<span class="number">108</span>[l]<span class="number">111</span>[o]<span class="number">32</span>[ ]<span class="number">20013</span>[中]<span class="number">22269</span>[国]</span><br></pre></td></tr></table></figure><p>遍历一个中英混杂的字符串后我们会发现，中文一个字占好几个字节。<br>因为 go 中字符串是按照 UTF-8 编码的，而 UTF-8 编码下一个中文汉字由 3~4 个字节组成。<br><strong>len(str) 返回的是字符串的字节数，而不是字符串的个数</strong>，所以第一个循环中会出现乱码的情况。</p><p>第二种方式 <code>for...range</code> 则可以正确的返回字符串中每个字符，因为它是按 rune 类型计算的，所以打印的时候没有乱码。</p><blockquote><ul><li>字符串的底层是一个 byte 数组，所以字符串可以和 <code>[]byte</code> 型互相转换。</li><li>字符串是不能修改的</li><li>字符串是由 byte 字节组成的</li><li>字符串的长度是 byte 字节的长度</li><li>rune 类型用来表示 utf8 字符</li><li>一个字符由一个或多个 byte 组成</li></ul></blockquote><h2 id="修改字符串"><a href="#修改字符串" class="headerlink" title="修改字符串"></a>修改字符串</h2><ol><li>将字符串转换成 <code>[]byte</code> 或 <code>[]rune</code> 类型；例如<code>[]byte(str)</code> 或 <code>[]rune(str)</code></li><li>修改字符串</li><li>转回 <code>string</code></li></ol><blockquote><p>无论哪种转换，都会重新分配内存，并复制字节数组。</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    str1 := <span class="string">&quot;big&quot;</span></span><br><span class="line"></span><br><span class="line">    byteS = []<span class="keyword">byte</span>(str1)    <span class="comment">// 转成[]byte切片</span></span><br><span class="line">    byteS[<span class="number">0</span>] = <span class="string">&#x27;p&#x27;</span>          <span class="comment">// 修改</span></span><br><span class="line">    str1 = <span class="keyword">string</span>(byteS)    <span class="comment">// 转回 string</span></span><br><span class="line">    fmt.Println(str1)</span><br><span class="line"></span><br><span class="line">    str2 = <span class="string">&quot;青菜&quot;</span></span><br><span class="line"></span><br><span class="line">    runeS = []<span class="keyword">rune</span>(str2)    <span class="comment">// 转成[]rune切片</span></span><br><span class="line">    runeS[<span class="number">0</span>] = <span class="string">&#x27;白&#x27;</span>         <span class="comment">// 修改</span></span><br><span class="line">    str2 = <span class="keyword">string</span>(runeS)    <span class="comment">// 转回 string</span></span><br><span class="line">    fme.Println(str2)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ----------------------------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line">pig</span><br><span class="line">白菜</span><br></pre></td></tr></table></figure><h2 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h2><p>Go语言中只有强制类型转换，没有隐式类型转换。该语法只能在两个类型之间支持相互转换的时候使用</p><p>基本语法如下：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Type(expression)</span><br></pre></td></tr></table></figure><p>Type 表示要转的类型，expression 表示变量、复杂算式、函数返回值等</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i <span class="keyword">int</span> = <span class="number">10</span></span><br><span class="line"><span class="keyword">var</span> f <span class="keyword">float32</span> = <span class="keyword">float32</span>(i)</span><br></pre></td></tr></table></figure><p>详见<a href="https://boii.xyz/posts/2c39f343">类型转换</a></p><h2 id="类型大小"><a href="#类型大小" class="headerlink" title="类型大小"></a>类型大小</h2><table><thead><tr><th align="right">类型</th><th align="center">bit数</th></tr></thead><tbody><tr><td align="right">指针</td><td align="center">32位 -&gt; 4bit，64位C -&gt; 8bit</td></tr><tr><td align="right">uintptr</td><td align="center">32位 -&gt; 4bit，64位C -&gt; 8bit</td></tr><tr><td align="right">bool</td><td align="center">8</td></tr><tr><td align="right">byte</td><td align="center">8</td></tr><tr><td align="right">int8</td><td align="center">8</td></tr><tr><td align="right">uint8</td><td align="center">8</td></tr><tr><td align="right">int16</td><td align="center">16</td></tr><tr><td align="right">uint16</td><td align="center">16</td></tr><tr><td align="right">int32</td><td align="center">32</td></tr><tr><td align="right">rune</td><td align="center">32</td></tr><tr><td align="right">uint32</td><td align="center">32</td></tr><tr><td align="right">float32</td><td align="center">32</td></tr><tr><td align="right">int64</td><td align="center">64</td></tr><tr><td align="right">uint64</td><td align="center">64</td></tr><tr><td align="right">float64</td><td align="center">64</td></tr><tr><td align="right">complex64</td><td align="center">64</td></tr><tr><td align="right">complex128</td><td align="center">128</td></tr><tr><td align="right">int</td><td align="center">与CPU位数相同</td></tr><tr><td align="right">uint</td><td align="center">与CPU位数相同</td></tr><tr><td align="right">string</td><td align="center">ASCII范围8bit，中文24bit</td></tr></tbody></table><p>使用 <code>unsafe.Sizeof(v)</code> 可以得到 v 占用内存大小。</p><h2 id="类型别名、自定义类型"><a href="#类型别名、自定义类型" class="headerlink" title="类型别名、自定义类型"></a>类型别名、自定义类型</h2><h3 id="类型别名"><a href="#类型别名" class="headerlink" title="类型别名"></a>类型别名</h3><p>为类型起个别名，方便代码编写过程中使用，</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> alias = T</span><br></pre></td></tr></table></figure><p><code>type</code>：关键字、<code>alias</code>：类型别名、<code>T</code>：类型</p><p>例如数据类型中提到的Unicode字符型 <code>rune</code> 和ASCII字符型 <code>byte</code>就是类型别名</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="keyword">rune</span> = <span class="keyword">int32</span></span><br><span class="line"><span class="keyword">type</span> <span class="keyword">byte</span> = <span class="keyword">uint8</span></span><br></pre></td></tr></table></figure><h3 id="自定义类型"><a href="#自定义类型" class="headerlink" title="自定义类型"></a>自定义类型</h3><p>在 Go 中有一些基本的数据类型，如<code>string</code>、<code>int</code>、<code>bool</code>等数据类型，也可以通过关键字 <code>type</code> 来定义自定义类型</p><p>自定义类型是定义了一个全新的类型，我们可以基于内置基本类型定义，也可以通过 struct 定义。<br>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Status <span class="keyword">bool</span></span><br></pre></td></tr></table></figure><p>通过 <code>type</code> 关键字的定义，<code>Status</code>就是一种新的类型，它具有 <code>bool</code> 的特性</p><h3 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h3><p>从定义上看，类型别名有 <code>=</code> ，自定义类型没有。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">type</span> abc = <span class="keyword">string</span></span><br><span class="line">    <span class="keyword">type</span> Status <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> OK Status</span><br><span class="line">    <span class="keyword">var</span> ss abc</span><br><span class="line"></span><br><span class="line">    fmt.Printf(<span class="string">&quot;Type of OK: %T\n&quot;</span>, OK)  <span class="comment">// Type of OK: main.Status</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;Type of ss: %T\n&quot;</span>, ss)  <span class="comment">// Type of ss: string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>OK 的类型是 main.Status，表示在 main 包下定义的<code>Status</code>类型<br>ss 的类型是 string。<code>abc</code>类型只会在代码中存在，编译前编译器会将其替换回来。</p>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
          <category> Basic </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Golang [基础] 1-基础</title>
      <link href="posts/7b9344b7"/>
      <url>posts/7b9344b7</url>
      
        <content type="html"><![CDATA[<p>基础语法</p><span id="more"></span><h1 id="1-基础"><a href="#1-基础" class="headerlink" title="1-基础"></a>1-基础</h1><h2 id="标识符"><a href="#标识符" class="headerlink" title="标识符"></a>标识符</h2><ul><li>[ _ | A-Z | a-z | 0-9 ]</li><li>不能数字开头</li><li>不能与关键字和保留字冲突</li></ul><h2 id="关键字"><a href="#关键字" class="headerlink" title="关键字"></a>关键字</h2><p>Go 中有25个关键字</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">break</span>        <span class="keyword">default</span>      <span class="function"><span class="keyword">func</span>         <span class="title">interface</span>    <span class="title">select</span></span></span><br><span class="line"><span class="keyword">case</span>         <span class="keyword">defer</span>        <span class="keyword">go</span>           <span class="keyword">map</span>          <span class="keyword">struct</span></span><br><span class="line"><span class="keyword">chan</span>         <span class="keyword">else</span>         <span class="keyword">goto</span>         <span class="keyword">package</span>      <span class="keyword">switch</span></span><br><span class="line"><span class="keyword">const</span>        <span class="keyword">fallthrough</span>  <span class="keyword">if</span>           <span class="keyword">range</span>        <span class="keyword">type</span></span><br><span class="line"><span class="keyword">continue</span>     <span class="keyword">for</span>          <span class="keyword">import</span>       <span class="keyword">return</span>       <span class="keyword">var</span></span><br></pre></td></tr></table></figure><p>37个保留字</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Constants:  <span class="literal">true</span>  <span class="literal">false</span>  <span class="literal">iota</span>  <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">    Types:  <span class="keyword">int</span>  <span class="keyword">int8</span>  <span class="keyword">int16</span>  <span class="keyword">int32</span>  <span class="keyword">int64</span></span><br><span class="line">            <span class="keyword">uint</span>  <span class="keyword">uint8</span>  <span class="keyword">uint16</span>  <span class="keyword">uint32</span>  <span class="keyword">uint64</span>  <span class="keyword">uintptr</span></span><br><span class="line">            <span class="keyword">float32</span>  <span class="keyword">float64</span>  <span class="keyword">complex128</span>  <span class="keyword">complex64</span></span><br><span class="line">            <span class="keyword">bool</span>  <span class="keyword">byte</span>  <span class="keyword">rune</span>  <span class="keyword">string</span>  error</span><br><span class="line"></span><br><span class="line">Functions:  <span class="built_in">make</span>  <span class="built_in">len</span>  <span class="built_in">cap</span>  <span class="built_in">new</span>  <span class="built_in">append</span>  <span class="built_in">copy</span>  <span class="built_in">close</span>  <span class="built_in">delete</span></span><br><span class="line">                <span class="built_in">complex</span>  <span class="built_in">real</span>  <span class="built_in">imag</span></span><br><span class="line">                <span class="built_in">panic</span>  <span class="built_in">recover</span></span><br></pre></td></tr></table></figure><h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><h3 id="声明"><a href="#声明" class="headerlink" title="声明"></a>声明</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> 变量名 变量类型</span><br></pre></td></tr></table></figure><p>变量声明以关键字 <code>var</code> 开头，类型放在后面，无需分号</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name <span class="keyword">string</span></span><br><span class="line"><span class="keyword">var</span> age <span class="keyword">int</span></span><br><span class="line"><span class="keyword">var</span> isEmpty <span class="keyword">bool</span></span><br></pre></td></tr></table></figure><h3 id="批量声明"><a href="#批量声明" class="headerlink" title="批量声明"></a>批量声明</h3><p>每个变量写一个 var 太麻烦，go 支持批量声明</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> (</span><br><span class="line">    name <span class="keyword">string</span></span><br><span class="line">    age <span class="keyword">int</span></span><br><span class="line">    isEmpty <span class="keyword">bool</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> num1, num2, num3 <span class="keyword">int</span></span><br></pre></td></tr></table></figure><h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><blockquote><p>go 声明变量时，会自动对变量对应的内存区域进行初始化，每个变量都会被初始化成默认值。</p></blockquote><p>eg：整型和浮点型变量默认值是 <code>0</code>，字符串变量默认值是 <code>空字符串</code>，布尔类型变量默认值是<code>false</code>，切片、函数、指针变量默认是 <code>nil</code>。</p><p>同时，我们可以在声明变量时为其指定初始值，格式如下：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> 变量名 类型 = 表达式</span><br></pre></td></tr></table></figure><p>eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name <span class="keyword">string</span> = <span class="string">&quot;Boii&quot;</span></span><br><span class="line"><span class="keyword">var</span> age  <span class="keyword">int</span>    = <span class="number">18</span></span><br></pre></td></tr></table></figure><p>或者一次初始化多个变量。eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name, age = <span class="string">&quot;Boii&quot;</span>, <span class="number">18</span></span><br></pre></td></tr></table></figure><blockquote><p>Go 语言具有的这种特性，使得交换两个变量非常方便，可以简单地使用 <code>a, b = b, a</code> 完成交换两个变量的值。</p></blockquote><h3 id="类型推导"><a href="#类型推导" class="headerlink" title="类型推导"></a>类型推导</h3><p>类型推导指的是<strong>没有显示的写明类型，编译器会通过等号右边的值来推导出类型</strong>，然后完成初始化工作。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">&quot;Boii&quot;</span></span><br><span class="line"><span class="keyword">var</span> age = <span class="number">18</span></span><br><span class="line">height := <span class="number">180</span></span><br></pre></td></tr></table></figure><h3 id="交换变量"><a href="#交换变量" class="headerlink" title="交换变量"></a>交换变量</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a, b := <span class="number">10</span>, <span class="number">15</span></span><br><span class="line">a, b = b, a</span><br><span class="line">fmt.Println(a, b)    <span class="comment">// 15 10</span></span><br></pre></td></tr></table></figure><h3 id="短变量声明"><a href="#短变量声明" class="headerlink" title="短变量声明"></a>短变量声明</h3><p>在函数内部，可以用更简略的方式 <code>:=</code> 声明并初始化变量，但这种方式<strong>只能声明局部变量</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> m = <span class="number">100</span>    <span class="comment">// 声明全局变量 m</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    n := <span class="number">10</span>    <span class="comment">// 声明局部变量 n</span></span><br><span class="line">    m := <span class="number">200</span>   <span class="comment">// 声明局部变量 m</span></span><br><span class="line">    fmt.Println(m ,n)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ----------------------------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line"><span class="number">200</span> <span class="number">10</span></span><br></pre></td></tr></table></figure><h3 id="匿名变量"><a href="#匿名变量" class="headerlink" title="匿名变量"></a>匿名变量</h3><p>使用多重赋值时，想要忽略某个值，可以使用 匿名变量，也就是一个下划线 <code>_</code> 表示。eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">foo</span><span class="params">()</span> <span class="params">(<span class="keyword">int</span>, <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">18</span>, <span class="string">&quot;Boii&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    x, _ := foo()</span><br><span class="line">    fmt.Println(<span class="string">&quot;x =&quot;</span>, x)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ----------------------------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line"><span class="number">18</span></span><br></pre></td></tr></table></figure><p>匿名变量不占用命名空间，不会分配内存，所以匿名变量之间不存在重复声明，且匿名变量无法拿来使用，只能用来承接不想要的值。</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ol><li>函数外的每个语句都必须以关键字开始（var、const、func等）</li><li><code>:=</code> 不能在函数外使用</li><li><code>_</code> 多用于占位，表示忽略值</li></ol><h2 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h2><p>常量是程序运行期间不会改变的那些值。<br>变量声明是用 <code>var</code>，常量声明是用 <code>const</code><br><strong>常量在定义的时候必须赋值</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> PI = <span class="number">3.14156</span></span><br><span class="line"><span class="keyword">const</span> E  = <span class="number">2.7182</span></span><br></pre></td></tr></table></figure><p>批量声明</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    PI = <span class="number">3.14156</span></span><br><span class="line">    E  = <span class="number">2.7182</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>批量声明时，如果省略了赋值则表示与上面一行的值相同。eg：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    a = <span class="number">100</span></span><br><span class="line">    b</span><br><span class="line">    c = <span class="number">3.33</span></span><br><span class="line">    d</span><br><span class="line">    e</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>例子中，常量 <code>a</code> 和 <code>b</code> 的值都是 100，<code>c</code>、<code>d</code>、<code>e</code> 的值都是 3.33</p><h3 id="iota"><a href="#iota" class="headerlink" title="iota"></a>iota</h3><p><code>iota</code> 是go语言中的<strong>常量计数器</strong>，只能在常量的表达式中使用。</p><p><code>iota</code> 在const 关键字出现时将被重置为 <strong>0</strong>。<br>const 中每新增一行常量声明，将使 <code>iota +1</code><br>iota 可理解为const 块中的行索引<br>使用iota能简化定义，在枚举时很方便</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    n1 = <span class="literal">iota</span>    <span class="comment">// 0</span></span><br><span class="line">    n2           <span class="comment">// 1</span></span><br><span class="line">    n3           <span class="comment">// 2</span></span><br><span class="line">    n4           <span class="comment">// 3</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(n1, n2, n3, n4)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ----------------------------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span></span><br></pre></td></tr></table></figure><p>还有几个比较经典的例子:</p><ul><li><p>匿名变量插队</p>  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    n1 = <span class="literal">iota</span> <span class="comment">// 0</span></span><br><span class="line">    n2        <span class="comment">// 1</span></span><br><span class="line">    _</span><br><span class="line">    n4        <span class="comment">// 3</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></li><li><p>声明中间插队</p>  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    n1 = <span class="literal">iota</span>    <span class="comment">// 0</span></span><br><span class="line">    n2 = <span class="number">100</span>     <span class="comment">// 100</span></span><br><span class="line">    n3 = <span class="literal">iota</span>    <span class="comment">// 2</span></span><br><span class="line">    n4           <span class="comment">// 3</span></span><br><span class="line">    n5           <span class="comment">// 4</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">const</span> n6 = <span class="literal">iota</span>  <span class="comment">// 0</span></span><br></pre></td></tr></table></figure></li><li><p>定义数量级</p>  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    _  = <span class="literal">iota</span></span><br><span class="line">    KB = <span class="number">1</span> &lt;&lt; (<span class="number">10</span> * <span class="literal">iota</span>)    <span class="comment">// 10*1 == 10</span></span><br><span class="line">    MB = <span class="number">1</span> &lt;&lt; (<span class="number">10</span> * <span class="literal">iota</span>)    <span class="comment">// 10*2 == 20</span></span><br><span class="line">    GB = <span class="number">1</span> &lt;&lt; (<span class="number">10</span> * <span class="literal">iota</span>)    <span class="comment">// 10*3 == 30</span></span><br><span class="line">    TB = <span class="number">1</span> &lt;&lt; (<span class="number">10</span> * <span class="literal">iota</span>)    <span class="comment">// 10*4 == 40</span></span><br><span class="line">    PB = <span class="number">1</span> &lt;&lt; (<span class="number">10</span> * <span class="literal">iota</span>)    <span class="comment">// 10*5 == 50</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></li><li><p>多个 <code>iota</code> 定义在一行</p></li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    a, b = <span class="literal">iota</span> + <span class="number">1</span>, <span class="literal">iota</span> + <span class="number">2</span> <span class="comment">//1,2</span></span><br><span class="line">    c, d                      <span class="comment">//2,3</span></span><br><span class="line">    e, f                      <span class="comment">//3,4</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(a, b, c, d, e, f)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ----------------------------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line"><span class="number">1</span> <span class="number">2</span> <span class="number">2</span> <span class="number">3</span> <span class="number">3</span> <span class="number">4</span></span><br></pre></td></tr></table></figure><ul><li>iota 只有在新起一行才会自增</li><li>iota 只有遇到新的 const 才会重置</li><li>iota 是从 0 开始的。 </li></ul><h2 id="值类型和引用类型"><a href="#值类型和引用类型" class="headerlink" title="值类型和引用类型"></a>值类型和引用类型</h2><p><strong>值类型</strong>：<code>int float bool string 指针</code>，使用这些类型的变量直接指向存在内存中的值，存储在栈中。<br>j = i<br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20201115104832899_3842.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20201115104832899_3842.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt=" j = i "></p><p><strong>引用类型</strong>：<code>slices、maps、channel</code>，被引用的变量会存储在堆中，以便垃圾回收。<br>r1 = r2<br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20201115104853017_32412.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Go/IMG/20201115104853017_32412.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt=" r1 = r2 "></p>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
          <category> Basic </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Golang [基础] 0-总叙</title>
      <link href="posts/913ad9ee"/>
      <url>posts/913ad9ee</url>
      
        <content type="html"><![CDATA[<p>Go 是一门好语言吗？</p><span id="more"></span><h1 id="0-总叙"><a href="#0-总叙" class="headerlink" title="0-总叙"></a>0-总叙</h1><h2 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h2><ul><li>简化问题，易于学习</li><li>内存管理，简洁语法，易于使用</li><li>快速编译，高效开发</li><li>高效执行</li><li>并发支持，轻松驾驭</li><li>静态类型</li><li>标准类库，规范统一</li><li>易于部署</li><li>文档全面</li><li>免费开源</li></ul><h2 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h2><ul><li><strong>GOROOT</strong>：Go的安装位置，默认<code>$HOME/go</code></li><li><strong>GOPATH</strong>：工作目录，在这下面写代码</li><li><strong>GOBIN</strong>：编译器和链接器的安装位置，默认 <code>$GOROOT/bin</code></li><li><strong>GOOS</strong>：运行Go的操作系统；<ul><li>取值：[darwin | freebsd | linux | windows]</li></ul></li><li><strong>GOARCH</strong>：运行Go的处理器架构；<ul><li>取值：[386 | amd64 | arm]</li></ul></li><li><strong>GOARM</strong>：专门针对基于 arm 架构的处理器，默认为 6；<ul><li>取值：[5 | 6]</li></ul></li></ul><h2 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/Hello/main.go</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> main    <span class="comment">// 声明 mian 包，表明当前是一个可执行程序</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span>    <span class="comment">// 导入内置 fmt 包</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;    <span class="comment">// main 函数，程序执行入口</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;Hello World!&quot;</span>)    <span class="comment">// 在终端打印 Hello World！</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><code>package main</code> 定义了包名。必须在源文件中非注释的第一行指明这个文件属于哪个包，如：package main。<br>  package main表示一个可独立执行的程序，<strong>每个 Go 应用程序都包含一个名为 main 的包</strong>。</li><li> <code>import &quot;fmt&quot;</code> 告诉 Go 编译器这个程序需要使用 fmt 包（的函数，或其他元素），fmt 包实现了格式化 IO（输入/输出）的函数。</li><li> <code>func main()</code> 是程序开始执行的函数。main 函数是每一个可执行程序所必须包含的，一般来说都是在启动后第一个执行的函数（如果有 init() 函数则会先执行 init() 函数）。</li><li> <code>fmt.Println(...)</code> 可以将字符串输出到控制台，并在最后自动增加换行字符 \n。使用 fmt.Print(“hello, world\n”) 可以得到相同的结果。</li></ol><ul><li>在 Go 中，左大括号不能单独一行，这会编译不了</li><li>对缩进没有要求，可以用 <code>go fmt 文件名.go</code> 命令将文件格式化</li><li>每个语句独占一行，不需要加分号</li><li>大部分语句只能写在 {} 内， {} 外只能做一些声明变量、函数、结构体的工作。</li><li>变量声明了不使用也是<strong>不允许</strong>的</li></ul><h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><p>在文件目录下，可以运行 <code>go build</code> 命令，编译之后会在目录下生成一个可执行文件 <code>Hello.exe</code>，输入文件名即可以运行。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go build</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./Hello</span></span><br><span class="line"></span><br><span class="line">Hello World!</span><br></pre></td></tr></table></figure><p>如果不在文件目录下，也可以使用 <code>go build 项目名称</code> 命令，编译之后会在所在目录下生成一个可执行文件 <code>Hello.exe</code>。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> ..</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> go build Hello</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./Hello</span></span><br><span class="line"></span><br><span class="line">Hello World!</span><br></pre></td></tr></table></figure><p>也可以使用 -o 参数来指定可执行文件的名字</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go build -o haha.exe</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./haha</span></span><br><span class="line"></span><br><span class="line">Hello World!</span><br></pre></td></tr></table></figure><p>还可以使用 <code>go run 文件名.go</code> 命令来执行，但不会生成可执行文件。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> src/Hello</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> go run main.go</span></span><br><span class="line"></span><br><span class="line">Hello World!</span><br></pre></td></tr></table></figure><h2 id="init-函数"><a href="#init-函数" class="headerlink" title="init 函数"></a>init 函数</h2><p>每个源文件都只能包含一个 init 函数。<br>它不能被人为调用，而是在每个包完成初始化后自动执行，并且执行优先级比 main 函数高。<br>可以将数据检验或修复的工作放在 init函数中，这样程序开始执行之前就会先修复或检验数据，保证程序状态正确性。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Pi <span class="keyword">float64</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Pi = <span class="number">4</span> * math.Atan(<span class="number">1</span>)</span><br><span class="line">    fmt.Println(<span class="string">&quot;init()&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;main()&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go run main.go</span></span><br><span class="line">init()</span><br><span class="line">main()</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
          <category> Basic </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>计算机网络 [0-概述]</title>
      <link href="posts/f56d3ab8"/>
      <url>posts/f56d3ab8</url>
      
        <content type="html"><![CDATA[<p>计算机网络一览~</p><span id="more"></span><h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><h2 id="计算机网络"><a href="#计算机网络" class="headerlink" title="计算机网络"></a>计算机网络</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>计算机网络是<strong>互联</strong>的、<strong>自治</strong>的计算机集合。</p><ul><li>互联：互联互通、</li><li>自治：无主从关系，相互独立。有通信，但不能控制对方</li></ul><h3 id="计算机网络的功能"><a href="#计算机网络的功能" class="headerlink" title="计算机网络的功能"></a>计算机网络的功能</h3><ol><li><strong>数据通信</strong>：数据可以在信道上传输，使得硬件设备可以通信</li><li><strong>资源共享</strong>：硬件、软件、数据的共享</li><li>分布式处理：多台计算机各自承担同一工作任务的不同部分</li><li>提高可靠性：一台主机挂了，另外一台可以顶上。</li><li>负载均衡</li></ol><h3 id="组成"><a href="#组成" class="headerlink" title="组成"></a>组成</h3><h4 id="组成部分"><a href="#组成部分" class="headerlink" title="组成部分"></a>组成部分</h4><p>硬件、软件、协议</p><h4 id="工作方式"><a href="#工作方式" class="headerlink" title="工作方式"></a>工作方式</h4><p>分为边缘部分和核心部分</p><ul><li>边缘部分：各种主机、终端机、服务器等；用于直接使用，分<code>C/S方式</code>和<code>P2P方式</code></li><li>核心部分：各种路由器、集线器等；为边缘部分服务</li></ul><h4 id="功能组成"><a href="#功能组成" class="headerlink" title="功能组成"></a>功能组成</h4><ul><li>通信子网：实现数据通信</li><li>资源子网：实现资源共享/数据处理<br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/408/NET/20210109163200605_13306.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/408/NET/20210109163200605_13306.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></li></ul><h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><ol><li>按分布范围分：<ol><li>广域网 WAN - 使用交换技术</li><li>城域网 MAN</li><li>局域网 LAN - 广播技术</li><li>个人区域网 PAN</li></ol></li><li>按使用者分<ol><li>公用网 - 中国电信、移动、联通</li><li>专用网 - 军队、政府、银行等使用的专用网络，需要一定权限</li></ol></li><li>按交换技术分<ol><li>电路交换</li><li>报文交换</li><li>分组交换</li></ol></li><li>按拓扑结构分<ol><li>总线型</li><li>星型</li><li>环形</li><li>网状型 - 常用于广域网</li></ol></li><li>按传输技术分<ol><li>广播式网络 - 共享公共通信信道</li><li>点对点网络 - 使用<strong>分组存储转发</strong>和<strong>路由选择</strong>机制</li></ol></li></ol><h2 id="标准化工作"><a href="#标准化工作" class="headerlink" title="标准化工作"></a>标准化工作</h2><h3 id="分类-1"><a href="#分类-1" class="headerlink" title="分类"></a>分类</h3><ul><li>法定标准：由权威机构制定的正式的、合法的标准，如OSI</li><li>事实标准：某些公司的产品在竞争中占据主流，时间长了，这些产品中的协议和技术就成了标准，如 TCP/IP</li></ul><h3 id="RFC"><a href="#RFC" class="headerlink" title="RFC"></a>RFC</h3><p>RFC (Request For Comments) —— 互联网标准的形式</p><p>RFC要上升为互联网正式标准的四个阶段：</p><ol><li>互联网草案 (Internet Draft) : 这个阶段还不是RFC文档</li><li>建议标准 (Proposed Standard) : 被收录后就进入这个阶段，成为RFC文档，然后进一步完善成为草案标准</li><li>草案标准 (Draft Standard) : 完善以后就形成一个草案标准，交由IETF、IAB 审核</li><li>互联网标准 (Internet Standard) : 通过审核以后就正式成为互联网标准。</li></ol><blockquote><p>2013年后取消了草案标准这一阶段，被收录为RFC文档完善审核通过后直接成为互联网标准。</p></blockquote><h3 id="相关组织"><a href="#相关组织" class="headerlink" title="相关组织"></a>相关组织</h3><table><thead><tr><th></th><th>主要贡献</th></tr></thead><tbody><tr><td><strong>ISO</strong> 国际标准化组织</td><td>OSI 参考模型、HDLC协议</td></tr><tr><td><strong>ITU</strong> 国际电信联盟</td><td>指定通信规则</td></tr><tr><td><strong>IEEE</strong> 国际电气电子工程师协会</td><td>学术论文、IEEE802系列标准、5G</td></tr><tr><td><strong>IETF</strong> Internet工程任务组</td><td>负责互联网标准制定</td></tr></tbody></table><h2 id="性能指标"><a href="#性能指标" class="headerlink" title="性能指标"></a>性能指标</h2><h3 id="速率"><a href="#速率" class="headerlink" title="速率"></a>速率</h3><p>又称 数据率 或 数据传输率 或 比特率（比特，即 1/0 ，又称“位”）<br>指连接在计算机网络上的主机在数字信道上传送数据位数的速度。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/408/NET/20210109170709637_8154.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/408/NET/20210109170709637_8154.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>单位是 b/s、kb/s、Mb/s、Gb/s、TB/s</p><table><thead><tr><th></th><th align="right">速率</th><th>存储容量（1Byte=8bit）</th></tr></thead><tbody><tr><td>千</td><td align="right">$1kb/s = 10^3b/s$</td><td>$1KB=2^{10}B=1024B=1024\times8b$</td></tr><tr><td>兆</td><td align="right">$1Mb/s = 10^3kb/s = 10^6b/s$</td><td>$1MB=2^{10}KB=1024KB$</td></tr><tr><td>吉</td><td align="right">$1Gb/s = 10^3Mb/s = 10^6kb/s=10^9b/s$</td><td>$1GB=2^{10}MB=1024MB$</td></tr><tr><td>太</td><td align="right">$1Tb/s=10^3Gb/s=10^6Mb/s=10^9kb/s=10^{12}b/s$</td><td>$1TB=2^{10}GB=1024GB$</td></tr></tbody></table><h3 id="带宽（车道数）"><a href="#带宽（车道数）" class="headerlink" title="带宽（车道数）"></a>带宽（车道数）</h3><blockquote><p>计算机网络中，带宽表示网络通信线路传送数据的能力，通常指单位时间内从网络中某一点到另一点所能通过的“最高数据率”，即网络设备所支持的最高速度</p></blockquote><p>带宽用来表示网络的通信线路传送数据的能力，通常指单位时间内从网络中的一端到另一端所能通过的“最高数据率”。<br>单位是 b/s、kb/s、Mb/s、Gb/s、Tb/s<br>换言之，就是<strong>一秒内我这个设备能传输到信道上的最多的比特数</strong>。</p><h3 id="吞吐量（车流量）"><a href="#吞吐量（车流量）" class="headerlink" title="吞吐量（车流量）"></a>吞吐量（车流量）</h3><blockquote><p>单位时间内通过某个网络（或信道、接口）的数据量。即实际接收到的数据量。</p></blockquote><p>单位是 b/s、kb/s、Mb/s、Gb/s、TB/s</p><p>带宽是理想，吞吐量是现实。</p><p>带宽指的是最大的发送或接收能力，吞吐量是实际的发送或接收的量。</p><h3 id="时延"><a href="#时延" class="headerlink" title="时延"></a>时延</h3><blockquote><p>指数据从网络的一段传送到另一端所需的时间。也叫延迟、迟延。单位是 s。</p></blockquote><p>时延包括 4 大类：</p><ol><li><p><strong>发送时延</strong>（传输时延）：一堆数据从开始推送到信道上那一刻起，到全部推完，这个动作持续的时间。</p><p> $发送时延 = \frac {数据长度} {信道带宽(发送速率)}$</p></li><li><p><strong>传播时延</strong>：一堆数据在数据链路上跑到目的地的用时。取决于电磁波传播速度($2\times10^8m/s$)和链路长度</p><p> $传播时延 = \frac {链路长度} {电磁波传播速度}$</p></li><li><p><strong>排队时延</strong>：数据在经过路由器、交换机等设备时不一定能马上处理，需要等待；排队时延指等待输入/输出链路可用这段时间。</p><p> 排队时延包括<code>等待输入链路时的排队</code>和<code>等待输出链路时的排队</code>。</p></li><li><p><strong>处理时延</strong>：指排队排到了以后，路由器/交换机等设备对数据进行检错、分析的这段时间。</p></li></ol><blockquote><p>时延 = 发送时延 + 传播时延 + 排队时延 + 处理时延</p></blockquote><blockquote><p>举个例子：从 A 城拉一车水果到 B 城。</p><p>发送时延 = 把水果装到车上的时间</p><p>传播时延 = 把车从 A 城开到 B 城花费的时间</p><p>排队时延 = 车在路上经过安检，在排队等待安检的这段时间</p><p>处理时延 = 被安检这个过程花费的时间</p></blockquote><h3 id="时延带宽积"><a href="#时延带宽积" class="headerlink" title="时延带宽积"></a>时延带宽积</h3><blockquote><p>时延带宽积 bit = 传播时延 s $\times$ 带宽 bit/s</p><p>时延带宽积又称 <strong>以比特为单位的链路长度</strong>，即某段链路中现在有多少比特。</p></blockquote><p>带宽是最大发送速率，也就是货物装车最快能装多快。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/408/NET/20210716135740.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/408/NET/20210716135740.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h3 id="往返时间RTT"><a href="#往返时间RTT" class="headerlink" title="往返时间RTT"></a>往返时间RTT</h3><blockquote><p>RTT 指从发送法发送数据开始，到发送方收到接收方的确认（接收方收到数据后立即发送确认）总共经历的时延。</p></blockquote><p>RTT 越大，在收到确认之前，可以发送的数据越多。</p><p>RTT 包括 <code>往返传播时延</code> = 传播时延$\times$2 + <code>末端处理时间</code></p><p>RTT 只管信道上的时延，不管主机上的发送时延。</p><h3 id="利用率"><a href="#利用率" class="headerlink" title="利用率"></a>利用率</h3><p>利用率包括<code>信道利用率</code> 和 <code>网络利用率</code>。</p><p>$信道利用率 = \frac {有数据通过时间} {(有+无)数据通过时间}$</p><p>网络利用率 = 信道利用率加权平均值</p><h2 id="分层"><a href="#分层" class="headerlink" title="分层"></a>分层</h2><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/408/NET/20210716144426.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/408/NET/20210716144426.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><ul><li>实体：第 n 层还中的活动元素称为 n 层实体。同一层的实体叫对等实体。</li><li>协议：为进行网络中的对等实体数据交换而建立的规则、标准或约定，称为网络协议。[水平]<ul><li>语法：规定传输数据的格式</li><li>语义：规定所要完成的功能</li><li>同步：规定各种操作的顺序</li></ul></li><li>接口(访问服务点，SAP)：上层使用下层服务的入口。</li><li>服务：下层为相邻上层提供的功能调用。[垂直]</li></ul><blockquote><p>PDU = PCI + SDU</p><p>数据包 = 上层数据 + 本层协议头</p></blockquote><ul><li><p>SDU, Service Data Unit，服务数据单元：为完成用户所要求的功能而应传送的数据。</p></li><li><p>PCI, Protocols Control Infomation，协议控制信息：控制协议操作的信息。</p></li><li><p>PDU, Protocols Data Unit，协议数据单元：对等层次之间传送的数据单位。</p></li></ul><p>分层的基本原则</p><ol><li>各层之间相互<strong>独立</strong>，每层只实现一种相对独立的功能。</li><li>每层之间<strong>界面自然清晰</strong>，易于理解，相互交流尽可能少。</li><li>结构上可分隔开，每层都采用<strong>最合适的技术</strong>来实现。</li><li>保持<strong>下层</strong>对<strong>上层</strong>的独立性，上层单向使用下层提供的服务。</li><li>整个分层结构应该能促进标准化工作。</li></ol><blockquote><p>网络体系结构是从<strong>功能</strong>上描述计算机网络结构。</p><p>计算机网络体系结构，简称网络体系结构，是分层结构。</p><p>每层遵循某个/某些<strong>网络协议</strong>以完成本层功能。</p><p>计算机网络体系结构是计算机网络的<strong>各层及其协议的集合</strong>。</p><p>第 n 层在向 n+1 层提供服务时，此服务不仅包含第 n 层本身的功能，还包含由下层服务提供的功能。</p><p>仅仅在<strong>相邻层间有接口</strong>，且所提供服务的具体实现细节对上一层完全屏蔽。</p><p>体系结构是<strong>抽象</strong>的，而实现是指能运行的一些软件和硬件。</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/408/NET/20210716183548.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/408/NET/20210716183548.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h3 id="OSI-网络模型"><a href="#OSI-网络模型" class="headerlink" title="OSI 网络模型"></a>OSI 网络模型</h3><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/408/NET/7%E5%B1%82_20210716175720.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/408/NET/7%E5%B1%82_20210716175720.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>法定标准：7 层 OSI 参考模型</p><p>事实标准：4 层 TCP/IP 参考模型</p><p>上面 4 层是<strong>端到端</strong>的通信，下面 3 层是<strong>点到点</strong>的通信。</p><ul><li><p><strong>应用层</strong>：所有能和用户交互产生网络流量的程序。典型应用层服务：</p><ul><li>文件传输 FTP</li><li>电子邮件 SMTP</li><li>万维网 HTTP</li></ul></li><li><p><strong>表示层</strong>：用于处理在两个通信系统中交换信息的表示方式（语法和语义）</p><ul><li>功能一：数据格式交换</li><li>功能二：数据加密解密</li><li>功能三：数据压缩和恢复</li></ul></li><li><p><strong>会话层</strong>：向表示层实体/用户进程提供<strong>建立连接</strong>并在连接上<strong>有序</strong>地<strong>传输</strong>数据。这是会话，也是建立同步（SYN）</p><ul><li>功能一：建立、管理、终止会话</li><li>功能二：使用校验点可使会话在通信失效时从<strong>校验点/同步点</strong>继续恢复通信，实现数据同步。适用于传输大文件。</li><li>主要协议：ADSP、ASP</li></ul></li><li><p><strong>传输层</strong>：负责主机中两个进程的通信，即端到端的通信。传输单位是<code>报文段</code>或<code>用户数据报</code>。</p><ul><li>功能一：可靠传输 TCP、不可靠传输 UDP</li><li>功能二：差错控制</li><li>功能三：流量控制（协调发送端和接收端的速度问题）</li><li>功能四：复用分用<ul><li>复用：多个应用层进程可同时使用下面运输层的服务。</li><li>分用：运输层把收到的信息分别交付给上面应用层中相应的进程。</li></ul></li><li>主要协议：TCP、UDP</li></ul></li><li><p><strong>网络层</strong>：主要任务是把分组从源端传到目的端，为分组交换网上的不同主机提供通信服务。传输单位是<code>数据报</code>。</p><ul><li>数据报和分组的关系是：数据报过长的时候就可以切成很多个分组。</li><li>功能一：路由选择（选择最佳路径）</li><li>功能二：差错控制</li><li>功能三：流量控制（协调发送端和接收端的速度问题）</li><li>功能四：拥塞控制。若所有结点都来不及接收分组，而要丢弃大量分组的话，网络就处于拥塞状态。因此要进行拥塞控制。</li><li>主要协议：IP、IPX、ICMP、IGMP、ARP、RARP、OSPF。</li></ul></li><li><p><strong>数据链路层</strong>：主要任务是把网络层传下来的数据报<strong>组装成帧</strong>。传输单位是<code>帧</code>。</p><ul><li>功能一：成帧（定义帧的开始和结束）</li><li>功能二：差错控制，包括<code>帧错</code>和<code>位错</code></li><li>功能三：流量控制</li><li>功能四：访问（接入）控制，控制对信道的访问</li><li>主要协议：SDLC、HDLC、PPP、STP</li></ul></li><li><p><strong>物理层</strong>：主要任务是在<strong>物理媒体上</strong>实现比特流的<strong>透明传输</strong>。</p><ul><li>透明传输：指不管所传数据是什么样的比特组合，都应当能够在链路上传送。</li><li>功能一：定义接口特性，如接头有多少引脚、使用多少跟线、电压所少…</li><li>功能二：定义传输模式<ul><li>单工：只能发送或只能接收</li><li>半双工：可以发送或接收，但同一时刻只可以一方在发送或接收</li><li>全双工：可以在发送的同时也在接收</li></ul></li><li>功能三：定义传输速率</li><li>功能四：比特同步</li><li>功能五：比特编码</li><li>主要协议：Rj45、IEEE 802.3</li></ul></li></ul><table><thead><tr><th></th><th>主要任务</th><th>传输单位</th><th>主要协议</th></tr></thead><tbody><tr><td>应用层</td><td>处理用户交互产生的数据</td><td>APDU</td><td>HTTP、FTP、DNS</td></tr><tr><td>表示层</td><td>处理在两个通信系统中交换信息的表示方式</td><td>PPDU</td><td>JPEG、ASCII</td></tr><tr><td>会话层</td><td>建立连接，并在连接上有序地传输数据</td><td>SPDU</td><td>ADSP、ASP</td></tr><tr><td>传输层</td><td>负责主机中两个进程的通信</td><td>报文段/用户数据报</td><td>TCP、UDP</td></tr><tr><td>网络层</td><td>源主机到目的主机的数据分组路由与转发</td><td>数据报</td><td>IP、IPX、ICMP、IGMP、ARP、RARP、OSPF</td></tr><tr><td>数据链路层</td><td>把网络层传下来的数据报组装成帧</td><td>帧</td><td>SDLC、HDLC、PPP、STP</td></tr><tr><td>物理层</td><td>比特传输</td><td>比特</td><td>Rj45、IEEE 802.3</td></tr></tbody></table><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/408/NET/TCP/IP.gif" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/408/NET/TCP/IP.gif" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h3 id="TCP-IP-网络模型"><a href="#TCP-IP-网络模型" class="headerlink" title="TCP/IP 网络模型"></a>TCP/IP 网络模型</h3><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/408/NET/4%E5%B1%82_20210716183806.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/408/NET/4%E5%B1%82_20210716183806.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><table><thead><tr><th></th><th>OSI 模型</th><th>TCP/IP 模型</th></tr></thead><tbody><tr><td>网络层</td><td>无连接+面向连接</td><td>无连接</td></tr><tr><td>传输层</td><td>面向链接</td><td>无连接+面向连接</td></tr></tbody></table><p>面向连接：喂你吃东西之前问你要不要吃，然后给你吃。</p><p>无连接：直接塞你嘴里。</p><p>面向连接分三个阶段：</p><ol><li><strong>建立连接</strong>：再此阶段发出一个建立连接的请求；</li><li><strong>数据传输</strong>：只有在连接成功建立之后，才能开始数据传输；</li><li><strong>释放连接</strong>：数据传输完成后，释放连接。</li></ol><p>无连接：直接进行数据传输。</p><h3 id="5层参考模型"><a href="#5层参考模型" class="headerlink" title="5层参考模型"></a>5层参考模型</h3><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/408/NET/5%E5%B1%82_20210716214222.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/408/NET/5%E5%B1%82_20210716214222.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h3 id="数据封装与解封装"><a href="#数据封装与解封装" class="headerlink" title="数据封装与解封装"></a>数据封装与解封装</h3><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/408/NET/20210716213207.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/408/NET/20210716213207.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p>]]></content>
      
      
      <categories>
          
          <category> 408 </category>
          
          <category> NET </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 七层模型 </tag>
            
            <tag> OSI 模型 </tag>
            
            <tag> 计算机网络 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OneTiny 开发日记-2021-6-29</title>
      <link href="posts/41947"/>
      <url>posts/41947</url>
      
        <content type="html"><![CDATA[<p>新增访问层级限制</p><span id="more"></span><p>更新功能没写成，还是没想好怎么处理整个流程。</p><p>摆在面前有两个问题：</p><ol><li>下载下来的新版本（可执行文件）放在哪</li><li>如何关闭自己然后启动新版本</li></ol><p>所以暂时搁置，转头去实现访问层级限制功能。</p><h2 id="使用中间件"><a href="#使用中间件" class="headerlink" title="使用中间件"></a>使用中间件</h2><p>这次把中间件用上了，还把之前对浏览器的默认行为：请求 favicon.ico 进行拦截的部分放在单独的中间件里，并且应用到全局。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Start 函数负责启动 gin 实例，开始提供 HTTP 服务</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Start</span><span class="params">()</span></span> &#123;</span><br><span class="line">    gin.SetMode(gin.ReleaseMode)</span><br><span class="line">    r := gin.New()</span><br><span class="line">    r.Use(gin.LoggerWithWriter(config.Output),gin.Recovery())</span><br><span class="line">    <span class="comment">// 中间件</span></span><br><span class="line">    r.Use(middleware.InterceptICO)</span><br><span class="line">    r.Use(middleware.CheckLevel)</span><br><span class="line"></span><br><span class="line">    r.NoRoute(controller.NotFound)</span><br><span class="line">    r.GET(<span class="string">&quot;/*filename&quot;</span>, controller.Handler)</span><br><span class="line">    r.POST(<span class="string">&quot;/upload&quot;</span>, controller.Upload)</span><br><span class="line"></span><br><span class="line">    printInfo()</span><br><span class="line"></span><br><span class="line">    err := r.Run(<span class="string">&quot;:&quot;</span> + config.Port)</span><br><span class="line">    <span class="keyword">if</span> _, ok := err.(*net.OpError); ok &#123;</span><br><span class="line">        log.Fatal(color.RedString(<span class="string">&quot;指定的 %s 端口已被占用，请换一个端口号。&quot;</span>, config.Port))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>拦截浏览器默认请求行为的中间件：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> middleware</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;net/http&quot;</span></span><br><span class="line">    <span class="string">&quot;strings&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// InterceptICO 拦截浏览器默认请求 favicon.ico 的行为</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InterceptICO</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> strings.HasSuffix(c.Param(<span class="string">&quot;filename&quot;</span>), <span class="string">&quot;.ico&quot;</span>) &#123;</span><br><span class="line">        c.Status(http.StatusOK)</span><br><span class="line">        c.Abort()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>gin 的封装真的让 web 开发变得很方便，中间件也让代码更加清晰，耦合度降低。Nice！</p><h2 id="新增参数-x"><a href="#新增参数-x" class="headerlink" title="新增参数 -x"></a>新增参数 -x</h2><p>这次新增一个访问层级限制的功能，使用参数 <code>-x</code> 或者 <code>--max</code> 可以指定。</p><p>例如：</p><p>用户指定共享目录为：<code>/a/b</code> , 最大层级为 2，则访问者最深可以访问到 <code>/a/b/c/d</code> 、<code>/a/b/c/d/file</code> 。</p><div class='checkbox green checked'><input type="checkbox" checked="checked"/>            <p><code>/a/b</code></p>            </div><div class='checkbox green checked'><input type="checkbox" checked="checked"/>            <p><code>/a/b/file</code></p>            </div><div class='checkbox green checked'><input type="checkbox" checked="checked"/>            <p><code>/a/b/c</code></p>            </div><div class='checkbox green checked'><input type="checkbox" checked="checked"/>            <p><code>/a/b/c/file</code></p>            </div><div class='checkbox green checked'><input type="checkbox" checked="checked"/>            <p><code>/a/b/c/d</code></p>            </div><div class='checkbox green checked'><input type="checkbox" checked="checked"/>            <p><code>/a/b/c/d/file</code></p>            </div><div class='checkbox times red checked'><input type="checkbox" checked="checked"/>            <p><code>/a/b/c/d/e</code></p>            </div><div class='checkbox times red checked'><input type="checkbox" checked="checked"/>            <p><code>/a/b/c/d/e/file</code></p>            </div><p>其实这个功能有点鸡肋，真实场景下限制访问层级可能不常用，只有一个场景会很常见。</p><p>即：共享者只是想开放共享目录那一层给人访问，你可以看到这一层有什么子目录和文件，你可以下载这一层的所有文件，但不能深入访问子目录。</p><p>所以我把参数的默认值设置为 0。即只能访问共享目录那一层，如果要开放子目录给人访问，就自己设置 <code>-x</code> 参数。</p><p>最核心的就是这个函数：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 检查当前访问的路径是否超过限定层级</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isOverLevel</span><span class="params">(relPath <span class="keyword">string</span>, isFile <span class="keyword">bool</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    rel, _ := filepath.Rel(config.RootPath, filepath.Join(config.RootPath, relPath))</span><br><span class="line">    i := strings.Split(rel, config.SEPARATORS)</span><br><span class="line">    level := <span class="built_in">len</span>(i)</span><br><span class="line">    <span class="keyword">if</span> i[<span class="number">0</span>] == <span class="string">&quot;.&quot;</span> &#123;</span><br><span class="line">        level = <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> isFile &#123;</span><br><span class="line">        level--</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> level &gt; <span class="keyword">int</span>(config.MaxLevel)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过 <code>filepath.Rel</code> 把当前访问路径切出来，按照路径分隔符 <code>config.SEPARATORS</code> 切割，判断切割出来的个数是否超过设定的最大访问层级。</p><p>如果访问的是共享目录，<code>filepath.Rel</code> 会返回一个单元素切片 <code>[&quot;.&quot;]</code>，应该把 level 修正为 0 。<br>如果访问的是文件，会超出 1 级，应该把 level 自减 1 。</p><p>例如 <code>filepath.Rel(&quot;/a/b&quot;, &quot;/a/b/c/file&quot;)</code> 会得到 <code>/c/file</code>，切割得到切片为 <code>[&quot;c&quot; &quot;file&quot;]</code>，level 为 2 。但这个 file 实际上是 c 目录下的一个文件，应该是与 c 同一层级 1，所以做一次自减来修正。</p><h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>今晚想了想，这好像是个 FTP 工具，却用 HTTP 来实现，总感觉怪怪的。有时间研究研究 FTP 协议，看看能不能用 FTP 协议实现吧。</p>]]></content>
      
      
      <categories>
          
          <category> Other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OneTiny </tag>
            
            <tag> FTP </tag>
            
            <tag> 局域网 </tag>
            
            <tag> gin </tag>
            
            <tag> 独立开发 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OneTiny 开发日记-2021-6-25</title>
      <link href="posts/42715"/>
      <url>posts/42715</url>
      
        <content type="html"><![CDATA[<p>第一次修改别人的东西哈哈</p><span id="more"></span><p>今天开始给 OneTiny 增加更新的功能，本来想做一个跟 oh-my-zsh 一样的效果，就是会突然跳出来问你是不是要更新，是的话就给你下载最新版然后重启一下终端。</p><p>但是写着写着渐渐面临一个问题，下载后放哪？如果是类 Unix 系统怎么把文件放到 /usr/bin 目录下？放完怎么让他自己启动？</p><p>慢慢的又修改思路，换成不自动检查更新或隔一段时间检查，通过 <code>onetiny update</code> 命令可以主动更新。</p><p>在写的时候新引入了两个库，一个时负责下载时显示进度的 <a href="https://github.com/schollz/progressbar">progressbar</a>，一个是解析命令参数的 <a href="https://github.com/integrii/flaggy">flaggy</a>。</p><table><thead><tr><th><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/schollz/progressbar"><img src="https://github-readme-stats.vercel.app/api/pin/?username=schollz&repo=progressbar&theme=algolia&show_owner=true" class="lazyload" data-srcset="https://github-readme-stats.vercel.app/api/pin/?username=schollz&repo=progressbar&theme=algolia&show_owner=true" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="/></a></th><th><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/integrii/flaggy"><img src="https://github-readme-stats.vercel.app/api/pin/?username=integrii&repo=flaggy&theme=algolia&show_owner=true" class="lazyload" data-srcset="https://github-readme-stats.vercel.app/api/pin/?username=integrii&repo=flaggy&theme=algolia&show_owner=true" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="/></a></th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><h2 id="修改-progressbar-库"><a href="#修改-progressbar-库" class="headerlink" title="修改 progressbar 库"></a>修改 progressbar 库</h2><ul><li>修改内容：修复了多了很多空行的情况</li></ul><p>在使用 <a href="https://github.com/schollz/progressbar">progressbar</a> 时，跑了官方给出的示例但是没得到官方的效果。</p><p>官网给出的例子：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    bar := progressbar.Default(<span class="number">100</span>)</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">100</span>; i++ &#123;</span><br><span class="line">        bar.Add(<span class="number">1</span>)</span><br><span class="line">        time.Sleep(<span class="number">40</span> * time.Millisecond)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>官方演示的效果：<br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/devlog/20210625142209.gif" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/devlog/20210625142209.gif" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="><br>实际跑出来的效果：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go run main.go</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">100%</span><span class="bash"> |█████████████████████████████████████| (100/100, 25bit/s)</span> </span><br></pre></td></tr></table></figure><p>有很多的空行。<br>应用到 OneTiny 里也是一样，官方并没有给出太多答案。<br>不过进度条的核心就在于 <code>\r</code> 字符串，于是顺着代码一步步找下去，最后在库的源文件 <code>progressbar.go</code> 中找到了一个函数 <code>clearProgressBar()</code>:</p><details cyan><summary> 点击查看 `clearProgressBar()` </summary>              <div class='content'>              <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">clearProgressBar</span><span class="params">(c config, s state)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> c.useANSICodes &#123;</span><br><span class="line">        <span class="comment">// write the &quot;clear current line&quot; ANSI escape sequence</span></span><br><span class="line">        <span class="keyword">return</span> writeString(c, <span class="string">&quot;\033[2K\r&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// fill the empty content</span></span><br><span class="line">    <span class="comment">// to overwrite the progress bar and jump</span></span><br><span class="line">    <span class="comment">// back to the beginning of the line</span></span><br><span class="line">    str := fmt.Sprintf(<span class="string">&quot;\r%s\r&quot;</span>, strings.Repeat(<span class="string">&quot; &quot;</span>, s.maxLineWidth))</span><br><span class="line">    <span class="keyword">return</span> writeString(c, str)</span><br><span class="line">    <span class="comment">// the following does not show correctly if the previous line is longer than subsequent line</span></span><br><span class="line">    <span class="comment">// return writeString(c, &quot;\r&quot;)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>              </div>            </details><p>看到最下面的注释，虽然我不知道上面 return 了下，但是最后一句注释让我觉得有戏。<br>于是我把上面的 return 注释掉，取消了最后一行 return 的注释。</p><details cyan><summary> 点击查看修改后的 `clearProgressBar()` </summary>              <div class='content'>              <figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">func clearProgressBar(c config, s state) error &#123;</span><br><span class="line">    if c.useANSICodes &#123;</span><br><span class="line">        // write the &quot;clear current line&quot; ANSI escape sequence</span><br><span class="line">        return writeString(c, &quot;\033[2K\r&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">    // fill the empty content</span><br><span class="line">    // to overwrite the progress bar and jump</span><br><span class="line">    // back to the beginning of the line</span><br><span class="line"><span class="deletion">-   str := fmt.Sprintf(&quot;\r%s\r&quot;, strings.Repeat(&quot; &quot;, s.maxLineWidth))</span></span><br><span class="line"><span class="deletion">-   return writeString(c, str)</span></span><br><span class="line">    // the following does not show correctly if the previous line is longer than subsequent line</span><br><span class="line"><span class="addition">+   return writeString(c, &quot;\r&quot;)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>              </div>            </details><p>结果居然正常了…正常了…常了…了…</p><p>好吧没时间管那么多，提交了个 <a href="https://github.com/schollz/progressbar/issues/102">issue</a> 给官方就走了。</p><h2 id="修改-flaggy-库"><a href="#修改-flaggy-库" class="headerlink" title="修改 flaggy 库"></a>修改 flaggy 库</h2><ul><li>修改点：增加了修改 <code>--help</code> 和 <code>--version</code> 的描述信息的接口，增加了打印版本信息的简写 <code>-v</code></li></ul><p>之前使用的是 <code>flag</code> 包解析命令行参数，但这包对子命令不友好。</p><h3 id="增加修改-SetHelpFlagDescription-和-SetVersionFlagDescription"><a href="#增加修改-SetHelpFlagDescription-和-SetVersionFlagDescription" class="headerlink" title="增加修改 SetHelpFlagDescription 和 SetVersionFlagDescription"></a>增加修改 SetHelpFlagDescription 和 SetVersionFlagDescription</h3><p>我准备把原本的命令改成：</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">  tiny</span><br><span class="line">  ├── -a --allow     指定是否允许访问者上传。</span><br><span class="line">  ├── -r --road      指定对外开放的目录的绝对路径。 (default: /home/boii/...)</span><br><span class="line">  ├── -p --port      指定开放的端口 (default: 9090)</span><br><span class="line">  ├── -h --help      打印帮助信息。</span><br><span class="line"><span class="addition">+ ├── -v --version   打印版本信息。当前版本: v0.2.1</span></span><br><span class="line"><span class="addition">+ └── update         更新到最新版本</span></span><br><span class="line"><span class="addition">+     └── -l --list       列出当前最新版本和更新内容</span></span><br></pre></td></tr></table></figure><p>增加了打印版本信息、update 子命令； update 子命令不带参数时执行更新。</p><p>用 flag 包太麻烦了，找了一会儿 github 之后终于找到一个比较适合的库 <a href="https://github.com/integrii/flaggy">flaggy</a>。使用方式和 flag 大体相似，支持子命令等更丰富的功能。</p><p>但是在打印 help 信息时，它把 <code>--help</code> 和 <code>--version</code> 的描述写死了，还不提供接口给人修改。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">tiny - 一个用于局域网内共享文件的FTP程序。</span><br><span class="line"></span><br><span class="line">  Usage:</span><br><span class="line">    tiny [update]</span><br><span class="line"></span><br><span class="line">  Subcommands: </span><br><span class="line">    update (u)   update 可以帮你进行版本升级</span><br><span class="line"></span><br><span class="line">  Flags: </span><br><span class="line">       --version   Displays the program version string.</span><br><span class="line">    -h --help      Displays help with available flag, subcommand, and positional value parameters.</span><br><span class="line">    -r --road      指定对外开放的目录的绝对路径。 (default: /home/boii/...)</span><br><span class="line">    -p --port      指定开放的端口 (default: 9090)</span><br><span class="line">    -a --allow     指定是否允许访问者上传。</span><br></pre></td></tr></table></figure><p>中英混杂，看着就别扭。</p><p>文档中给出的示例也只有一点点，让我猜了好久最后找到了。</p><details cyan><summary> 点击查看修改步骤 </summary>              <div class='content'>              <div class="tabs" id="tab-id"><ul class="nav-tabs"><li class="tab active"><a class="#tab-id-1">步骤1</a></li><li class="tab"><a class="#tab-id-2">步骤2</a></li><li class="tab"><a class="#tab-id-3">步骤3</a></li><li class="tab"><a class="#tab-id-4">最后</a></li><li class="tab"><a class="#tab-id-5">使用</a></li></ul><div class="tab-content"><div class="tab-pane active" id="tab-id-1"><p>在 <code>main.go</code> 中增加两个函数，开发者可以通过这两个函数修改默认的描述信息：</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">  // SetName sets the name of the default package command parser</span><br><span class="line">  func SetName(name string) &#123;</span><br><span class="line">      DefaultParser.Name = name</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="addition">+ // SetHelpFlagDescription sets the help flag description of the default package command parser</span></span><br><span class="line"><span class="addition">+ func SetHelpFlagDescription(description string) &#123;</span></span><br><span class="line"><span class="addition">+ DefaultParser.HelpFlagDescription = description</span></span><br><span class="line"><span class="addition">+ &#125;</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+ // SetVersionFlagDescription sets the version flag description of + the default package command parser</span></span><br><span class="line"><span class="addition">+ func SetVersionFlagDescription(description string) &#123;</span></span><br><span class="line"><span class="addition">+ DefaultParser.VersionFlagDescription = description</span></span><br><span class="line"><span class="addition">+ &#125;</span></span><br><span class="line"></span><br><span class="line">  // ShowHelpAndExit shows parser help and exits with status code 2</span><br><span class="line">  func ShowHelpAndExit(message string) &#123;</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure><p>当然，原本的默认描述还是要保留的</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">  // defaultVersion is applied to parsers when they are created</span><br><span class="line">  const defaultVersion = &quot;0.0.0&quot;</span><br><span class="line"></span><br><span class="line"><span class="addition">+ var defaultHelpFlagDescription = &quot;Displays help with available flag, subcommand, and positional value parameters.&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+ var defaultVersionFlagDescription = &quot;Displays the program version string.&quot;</span></span><br><span class="line"></span><br><span class="line">  // DebugMode indicates that debug output should be enabled</span><br><span class="line">  var DebugMode bool</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="tab-id-2"><p>在 <code>helpValues.go</code> 中修改两处地方：</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">   // if the built-in version flag is enabled, then add it as a help flag</span><br><span class="line">   if p.ShowVersionWithVersionFlag &#123;</span><br><span class="line">       defaultVersionFlag := HelpFlag&#123;</span><br><span class="line">           ShortName:    &quot;&quot;,</span><br><span class="line">           LongName:     versionFlagLongName,</span><br><span class="line"><span class="deletion">-           Description:  &quot;Displays the program version string.&quot;,</span></span><br><span class="line"><span class="addition">+           Description:  DefaultParser.VersionFlagDescription,</span></span><br><span class="line">           DefaultValue: &quot;&quot;,</span><br><span class="line">           Spacer:       makeSpacer(versionFlagLongName, maxLength),</span><br><span class="line">       &#125;</span><br><span class="line">       h.Flags = append(h.Flags, defaultVersionFlag)</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   // if the built-in help flag exists, then add it as a help flag</span><br><span class="line">   if p.ShowHelpWithHFlag &#123;</span><br><span class="line">       defaultHelpFlag := HelpFlag&#123;</span><br><span class="line">           ShortName:    helpFlagShortName,</span><br><span class="line">           LongName:     helpFlagLongName,</span><br><span class="line"><span class="deletion">-           Description:  &quot;Displays help with available flag, subcommand, and positional value parameters.&quot;,</span></span><br><span class="line"><span class="addition">+           Description:  DefaultParser.HelpFlagDescription,</span></span><br><span class="line">           DefaultValue: &quot;&quot;,</span><br><span class="line">           Spacer:       makeSpacer(helpFlagLongName, maxLength),</span><br><span class="line">       &#125;</span><br><span class="line">       h.Flags = append(h.Flags, defaultHelpFlag)</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="tab-id-3"><p>修改 <code>subCommand.go</code> 中的结构体</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">type Subcommand struct &#123;</span><br><span class="line">    Name                   string</span><br><span class="line">    ShortName              string</span><br><span class="line">    Description            string</span><br><span class="line"><span class="addition">+   HelpFlagDescription    string // the help flag description</span></span><br><span class="line"><span class="addition">+   VersionFlagDescription string // the version flag description</span></span><br><span class="line">    Position               int    // the position of this subcommand, not including flags</span><br><span class="line">    Subcommands            []*Subcommand</span><br><span class="line">    Flags                  []*Flag</span><br><span class="line">    PositionalFlags        []*PositionalValue</span><br><span class="line">    ParsedValues           []parsedValue // a list of values and positionals parsed</span><br><span class="line">    AdditionalHelpPrepend  string        // additional prepended message when Help is displayed</span><br><span class="line">    AdditionalHelpAppend   string        // additional appended message when Help is displayed</span><br><span class="line">    Used                   bool          // indicates this subcommand was found and parsed</span><br><span class="line">    Hidden                 bool          // indicates this subcommand should be hidden from help</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我也想不明白为啥 DefaultParser 声明是个 <code>*Parser</code>，但是在 VSCODE 中点击跳转会跳到 SubCommand。</p></div><div class="tab-pane" id="tab-id-4"><p>最后，修改一下 <code>parser.go</code> 中的结构体。</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">type Parser struct &#123;</span><br><span class="line">    Subcommand</span><br><span class="line">    Version                    string             // the optional version of the parser.</span><br><span class="line"><span class="addition">+   HelpFlagDescription        string             // the help flag description</span></span><br><span class="line"><span class="addition">+   VersionFlagDescription     string             // the version flag description</span></span><br><span class="line">    ShowHelpWithHFlag          bool               // display help when -h or --help passed</span><br><span class="line">    ShowVersionWithVersionFlag bool               // display the version when --version passed</span><br><span class="line">    ShowHelpOnUnexpected       bool               // display help when an unexpected flag or subcommand is passed</span><br><span class="line">    TrailingArguments          []string           // everything after a -- is placed here</span><br><span class="line">    HelpTemplate               *template.Template // template for Help output</span><br><span class="line">    trailingArgumentsExtracted bool               // indicates that trailing args have been parsed and should not be appended again</span><br><span class="line">    parsed                     bool               // indicates this parser has parsed</span><br><span class="line">    subcommandContext          *Subcommand        // points to the most specific subcommand being used</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// NewParser creates a new ArgumentParser ready to parse inputs</span><br><span class="line">func NewParser(name string) *Parser &#123;</span><br><span class="line">    // this can not be done inline because of struct embedding</span><br><span class="line">    p := &amp;Parser&#123;&#125;</span><br><span class="line">    p.Name = name</span><br><span class="line">    p.Version = defaultVersion</span><br><span class="line"><span class="addition">+   p.HelpFlagDescription = defaultHelpFlagDescription</span></span><br><span class="line"><span class="addition">+   p.VersionFlagDescription = defaultVersionFlagDescription</span></span><br><span class="line">    p.ShowHelpOnUnexpected = true</span><br><span class="line">    p.ShowHelpWithHFlag = true</span><br><span class="line">    p.ShowVersionWithVersionFlag = true</span><br><span class="line">    p.SetHelpTemplate(DefaultHelpTemplate)</span><br><span class="line">    p.subcommandContext = &amp;Subcommand&#123;&#125;</span><br><span class="line">    return p</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="tab-id-5"><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">    flaggy.SetName(&quot;tiny&quot;)</span><br><span class="line">    flaggy.SetVersion(VERSION)</span><br><span class="line">    flaggy.SetDescription(&quot;一个用于局域网内共享文件的FTP程序。&quot;)</span><br><span class="line"><span class="addition">+   flaggy.SetHelpFlagDescription(&quot;打印帮助信息。&quot;)</span></span><br><span class="line"><span class="addition">+   flaggy.SetVersionFlagDescription(&quot;打印版本信息。当前版本: &quot; + VERSION)</span></span><br><span class="line">    flaggy.String(&amp;RootPath, &quot;r&quot;, &quot;road&quot;, &quot;指定对外开放的目录的绝对路径。&quot;)</span><br><span class="line">    flaggy.String(&amp;Port, &quot;p&quot;, &quot;port&quot;, &quot;指定开放的端口&quot;)</span><br><span class="line">    flaggy.Bool(&amp;IsAllowUpload, &quot;a&quot;, &quot;allow&quot;, &quot;指定是否允许访问者上传。&quot;)</span><br><span class="line">    ...</span><br><span class="line">    flaggy.Parse()</span><br></pre></td></tr></table></figure></div></div></div>              </div>            </details><h3 id="增加打印版本信息的-v"><a href="#增加打印版本信息的-v" class="headerlink" title="增加打印版本信息的 -v"></a>增加打印版本信息的 -v</h3><p>原本的打印信息有两种方式：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 第一种</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cmd --version</span></span><br><span class="line">0.0.1</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 第二种</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cmd version</span></span><br><span class="line">0.0.1</span><br></pre></td></tr></table></figure><p>可能是为了把 -v 留给使用者定义成 <code>--verbose</code> 之类的，所以源码中只有几个默认的值：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// strings used for builtin help and version flags both short and long</span></span><br><span class="line"><span class="keyword">const</span> versionFlagLongName = <span class="string">&quot;version&quot;</span></span><br><span class="line"><span class="keyword">const</span> helpFlagLongName = <span class="string">&quot;help&quot;</span></span><br><span class="line"><span class="keyword">const</span> helpFlagShortName = <span class="string">&quot;h&quot;</span></span><br></pre></td></tr></table></figure><p>不过我暂时用不到，我希望能有第三种方式：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 第三种</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cmd -v</span></span><br><span class="line">0.0.1</span><br></pre></td></tr></table></figure><p>所以进行了以下修改：</p><div class="tabs" id="tab-id"><ul class="nav-tabs"><li class="tab active"><a class="#tab-id-1">步骤1</a></li><li class="tab"><a class="#tab-id-2">步骤2</a></li><li class="tab"><a class="#tab-id-3">步骤3</a></li></ul><div class="tab-content"><div class="tab-pane active" id="tab-id-1"><p><code>main.go</code> 添加 <code>versionFlagShortName</code></p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  // strings used for builtin help and version flags both short and long</span><br><span class="line">  const versionFlagLongName = &quot;version&quot;</span><br><span class="line"><span class="addition">+ const versionFlagShortName = &quot;v&quot;</span></span><br><span class="line">  const helpFlagLongName = &quot;help&quot;</span><br><span class="line">  const helpFlagShortName = &quot;h&quot;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="tab-id-2"><p><code>helpValues.go</code> 修改一下，这样打印帮助信息的时候才会显示出来 <code>-v</code></p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">    // if the built-in version flag is enabled, then add it as a help flag</span><br><span class="line">    if p.ShowVersionWithVersionFlag &#123;</span><br><span class="line">        defaultVersionFlag := HelpFlag&#123;</span><br><span class="line"><span class="deletion">-           ShortName:    &quot;&quot;,</span></span><br><span class="line"><span class="addition">+           ShortName:    versionFlagShortName,</span></span><br><span class="line">            LongName:     versionFlagLongName,</span><br><span class="line">            Description:  DefaultParser.VersionFlagDescription,</span><br><span class="line">            DefaultValue: &quot;&quot;,</span><br><span class="line">            Spacer:       makeSpacer(versionFlagLongName, maxLength),</span><br><span class="line">        &#125;</span><br><span class="line">        h.Flags = append(h.Flags, defaultVersionFlag)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="tab-id-3"><p><code>subCommand.go</code> 修改一下，这里主要是让 -v 生效</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">        // if the flag being passed is version or v and the option to display</span><br><span class="line">        // version with version flags, then display version</span><br><span class="line">        if p.ShowVersionWithVersionFlag &#123;</span><br><span class="line"><span class="deletion">-           if flagName == versionFlagLongName &#123;</span></span><br><span class="line"><span class="addition">+           if flagName == versionFlagLongName || flagName == versionFlagShortName &#123;</span></span><br><span class="line">                p.ShowVersionAndExit()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>同样在 <code>subCommand.go</code> 修改一下，这里主要是检查使用者是不是定义了 -v 或者 –version</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// ensureNoConflictWithBuiltinVersion ensures that the flags on this subcommand do</span><br><span class="line">// not conflict with the builtin version flag (-v/--version). Exits the program</span><br><span class="line">// if a conflict is found.</span><br><span class="line">func (sc *Subcommand) ensureNoConflictWithBuiltinVersion() &#123;</span><br><span class="line">    for _, f := range sc.Flags &#123;</span><br><span class="line">        if f.LongName == versionFlagLongName &#123;</span><br><span class="line">            sc.exitBecauseOfVersionFlagConflict(f.LongName)</span><br><span class="line">        &#125;</span><br><span class="line"><span class="deletion">-       if f.ShortName == versionFlagLongName &#123;</span></span><br><span class="line"><span class="addition">+       if f.ShortName == versionFlagShortName &#123;</span></span><br><span class="line">            sc.exitBecauseOfVersionFlagConflict(f.ShortName)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>]]></content>
      
      
      <categories>
          
          <category> Other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OneTiny </tag>
            
            <tag> FTP </tag>
            
            <tag> 局域网 </tag>
            
            <tag> gin </tag>
            
            <tag> 独立开发 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OneTiny 开发日记-2021-6-22</title>
      <link href="posts/25754"/>
      <url>posts/25754</url>
      
        <content type="html"><![CDATA[<p>开发 OneTiny 时的一点思路</p><span id="more"></span><h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><p>自从买了台二手 Surface 二合一电脑以后，的确效率上去了，可以手写真香，手终于能跟上脑子了。<br>一开始拿来当出门用的备用机，轻便，但是使用久了以后，渐渐开始有和主力机之间传输文件的需求。<br>最简单的就是拿个 U 盘拷过来拷过去，一次两次还好，多了就烦了。</p><p>于是经过搜索我发现了 Python 可以通过在命令行输入 <code>python -m http.server 8000</code> 来暂时开启一个共享目录，同一局域网内的主机就可以访问到这个目录的内容。<br>但是这条命令在 Linux 中可以，在 Windows 下不能执行。</p><p>想想这玩意本质就是开启一个 HTTP 服务，指定当前目录为 HTTP 服务的根目录。刚好学了 <code>Gin</code> 框架，而 Golang 又可以编译独立的可执行文件，还可以交叉编译，于是说干就干开始干活。</p><h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>开启一个 HTTP 服务以后，当有人访问时，需要返回目录下的内容。<br>返回的页面采用最简单的效果，基本没有 CSS 。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/devlog/20210622134240.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/devlog/20210622134240.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/devlog/20210622134617.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/devlog/20210622134617.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/devlog/20210622134734.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/devlog/20210622134734.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p><code>v0.1 版</code>非常简单，程序启动的时候通过 <code>-r</code> 指定目录，没有的话默认当前目录；通过 <code>-p</code> 可以指定程序运行的端口。</p><p>当有人访问时，也就是程序接收到请求，读取目录下所有文件包括目录，交给 HTML 生成器 <code>generateHTML</code> 生成 HTML 内容，然后返回给访问者。</p><p>如果用户点击的是目录，则遍历该目录、生成 HTML，返回；<br>如果用户点击的是文件，则触发下载行为，将文件传输给访问者。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/devlog/20210622150113.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/devlog/20210622150113.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p><code>v0.1.1 版</code>时重构了 获取IP 函数，解决了 Windows 下给出的无效 IP 的问题，并修复了下载文件异常的问题。</p><p>到这里 OneTiny 作为一个局域网 FTP 工具已经可以提供稳定的服务了。</p><p>但是只能单向下载文件还不够，如果能上传就好了，有来有回。</p><p>于是 <code>v0.2 版</code>新增了上传功能，并且在 HTML 部分增加了显示文件大小、返回上一级目录的链接。</p><p>这一版在新增功能的时候做了一部分重构。由于 0.1 版直接获取请求路径中的参数导致代码耦合度非常高，所以创建了一个 <code>FileStruction</code> 的模型，用于存储文件的绝对路径、相对路径、文件大小等信息。</p><p><code>v0.2.1 版</code>的时候觉得，有时候开放一个目录供人下载文件，但不希望对方上传文件上来，所以需要一个开关来设置是否允许上传。于是增加了 <code>-a</code> 的参数，默认不可以上传，除非加上 <code>-a</code> 参数才会在客户端展示的时候展示出上传框。</p><p><code>v0.2.2 版</code>对整个程序做了较大幅度的重构，将一些全局的变量移动到 config 包，然后把启动 Gin 实例的部分移动到 start 包，并做了对 <code>-p</code> 、<code>-r</code> 参数的校验，避免用户指定系统预留的端口，或者输入一个不存在的目录作为访问根目录。还另外增加了 color 包用于控制台彩色打印（windows 除外）。</p><h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>这是我的第一个规范使用 Git 维护的独立项目，源自自身实际需求。<br>虽然市面上有许多现成的好看的功能更强大的 FTP 工具，但是我觉得那些太复杂，且需要安装等等。<br>我更愿意使用一个简简单单的只负责在局域网内的设备间传输文件的工具，除了必要的功能不添加太多复杂的功能，所以连界面也采用最简单的 “裸 HTML” 。<br>（我也不喜欢把时间花在写出华丽的界面上，而更愿意把时间拿来完善和增强本身的功能）</p><p>简单、专注、无需安装，这些是 OneTiny 的特点，也是 OneTiny 的局限。<br>我希望除了图形界面版本，OneTiny 能一直保持这种大道至简的风格，专注与局域网 FTP 这个职责即可。</p><p><em>Давай!</em></p><h2 id="Todo"><a href="#Todo" class="headerlink" title="Todo"></a>Todo</h2><ul><li><input checked="" disabled="" type="checkbox"> 上传功能</li><li><input disabled="" type="checkbox"> 自动检查更新功能</li><li><input disabled="" type="checkbox"> 密码验证功能（防止局域网内监听）</li><li><input disabled="" type="checkbox"> 增加图形界面（使用 <a href="https://fyne.io/">fyne</a>）</li><li><input disabled="" type="checkbox"> 限定访问层级</li><li><input disabled="" type="checkbox"> 限定允许上传位置</li><li><input disabled="" type="checkbox"> 大文件多线程下载</li><li><input disabled="" type="checkbox"> 断点续传</li></ul><h2 id="版本历史"><a href="#版本历史" class="headerlink" title="版本历史"></a>版本历史</h2><div class="timeline"><div class="timenode"><div class="meta"><p><p>2021-06-16 <a href="https://github.com/TCP404/OneTiny/releases/tag/v0.2.2">0.2.1 -&gt; 0.2.2</a></p></p></div><div class="body"><ol><li>Refactor: 对gin实例启动部分进行重构，移动至 start 包内；新增 config 包</li><li>Style：控制台增加彩色打印（windows除外）</li><li>Fix: 增加 flag 参数的验证</li></ol></div></div><div class="timenode"><div class="meta"><p><p>2021-06-16 <a href="https://github.com/TCP404/OneTiny/releases/tag/v0.2.1">v0.2 -&gt; v0.2.1</a></p></p></div><div class="body"><ul><li>Feat: 新增 允许上传 flag <code>-a</code></li></ul></div></div><div class="timenode"><div class="meta"><p><p>2021-06-11 <a href="https://github.com/TCP404/OneTiny/releases/tag/v0.2">v0.1.1 -&gt; v0.2</a></p></p></div><div class="body"><ol><li>Feat: 新增上传功能</li><li>Style: 文件列表增加 文件大小，增加返回上一级目录链接</li></ol></div></div><div class="timenode"><div class="meta"><p><p>2021-06-11 <a href="https://github.com/TCP404/OneTiny/releases/tag/v0.1.1">v0.1 -&gt; v0.1.1</a></p></p></div><div class="body"><ol><li>Fix: 修复了下载文件异常</li><li>Refactor: 重构了获取IP函数</li></ol></div></div><div class="timenode"><div class="meta"><p><p>2021-06-11 <a href="https://github.com/TCP404/OneTiny/releases/tag/v0.1">nil -&gt; v0.1</a></p></p></div><div class="body"><ol><li>首个版本，具有局域网内单向共享文件的功能，未具有上传功能。</li><li>可通过 <code>-p</code> 指定端口，通过 <code>-r</code> 指定目录</li></ol></div></div></div>]]></content>
      
      
      <categories>
          
          <category> Other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OneTiny </tag>
            
            <tag> FTP </tag>
            
            <tag> 局域网 </tag>
            
            <tag> gin </tag>
            
            <tag> 独立开发 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DataStruction 0x09 图-3</title>
      <link href="posts/1aa7bff2"/>
      <url>posts/1aa7bff2</url>
      
        <content type="html"><![CDATA[<p>图的应用: 最小生成树、最短路径、拓扑排序、关键路径</p><span id="more"></span><h1 id="9-图3"><a href="#9-图3" class="headerlink" title="9-图3"></a>9-图3</h1><p>图在现实中有着许多的应用，帮助人们解决了许多问题，同时图的应用也是比较晦涩难懂的地方。</p><p>本文图的应用共有：</p><ul><li>最小生成树</li><li>最短路径法</li><li>拓扑排序</li><li>关键路径</li></ul><p>从图结构的角度看，图的应用有两种：一种的解决无向图的，一种是解决有向图的。<br>更详细的看：</p><ul><li>最小生成树使用的是贪心算法，得到的是局部最优解，有可能得到的不是全局最优解</li><li>最短路径法使用的是动态规划，得到的是全局最优解</li><li>拓扑排序关注的是点</li><li>关键路径关注的是边</li></ul><p>接下来每讲一个应用之前我会先举一个场景，这样学习的时候才不至于不知道用来干嘛的。</p><h2 id="最小生成树-Minimum-Spanning-Tree"><a href="#最小生成树-Minimum-Spanning-Tree" class="headerlink" title="最小生成树 Minimum Spanning Tree"></a>最小生成树 Minimum Spanning Tree</h2><h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><p>假设现在有 北、上、广、深、杭、厦 几个城市，他们之间要建立通信联络网。<br>一共有 6 个城市，他们之间最少只需要 6 - 1 = 5 条通信线路即可连通。<br>但是各个城市之间的距离是不同的，距离越远，建立费用越高（即距离和费用成正比）。<br>所以，问题就是：怎么样让这 6 个城市建立起通信联络网，并且建立费用最低？</p><p>答案是使用最小生成树。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20210715201359.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20210715201359.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h3 id="理解"><a href="#理解" class="headerlink" title="理解"></a>理解</h3><p>要理解最小生成树，可以从<strong>最小</strong>和<strong>树</strong>去理解。</p><p>先理解「树」：<br>首先，生成树是一颗树，那么一堆顶点要生成一棵树，就不能有环<br>其次，每个顶点都不能落下，所以这些顶点得组成一个连通图</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20210715172624.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20210715172624.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>接着理解「最小」：<br>一张网，也就是路径上带权值的图，可以有很多生成树，而最小生成树则是：所有生成树里路径权值总和最小的一颗生成树。</p><h3 id="普里姆算法-Prim"><a href="#普里姆算法-Prim" class="headerlink" title="普里姆算法 (Prim)"></a>普里姆算法 (Prim)</h3><p>从任一顶点出发，将其加入已选顶点数组、其邻接的边加入备选边数组；<br>选取该顶点权值最小的一条边，所连接的顶点也加入已选顶点数组，并将该边</p><h3 id="克鲁斯卡尔算法-Kruskal"><a href="#克鲁斯卡尔算法-Kruskal" class="headerlink" title="克鲁斯卡尔算法 (Kruskal)"></a>克鲁斯卡尔算法 (Kruskal)</h3><p>克鲁斯卡尔算法适合求 稀疏网 的最小生成树。</p><p>克鲁斯卡尔算法的做法是将每一条边和权值存储到数组中，然后</p><ol><li>进行一次从小到大的排序。</li><li>从最小的边开始，将边放置到顶点上。放置前判断是否产生环：<ol><li>是：跳过这条边</li><li>否：放置这条边</li></ol></li><li>重复步骤 1</li></ol><p>总共放置顶点总数 - 1 次即可。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    Vertex a, b;</span><br><span class="line">    <span class="keyword">int</span> Weight;</span><br><span class="line">&#125; Edge;</span><br><span class="line"></span><br><span class="line">Edge net[];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Kruskal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    sort(net);</span><br><span class="line">    <span class="keyword">int</span> n = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; len(net); i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (n &gt; VertexCount<span class="number">-1</span>) <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (isCycle(net[i].a)) &#123;</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">         &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            addEdge(net[i]);</span><br><span class="line">            n++;</span><br><span class="line">         &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>先将每条边和其权值存储到数组里，做一个从小到大的排序<br>遍历数组，判断是否产生环<br>    是：删除该边<br>    否：将边放入图中，进入下一轮<br>    循环次数：顶点总数 - 1</p><h2 id="最短路径"><a href="#最短路径" class="headerlink" title="最短路径"></a>最短路径</h2><p><code>最短路径</code>和<code>最小生成树</code>都是求几个顶点之间的最短的路径，区别在于：</p><ul><li><code>最小生成树</code>的思想是使用贪心算法，而贪心算法能获得的是局部最优解，不一定是全局最优解</li><li><code>最短路径</code>的思想则是使用动态规划，而动态规划能获得的是全局最优解</li></ul><h3 id="迪杰斯特拉算法-Dijkstra"><a href="#迪杰斯特拉算法-Dijkstra" class="headerlink" title="迪杰斯特拉算法 (Dijkstra)"></a>迪杰斯特拉算法 (Dijkstra)</h3><h3 id="弗洛伊德算法-Floyd"><a href="#弗洛伊德算法-Floyd" class="headerlink" title="弗洛伊德算法 (Floyd)"></a>弗洛伊德算法 (Floyd)</h3><h2 id="拓扑排序"><a href="#拓扑排序" class="headerlink" title="拓扑排序"></a>拓扑排序</h2><h3 id="AOV-网-Activity-On-Vertex-Network"><a href="#AOV-网-Activity-On-Vertex-Network" class="headerlink" title="AOV-网 (Activity On Vertex Network)"></a>AOV-网 (Activity On Vertex Network)</h3><h2 id="关键路径"><a href="#关键路径" class="headerlink" title="关键路径"></a>关键路径</h2><h3 id="AOE-网-Activity-On-Edge-Network"><a href="#AOE-网-Activity-On-Edge-Network" class="headerlink" title="AOE-网 (Activity On Edge Network)"></a>AOE-网 (Activity On Edge Network)</h3>]]></content>
      
      
      <categories>
          
          <category> DataStruction </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构 </tag>
            
            <tag> DataStruction </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DataStruction 0x08 图-2</title>
      <link href="posts/55493"/>
      <url>posts/55493</url>
      
        <content type="html"><![CDATA[<p>图的存储</p><span id="more"></span><h1 id="8-图2"><a href="#8-图2" class="headerlink" title="8-图2"></a>8-图2</h1><h2 id="图的ADT"><a href="#图的ADT" class="headerlink" title="图的ADT"></a>图的ADT</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">ADT 图 Graph</span><br><span class="line">Data</span><br><span class="line">    顶点的有穷非空集合和边的集合</span><br><span class="line"><span class="function">Operation</span></span><br><span class="line"><span class="function">    <span class="title">CreateGraph</span><span class="params">(*G, V, E)</span>: 按照顶点集V和边集E的定义构造图G</span></span><br><span class="line"><span class="function">    <span class="title">DestoryGraph</span><span class="params">(G*)</span>: 图G存在则销毁</span></span><br><span class="line"><span class="function">    <span class="title">LocateVex</span><span class="params">(G*, v)</span>: 若图G中存在顶点v，则返回v在图中的顶点数组的下标</span></span><br><span class="line"><span class="function">    <span class="title">GetVex</span><span class="params">(G*, v)</span>: 返回图中顶点v的值</span></span><br><span class="line"><span class="function">    <span class="title">PutVex</span><span class="params">(G*, v, value)</span>: 将图G中顶点v赋值value</span></span><br><span class="line"><span class="function">    <span class="title">FirstNeighbor</span><span class="params">(G*, v)</span>: 返回顶点v的第一个邻接点，若无则返回空</span></span><br><span class="line"><span class="function">    <span class="title">NextNeighbor</span><span class="params">(G*, v1, v2)</span>: 返回顶点v1相对于顶点v2的下一个邻接点，若v2是v1的最后一个邻接点则返回空</span></span><br><span class="line"><span class="function">    <span class="title">InsertVex</span><span class="params">(G*, v)</span>: 在图G中增加顶点v</span></span><br><span class="line"><span class="function">    <span class="title">DeleteVex</span><span class="params">(G*, v)</span>: 删除图G中顶点v及其相关的边/弧</span></span><br><span class="line"><span class="function">    <span class="title">InsertArc</span><span class="params">(G*, v1, v2)</span>: 在图G中增加弧&lt;v1, v2&gt;，若G是无向图，还需添加对称弧&lt;v2, v1&gt;</span></span><br><span class="line"><span class="function">    <span class="title">DeleteArc</span><span class="params">(G*, v1, v2)</span>: 在图G中删除弧&lt;v1, v2&gt;，若G是无向图，还需删除对称弧&lt;v2, v1&gt;</span></span><br><span class="line"><span class="function">    <span class="title">DFSTraverse</span><span class="params">(G*)</span>: 对图G中进行深度优先遍历</span></span><br><span class="line"><span class="function">    <span class="title">BFSTraverse</span><span class="params">(G*)</span>: 对图G中进行广度优先遍历</span></span><br><span class="line"><span class="function">    <span class="title">Adjacent</span><span class="params">(G*, v1, v2)</span>: 判断图G中是否存在边/弧&lt;v1, v2&gt;</span></span><br><span class="line"><span class="function">    <span class="title">Neighbors</span><span class="params">(G*, v)</span>: 列出图G中与顶点v邻接的边</span></span><br><span class="line"><span class="function">    <span class="title">GetEdgeValue</span><span class="params">(G*, v1, v2)</span>: 获取图G中边/弧&lt;v1, v2&gt;对应的权值</span></span><br><span class="line"><span class="function">    <span class="title">SetEdgeValue</span><span class="params">(G*, v1, v2, value)</span>: 设置图G中边/弧&lt;v1, v2&gt;对应的权值为value</span></span><br><span class="line"><span class="function">endADT</span></span><br></pre></td></tr></table></figure><h2 id="图的存储结构"><a href="#图的存储结构" class="headerlink" title="图的存储结构"></a>图的存储结构</h2><p>图的顶点之间没有次序关系，且顶点的邻接情况多变，无法用统一的格式来存储。</p><p>图的存储结构总共有以下 5 种方式：</p><ol><li>邻接矩阵</li><li>邻接表</li><li>十字链表</li><li>邻接多重表</li><li>边集数组</li></ol><h3 id="邻接矩阵-Adjacent-Matrix"><a href="#邻接矩阵-Adjacent-Matrix" class="headerlink" title="邻接矩阵 Adjacent Matrix"></a>邻接矩阵 Adjacent Matrix</h3><div class="note quote blue"><p>图的邻接矩阵的存储方式是用两个数组来表示图。<br>一个一维数组用来存储图中的顶点集，一个二维数组（称为邻接矩阵）用来存储图中的边集。</p><p>图的邻接矩阵表示法 = 一维数组 $\times$ 1 + 二维数组 $\times$ 1</p></div><p>设 图G 有 n 个顶点，则邻接矩阵是一个 $n \times n$ 的方阵，定义为：</p><p>$$<br>Arc[i][j] =<br>\begin{cases}<br>1, &amp; {(v_i, v_j) \in E 或 \langle v_i, v_j \rangle \in E} \\<br>0, &amp; {反之}<br>\end{cases}<br>$$</p><h4 id="无向图"><a href="#无向图" class="headerlink" title="无向图"></a>无向图</h4><h5 id="理论描述"><a href="#理论描述" class="headerlink" title="理论描述"></a>理论描述</h5><p><strong>顶点集</strong>很容易表示，使用顶点结构类型的一维数组来存储顶点信息。<br><strong>边集</strong>可以用 <strong>矩阵(Metrix)</strong> 来表示，而矩阵在计算机中可以使用二维数组来实现。</p><p>eg: <img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201221132810429_2398.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201221132810429_2398.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="> </p><p>这个图的边集可以变成下面的矩阵：</p><p>$$<br>\begin{bmatrix}<br>0 &amp; 1 &amp; 1 &amp; 0 \\<br>1 &amp; 0 &amp; 1 &amp; 0 \\<br>1 &amp; 1 &amp; 0 &amp; 1 \\<br>0 &amp; 0 &amp; 1 &amp; 0<br>\end{bmatrix}<br>$$</p><p>所以对于图 <strong>G =（V, {E}）</strong>，可以使用一个一维数组来存储顶点集 V，再用一个二维数组来存储边集 E。<br>于是一张图可以变成下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201221172548767_15519.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201221172548767_15519.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="无向图邻接矩阵"></p><p>上图中，有一个结构体 <code>struct Graph</code>，结构体中包含一个一维数组 <code>Vertex[]</code> 和一个二维数组 <code>Edge[][]</code>，一个 <code>v_count</code> 存储顶点数，一个 <code>e_count</code> 存储边数。</p><p><code>Vertex[]</code> 用来存储顶点信息，<code>Edge[][]</code> 用来存储边的信息。</p><p>例如 (v1, v2) 就将 <code>Edge[0][1]</code> 置为1；而 (v1, v2) 也可以表示为 (v2, v1) ，所以 <code>Edge[1][0]</code> 也应置为1。<br>而简单图不会有自己邻接自己的边，所以 <code>Edge[0][0]、Edge[1][1]、Edge[2][2]、Edge[3][3]</code> 均为0。</p><p>稍微观察可以发现，无向图的邻接矩阵一定是一个<span class='p blue'>对称矩阵</span>[^1]，于是我们可以很容易知道图中的信息：</p><ol><li>某个顶点的度，起始就是这个顶点 v<sub>i</sub> 在邻接矩阵中第 i 行（或第 i 列）的元素之和。eg：顶点 v3 的度就是 1+1+0+1 = 3</li><li>求顶点 v<sub>i</sub> 的所有邻接点就是在邻接矩阵中第 i 行所有元素为 1 的点。eg：顶点 v2 的所有邻接点就遍历 Edge[1][…]，其中为 <code>Eege[1][0]、Edge[1][2]</code> 为1，表示 v1 和 v3 为邻接点。</li></ol><h5 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GraphModel.h</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> GRAPH_MODEL_H_INCLUDED</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> GRAPH_MODEL_H_INCLUDED</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX 4</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">enum</span> &#123;</span></span><br><span class="line">    ERROR,</span><br><span class="line">    OK,</span><br><span class="line">&#125; Status;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">enum</span> &#123;</span></span><br><span class="line">    DG,  <span class="comment">// 有向图</span></span><br><span class="line">    UDG, <span class="comment">// 无向图</span></span><br><span class="line">    DN,  <span class="comment">// 有向网</span></span><br><span class="line">    UDN, <span class="comment">// 无向网</span></span><br><span class="line">&#125; GraphKind;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">char</span>* Vertex; <span class="comment">// 顶点数组类型</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> Edge;     <span class="comment">// 邻接矩阵类型</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// GRAPH_MODEL_H_INCLUDED</span></span></span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MatrixGraph.h</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> MATRIX_GRAPH_H_INCLUDED</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MATRIX_GRAPH_H_INCLUDED</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;GraphModel.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    Vertex vers[MAX];       <span class="comment">// 顶点数组</span></span><br><span class="line">    Edge   edges[MAX][MAX]; <span class="comment">// 邻接矩阵（边数组）</span></span><br><span class="line">    <span class="keyword">size_t</span> v_count;         <span class="comment">// 顶点总数</span></span><br><span class="line">    <span class="keyword">size_t</span> e_count;         <span class="comment">// 边总数</span></span><br><span class="line">    GraphKind kind;         <span class="comment">// 图类型</span></span><br><span class="line">&#125; MatrixGraph;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @description: 创建无向图</span></span><br><span class="line"><span class="comment"> * @param G 要操作初始化的图</span></span><br><span class="line"><span class="comment"> * @return 成功返回OK，失败返回ERROR</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">Status <span class="title">CreatUDG</span><span class="params">(MatrixGraph* G)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @description: 返回某个顶点在顶点集合中的下标</span></span><br><span class="line"><span class="comment"> * @param G 要查找的图结构</span></span><br><span class="line"><span class="comment"> * @param v 顶点</span></span><br><span class="line"><span class="comment"> * @return 返回下标，不存在返回-1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">LocateVex</span><span class="params">(MatrixGraph* G, Vertex v)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// MATRIX_GRAPH_H_INCLUDED</span></span></span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MatrixGraph.c</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;MatrixGraph.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">Status <span class="title">CreatUDG</span><span class="params">(MatrixGraph* G)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    G-&gt;kind = UDG;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Please type the count of Vertex : &quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;G-&gt;v_count);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Please type the count of Edge : &quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;G-&gt;e_count);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 录入顶点数组</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Please type Vertex in turn.\n&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G-&gt;v_count; i++) &#123;</span><br><span class="line">        G-&gt;vers[i] = <span class="built_in">calloc</span>(<span class="number">10</span>, <span class="keyword">sizeof</span>(Vertex));</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Vertex %d :&quot;</span>, i);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, G-&gt;vers[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化邻接矩阵，所有边的权值设置为0</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G-&gt;v_count; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; G-&gt;v_count; j++) &#123;</span><br><span class="line">            G-&gt;edges[i][j] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 录入邻接矩阵</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Please type Vertex and Adjacent. \n&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G-&gt;e_count; i++) &#123;</span><br><span class="line">        Vertex v1 = <span class="built_in">calloc</span>(<span class="number">10</span>, <span class="keyword">sizeof</span>(Vertex));</span><br><span class="line">        Vertex v2 = <span class="built_in">calloc</span>(<span class="number">10</span>, <span class="keyword">sizeof</span>(Vertex));</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Vertex %d : &quot;</span>, i + <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, v1);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Adjacent %d : &quot;</span>, i + <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, v2);</span><br><span class="line"></span><br><span class="line">         <span class="comment">/** 核心代码 begin */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取顶点的下标</span></span><br><span class="line">        <span class="keyword">int</span> x = LocateVex(G, v1);</span><br><span class="line">        <span class="keyword">int</span> y = LocateVex(G, v2);</span><br><span class="line">        <span class="keyword">if</span> (x == <span class="number">-1</span> || y == <span class="number">-1</span>)</span><br><span class="line">            <span class="keyword">return</span> ERROR;</span><br><span class="line">        <span class="comment">// 对应位置置为1</span></span><br><span class="line">        G-&gt;edges[x][y] = <span class="number">1</span>;</span><br><span class="line">        G-&gt;edges[y][x] = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** 核心代码 end */</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">free</span>(v1);</span><br><span class="line">        <span class="built_in">free</span>(v2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">LocateVex</span><span class="params">(MatrixGraph* G, Vertex v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (index &lt; G-&gt;v_count) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(v, G-&gt;vers[index]) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        index++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> index == G-&gt;v_count ? <span class="number">-1</span> : index;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Test</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    MatrixGraph G;</span><br><span class="line">    Status status = CreatUDG(&amp;G);</span><br><span class="line">    <span class="keyword">if</span> (status = ERROR) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Create Graph Failed~&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;The Adjacent Matrix: \n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\t&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G.v_count; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\t%s&quot;</span>, G.vers[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G.e_count; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\t%s&quot;</span>, G.vers[i]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; G.e_count; j++) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;\t%d&quot;</span>, G.edges[i][j]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;MatrixGraph.c&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Test();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="有向图"><a href="#有向图" class="headerlink" title="有向图"></a>有向图</h4><h5 id="理论描述-1"><a href="#理论描述-1" class="headerlink" title="理论描述"></a>理论描述</h5><p>有向图和无向图的区别在于邻接矩阵。</p><p>在有向图邻接矩阵中，<br>第 i 行含义：以结点 v<sub>i</sub> 为尾的弧（即出度边）<br>第 i 列含义：以结点 v<sub>i</sub> 为头的弧（即入度边）</p><p>其特点为：</p><ul><li>无向图的邻接矩阵一定是对称的，当有向图的邻接矩阵不一定是对称的。</li><li>顶点 v<sub>i</sub> 的出度 = 第 i <strong>行</strong>元素之和</li><li>顶点 v<sub>i</sub> 的入度 = 第 i <strong>列</strong>元素之和</li><li>顶点 v<sub>i</sub> 的度 = 第 i 行元素之和 + 第 i 列元素之和</li></ul><div class="note done"><p>口诀：</p><ul><li><code>Arc[行][列]</code></li><li><code>Arc[出][入]</code></li><li><strong>列头入，行尾出</strong>：即 列为弧头、入度；行为弧尾、出度。</li></ul></div><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201221172927072_32706.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201221172927072_32706.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="有向图邻接矩阵"></p><h5 id="代码实现-1"><a href="#代码实现-1" class="headerlink" title="代码实现"></a>代码实现</h5><p>在代码实现上，有向图与无向图唯一的区别在于：录入弧的数据之后，只需要执行赋值一次就可以。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">G-&gt;edges[x][y] = <span class="number">1</span>;</span><br><span class="line"><span class="comment">// G-&gt;edges[y][x] = 1;</span></span><br></pre></td></tr></table></figure><p>这里我将有向图和无向图的创建合并在一起，在调用函数时多传入一个 GraphKind 类型参数来区分。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Status <span class="title">CreatGraph</span><span class="params">(MatrixGraph* G, GraphKind kind)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    G-&gt;kind = kind;</span><br><span class="line">    <span class="comment">// 录入顶点数和边数</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// 录入顶点数组</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// 初始化邻接矩阵，所有边的权值设置为0</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// 录入邻接矩阵</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Please type %s and %s. \n&quot;</span>, kind == UDG ? <span class="string">&quot;Vertex&quot;</span> : <span class="string">&quot;InDegree&quot;</span>, kind == UDG ? <span class="string">&quot;Adjacent&quot;</span> : <span class="string">&quot;OutDegree&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G-&gt;e_count; i++) &#123;</span><br><span class="line">        Vertex v1 = <span class="built_in">calloc</span>(<span class="number">10</span>, <span class="keyword">sizeof</span>(Vertex));</span><br><span class="line">        Vertex v2 = <span class="built_in">calloc</span>(<span class="number">10</span>, <span class="keyword">sizeof</span>(Vertex));</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s %d : &quot;</span>, kind == UDG ? <span class="string">&quot;Vertex&quot;</span> : <span class="string">&quot;OutDegree&quot;</span>, i + <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, v1);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s %d : &quot;</span>, kind == UDG ? <span class="string">&quot;Adjacent&quot;</span> : <span class="string">&quot;InDegree&quot;</span>, i + <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, v2);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> x = LocateVex(G, v1);</span><br><span class="line">        <span class="keyword">int</span> y = LocateVex(G, v2);</span><br><span class="line">        <span class="keyword">if</span> (x == <span class="number">-1</span> || y == <span class="number">-1</span>)</span><br><span class="line">            <span class="keyword">return</span> ERROR;</span><br><span class="line"></span><br><span class="line">        G-&gt;edges[x][y] = <span class="number">1</span>;</span><br><span class="line">        G-&gt;edges[y][x] = kind == UDG ? <span class="number">1</span> : <span class="number">0</span>;    <span class="comment">// 无向图置为1，有向图保持默认</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">free</span>(v1);</span><br><span class="line">        <span class="built_in">free</span>(v2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Status status = CreatGraph(&amp;G);</span></span><br><span class="line">Status status = CreatGraph(&amp;G, DG);</span><br></pre></td></tr></table></figure><p>同时，有向图的顶点的度 = 出度 + 入度，可以实现一个函数根据图的类型来返回顶点的度。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @description: 获取某个顶点的度</span></span><br><span class="line"><span class="comment"> * @param G 要查找的图</span></span><br><span class="line"><span class="comment"> * @param v 要查询度的顶点</span></span><br><span class="line"><span class="comment"> * @return 该顶点的度</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">size_t</span> <span class="title">GetDegree</span><span class="params">(MatrixGraph* G, Vertex v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 获取无向图的度：累加第i行或第i列的元素之和</span></span><br><span class="line">    <span class="comment">// 获取有向图的度：累加第i行和第i列的元素之和并相加</span></span><br><span class="line">    <span class="keyword">int</span> index = LocateVex(G, v);</span><br><span class="line">    <span class="keyword">int</span> inDegree = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> outDegree = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G-&gt;e_count; i++) &#123;</span><br><span class="line">        inDegree += G-&gt;edges[i][index];</span><br><span class="line">        outDegree += G-&gt;edges[index][i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> G-&gt;kind == UDG ? inDegree : inDegree + outDegree;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>无向图的度只需要返回行的和或列的和就行，有向图的度则需要相加再返回。</p><h4 id="网"><a href="#网" class="headerlink" title="网"></a>网</h4><p>边或弧带权的图即为网。</p><h5 id="理论描述-2"><a href="#理论描述-2" class="headerlink" title="理论描述"></a>理论描述</h5><p>设 图G 有 n 个顶点，则邻接矩阵是一个 $n \times n$ 的方阵，定义为：</p><p>$$<br>Arc[i][j] =<br>\begin{cases}<br>W_{ij}, &amp; {(v_i, v_j) \in E 或 \langle v_i, v_j \rangle \in E} \\<br>0, &amp; {i=j} \\<br>∞, &amp; {反之}<br>\end{cases}<br>$$</p><p>这里 $W_{ij}$ 表示 $\langle v_i, v_j \rangle$ 或 $(v_i, v_j)$ 上的权值。<br>$\infty$ 表示一个计算机允许的、大于所有边上权值的值，即一个不可能的极限值，在C语言中可以使用 <code>INT_MAX</code> 来表示无穷。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201221215629050_25484.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201221215629050_25484.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="网的邻接矩阵"></p><h5 id="代码实现-2"><a href="#代码实现-2" class="headerlink" title="代码实现"></a>代码实现</h5><p>网的大部分代码与有向图和无向图的相同的，只有几处需要修改。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 初始化邻接矩阵，所有边的权值设置为无穷</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G-&gt;v_count; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; G-&gt;v_count; j++) &#123;</span><br><span class="line">        G-&gt;edges[i][j] = INT_MAX;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在初始化时，不能初始化为0，而要初始化为 <code>INT_MAX</code>。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 录入邻接矩阵</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Please type %s and %s. \n&quot;</span>, kind == UDN ? <span class="string">&quot;Vertex&quot;</span> : <span class="string">&quot;InDegree&quot;</span>, kind == UDN ? <span class="string">&quot;Adjacent&quot;</span> : <span class="string">&quot;OutDegree&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G-&gt;e_count; i++) &#123;</span><br><span class="line">        Vertex v1 = <span class="built_in">calloc</span>(<span class="number">10</span>, <span class="keyword">sizeof</span>(Vertex));</span><br><span class="line">        Vertex v2 = <span class="built_in">calloc</span>(<span class="number">10</span>, <span class="keyword">sizeof</span>(Vertex));</span><br><span class="line">        <span class="keyword">int</span> weight = <span class="number">0</span>; <span class="comment">// 权值</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s %d : &quot;</span>, kind == UDN ? <span class="string">&quot;Vertex&quot;</span> : <span class="string">&quot;OutDegree&quot;</span>, i + <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, v1);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s %d : &quot;</span>, kind == UDN ? <span class="string">&quot;Adjacent&quot;</span> : <span class="string">&quot;InDegree&quot;</span>, i + <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, v2);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Value %d: &quot;</span>, i + <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, &amp;weight);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> x = LocateVex(G, v1);</span><br><span class="line">        <span class="keyword">int</span> y = LocateVex(G, v2);</span><br><span class="line">        <span class="keyword">if</span> (x == <span class="number">-1</span> || y == <span class="number">-1</span>)</span><br><span class="line">            <span class="keyword">return</span> ERROR;</span><br><span class="line"></span><br><span class="line">        G-&gt;edges[x][y] = weight;</span><br><span class="line">        G-&gt;edges[y][x] = kind == UDN ? weight : INT_MAX;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">free</span>(v1);</span><br><span class="line">        <span class="built_in">free</span>(v2);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>录入邻接矩阵时也需要多录入一个权值。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 邻接矩阵</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G.e_count; i++) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\t%s&quot;</span>, G.vers[i]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; G.e_count; j++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\t%s&quot;</span>, G.edges[i][j] == INT_MAX ? <span class="string">&quot;∞&quot;</span> : (<span class="keyword">char</span>*)G.edges[i][j]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>打印时也稍作处理。</p><h3 id="邻接表-Adjacent-List"><a href="#邻接表-Adjacent-List" class="headerlink" title="邻接表 Adjacent List"></a>邻接表 Adjacent List</h3><p>邻接矩阵适合处理稠密图，对于稀疏图，邻接矩阵会造成巨大的浪费。在数据结构中，解决浪费问题需要往链式结构的方向去想。</p><div class="note quote"><p>图的邻接表的存储方式是用一维数组和单链表来表示图。<br>一个一维数组用来存储图中的顶点集，多个单链表用来存储图中的边集。</p><p>图的邻接矩阵表示法 = 一维数组 $\times$ 1 + 单链表 $\times$ n</p></div><h4 id="无向图的邻接表"><a href="#无向图的邻接表" class="headerlink" title="无向图的邻接表"></a>无向图的邻接表</h4><p>邻接表的处理方法如下：</p><ul><li>图的顶点集用一维数组存储，数组元素为 <code>数据域(data)</code> + <code>首邻接点域(firstEdge)</code>；</li><li>图的边/弧集用单链表存储，链表结点由 <code>邻接点域(adjvex)</code> + <code>指针域(next)</code> 构成；</li></ul><p><code>首邻接点域</code> 指的是顶点的第一个边链表结点的地址，链表中的 <code>邻接点域</code> 存储的是邻接点的在顶点数组中的下标。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201222123713244_31065.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201222123713244_31065.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="邻接表"></p><p>从上图可以看出，一个无向图可以用一个顶点类型的一维数组来存储顶点，每个顶点都各自有一条边链表，存储着该顶点的所有邻接点；</p><p>顶点数组中的某个顶点 <code>Vertex[i]</code> 和 对应边链表中的任一个结点构成了一条边。</p><p>eg：</p><p>$v_1$ 的邻接点是 $v_2$ 和 $v_3$，在顶点数组中 $v_1$ 的下标是 0；<br/><br>在 <code>Vertex[0]</code> 数据域(data) 中存着 $v_1$，首邻接点域(firstEdge) 存储着边链的第一个结点的地址；<br/><br>在边链的第一个结点中，邻接点域(adjvex) 存储着 $v_2$ 的下标 1，然后指针域(next) 指向下一个结点；<br/><br>下一个结点的邻接点域存储着 $v_3$ 的下标 2，后面不再有了，所以指针域为空。<br/></p><p>仔细观察可以发现以下特点：</p><ul><li>无向图的邻接表重复存储着数据（邻接矩阵里也是），但总比邻接矩阵节省空间。</li><li>边链中的结点，除了与顶点数组中的元素，相互之间没有关系。</li><li>顶点的度 = 它的边链的结点数</li><li>求顶点的所有邻接点 = 遍历顶点的边链并取邻接点域</li><li>如果有 n 条边，则边链表会有 2n 个结点</li></ul><h4 id="有向图的邻接表"><a href="#有向图的邻接表" class="headerlink" title="有向图的邻接表"></a>有向图的邻接表</h4><p>有向图的邻接表是类似的，但有向图区分方向。</p><p>我们以顶点为弧尾来存储边链表，并称这样的边链表为<strong>出边表</strong>，或<strong>正邻接表</strong><br>我们以顶点为弧头来存储边链表，并称这样的边链表为<strong>入边表</strong>，或<strong>逆邻接表</strong></p><div class="img-wrap"><div class="img-bg"><img class="img lazyload" src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201222123739148_26529.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201222123739148_26529.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="右上出边表 和 右下入边表"/></div><span class="image-caption">右上出边表 和 右下入边表</span></div><p>右上为出边表，右下为入边表</p><p>出边表中，顶点 v1 作为弧尾，邻接弧头 v2，所以首邻接点与指向出边表的第一个结点，结点中的数据域存储着弧头 v2 的下标 1。所以 v1 和 <code>Vertex[1]</code> 共同组成一条弧。</p><p>而顶点 v2 有 2 个出度，所以 v2 的出边表中有 2 个结点。</p><p>入边表中，顶点 v3 作为弧头，邻接弧尾 v2 和 v4，所以首邻接点指向入边表的第一个结点，结点中存着 v2 的下标 1，第二个结点存着 v4 下标 3。</p><p>观察两个表，可以发现以下特点：</p><ul><li>使用入边表表示图时，顶点的入度 = 对应入边表的结点数量，要计算出度只能遍历所有边链表</li><li>使用出边表表示图时，顶点的出度 = 对应出边表的结点数量，要计算入度只能遍历所有边链表</li><li>边链表中的结点，除了与顶点元素，相互之间没有关系</li><li>弧的总数 = 所有边链表的结点的总数之和</li></ul><h4 id="有向网的邻接表"><a href="#有向网的邻接表" class="headerlink" title="有向网的邻接表"></a>有向网的邻接表</h4><p>有向网和无向网的邻接表仅仅只是在边链表中的结点增加一个变量 weight 来存储权值。同样有有向无向、出边入边之分。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201222123823531_26765.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201222123823531_26765.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="网的邻接表"></p><h4 id="代码实现-3"><a href="#代码实现-3" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 边链表结点类型</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> adjvex;          <span class="comment">// 邻接点域、邻接点下标</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">node</span>* <span class="title">next</span>;</span>   <span class="comment">// 指针域</span></span><br><span class="line">&#125; EdgeNode, ArcNode;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 顶点类型</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">char</span>* Vertex;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 顶点结点类型</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    Vertex data;         <span class="comment">// 数据域</span></span><br><span class="line">    EdgeNode firstEdge;  <span class="comment">// 首邻接点域</span></span><br><span class="line">&#125; VertexNode;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 图类型</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    VertexNode vexs[MAX];    <span class="comment">// 顶点结点数组</span></span><br><span class="line">    <span class="keyword">int</span> v_count;             <span class="comment">// 顶点数量</span></span><br><span class="line">    <span class="keyword">int</span> e_count;             <span class="comment">// 边/弧数量</span></span><br><span class="line">    GraphKind kind;          <span class="comment">// 图类型</span></span><br><span class="line">&#125; AdjListGraph;</span><br></pre></td></tr></table></figure><h3 id="十字链表-Orthogonal-List"><a href="#十字链表-Orthogonal-List" class="headerlink" title="十字链表 Orthogonal List"></a>十字链表 Orthogonal List</h3><div class="note quote"><p>十字链表主要针对有向图，适用于需要<strong>频繁获取顶点的入度和出度，频繁地判断一个点是不是另一个点</strong>的邻接点等的情况。</p><p>其核心思想是<strong>将出边表和入边表整合起来</strong>。</p></div><p>有向图的邻接表只有表示出度的出边表，或者表示入度的入边表，鱼和熊掌不可兼得。</p><p>对于这种情况，小孩子才做选择，大人全都要！</p><p>于是我们可以改造一下顶点数组，让一个顶点数组的元素包含 <code>顶点</code>、<code>出边表的首邻接点域</code>、<code>入边表的首邻接点域</code></p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201223125912346_19343.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201223125912346_19343.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p><code>data</code> 表示顶点，<code>iFirst</code> 表示入边表的首邻接点域，<code>oFirst</code> 表示出边表的首邻接点域。</p><p>于是我们可以得到一个这样的双邻接表：</p><div class="img-wrap"><div class="img-bg"><img class="img lazyload" src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201223132930617_4233.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201223132930617_4233.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="←图结构，↑出边表，↓入边表，→双邻接表"/></div><span class="image-caption">←图结构，↑出边表，↓入边表，→双邻接表</span></div><p>最左边是图结构，中间上面是出边表，中间下面是入边表，将它们结合，就成了最右边的双邻接表</p><p>下一步我们改造一下边链表的结点，让它由 <code>弧尾下标</code> + <code>弧尾边链的指针域</code> + <code>弧头下标</code> + <code>弧头边链的指针域</code> 构成。<br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201223130924330_32433.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201223130924330_32433.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p><code>oVex</code> 表示弧中出边的结点，即弧尾结点，的下标；<code>oNext</code> 替代了原出边表结点里的指针域；<br><code>iVex</code> 表示弧中入边的结点，即弧头结点，的下标；<code>iNext</code> 替代了原入边表结点里的指针域；</p><p>现在对双邻接表进行改造：<br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201223133027047_23264.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201223133027047_23264.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="改造边链表结点"></p><p>然后我们会发现有很多重复的结点，我们保留一个，删除一个：<br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201223133122257_6587.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201223133122257_6587.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="删除重复结点"></p><p>接着把被删除的地方的链指向保留下来的那个结点：</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201223135115072_2208.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201223135115072_2208.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="改链"></p><p>例如 v1 的出边表第一个结点（v1 红色线条指向的那个 0 和 1 的结点） 和 v2 的入边表的第一个节点（v2 蓝色线条指向的那个 0 和 1 的结点），</p><p>这两个结点相同，</p><p>于是我删掉其中 v2 的那个，然后让 v2 的蓝色线指向 v1 的第一个结点，其他结点也是同样操作。</p><p>最后整理一下就是下图的样子：</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201223135135896_26333.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201223135135896_26333.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="十字链表"></p><p>对比一下该图的顶点 v2 的出边表和十字链表：<br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201223140240032_28522.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201223140240032_28522.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="出边表 VS 十字链表"></p><p>可以看到没有损失任何信息。</p><h4 id="代码实现-4"><a href="#代码实现-4" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 顶点类型 */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">char</span>* Vertex;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 十字链表结点 */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span></span><br><span class="line">    Vertex oVex;        <span class="comment">// 弧头下标</span></span><br><span class="line">    Vertex iVex;        <span class="comment">// 弧尾下标</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">node</span>* <span class="title">oNext</span>;</span> <span class="comment">// 出边表指针域</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">node</span>* <span class="title">iNext</span>;</span> <span class="comment">// 入边表指针域</span></span><br><span class="line">    <span class="keyword">int</span> weight;         <span class="comment">// 权值</span></span><br><span class="line">&#125; OrthoNode;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 顶点数组元素类型 */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    Vertex data;        <span class="comment">// 顶点</span></span><br><span class="line">    OrthoNode iFirst;   <span class="comment">// 入边表的首个结点</span></span><br><span class="line">    OrthoNode oFirst;   <span class="comment">// 出边表的首个节点</span></span><br><span class="line">&#125; VertexNode;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 图结构 */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    VertexNode vexArray[MAX];    <span class="comment">// 顶点数组</span></span><br><span class="line">    <span class="keyword">int</span> v_count;                 <span class="comment">// 顶点数量</span></span><br><span class="line">    <span class="keyword">int</span> a_count;                 <span class="comment">// 弧的数量</span></span><br><span class="line">    GraphKind kind;              <span class="comment">// 图的类型（有向图/有向网）</span></span><br><span class="line">&#125; OrthoGraph;</span><br></pre></td></tr></table></figure><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><div class="note done"><p>十字链表5步走：</p><ol><li>生成有向图的出边表和入边表</li><li>组合成双邻接表</li><li>改造链表结点</li><li>删除重复结点</li><li>连接</li></ol></div><h3 id="邻接多重表-Adjacent-Multilist-List"><a href="#邻接多重表-Adjacent-Multilist-List" class="headerlink" title="邻接多重表 Adjacent Multilist List"></a>邻接多重表 Adjacent Multilist List</h3><div class="note quote"><p>邻接多重表主要是针对无向图。</p></div><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201222185711829_15128.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201222185711829_15128.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="无向图的邻接表表示法"></p><p>从图中可以发现边链结点很多都是重复的。当删除一条边时，需要到两条边链中删除。<br>例如删除 边(v1, v3)，需要找到 v1 的边链，删除第二个结点，然后还要找到 v3 的边链，然后删除第一个结点。显然这是比较繁琐的。</p><p>所以邻接多重表就在邻接表的基础上对边链的结点进行改造。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201222191259613_26797.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201222191259613_26797.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>邻接表的结点由 <code>邻接点的下标</code> <strong>+</strong> <code>下一结点指针</code> 构成<br>邻接多重表的结点由 <code>顶点下标</code> <strong>+</strong> <code>顶点的下一结点的指针</code> <strong>+</strong> <code>邻接点下标</code> <strong>+</strong> <code>邻接点的下一结点的指针</code> 构成</p><div class="note quote"><p>其思想是<strong>将所有顶点的边链整合起来</strong>，即节省空间，也提高了操作效率。</p></div><p>下面介绍一下如何将邻接表改为邻接多重表：</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201222224547724_28766.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201222224547724_28766.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="改造边链结点"></p><ol><li>首先将 边链的结点进行改造：边链结点中不仅要填入邻接点的下标，还要填入顶点自己的下标。</li></ol><p>例如 顶点 v1 有两个邻接点 v2 和 v3，所以要在两个结点中的 ivex 处填入 v1 的下标 0。其他结点同理。看不懂可以对比两个图的边链。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201222225410133_12444.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201222225410133_12444.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="删除重复结点"></p><ol start="2"><li>例如 v1 的第一个边链结点中有 0 和 1，代表 v1 的地址和 v2 的地址；v2 的第一个边链结点也有 1 和 0，所以随便保留哪一个都可以。</li></ol><p>图中将 v2 的第一个边链结点删除，然后让 v1 的第一个边链结点也成为 v2 的边链结点。</p><p>这一步怎么删，删完指向谁可能有点乱，请看下面的图。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201222225336253_30848.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201222225336253_30848.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="对比图"></p><ol start="3"><li>这里左侧两个图结构是同一个，第二个图结构多做了4条辅助线用来对照，实际真正的图是第一个的图结构，不要混淆。<br>对照第二个的图结构，和右侧的邻接多重表：</li></ol><p>顶点 v1 有两条边，邻接 v2 和 v3，在邻接多重表中用红色线连接起来了。单独观察 <code>VertexNode[0]</code> 和 <code>红色线连接的两个结点</code>，是不是跟邻接表相似？</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201222230310803_2534.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201222230310803_2534.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="左：邻接多重表 右：邻接表"></p><p>同样道理可以继续观察 v2、v3、v4。</p><p>我们会发现邻接多重表的结点数少了，而且<strong>结点总数刚好就是边数</strong>。</p><p>现在再来体会那句：<strong>将所有边链整合起来</strong>，再体会体会为什么要增加 <code>inext</code> 和 <code>jnext</code> 两个元素在结点中，其实就是为了保留原本的信息。</p><p>邻接多重表中边链的结点不分是谁的，只记录边两头两个顶点的下标。</p><div class="note quote"><p>扩展一下，如果无向网使用邻接多重表表示，是不是只要将边链结点多加一个 权值 的成员即可？如果还要再来个是否被搜索过的标记，是不是再加个 布尔值 的成员即可？</p></div><h3 id="边集数组-Edgeset-Array"><a href="#边集数组-Edgeset-Array" class="headerlink" title="边集数组 Edgeset Array"></a>边集数组 Edgeset Array</h3><div class="note quote"><p>边集数组是由两个一维数组构成，一个是存储顶点的信息，另一个是存储边的信息。这个边数组的每个元素由一条边的起点下标 (begin) 、终点下标 (end) 和权 (weight) 组成。</p><p>边集数组关注的是边的集合。</p><p>在边集数组中要查找一个顶点的度需要扫描整个边数组，效率不高，因此更适合对边依次进行处理的操作，而不适合对顶点相关的操作。</p></div><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201222233340163_16644.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201222233340163_16644.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="边集数组"></p><h3 id="适用情况总结"><a href="#适用情况总结" class="headerlink" title="适用情况总结"></a>适用情况总结</h3><ul><li>邻接矩阵适合处理稠密图</li><li>邻接表适合处理稀疏图</li><li>十字链表适合于需要频繁获取顶点的入度和出度，频繁地判断一个点是不是另一个点的邻接点等的情况</li><li>邻接多重表主要是针对无向图</li><li>边集数组适合对边依次进行处理的操作，而不适合对顶点相关的操作</li></ul><h2 id="图的遍历"><a href="#图的遍历" class="headerlink" title="图的遍历"></a>图的遍历</h2><h3 id="深度优先搜索-DFS"><a href="#深度优先搜索-DFS" class="headerlink" title="深度优先搜索 DFS"></a>深度优先搜索 DFS</h3><div class="note quote"><p>深度优先遍历 (Depth-First-Search) 是仿树的前序遍历，该算法是利用栈来实现，也就是递归，所以在 DFS 中会有<strong>递归</strong>和<strong>回溯</strong>的说法。</p></div><p>DFS 需要借助一个数组来记录访问状态，这里将其称作<strong>状态数组（Status Array）</strong>；该数组长度为顶点总数，次序与顶点数组相同。</p><p>从某一个顶点 vi 出发，则当前顶点为 vi；</p><p>先将该顶点标记为已访问，然后遍历其所有邻接点，找到 <strong>第一个未访问的邻接点 vj</strong> 并置为当前顶点；</p><p>接着从该顶点 vj 出发，先标记为已访问，然后遍历找到 <strong>第一个未访问的邻接点 vk</strong> 并置为当前顶点… 以此类推</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201227104338200_15211.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201227104338200_15211.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>例如上图左边是一个图，我们可以转换一下思维，像右图一样把那两条边当作没有，就可以看成一棵二叉树</p><p>运用树的前序遍历法可以得到：<strong>v0 -&gt; v1 -&gt; v5 -&gt; v2 -&gt; v4 -&gt; v3</strong>，而这正好就是 DFS 的结果。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201227104426654_6400.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201227104426654_6400.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="><br>回过头来重新看着左边的图，假设从 v0 出发（其实图是无序的，从任何一点出发都可以）；</p><ul><li>v0 有两个邻接点 v1 和 v3，我们先选择 v1，然后从 v1 出发；</li><li>v1 有两个邻接点 v5 和 v0，v0 已经访问过了，只能选择 v5，然后从 v5 出发；</li><li>v5 有三个邻接点 v1、v2、v3，v1 已经访问过了，我们先选择 v2 ，然后从 v2 出发；</li><li>v2 有两个邻接点 v5 和 v4，v5 已经访问过了，只能选择 v4，然后从 v4 出发；</li><li>v4 有两个邻接点 v2 和 v3，v2 已经访问过了，只能选择 v3，然后从 v3 出发；</li><li>v3 有三个邻接点 v4、v5、v0，全都访问过了，到此遍历也就结束了。</li></ul><p>如果仔细阅读上面6个步骤会发现，当我们遍历时，我们需要知道这个顶点是不是被访问过了，所以我们需要一个状态数组来记录；</p><p>而当有多个邻接点可以访问时，我们选择的依据，其实是顶点在顶点数组中存储的顺序所决定的。</p><p>例如在 v5 的时候，选择了 v2 而不是 v3，其实是我们默认顶点数组是按照 <code>v0、v1、v2、v3、v4、v5</code> 的顺序存储，假设是按照 <code>v0、v1、v3、v2、v4、v5</code> 存储，v3 在 v2 前，则会先访问 v3。</p><h4 id="邻接矩阵的-DFS"><a href="#邻接矩阵的-DFS" class="headerlink" title="邻接矩阵的 DFS"></a>邻接矩阵的 DFS</h4><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201227102907217_22966.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201227102907217_22966.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="邻接矩阵的 DFS"></p><p>先将图的边用矩阵表示，在计算机中使用二维数组存储。<br>然后设置一个状态数组，长度和顶点数组相同。</p><p>接下来就可以执行 DFS 了。</p><p>第一步：先初始化状态数组为未访问状态，即最开始所有顶点都未访问。<br>第二步：遍历顶点数组，让数组里每个顶点都放入遍历执行函数中，不过在调用遍历执行函数之前要先判断顶点是否已被访问。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> visited[MAX];</span><br><span class="line"></span><br><span class="line"><span class="comment">/** DFS begin */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @description: 深度优先遍历算法</span></span><br><span class="line"><span class="comment"> * @param G 需要被遍历的图</span></span><br><span class="line"><span class="comment"> * @return 无</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFSTraverse_AMG</span><span class="params">(MatrixGraph* G)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 初始化状态数组</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G-&gt;v_count; i++)</span><br><span class="line">        visited[i] = UNVISITED;</span><br><span class="line">    <span class="comment">// DFS 遍历</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G-&gt;v_count; i++)</span><br><span class="line">        <span class="keyword">if</span> (!visited[i]) <span class="comment">// 如果某个顶点未访问</span></span><br><span class="line">            DFS_AMG(G, i); <span class="comment">// 调用遍历执行函数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>遍历执行函数就是 DFS 的核心算法了。<br>该函数接收顶点的下标，并做3件事：</p><ol><li>访问当前顶点</li><li>更改顶点的访问状态</li><li>获取第一个未访问的邻接点下标，然后递归进去，找不到则回溯</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @description: 深度优先搜索的核心算法</span></span><br><span class="line"><span class="comment"> * @param G 要搜索的图</span></span><br><span class="line"><span class="comment"> * @param index 要搜索的顶点的下标</span></span><br><span class="line"><span class="comment"> * @return 无</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS_AMG</span><span class="params">(MatrixGraph* G, <span class="keyword">int</span> index)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;-&gt; %s &quot;</span>, G-&gt;vexes[index]); <span class="comment">// 访问当前顶点</span></span><br><span class="line">    visited[index] = VISITED; <span class="comment">// 更改当前顶点的访问状态</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; G-&gt;v_count; j++)</span><br><span class="line">        <span class="keyword">if</span> (G-&gt;matrix[index][j] &amp;&amp; !visited[j]) <span class="comment">// 获取第一个未访问的邻接点下标然后递归进去</span></span><br><span class="line">            DFS_AMG(G, j);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/** DFS end */</span></span><br></pre></td></tr></table></figure><p>在邻接矩阵中，获取某个顶点的所有邻接点就是遍历其所在的行，找到第一个未访问的邻接点。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201227111845411_7573.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201227111845411_7573.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>从邻接矩阵中看如上图</p><ul><li>最开始从第 0 行进行（箭头1），找到第一个邻接点的下标，其列标为 1，于是跳到第 1 行（箭头2）</li><li>第 1 行第一个邻接点是 v0 ，已经访问过，所以跳过（箭头3），一直找到 v5 这个邻接点，其列标为 5，于是跳到第 5 行（箭头4）</li><li>第 5 行第一个邻接点的 v1，已经访问过，所以跳过（箭头5），接下去找到第二个邻接点 v2，其列标为 2，于是跳到第 2 行（箭头6）</li><li>接下去的步骤都是这个思路，画出来太乱就没画了。</li></ul><h4 id="邻接表的-DFS"><a href="#邻接表的-DFS" class="headerlink" title="邻接表的 DFS"></a>邻接表的 DFS</h4><p>邻接表的具体代码实现跟邻接矩阵稍稍不同而已，只不过把数组处理换成了链表处理<br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201227115455825_10282.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201227115455825_10282.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><ul><li>最开始从 v1 开始（箭头1），访问 v1 的边链上第一个结点（箭头2），得到了 v2 的下标，于是跳到 v2（箭头3）</li><li>接着从 v2 开始，先访问 v2，然后遍历 v2 的边链上的结点（箭头4），第一个结点 0 是 v1 的下标，已经访问过了，于是继续下一个结点，得到了 v3 的下标，于是跳到 v3（箭头5）</li><li>接着从 v3 开始，先访问 v3，然后遍历 v3 的边链上的结点（箭头6），第一和第二个结点是 v1 和 v2 的下标，已经访问过，所以接着下一个结点，得到 v4 的下标，于是跳到 v4（箭头7）</li><li>接着从 v4 开始，先访问 v4，然后遍历 v4 的边链上的结点，发现得到的是 v3 的下标，已经访问过了，再下去没有了，于是结束。</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFSTraverse_ALG</span><span class="params">(AdjListGraph* G)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//  初始化状态数组</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G-&gt;v_count; i++)</span><br><span class="line">        visited[i] = UNVISITED;</span><br><span class="line">    <span class="comment">// DFS遍历</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G-&gt;v_count; i++)</span><br><span class="line">        <span class="keyword">if</span> (!visited[i]) <span class="comment">// 如果顶点没有被访问，就递归调用</span></span><br><span class="line">            DFS_ALG(G, i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS_ALG</span><span class="params">(AdjListGraph* G, <span class="keyword">int</span> index)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot; -&gt; %s&quot;</span>, G-&gt;vexes[index].data);    <span class="comment">// 访问顶点</span></span><br><span class="line">    visited[index] = VISITED;                  <span class="comment">// 更改状态</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">// 寻找邻接点</span></span><br><span class="line">    EdgeNode* eNode = G-&gt;vexes[index].firstEdge;</span><br><span class="line">    <span class="keyword">while</span> (eNode) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!visited[eNode-&gt;adjvex]) <span class="comment">// 如果邻接点未访问就递归访问</span></span><br><span class="line">            DFS_ALG(G, eNode-&gt;adjvex);</span><br><span class="line">        eNode = eNode-&gt;nextEdge;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>DFSTraverse_ALG()</code> 和 <code>DFSTraverse_AMG()</code> 是一样的，初始化状态数组，然后遍历顶点数组，调用 DFS 算法</p><p><code>DFS_AMG()</code> 中是遍历某一行，<code>DFS_ALG()</code> 中是遍历某一条链表，执行的逻辑都是如果邻接点为访问就递归。<br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201227114050613_21706.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201227114050613_21706.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h4 id="时间复杂度"><a href="#时间复杂度" class="headerlink" title="时间复杂度"></a>时间复杂度</h4><p>在遍历图时，对图中每个顶点至多调用一次 DFS 函数，因为一旦某个顶点被标志成已访问后，就不再从它出发进行搜索。<br>因此，深度遍历图的过程实质上是对每个顶点查找其邻接点的过程，其耗费时间取决于所采用的存储结构。</p><ul><li>当用邻接矩阵时，使用的是二位数组，查找每个顶点的邻接点所需时间为 $O(n^2)$，n 为图中顶点数。</li><li>当用邻接表时，使用的是链表，查找每个顶点的邻接点所需时间为 $O(e)$，e 为无向图中边的数量，或有向图中弧的数量。</li></ul><p>由此，<br>邻接矩阵的 DFS 时间复杂度为 $O(n^2 + n) = O(n^2)$<br>邻接表的 DFS 时间复杂度为 $O(n+e)$</p><h3 id="广度优先-BFS"><a href="#广度优先-BFS" class="headerlink" title="广度优先 BFS"></a>广度优先 BFS</h3><div class="note quote"><p>广度优先遍历 (Breadth-First-Search) 是仿树的层次遍历。该算法是利用队列实现的。</p></div><p>BFS 的思想是，把顶点都放到队列中，当访问一个顶点，即为出队一个元素；当出队一个元素时，需将其所有未访问的邻接点入队。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201227214919073_23879.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201227214919073_23879.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><ol><li>先从 v0 开始遍历，打印 v0，然后 v0 入队</li><li>队列不为空，v0 出队，同时 v0 的未入队且未访问的邻接点 v1、v3 入队，然后访问 v1、v3</li><li>队列不为空，v1 出队，同时 v1 的未入队且未访问的邻接点 v5、v6 入队，然后访问 v5、v6</li><li>队列不为空，v3 出队，同时 v3 的未入队且未访问的邻接点 v4 入队，然后访问 v4</li><li>队列不为空，v5 出队，同时 v5 的未入队且未访问的邻接点 v2 入队，然后访问 v2</li><li>队列不为空，v6 出队，同时 v6 已经没有未入队且为访问的邻接点了，不做入队操作</li><li>队列不为空，v4 出队</li><li>队列不为空，v2 出队<br>队列为空，结束<br>到此 BFS 执行完毕</li></ol><p>所以该图的 BFS 顺序为 <code>v0 -&gt; v1 -&gt; v3 -&gt; v5 -&gt; v6 -&gt; v4 -&gt; v2</code>。</p><h4 id="队列"><a href="#队列" class="headerlink" title="队列"></a>队列</h4><p>BFS 需要借助队列实现，下面是队列的代码：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LinkQueue.h</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> LINK_QUEUE_H_INCLUDED</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LINK_QUEUE_H_INCLUDED</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;GraphModel.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> Vertex Element;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 结点</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">QueueNode</span> &#123;</span></span><br><span class="line">    Element data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">QueueNode</span>* <span class="title">next</span>;</span></span><br><span class="line">&#125; QueueNode;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 队列</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    QueueNode* front;</span><br><span class="line">    QueueNode* rear;</span><br><span class="line">&#125; LinkedQueue;</span><br><span class="line"></span><br><span class="line"><span class="function">Status <span class="title">InitLinkedQueue</span><span class="params">(LinkedQueue* q)</span></span>;</span><br><span class="line"><span class="function">Status <span class="title">EnQueue</span><span class="params">(LinkedQueue* q, Element e)</span></span>;</span><br><span class="line"><span class="function">Status <span class="title">DeQueue</span><span class="params">(LinkedQueue* q, Element* e)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isEmptyQueue</span><span class="params">(LinkedQueue* q)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">PrintLinkedQueue</span><span class="params">(LinkedQueue* q)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// LINK_QUEUE_H_INCLUDED</span></span></span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LinkQueue.c</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;LinkQueue.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">Status <span class="title">InitLinkedQueue</span><span class="params">(LinkedQueue* q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    q-&gt;front = <span class="literal">NULL</span>;</span><br><span class="line">    q-&gt;rear = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Status <span class="title">EnQueue</span><span class="params">(LinkedQueue* q, Element e)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QueueNode* <span class="keyword">new</span> = <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(QueueNode));</span><br><span class="line">    <span class="keyword">new</span>-&gt;data = e;</span><br><span class="line">    <span class="keyword">new</span>-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isEmptyQueue(q)) &#123; <span class="comment">// 处理空队情况</span></span><br><span class="line">        q-&gt;front = q-&gt;rear = <span class="keyword">new</span>;</span><br><span class="line">        <span class="keyword">return</span> OK;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">// 处理非空队情况</span></span><br><span class="line">        q-&gt;rear-&gt;next = <span class="keyword">new</span>; <span class="comment">// 原队尾结点的next指向新结点</span></span><br><span class="line">        q-&gt;rear = <span class="keyword">new</span>; <span class="comment">// 更新队尾指针</span></span><br><span class="line">        <span class="keyword">return</span> OK;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ERROR;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Status <span class="title">DeQueue</span><span class="params">(LinkedQueue* q, Element* e)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (isEmptyQueue(q)) &#123; <span class="comment">// 空队直接返回</span></span><br><span class="line">        e = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">return</span> OK;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (q-&gt;front == q-&gt;rear) &#123; <span class="comment">// 处理队中只有一个结点的情况</span></span><br><span class="line">        *e = q-&gt;front-&gt;data;</span><br><span class="line">        <span class="built_in">free</span>(q-&gt;front);</span><br><span class="line">        q-&gt;front = q-&gt;rear = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">return</span> OK;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 处理队中不止一个结点的情况</span></span><br><span class="line">    QueueNode* del = q-&gt;front; <span class="comment">// 标记队头结点</span></span><br><span class="line">    q-&gt;front = del-&gt;next; <span class="comment">// 队头指针指向下一个结点</span></span><br><span class="line">    *e = del-&gt;data; <span class="comment">// 取数据</span></span><br><span class="line">    <span class="built_in">free</span>(del); <span class="comment">// 删除原队头结点</span></span><br><span class="line">    del = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isEmptyQueue</span><span class="params">(LinkedQueue* q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> q-&gt;front == <span class="literal">NULL</span> || q-&gt;rear == <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">PrintLinkedQueue</span><span class="params">(LinkedQueue* q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (isEmptyQueue(q)) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Queue Empty&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    QueueNode* p = q-&gt;front;</span><br><span class="line">    <span class="keyword">while</span> (p) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\t%s &quot;</span>, p-&gt;data);</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="邻接矩阵的-BFS"><a href="#邻接矩阵的-BFS" class="headerlink" title="邻接矩阵的 BFS"></a>邻接矩阵的 BFS</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** BFS begin */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BFSTraverse_AMG</span><span class="params">(MatrixGraph* G)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G-&gt;v_count; i++)</span><br><span class="line">        visited[i] = UNVISITED;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 循环遍历每个顶点</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G-&gt;v_count; i++)</span><br><span class="line">        <span class="keyword">if</span> (!visited[i]) <span class="comment">// 如果没有访问过就遍历访问</span></span><br><span class="line">            BFS_AMG(G, i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BFS_AMG</span><span class="params">(MatrixGraph* G, <span class="keyword">int</span> index)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;-&gt; %s &quot;</span>, G-&gt;vexes[index]);    <span class="comment">// 访问顶点</span></span><br><span class="line">    visited[index] = VISITED;             <span class="comment">// 更改访问状态</span></span><br><span class="line"></span><br><span class="line">    LinkQueue <span class="built_in">queue</span>;</span><br><span class="line">    InitLinkedQueue(&amp;<span class="built_in">queue</span>);            <span class="comment">// 初始化队列</span></span><br><span class="line">    EnQueue(&amp;<span class="built_in">queue</span>, G-&gt;vexes[index]);   <span class="comment">// 当前顶点入队，对应上图中第一步的 v0 入队</span></span><br><span class="line">    <span class="keyword">while</span> (!isEmptyQueue(&amp;<span class="built_in">queue</span>)) &#123;    <span class="comment">// 取出队头元素，遍历队头顶点的所有邻接点</span></span><br><span class="line"></span><br><span class="line">        Vertex vex;</span><br><span class="line">        DeQueue(&amp;<span class="built_in">queue</span>, &amp;vex);     <span class="comment">// 取出的队头顶点</span></span><br><span class="line">        <span class="comment">// 获取该顶点的所有邻接点</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = FirstAdjVex_AMG(G, vex); i; i = SecondAdjVex_AMG(G, vex, G-&gt;vexes[i])) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!visited[i]) &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;-&gt; %s &quot;</span>, G-&gt;vexes[i]);    <span class="comment">// 遇到顶点的邻接点先访问</span></span><br><span class="line">                visited[i] = VISITED;</span><br><span class="line">                EnQueue(&amp;<span class="built_in">queue</span>, G-&gt;vexes[i]);     <span class="comment">// 再入队</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">FirstAdjVex_AMG</span><span class="params">(MatrixGraph* G, Vertex v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> defaultWeight = G-&gt;kind &lt;= <span class="number">1</span> ? <span class="number">0</span> : INT_MAX; <span class="comment">// 图/网 的默认权重</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> vex_index = LocateVex(G, v); <span class="comment">// 获取顶点下标</span></span><br><span class="line">    <span class="keyword">if</span> (vex_index == <span class="number">-1</span>)</span><br><span class="line">        <span class="keyword">return</span> ERROR;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 搜索图的邻接矩阵中域顶点v的第一个邻接点下标</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; G-&gt;v_count; j++)</span><br><span class="line">        <span class="keyword">if</span> (G-&gt;matrix[vex_index][j] != defaultWeight)</span><br><span class="line">            <span class="keyword">return</span> j;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">SecondAdjVex_AMG</span><span class="params">(MatrixGraph* G, Vertex v1, Vertex v2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> defaultWeight = G-&gt;kind &lt;= <span class="number">1</span> ? <span class="number">0</span> : INT_MAX; <span class="comment">// 图/网 的默认权重</span></span><br><span class="line">    <span class="keyword">int</span> index1 = LocateVex(G, v1);</span><br><span class="line">    <span class="keyword">int</span> index2 = LocateVex(G, v2);</span><br><span class="line">    <span class="keyword">if</span> (index1 == <span class="number">-1</span> || index2 == <span class="number">-1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = index2 + <span class="number">1</span>; i &lt; G-&gt;v_count; i++)</span><br><span class="line">        <span class="keyword">if</span> (G-&gt;matrix[index1][i] != defaultWeight)</span><br><span class="line">            <span class="keyword">return</span> i;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/** BFS end */</span></span><br></pre></td></tr></table></figure><h4 id="邻接表的-BFS"><a href="#邻接表的-BFS" class="headerlink" title="邻接表的 BFS"></a>邻接表的 BFS</h4><p>按理来说邻接矩阵的 BFS 和邻接表的 BFS 应该是一样的，至少在无向图中是一样的。<br>但是如果邻接表是用的头插法，那可能结果是不一样的</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BFSTraverse_ALG</span><span class="params">(AdjListGraph* G)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G-&gt;v_count; i++)    <span class="comment">// 初始化状态数组</span></span><br><span class="line">        visited[i] = UNVISITED;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G-&gt;v_count; i++)    <span class="comment">// 遍历顶点数组，逐一对每一个未访问的顶点执行 BFS</span></span><br><span class="line">        <span class="keyword">if</span> (!visited[i])</span><br><span class="line">            BFS_ALG(G, i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BFS_ALG</span><span class="params">(AdjListGraph* G, <span class="keyword">int</span> index)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;-&gt; %s &quot;</span>, G-&gt;vexes[index].data);    <span class="comment">// 访问顶点</span></span><br><span class="line">    visited[index] = VISITED;                  <span class="comment">// 更改顶点状态</span></span><br><span class="line"></span><br><span class="line">    LinkQueue <span class="built_in">queue</span>;</span><br><span class="line">    InitLinkedQueue(&amp;<span class="built_in">queue</span>);</span><br><span class="line">    EnQueue(&amp;<span class="built_in">queue</span>, G-&gt;vexes[index].data);     <span class="comment">// 当前顶点入队</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!isEmptyQueue(&amp;<span class="built_in">queue</span>)) &#123;    <span class="comment">// 取出队头元素，遍历队头顶点的所有邻接点</span></span><br><span class="line">        Vertex vex;</span><br><span class="line">        DeQueue(&amp;<span class="built_in">queue</span>, &amp;vex);    <span class="comment">// 取出队头元素</span></span><br><span class="line">        <span class="comment">// 遍历所有邻接点</span></span><br><span class="line">        EdgeNode* node = G-&gt;vexes[LocateVex_ADJ(G, vex)].firstEdge;</span><br><span class="line">        <span class="keyword">while</span> (node) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!visited[node-&gt;adjvex]) &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;-&gt; %s &quot;</span>, G-&gt;vexes[node-&gt;adjvex].data);    <span class="comment">// 邻接点先访问</span></span><br><span class="line">                visited[node-&gt;adjvex] = VISITED;</span><br><span class="line">                EnQueue(&amp;<span class="built_in">queue</span>, G-&gt;vexes[node-&gt;adjvex].data);    <span class="comment">// 再入队</span></span><br><span class="line">            &#125;</span><br><span class="line">            node = node-&gt;nextEdge;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="时间复杂度-1"><a href="#时间复杂度-1" class="headerlink" title="时间复杂度"></a>时间复杂度</h4><p>在遍历图时，每个顶点最多进一次队列，遍历图的过程实质上是通过边或弧找邻接点的过程。<br>因此，广度优先搜索、深度优先搜索，在遍历图时的时间复杂度是相同的。</p><h2 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h2><ol><li><p>存储结构：</p><ul><li><strong>邻接矩阵</strong>：一维数组存储顶点集+二维数组存储边/弧</li><li><strong>邻接表</strong>：一维数组存储顶点集+单链表存储边/弧<ul><li><strong>出边表</strong>：链表的结点存储的是弧头的下标</li><li><strong>入边表</strong>：链表的结点存储的是弧尾的下标</li></ul></li><li><strong>十字链表</strong>：将出边表和入边表整合起来，主要针对有向图</li><li><strong>邻接多重表</strong>：将所有边链的结点整合起来，去除重复的结点，主要针对无向图</li><li><strong>边集数组</strong>：一维数组存储顶点集+一维数组存储边集，关注的是边</li></ul></li><li><p>图的遍历：</p><ul><li><strong>深度优先搜索 DFS</strong> 和 <strong>广度优先搜索 BFS</strong> 是图的最基本的遍历方式。</li><li>DFS 是仿树的前序遍历，利用栈做辅助，具体实现是不断将当前顶点的第一个未访问邻接点拿去递归。</li><li>BFS 是仿树的层序遍历，利用队列做辅助，具体实现是每当出队一个元素时，就访问其所有未访问且未入队的邻接点，并将这些邻接点入队。</li><li>使用邻接矩阵存储和使用邻接表存储的图在做 DFS 或 BFS 时没什么区别，只不过邻接矩阵是操作二维数组，邻接表是操作链表。</li></ul></li></ol><hr><p>[^1]: 对称矩阵：n 阶矩阵的元满足 $a_{ij} = a_{ji}, (0 \leq i, j \leq n)$，即从矩阵左上角到右下角的主对角线为轴，右上角的元与左下角相对应的元完全相等。</p>]]></content>
      
      
      <categories>
          
          <category> DataStruction </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构 </tag>
            
            <tag> DataStruction </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DataStruction 0x07 图-1</title>
      <link href="posts/55674"/>
      <url>posts/55674</url>
      
        <content type="html"><![CDATA[<p>什么是图？</p><span id="more"></span><h1 id="7-图"><a href="#7-图" class="headerlink" title="7-图"></a>7-图</h1><p>图 是有顶点的有穷非空集合和顶点之间边的集合组成，通常表示为：<strong>G（ V, E ）</strong><br>其中 G 表示一个图，V 是顶点集合，E 是边的集合。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201218174755925_13428.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201218174755925_13428.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>线性表的数据元素 -&gt; 元素 Element<br>树中的数据元素 -&gt; 结点 Node<br>图中的数据元素 -&gt; <span class='p blue'>顶点 Vertex</span>[^0]</p><p>线性表没有数据元素 -&gt; 空表<br>树中没有数据元素 -&gt; 空树<br>图中没有数据元素 -&gt; <emp>不行！</emp></p><p>线性表中，相邻的元素之间具有线性关系<br>树中，相邻的两层之间具有层次关系<br>图中，任意两个顶点之间都可能有关系。顶点之间的逻辑关系用边来表示。边集可以为空。</p><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><h3 id="无向边"><a href="#无向边" class="headerlink" title="无向边"></a>无向边</h3><p>若顶点 vi 到 vj 之间的边没有方向，则称这条边为<span class='p blue'>无向边（Edge）</span>[^1]，用<strong>无序偶对（vi, vj）</strong> 来表示。<br>如果图中任意两个顶点之间的边都是无向边，则称该图为<span class='p blue'>无向图（Undirected graphs）</span>[^2]。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201220094008757_30834.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201220094008757_30834.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>上图就是一个无向图，K 到 T 之间的边可以表示成无序对（K, T）或者（T, K）。<br>而整个图可以描述成为: <span class='p green'>G1 = (V1，{E1})</span>，<br>其中顶点集合 <code>V1=&#123;G, Z, K, T, C&#125;</code>；<br>边集合 <code>E1 = &#123; (G, Z), (G, K), (Z, K), (Z, T), (K, T), (K, C), (T, C) &#125;</code>；</p><h3 id="有向边"><a href="#有向边" class="headerlink" title="有向边"></a>有向边</h3><p>若顶点 vi 到 vj 之间的边有方向，则称这条边为<span class='p blue'>弧（Arc）</span>[^3]。<br>用<strong>无序偶对 &lt;vi, vj&gt;</strong> 来表示： $v_i \to v_j$，</p><p>vi 称为弧尾（Tail），即指出去的那个；<br>vj 称为弧头（Head），即被指的那个。</p><p>如果图中任意两个顶点之间的边都是有向边，则称该图为<span class='p blue'>有向图（Directed graphs）</span>[^4]。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201220094650808_9267.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201220094650808_9267.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>上图就是一个有向图，连接 G 到 K 的边就是弧，K 是弧头，被指向的那个，G 是弧尾，指出去的那个。<br>&lt;G, k&gt; 表示弧，不能写为 &lt;K, G&gt;。<br>而整个图可以描述成为 <span class='p green'>G2 = (V2，{E2})</span>，<br>其中顶点集合 <code>V2 = &#123;G, Z, K, T, C&#125;</code>；<br>弧集合 <code>E2 = &#123; &lt;G, K&gt;, &lt;Z, G&gt;, &lt;Z, K&gt;, &lt;K, T&gt;, &lt;T, Z&gt;, &lt;T, C&gt;, &lt;C, K&gt; &#125;</code>；</p><div class="note warning"><p>注意：无向边用 () 表示， 有向边用 &lt; &gt; 表示。</p></div><h3 id="简单图"><a href="#简单图" class="headerlink" title="简单图"></a>简单图</h3><p>在图中若不存在<span class='p red'>顶点到其自身的边</span>，且同一条边不重复出现，则称这样的图为<span class='p blue'>简单图</span>[^5]。<br>在无向图中，如果任意两个顶点之间都存在边，则称该图为<span class='p blue'>无向完全图（Undirected Completed graph）</span>[^6]<br>在有向图中，如果任意两个顶点之间都存在方向互为相反的两条弧，则称该图为<span class='p blue'>有向完全图（Directed graph）</span>。[^7]<br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201220104816617_23813.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201220104816617_23813.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>含有 n 个顶点的无向完全图有 $\frac {n(n-1)} 2$ 条边，如上图的无向完全图有4个顶点，边数为 $4 \times 3 \div 2 = 6$</p><p>含有 n 个顶点的有向完全图有 $n \times (n-1)$ 条边，如上图的有向完全图有4个顶点，边数为 $4 \times 3 = 12$</p><div class="note quote blue"><p>推广一下：</p><p>在非完全的图中，设图具有 n 个顶点和 e 条边，</p><p>若该图为无向图则 $0 \leq e \leq \frac {n(n-1)} 2$</p><p>若该图为有向图则 $0 \leq e \leq n(n-1)$</p></div><p>有很少条边或弧称为<strong>稀疏图（Sparse greph）</strong>，反之称为<strong>稠密图（Dense greph）</strong>。稀疏和稠密的相对的概念，没有严格定义。</p><h3 id="权、网"><a href="#权、网" class="headerlink" title="权、网"></a>权、网</h3><p>图的边或弧有相关的数值，这个数叫做<span class='p blue'>权（Weight）</span>[^8]，可以表示一个顶点到另一个顶点的距离或耗费等等。<br>这种带全的图通常称为<span class='p blue'>网（Network）</span>[^9]。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201220111713099_20823.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201220111713099_20823.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h3 id="子图"><a href="#子图" class="headerlink" title="子图"></a>子图</h3><p>假设两个图 $G = (V, {E})$ 和 $G’ = (V’, {E’})$，如果 $V’ \subseteq V$ 且 $E’ \subseteq E$，则称 G’ 为 G 的<span class='p blue'>子图（Subgraph）</span>[^10]。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201220112758881_17487.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201220112758881_17487.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h2 id="图的顶点和边间的关系"><a href="#图的顶点和边间的关系" class="headerlink" title="图的顶点和边间的关系"></a>图的顶点和边间的关系</h2><h3 id="度"><a href="#度" class="headerlink" title="度"></a>度</h3><h4 id="无向图的度"><a href="#无向图的度" class="headerlink" title="无向图的度"></a>无向图的度</h4><p>对于无向图 <strong>G = (V, {E})</strong></p><ul><li>如果边 $(v, v’) \in E$，则称顶点 v 和 v’ 互为 <strong>邻接点（Adjacent）</strong>，即 v 和 v’ 相邻接。</li><li>边 (v, v’)  <strong>依附（Incident）</strong> 于顶点 v 和 v’，即边（v, v’）与顶点 v 和 v’ 相关联。</li><li>顶点 v 的<span class='p blue'>度（Degree）</span>[^11] 是和 v 相关的边的数量，记为 <strong>TD（v）</strong>。</li></ul><p>eg: <img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201220113706946_13545.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201220113706946_13545.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>例如这个图，顶点 G 和 K 互为邻接点，边 （G, K）依附于 G 和 K 上，K顶点的度为 3。</p><p>图的边数为 5，各个顶点的度的和 = 3+3+2+2 = 10，其中重复两次计数，所以<strong>边数应为个顶点度数之和的一半</strong>。</p><p>记作 </p><p>$$e= \frac 1 2 \sum_{i=1}^n TD(v_i)$$</p><h4 id="有向图的度"><a href="#有向图的度" class="headerlink" title="有向图的度"></a>有向图的度</h4><p>对于有向图 <strong>G = (V, {E})</strong></p><ul><li>如果弧 $\langle v, v’ \rangle \in E$，则称：顶点 v 邻接到 v’，顶点 v’ 邻接自 v。顶点 v 和 v’ 互为<strong>邻接点（Adjacent）</strong>。</li><li>弧 &lt;v, v’&gt; <strong>依附（incident）</strong> 于顶点 v 和 v’，即弧 &lt;v, v’&gt; 与 顶点 v 和 v’ 相关联。</li><li>以顶点 v 为头的弧的数量称为 v 的<span class='p blue'>入度（InDegree）</span>[^12]，记为 <strong>ID（v）</strong>;</li><li>以顶点 v 为尾的弧的数量称为 v 的<span class='p blue'>出度（OutDegree）</span>[^13]，记为 <strong>OD（v）</strong>;</li><li>顶点 v 的<strong>度（Degree）</strong> 为 <strong>TD（v） = ID（v） + OD（v）</strong>。</li></ul><p>eg: <img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201220134157213_390.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201220134157213_390.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>例如这个图，顶点 G 和 K 互为邻接点，顶点 G 邻接到 K，K 邻接自 G。</p><p>边 （G, K）依附于 G 和 K 上，顶点 K 的入度为 2，$ID(K) = 2$，出度为 1，$OD(K) = 1$，度为 $TD(K) = ID(K) + OD(K) = 3$</p><p>图的弧数为 5，各个顶点的入度和 = 1+2+2+0 = 5，出度和 = 1+1+0+3 = 5；</p><p>由此可得有向图的弧数: </p><p>$$e= \sum_{i=1}^n ID(V_i) = \sum_{i=1}^n OD(v_i)$$</p><h3 id="路径"><a href="#路径" class="headerlink" title="路径"></a>路径</h3><p>无向图**G = (V, {E})**中从顶点 v 到顶点 v’ 的<span class='p blue'>路径（Path）</span>[^14]是一个顶点序列 $(v = v_{i,0}, v_{i,1}, …, v_{i,m} = v’)$，其中 $(v_{i,j-1}, v_{i,j}) \in E, 1\leq j \leq m$。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201220141655092_23529.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201220141655092_23529.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="G到T的四种路径"><br>G 到 T 有四种路径。</p><p>如果 G 是有向图，则路径也是有向的，顶点序列应满足 $\langle v_{i,j-1}, v_{i,j}\rangle \in E, 1 \leq j \leq m$。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201220142137334_4928.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201220142137334_4928.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="G到T只有一种路径"></p><p>上图种 G 到 T 只有一种路径，其他路径都不行。因为 G 到 Z 不存在路径。</p><span class='p blue'>路径的长度</span>[^15]是路径上的边或弧的数量。例如上图的有向图，G到T的路径长度为2。<p>第一个顶点到最后一个顶点相同的路径称为<span class='p blue'>回路（circuit）或环（Cycle）</span>[^16]。</p><p>序列种顶点不重复出现的路径为<span class='p blue'>简单路径</span>[^17]。</p><p>除了第一个顶点和最后一个顶点之外，其余顶点不重复出现的回路，称为<strong>简单回路（Simple circuit）</strong>或<strong>简单环（Simple Cycle）</strong>。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201220142923502_21890.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201220142923502_21890.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>左边图路径为 {B, C, D, A, B}，第一个顶点和最后一个顶点都是 B，且 C、D、A没有重复出现，所以是一个简单环<br>右边图路径为 {B, C, D, A, C, B}，由于 C 重复，所以不是简单环。</p><h2 id="连通图"><a href="#连通图" class="headerlink" title="连通图"></a>连通图</h2><h3 id="无向连通图"><a href="#无向连通图" class="headerlink" title="无向连通图"></a>无向连通图</h3><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201220150322079_7679-2.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201220150322079_7679-2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>无向图中：<br>任意两个顶点之间都有<strong>直接或间接</strong>的路径，即都能到达，则称这个图为<span class='p blue'>连通图（Connected Graph）</span>[^18]。<br>例如 图1 就是非连通图，应为顶点 5 和 6 没有路径到顶点 1、2、3、4，而图2、3、4 就是连通图。</p><p>无向图中的<strong>极大连通子图（Great Connected Subgraph）</strong>称为<span class='p blue'>连通分量（Connected Component）</span>[^19]，它强调：</p><ul><li>必须是子图（<strong>子图</strong>）</li><li>子图是连通的（<strong>连通</strong>）</li><li>连通子图含有极大顶点数（<strong>有极大顶点数</strong>）</li><li>具有极大顶点数的连通子图包含依附于这些顶点的所有边。（<strong>含有边</strong>）</li></ul><p>例如 图1就是一个无向非连通图，但是它有两个连通分量 图2 和 图3，而 图4 虽然是 图1 的子图，但是不满足连通子图的极大顶点数（图2 满足），所以不是连通分量。</p><h3 id="有向连通图"><a href="#有向连通图" class="headerlink" title="有向连通图"></a>有向连通图</h3><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201220152619974_29235.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201220152619974_29235.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>有向图中：<br>任意两个顶点都有直接路径或间接路径，则称这个图为<span class='p blue'>强连通图（Strong Connected Graph）</span>[^20]。<br>有向图中的<strong>极大强连通子图（Great Strong Connected Subgraph）</strong>称作有向图的<span class='p blue'>强连通分量（Strong Connected Component）</span>[^21]。</p><p>例如 图1 就不是一个强连通图，因为 1 到 4 有路径，而 4 到 1 没路径。而 图2 就是 图1 的极大强连通子图，即它的强连通分量。</p><h3 id="生成树、生成森林"><a href="#生成树、生成森林" class="headerlink" title="生成树、生成森林"></a>生成树、生成森林</h3><h4 id="生成树"><a href="#生成树" class="headerlink" title="生成树"></a>生成树</h4><blockquote><p>对连通图进行遍历，过程中所经过的边和顶点的组合可看做是一棵普通树，通常称为<span class='p blue'>生成树（Spanning Tree）</span>[^22]。 </p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201221061510102_9801.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201221061510102_9801.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="连通图及其对应的生成树"></p><p>左边是一张连通图，右边则是其对应的两种生成树。<br>连通图中，任意两顶点之间可能还有多条路径，遍历连通图的方式有多种，往往一张连通图可能有多种不同的生成树与之对应。</p><div class="note quote blue"><p>连通图中的生成树必须满足以下2个条件：</p><ol><li>包含连通图中所有的顶点；</li><li>任意两顶点之间有且仅有一条通路；</li></ol><p>因此，连通图的生成树具有这样的特征：生成树中 <code>边的数量 = 顶点数 - 1</code>。</p><p>$$<br>\begin{cases}<br>非连通图, &amp;  顶点个数 = n;边数 \lt n-1 \\<br>生成树,   &amp;  顶点个数 = n;边数 = n-1 \\<br>一定有环, &amp;  顶点个数 = n;边数 \gt n-1 \\<br>\end{cases}<br>$$</p></div><h4 id="生成森林"><a href="#生成森林" class="headerlink" title="生成森林"></a>生成森林</h4><div class="note quote blue"><p>生成树的对于连通图来说的，而生成森林则是对应非连通图来说的。<br>非连通图可以分解为多个连通分量，而每个连通分量又各自对应多棵生成树，因此与整个非连通图相对应的，是由多棵生成树组成的<span class='p blue'>生成森林（Spanning Forest）</span>[^23]。</p></div><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201221062312094_8712.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201221062312094_8712.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="非连通图和连通分量"></p><p>上图左边是一张非连通图，可以分解为右边三个连通分量，其中各个连通分量对应的生成树如下所示：</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201221062901311_2544.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201221062901311_2544.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="生成森林"><br>上图只是列出各个连通分量的其中一种生成树。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul><li>图由顶点和边组成，<span class='p green'>无向图由 顶点 和 边 构成</span>；<span class='p red'>有向图由 顶点 和 弧 构成，弧分 弧头弧尾</span>。</li><li>任两个顶点之间都存在边叫<strong>完全图</strong>，分<strong>有向完全图</strong>和<strong>无向完全图</strong>。同一条边不重复出现的图叫<strong>简单图</strong>。</li><li>顶点之间有<strong>邻接点</strong>、<strong>依附</strong>的概念，<span class='p green'>无向图的顶点的边数叫 度</span>，<span class='p red'>有向图的顶点分 出度 和 入度 ，度 = 出+入</span>。</li><li>从图的顶点集和边集中取一小部分组成新的图，称为原图的<strong>子图</strong>。</li><li>带数值的边叫<strong>权</strong>，顶点和权构成<strong>网</strong></li><li>图中顶点间存在<strong>路径</strong>，两顶点存在路径则说明是<strong>连通</strong>的，如果路径最终回到起始点则称为<strong>环</strong>，当中顶点没有重复过称为<strong>简单路径</strong>。若任意两顶点都是连通的，则图是<strong>连通图</strong>，有向则是<strong>强连通图</strong>。图中有子图，若子图极大连通则称<strong>连通分量</strong>，有向则称<strong>强连通分量</strong>。</li><li>无向图中连通且<code>边数 = 顶点数 - 1</code> 的树叫<strong>生成树</strong>，无向非连通图的连通分量生成的生成树一起构成<strong>生成森林</strong>。</li><li>有向图中一个顶点入度为 0，其他顶点的入度为1的叫<strong>有向树</strong>。一个有向图由若干棵有向树构成生成森林。</li></ul><p>[^0]: 顶点 -&gt; 图的数据元素</p><p>[^1]: 无向边 -&gt; 边没有方向</p><p>[^2]: 无向图 -&gt; 边没有方向的图，n个顶点的无向图最多有 $\frac {n(n-1)} 2$ 条边</p><p>[^3]: 弧 -&gt; 边有方向；弧有弧头弧尾之分</p><p>[^4]: 有向图 -&gt; 边有方向的图，n个顶点的有向图最多有 $n(n-1)$ 条边</p><p>[^5]: 简单图 -&gt; 同一条边不重复出现的图</p><p>[^6]: 无向完全图 -&gt; 任意两个顶点之间都有边，共有 $\frac {n(n-1)} 2$ 条边</p><p>[^7]: 有向完全图 -&gt; 任意两个顶点之间都有弧，共有 $n(n-1)$ 条弧</p><p>[^8]: 权 -&gt; 有数值的边</p><p>[^9]: 网 -&gt; 顶点+权</p><p>[^10]: 子图 -&gt; 从原图中拆出来的图</p><p>[^11]: 度 -&gt;顶点的边数</p><p>[^12]: 入度 -&gt; 邻接到顶点的边的数量</p><p>[^13]: 出度 -&gt; 顶点邻接出去的边的数量</p><p>[^14]: 路径 -&gt; 两个顶点之间的直接线路或间接线路的边集序列，注意是序列，所以可能不止一条</p><p>[^15]: 路径长度 -&gt; 两个顶点之间的线路的边数</p><p>[^16]: 回路或环 -&gt; 从起始点离开最后到达起始点的路径</p><p>[^17]: 简单路径 -&gt; 回路上没有重复的点的路径</p><p>[^18]: 连通图 -&gt; 任意两顶点都是连通的无向图</p><p>[^19]: 连通分量 -&gt; 无向图的极大连通的子图</p><p>[^20]: 强连通图 -&gt; 任意两顶点都是连通的有向图</p><p>[^21]: 强连通分量 -&gt; 有向图的极大连通的子图</p><p>[^22]: 生成树 -&gt; 无向连通图生成的 边的数量 = 顶点数 -1 的树</p><p>[^23]: 生成森林 -&gt; 无向非连通图的连通分量生成的生成树一起构成生成森林 </p>]]></content>
      
      
      <categories>
          
          <category> DataStruction </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构 </tag>
            
            <tag> DataStruction </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DataStruction 0x06 树</title>
      <link href="posts/48872"/>
      <url>posts/48872</url>
      
        <content type="html"><![CDATA[<p>什么是树？</p><span id="more"></span><h1 id="6-树"><a href="#6-树" class="headerlink" title="6-树"></a>6-树</h1><p>前面的线性表、广义表、栈、队、串，都是一对一的数据结构。<br>现在开始我们要讨论一种一对多的数据结构: <span class='p blue'>树</span>。</p><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><blockquote><p>树是 n 个结点的有限集。</p></blockquote><p>n=0 时称为 <span class='p blue'>空树</span>。<br>n&gt;1 时，有且仅有一个特定的根节点 root，其余结点可分为 m（m&gt;0）个互不相交的有限集 $T_1、T_2、…、T_m$，其中每个集合本身又是一棵树，称为 <span class='p blue'>子树</span>。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201215140616085_25463.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201215140616085_25463.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="树"></p><h2 id="名词解释"><a href="#名词解释" class="headerlink" title="名词解释"></a>名词解释</h2><table><thead><tr><th align="left">名词</th><th align="left">解释</th><th align="left">示例</th></tr></thead><tbody><tr><td align="left"><strong>结点</strong></td><td align="left">树中的一个独立单元。包含一个数据元素及若干指向其他子树的分支。</td><td align="left">eg：图中每一个圆圈都是结点。</td></tr><tr><td align="left"><strong>结点的度</strong></td><td align="left">结点拥有的子树的数量。</td><td align="left">eg：A的度为3，B的度为2，C的度为1。</td></tr><tr><td align="left"><strong>树的度</strong></td><td align="left">树内各结点的度的最大值。</td><td align="left">eg：上面的树的度为3。</td></tr><tr><td align="left"><strong>树的高度（深度）</strong></td><td align="left">树中的最大层数。</td><td align="left">eg：图中树的深度（高度）为 4。</td></tr><tr><td align="left"><strong>叶子结点</strong></td><td align="left">度为0的结点，也称终端结点。</td><td align="left">eg：K、L、F、G、M、I、J 都是叶子结点。</td></tr><tr><td align="left"><strong>分支结点</strong></td><td align="left">度不为0的结点，也称非终端结点。</td><td align="left">eg： A、B、C、D、E、H 都是非终端结点。</td></tr><tr><td align="left"><strong>双亲结点</strong></td><td align="left">一个结点的直接前驱结点称为其双亲结点。</td><td align="left">eg：E的双亲为B，G的双亲为C。</td></tr><tr><td align="left"><strong>孩子结点</strong></td><td align="left">一个结点的所有直接后继结点称为其孩子结点。</td><td align="left">eg：B的子结点为E、F，H的子结点为M。</td></tr><tr><td align="left"><strong>兄弟结点</strong></td><td align="left">同一个双亲的子结点之间互称兄弟结点。</td><td align="left">eg：H的兄弟结点为I、J。</td></tr><tr><td align="left"><strong>祖先</strong></td><td align="left">从一个结点到根节点所经分支上的所有结点。</td><td align="left">eg：K的祖先为E、B、A。</td></tr><tr><td align="left"><strong>子孙</strong></td><td align="left">一个结点所有直接和间接后继结点。</td><td align="left">eg：D的子孙为H、I、J、M。</td></tr><tr><td align="left"><strong>堂兄弟</strong></td><td align="left">双亲在同一层的结点互为堂兄弟。</td><td align="left">eg：G与E、F、H、I、J 互为堂兄弟。</td></tr><tr><td align="left"><strong>层</strong></td><td align="left">根为第一层，根的孩子为第二层，以此类推</td><td align="left">eg：A为1层，B、C、D为2层，K、L、M为3层。</td></tr></tbody></table><span class='p blue'>有序树、无序树</span>：树中的结点从左至右依次有序不能互换，称为有序，否则称为无序。有序树中最左边的子树称为根节点的第一个孩子，最右边称为根节点的最后一个孩子。<span class='p blue'>森林</span>：m棵不相交的树的集合。<h2 id="ADT"><a href="#ADT" class="headerlink" title="ADT"></a>ADT</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">ADT Tree</span><br><span class="line">Data</span><br><span class="line">    树是由一个根结点和若干子树构成。树中结点具有相同数据类型及层次关系。</span><br><span class="line">Operation</span><br><span class="line">    InitTree(<span class="built_in">T</span>*): 构造空树<span class="built_in">T</span></span><br><span class="line">    DestoryTree(<span class="built_in">T</span>*): 销毁树<span class="built_in">T</span></span><br><span class="line">    CreateTree(<span class="built_in">T</span>*, definition): 按definition中给出的树的定义来构造树</span><br><span class="line">    ClearTree(<span class="built_in">T</span>*): 若树<span class="built_in">T</span>存在，则将树<span class="built_in">T</span>清空为空树</span><br><span class="line">    TreeEmpty(<span class="built_in">T</span>): 若<span class="built_in">T</span>为控诉，返回true，否则返回false</span><br><span class="line">    TreeDepth(<span class="built_in">T</span>): 返回树<span class="built_in">T</span>的深度</span><br><span class="line">    Root(<span class="built_in">T</span>): 返回<span class="built_in">T</span>的根节点</span><br><span class="line">    Value(<span class="built_in">T</span>, cur_e): cur_e 是树<span class="built_in">T</span>中一个结点，返回此结点的值</span><br><span class="line">    Assign(<span class="built_in">T</span>, cur_e, value): 给树<span class="built_in">T</span>的结点cur_e赋值为 value</span><br><span class="line">    Parent(<span class="built_in">T</span>, cur_e): 若 cur_e 是树<span class="built_in">T</span>的非根结点，则返回它的双亲，否则返回空</span><br><span class="line">    LeftChild(<span class="built_in">T</span>, cur_e): 若 cur_e 是树<span class="built_in">T</span>的非叶结点，则返回它的最左孩子，否则返回空</span><br><span class="line">    RightSibling(<span class="built_in">T</span>, cur_e): 若 cur_e 有右兄弟，则返回它的右兄弟，否则返回空</span><br><span class="line">    InsertChild(<span class="built_in">T</span>*, p*, i, <span class="built_in">c</span>): 其中p指向树<span class="built_in">T</span>的某个结点，i为所指结点p的度+<span class="number">1</span>，非空树<span class="built_in">c</span>与<span class="built_in">T</span>不相交，操作结果为插入<span class="built_in">c</span>为树<span class="built_in">T</span>中p指结点的第i棵子树</span><br><span class="line">    DeleteChild(<span class="built_in">T</span>*, p*, i): 其中p指向树<span class="built_in">T</span>的某个结点，i为所指结点p的度，操作结果为删除<span class="built_in">T</span>中p所指结点的第i棵子树</span><br><span class="line">endADT</span><br></pre></td></tr></table></figure><h2 id="存储结构"><a href="#存储结构" class="headerlink" title="存储结构"></a>存储结构</h2><h3 id="顺序结构"><a href="#顺序结构" class="headerlink" title="顺序结构"></a>顺序结构</h3><h4 id="双亲表示法"><a href="#双亲表示法" class="headerlink" title="双亲表示法"></a>双亲表示法</h4><p>除了根节点，其他结点一定有双亲结点</p><p>双亲表示法有两种：</p><ol><li>只能简单的记录结点关系的一维数组</li><li>带数据域和指示域的多维数组</li></ol><p>我们利用<strong>一维数组</strong>，下标表示树中的结点，数组元素的内容表示该结点的双亲结点。<br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201215175910605_32586.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201215175910605_32586.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="简单双亲表示法"></p><p>用<strong>结构数组</strong>，每个结点附设一个指示器指示其双亲结点在表中的位置。<br>上图的树用多维数组表示为：</p><table><thead><tr><th>下标</th><th>数据</th><th>双亲</th></tr></thead><tbody><tr><td>0</td><td>A</td><td>-1</td></tr><tr><td>1</td><td>B</td><td>0</td></tr><tr><td>2</td><td>C</td><td>0</td></tr><tr><td>3</td><td>D</td><td>1</td></tr><tr><td>4</td><td>E</td><td>1</td></tr><tr><td>5</td><td>F</td><td>2</td></tr><tr><td>6</td><td>G</td><td>2</td></tr><tr><td>7</td><td>H</td><td>3</td></tr></tbody></table><p>用代码实现如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_TREE_SIZE 100</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">char</span> Element;    <span class="comment">// 数据元素类型，暂定为字符型</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    Element data;    <span class="comment">// 数据域</span></span><br><span class="line">    <span class="keyword">int</span> parent;      <span class="comment">// 双亲位置</span></span><br><span class="line">&#125; PTNode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    PTNode nodes[MAX_TREE_SIZE];    <span class="comment">// 结点数组</span></span><br><span class="line">    <span class="keyword">int</span> root, node_count;    <span class="comment">// 根的位置和结点数</span></span><br><span class="line">&#125; PTree;</span><br><span class="line"></span><br><span class="line"><span class="function">Status <span class="title">insert</span><span class="params">(PTree* pt, Element e, <span class="keyword">int</span> p)</span> </span>&#123;</span><br><span class="line">    pt-&gt;nodes[pt-&gt;node_count].data = e;</span><br><span class="line">    pt-&gt;nodes[pt-&gt;node_count].parent = p;</span><br><span class="line">    <span class="keyword">if</span> (p == <span class="number">-1</span>) pt-&gt;root = pt-&gt;node_count;</span><br><span class="line">    pt-&gt;node_count++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这种结构的话很容易找到一个结点的双亲结点，如果parent为-1即表示此结点为根节点。<br>但是如果要找结点的孩子，只能遍历整个数组。</p><h3 id="链式结构"><a href="#链式结构" class="headerlink" title="链式结构"></a>链式结构</h3><h2 id="二叉树-Binary-Tree"><a href="#二叉树-Binary-Tree" class="headerlink" title="二叉树 Binary Tree"></a>二叉树 Binary Tree</h2><h3 id="定义-1"><a href="#定义-1" class="headerlink" title="定义"></a>定义</h3><span class='p blue'>二叉树</span> 是 n（n >= 0）个结点的有限集合，该集合或者为空集，或者有一个根结点和两棵不相交的分别称为根结点的左子树和右子树的二叉树组成。<p>一棵树的度为 n 时，又称 <span class='p blue'>n 叉树</span>。所以二叉树的度为2，即每个结点最多有2个子结点。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201216081239101_25443.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201216081239101_25443.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="二叉树"></p><h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><ol><li>每个结点<strong>最多</strong>有两棵子树，所以二叉树中不存在度 &gt; 2 的结点。</li><li>左子树和右子树是有顺序的，次序不能任意颠倒。就像左手是左手，右手是右手，不能互换。</li><li>即使树中某结点只有一棵子树，也要区分是左子树还是右子树。就像摔伤了左手还是右手，对你生活的影响程度是不一样的。</li></ol><p>二叉树有5种基本形态：</p><ol><li>空二叉树</li><li>只有根节点</li><li>根节点+左子树</li><li>根节点+右子树</li><li>根节点+左子树+右子树</li></ol><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201216082358074_31113.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201216082358074_31113.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="5种状态"></p><h3 id="斜树"><a href="#斜树" class="headerlink" title="斜树"></a>斜树</h3><p>所有结点都只有左子树的二叉树叫<span class='p blue'>左斜树</span><br>所有结点都只有右子树的二叉树叫<span class='p blue'>右斜树</span></p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201216082826369_2489.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201216082826369_2489.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>斜树有很明显的特点，每一层都只有一个结点，结点的个数与二叉树的深度相同。</p><h3 id="满二叉树"><a href="#满二叉树" class="headerlink" title="满二叉树"></a>满二叉树</h3><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201216083439113_16887.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201216083439113_16887.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="满二叉树"></p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201216084807345_31935.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201216084807345_31935.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="满二叉树"></p><p>在一棵二叉树中，所有分支节点都有左子树和右子树，且所有叶结点都在同一层，则称为 <span class='p blue'>满二叉树</span>。</p><p>注意单是每个结点都存在左右子树还不够，那样只算完全二叉树，还需要叶子节点都在同一层。<br>满二叉树的特点有：</p><ol><li>叶结点只能出现在最下层，其他层出现就不可能达成平衡</li><li>分支结点的度必须 = 2，否则就是缺胳膊少腿了。</li><li>在同样深度的二叉树中，满二叉树的结点树最多，叶子最多。</li></ol><h3 id="完全二叉树"><a href="#完全二叉树" class="headerlink" title="完全二叉树"></a>完全二叉树</h3><p>对一棵具有 n 个结点的二叉树按层序编号，如果<code>编号为 i（1 &lt;= i &lt;= n）的结点</code>与<code>同样深度的满二叉树中编号为i的结点</code>在二叉树中位置完全相同，则这棵二叉树称为完全二叉树。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201216084851875_2060.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201216084851875_2060.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>一棵满二叉树一定是完全二叉树，一棵完全二叉树不一定是满二叉树。</p><p>注意完全二叉树是<strong>按层序编号</strong></p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201216091502929_18400.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201216091502929_18400.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>第 2 棵树虽然有些结点没有连续，但是因为每个结点都是按层序编号，和满二叉树能对应，所以<strong>是</strong>完全二叉树</p><p>第 3 棵树由于叶结点出现在最后一层（编号 8、9、10）和倒数第三层（编号 3），叶子结点层数差超过 1，所以<strong>不是</strong>完全二叉树</p><p>第 4 棵树应为 12 的结点编号为 11，所以<strong>不是</strong>完全二叉树。</p><p>完全二叉树的特点：</p><ol><li>叶子结点只能出现在最下面两层。</li><li>最下层的叶子一定集中在左部连续位置。</li><li>倒数两层，若有叶子结点，一定都在右部连续位置</li><li>如果结点度为 1，则该结点只有左孩子，不能只有右孩子。</li><li>同样结点数的二叉树，完全二叉树的深度最小。</li></ol><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201216091948123_5948.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201216091948123_5948.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>上图这两颗就是正确的完全二叉树。<br>左边为满二叉树，右边为完全二叉树。</p><p>看右边那棵，叶结点只在最下两层（7、8、9、10、11、12），度为1时只有左孩子（6 -&gt; 12）</p><h3 id="性质"><a href="#性质" class="headerlink" title="性质"></a>性质</h3><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201216091948123_5948.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201216091948123_5948.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><div class="note radiation"><div class="note guide blue"><p>性质1：在二叉树的第 i 层上最多有 $2^{i-1}$ 个结点。</p></div><details yellow><summary>  </summary>              <div class='content'>              <p>第一层是根结点，只有1个结点，$2^{1-1} = 2^0 = 1$</p><p>第二层最多有2个结点，$2^{2-1} = 2^1 = 2$</p><p>第三层最多有4个结点，$2^{3-1} = 2^2 = 4$</p><p>第四层最多有8个结点，$2^{4-1} = 2^3 = 8$</p><p>通过归纳法，可以得出：二叉树的第i层最多有 $2^{i-1}$ 个结点。</p><div class="note green"><p>推广一下：一棵树的度为 n 时，又称<strong>n 叉树</strong>。</p><p>如果一棵三叉树、四叉树，在第i层上最多有 $3^{i-1}$、$4^{i-1}$ 个结点。</p><p>由此可得：一棵 n 叉树在第i层上最多有 $n^{i-1}$个结点。</p></div>              </div>            </details></div><div class="note radiation"><div class="note guide blue"><p>性质2：深度为 k 的二叉树总结点数最多有 $2^k - 1$个（k &gt;= 1）。</p></div><details yellow><summary>  </summary>              <div class='content'>              <p>如果有一层，最多共1个结点。$2^1 - 1 = 1$</p><p>如果有两层，最多共3个结点。$2^2 - 1 = 3$</p><p>如果有三层，最多共7个结点。$2^3 - 1 = 7$</p><p>如果有四层，最多共15个结点。$2^4 - 1 = 15$</p><p>通过归纳法，可以得出：深度为 k 的二叉树总结点数最多有 $2^k - 1$ 个。</p>              </div>            </details></div><div class="note radiation"><div class="note guide blue"><p>性质3：对任何一棵二叉树 T，如果其叶子结点总数为 $n_0$，度为 2 的结点总数为 $n_2$，则 $n_0 = n_2 + 1$。</p></div><details yellow><summary>  </summary>              <div class='content'>              <p>例如上图右边的完全二叉树，叶子结点为7、8、9、10、11、12共6个，</p><p>所以 $n_0 = 6$；而度为2的结点1、2、3、4、5共5个，$n_2 = 5$。</p><p>所以 $n_0 = n_2 + 1 = 5 + 1 = 6$。</p>              </div>            </details></div><div class="note radiation"><div class="note guide blue"><p>性质4：总结点数为 n 的完全二叉树的深度为 $⌊log_2 n⌋ + 1$。 ⌊x⌋ 表示对 x 向下取整。</p></div>    例如上图左边的满二叉树，总结点数为 15，深度为 $⌊log_2 15⌋ + 1 = 4$。</div><div class="note radiation"><div class="note guide blue"><p>性质5：若对一颗总结点数为 n 的完全二叉树（其深度为 $⌊log_2 n⌋ + 1$）的结点按层序编号，对任一结点 i （1 &lt;= i &lt;= n）有：</p></div><details yellow><summary>  </summary>              <div class='content'>              <ul><li>如果  i = 1，则结点 i 是二叉树的根，无双亲；</li><li>如果  i &gt; 1，则其双亲结点是第 $⌊i/2⌋$ 个；</li><li>如果 2i &gt; n，则结点 i 无左孩子（结点 i 为叶子结点）；否则其左孩子是结点 2i；</li><li>如果 2i+1 &gt; n，则结点 i 无右孩子；否则其右孩子是结点 2i+1。</li></ul>              </div>            </details></div><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201216185120293_12261.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201216185120293_12261.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>例如这样一棵完全二叉树。总结点数 10；高度 4。</p><ul><li>如果 i = 1，根节点。</li><li>如果 i = 7，双亲就是 $⌊7/2⌋ = ⌊3.5⌋ = 3$；</li><li>如果 i = 6，(2i = 2*6 = 12) &gt; (10 = n)，所以6无左孩子；</li><li>如果 i = 4，(2i + 1 = 9) &gt; 10，所以4的右孩子是9。</li></ul><p>总结一下就是：</p><ul><li>i = 1，为根结点</li><li>i 的双亲是 <span class='p green'>⌊i/2⌋</span></li><li>i 的左孩子是 <span class='p green'>2i</span></li><li>i 的右孩子是 <span class='p green'>2i + 1</span></li></ul><h3 id="存储结构-1"><a href="#存储结构-1" class="headerlink" title="存储结构"></a>存储结构</h3><p>顺序结构适用性不强，还是用链表结构比较好。</p><p>每个结点包含一个数据域和两个左右孩子指针域，当然也可以包含一个双亲域。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">char</span>* name;</span><br><span class="line">&#125; Elem;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">BTNode</span>&#123;</span></span><br><span class="line">    Elem data;            <span class="comment">// 数据域</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">BTNode</span>* <span class="title">lchild</span>;</span> <span class="comment">// 左孩子</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">BTNode</span>* <span class="title">rchild</span>;</span> <span class="comment">// 右孩子</span></span><br><span class="line">&#125; BTNode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    BTNode* root; <span class="comment">// 根结点</span></span><br><span class="line">    <span class="keyword">int</span> depth;    <span class="comment">// 树的度</span></span><br><span class="line">    <span class="keyword">int</span> count;    <span class="comment">// 总结点数</span></span><br><span class="line">&#125; BTree;</span><br></pre></td></tr></table></figure><h3 id="遍历"><a href="#遍历" class="headerlink" title="遍历"></a>遍历</h3><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201217115357875_24759.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201217115357875_24759.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h4 id="前序遍历法-DLR"><a href="#前序遍历法-DLR" class="headerlink" title="前序遍历法 DLR"></a>前序遍历法 DLR</h4><p>即先打印根结点，再打印左孩子，最后打印右孩子，以此类推</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201217120423042_26566.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201217120423042_26566.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>上面的打印顺序为：ABDHKECFIGJ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">PreOrderTraverse</span><span class="params">(BTNode T)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (T == <span class="literal">NULL</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, T-&gt;data);</span><br><span class="line">    PreOrderTraverse(T-&gt;lchild);</span><br><span class="line">    PreOrderTraverse(T-&gt;rchild);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="中序遍历法-LDR"><a href="#中序遍历法-LDR" class="headerlink" title="中序遍历法 LDR"></a>中序遍历法 LDR</h4><p>即先打印左孩子，再打印根结点，最后打印右孩子，以此类推</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201217120428740_15744.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201217120428740_15744.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>上面的打印顺序为：HKDBEAIFCGJ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">InOrderTraverse</span><span class="params">(BTNode T)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (T == <span class="literal">NULL</span>) <span class="keyword">return</span>;</span><br><span class="line">    InOrderTraverse(T-&gt;lchild);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, T-&gt;data);</span><br><span class="line">    InOrderTraverse(T-&gt;rchild);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="后序遍历法-LRD"><a href="#后序遍历法-LRD" class="headerlink" title="后序遍历法 LRD"></a>后序遍历法 LRD</h4><p>即先打印左孩子，再打印右孩子，最后打印根结点，以此类推</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201217120431843_22415.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201217120431843_22415.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>上面的打印顺序为：KHDEBIFJGCA</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">PostOrderTraverse</span><span class="params">(BTNode T)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (T == <span class="literal">NULL</span>) <span class="keyword">return</span>;</span><br><span class="line">    PostOrderTraverse(T-&gt;lchild);</span><br><span class="line">    PostOrderTraverse(T-&gt;rchild);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, T-&gt;data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="层序遍历法"><a href="#层序遍历法" class="headerlink" title="层序遍历法"></a>层序遍历法</h4><p>即按层从左到右依次打印<br>上面打印顺序为：ABCDEFGHIJK</p><p>层序遍历时需要借助一个队列来完成。从根结点开始，当一个结点出队时，将其所有孩子结点入队。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SequenceTraverse</span><span class="params">(BTree T)</span> </span>&#123;</span><br><span class="line">    EnQueue(T-&gt;root);</span><br><span class="line">    BTNode* root = DeQueue()</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; T-&gt;count; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (root) <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, root-&gt;data);</span><br><span class="line">        <span class="keyword">if</span> (root-&gt;lchild) EnQueue(root-&gt;lchild);</span><br><span class="line">        <span class="keyword">if</span> (root-&gt;rchild) EnQueue(root-&gt;rchild);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>前序就是根结点在前面<br>中序就是根结点在中间<br>后序就是根结点在后面</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201217124341220_25563.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201217124341220_25563.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>像这棵比较小的树，<br><strong>前序 DLR</strong>：ABDEC<br><strong>中序 LDR</strong>：DBEAC<br><strong>后序 LRD</strong>：DEBCA<br><strong>层次遍历</strong>：ABCDE</p><h4 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h4><p>如果一棵二叉树的前序遍历序列为 ABCDEF，中序遍历序列为 CBAEDF，请问后序遍历序列为？<br><strong>解题思路：</strong></p><ol><li><p>前序的第一位或后序的最后一位，一定是根节点，所以这题的根结点就是 A。</p></li><li><p>接着看 A 在中序序列的位置，可以看出 CB 是 A 的左孩子，EDF是 A 的右孩子；然后在前序中就可以确定 BC 为一组，DEF 为一组。<br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201217132726225_29810.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201217132726225_29810.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></li><li><p><strong>二叉树的子树也是二叉树</strong>。根据这个道理，从前序中可以知道 B是左子树的根结点，同理D是右子树的根结点。<br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201217132708350_15611.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201217132708350_15611.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></li><li><p>拿着 B 和 D 到中序序列中分析，分出左右子树，以此类推。</p></li></ol><p>核心就是：<strong>从前序的第一个 或 后序的最后一个确定根结点，然后到中序里区分左右子树。</strong></p><p>所以这道题应该是这样一棵树：</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201217133358914_31623.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201217133358914_31623.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>后序应该为： CBEFDA</p><h2 id="线索二叉树-Threading-Tree"><a href="#线索二叉树-Threading-Tree" class="headerlink" title="线索二叉树 Threading Tree"></a>线索二叉树 Threading Tree</h2><div class="note radiation blue"><p><strong>线索二叉树 = （前 | 中 | 后）遍历 + 二叉树</strong>。</p></div><p>虽然采用链式结构存储，每个结点存储本身数据和左右孩子的指针，但还是会带来一个问题：<strong>叶子结点没有子树，它们的孩子指针必然为 NULL，叶子越多，NULL 越多，这就导致不管什么树，都必然会浪费一定的空间。</strong></p><p>例下图：<br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201218083935575_13596.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201218083935575_13596.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>现在思考如何将那些 <code>^</code> 利用起来。<br>如果一个结点没有孩子，则让孩子指针指向双亲？这样有的指有的不指，很奇怪，且实现起来很不方便。<br>如果结合遍历顺序怎么样？可以。</p><p>因为在没有遍历的情况下，我们不知道一个结点的前驱是谁，后继是谁，不如在创建树时，如果没有子树，就换成记录前驱元素或后继元素。</p><p>这样创建出来的树，就叫 <span class='p blue'>线索二叉树</span>。</p><p>线索二叉树的核心思想为：</p><ul><li><span class='p blue'>如果有左子树，则左指针域指向左子树</span>；<span class='p green'>如果没有左子树，则左指针指向**遍历前驱元素**</span></li><li><span class='p blue'>如果有右子树，则右指针域指向右子树</span>；<span class='p green'>如果没有右子树，则右指针指向**遍历后继元素**</span></li></ul><p>这里的前驱和后继指的是 <span class='p green'>某个结点在</span><span class='p cyan'>遍历后得到的序列中</span><span class='p green'>的前驱和后继</span>。</p><p>例如：<img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201217133358914_31623.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201217133358914_31623.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>后序遍历得到序列：CBEFDA。其中 E 是 F 的前驱，D 是 F 的后继。</p><p>即：<strong>线索二叉树 = （前 | 中 | 后）遍历 + 二叉树</strong>。</p><p>我们在将左右指针指向子树还是前驱后继这个行为叫做<strong>线索化</strong>。</p><h3 id="实现细节"><a href="#实现细节" class="headerlink" title="实现细节"></a>实现细节</h3><p>定义了二叉树，我们需要讨论：如何知道一个结点的孩子指针是指向子树还是指向前驱后继？<br>为了解决这个问题，还需要在每个结点中增加两个变量 <code>ltag</code> 、<code>rtag</code>。<br>当 ltag 或 rtag 为 true 时表示有孩子，指针域指向子树；<br>当 ltag 或 rtag 为 false 时表示没有孩子，指针域指向前驱或后继。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">BTNode</span>&#123;</span></span><br><span class="line">    Elem data;             <span class="comment">// 数据域</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">BTNode</span>* <span class="title">lchild</span>;</span> <span class="comment">// 左孩子</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">BTNode</span>* <span class="title">rchild</span>;</span> <span class="comment">// 右孩子</span></span><br><span class="line">    <span class="keyword">bool</span> ltag;</span><br><span class="line">    <span class="keyword">bool</span> rtag;</span><br><span class="line">&#125; BTNode;</span><br></pre></td></tr></table></figure><p>这样在创建一棵树时，如果某个结点有左子树，ltag 为 true，lchild 指向左子树；如果没有左子树，ltag 为 false，lchild 指向前驱。<br>eg：<br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201217133358914_31623.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201217133358914_31623.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="><br>这样一棵二叉树，经过中序线索化以后，变成下面这样：<br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201218094820883_2791.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201218094820883_2791.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">TTNode* pre;     <span class="comment">// 全局变量，指向刚刚访问过的结点</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">InThreading</span><span class="params">(TTNode* T)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(T) &#123;</span><br><span class="line">        InThreading(T-&gt;lchild);    <span class="comment">// 递归左子树线索化</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/** 线索化 begin */</span></span><br><span class="line">        <span class="keyword">if</span>(!T-&gt;lchild) &#123;    <span class="comment">// 没有左孩子</span></span><br><span class="line">            T-&gt;ltag = <span class="literal">false</span>;        <span class="comment">// 线索标志</span></span><br><span class="line">            T-&gt;lchild = pre;    <span class="comment">// 指向前驱元素</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!pre-&gt;rchild) &#123;    <span class="comment">// 前驱结点没有右孩子</span></span><br><span class="line">            pre-&gt;rtag = <span class="literal">false</span>;      <span class="comment">// 线索标志</span></span><br><span class="line">            pre-&gt;rchild = T;    <span class="comment">// 前驱右指针指向当前指针</span></span><br><span class="line">        &#125;</span><br><span class="line">        pre = T;    <span class="comment">// 保持 pre 指向 T 的前驱</span></span><br><span class="line">        <span class="comment">/** 线索化 end */</span></span><br><span class="line"></span><br><span class="line">        InThreading(T-&gt;rchild);    <span class="comment">// 递归右子树线索化</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="转换"><a href="#转换" class="headerlink" title="转换"></a>转换</h2><h3 id="树转二叉树"><a href="#树转二叉树" class="headerlink" title="树转二叉树"></a>树转二叉树</h3><p>一棵不规则的树，在一定程度上可以转换为一棵二叉树。</p><p>转换方法：</p><ol><li>连接：兄弟之间连线</li><li>断开：双亲结点只保留最左孩子，其余都断开</li><li>旋转：调整好位置</li><li>保留的做左子树，连接的做右子树</li></ol><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201218100403895_1715.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201218100403895_1715.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="树"></p><p>将这样一棵树转成二叉树。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201218100321786_8010.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201218100321786_8010.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="树转二叉树"></p><p>第一步：兄弟结点之间连接起来。例如 BCD 之间都连接起来了。<br>第二步：除了双亲跟左孩子，其他联系都断开。例如A只保留与 B，断开与 CD 的关系。<br>第三步：旋转调整。保留下来的作为左子树，连接得来的作为右子树。例如 B 是保留下来的，作为左子树，CD 是连接出来的，作为右子树。</p><div class="note done"><p>口诀：<strong>一连接、二断开、三旋转、保留左子树、连接右子树。</strong></p></div><h3 id="二叉树转树"><a href="#二叉树转树" class="headerlink" title="二叉树转树"></a>二叉树转树</h3><p>二叉树转树 是 树转二叉树的逆过程</p><p>一旋转、二断开、三连接即可。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201218105149339_15021.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201218105149339_15021.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="二叉树转树"></p><p>第一步：旋转，将右子树都旋转都同一层<br>第二步：连接右子树结点与双亲结点<br>第三步：断开兄弟间的连线</p><h3 id="二叉树转森林"><a href="#二叉树转森林" class="headerlink" title="二叉树转森林"></a>二叉树转森林</h3><p>判断一棵树是普通树还是二叉树，看它根结点有没有右子树。有就是二叉树，没有就是普通树。</p><p>二叉树转森林只需要把每个<strong>有孩子的右子树</strong>拆开作为单独一棵树即可。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201218110535205_14643.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201218110535205_14643.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="二叉树转森林"></p><h2 id="哈夫曼树"><a href="#哈夫曼树" class="headerlink" title="哈夫曼树"></a>哈夫曼树</h2><blockquote><p>哈夫曼树是一类带权路径长度最短的树，又称赫夫曼树、最优树、最优二叉树。</p></blockquote><p>哈夫曼树的应用非常广泛，特别是在大文本编码方面，压缩比非常可观。</p><p>首先解释一下带权路径：</p><ul><li><strong>路径</strong>：两个结点之间那根线就叫路径</li><li><strong>权</strong>：路径上的数字。</li><li><strong>带权路径</strong>：两个结点之间那根线带数字</li></ul><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20210713122800.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20210713122800.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="带权树"><br>权值可以用来表示某些含义，而在哈夫曼编码中，权值只有 0 和 1 两种。</p><ul><li><strong>路径长度</strong>：从树中一个结点到另一个结点之间的分支构成这两个结点之间的路径，路径上的分支数目称作<span class='p blue'>路径长度</span></li><li><strong>树的路径长度</strong>：从树根到每一个结点的<span class='p blue'>路径长度之和</span>。</li><li><strong>树的带权路径长度</strong>：树中所有叶子结点的<span class='p blue'>带权路径长度之和</span>，通常记作 $WPL=\sum^n_{k=1}{w_kl_k}$。（$l$ 为结点 $k$ 的层数，从 0 开始计算）</li></ul><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20210713125941.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20210713125941.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>上图中的 3 棵二叉树，都有 4 个叶子结点 A、B、C、D，分别带权 11、7、6、9。<br>他们的带权路径长度分别为：</p><ol><li>$WPL = 11 \times 2 + 7 \times 2 + 6 \times 2 + 9 \times 2 = 66$</li><li>$WPL = 11 \times 2 + 7 \times 1 + 6 \times 3 + 9 \times 3 = 74$</li><li>$WPL = 11 \times 1 + 7 \times 2 + 6 \times 3 + 9 \times 3 = 70$</li></ol><p>假设有一棵二叉树，其有 n 个叶子结点，并有 n 个权值 ${w_1, w_2, …, w_n}$，每个叶子结点带权为 $w_i$，则其中带权路径长度 WPL 最小的二叉树称作<span class='p blue'>最优二叉树</span>或<span class='p blue'>哈夫曼树</span>。</p><h3 id="哈夫曼编码"><a href="#哈夫曼编码" class="headerlink" title="哈夫曼编码"></a>哈夫曼编码</h3><blockquote><p>哈夫曼编码是一种变长的编码方式，在大文本压缩方面有着出色的表现。</p></blockquote><p>相对比<span class='p blue'>变长</span>，另一种编码方式为<span class='p red'>定长</span>。</p><p>假设现在有一串文本 <code>aaabbaacdeefdeaeff</code>，共 18 个字符。<br>现在要进行远距离传输，我们需要先进行编码，也就是编成二进制形式。</p><p>可以看到总共是 abcdef 这几个字符，那么我们可以用 001 表示 a，010 表示 b，011 表示 c… 以此类推。</p><table><thead><tr><th>a</th><th>b</th><th>c</th><th>d</th><th>e</th><th>f</th></tr></thead><tbody><tr><td>001</td><td>010</td><td>011</td><td>100</td><td>101</td><td>110</td></tr></tbody></table><p>这就是<span class='p blue'>定长编码</span>，每一个字符编码后都是同样的位数 3 位。</p><p><code>aaabbaacdeefdeaeff</code> 编码后为 <code>001001001010010001001011100101101110100101001101110110</code>。18 个字符共编成 54 个二进制位。</p><p>这种方式有个缺点：现在只有 6 种字符，所以每个字符编码后的位数占了 3 位，如果有 17 种字符，那么每个字符编码后需要占用 5 位，非常浪费空间。</p><p>所以哈夫曼教授提出了现在的哈夫曼编码，核心就是一句话：让出现次数越高的字符占用越少的位数。</p><h3 id="编码步骤"><a href="#编码步骤" class="headerlink" title="编码步骤"></a>编码步骤</h3><p>这是一种变长的编码方式，具体步骤如下：</p><ol><li>统计各种字符的出现次数构成一个序列</li><li>对序列进行排序</li><li>选取 2 个最小的作为叶子结点，父结点为两次数之和</li><li>将选出的两个数从序列中删除，将父结点加入序列</li><li>重复步骤 2，直到序列为空。</li></ol><p>注意事项：</p><ul><li>保持任何左侧结点都比右侧的兄弟结点小/大。</li><li>构造完成以后，给每一条路径填充权值 0 或 1。</li></ul><p>上面的例子用哈夫曼编码，应该是这样：</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20210713175510.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20210713175510.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>最终会生成一颗这样的树：</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20210713180824.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20210713180824.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>然后从根结点开始，直到字符那个结点，这一路的权值拼接起来就得到了变长编码。</p><table><thead><tr><th>a</th><th>b</th><th>c</th><th>d</th><th>e</th><th>f</th></tr></thead><tbody><tr><td>00</td><td>011</td><td>0101</td><td>0100</td><td>10</td><td>11</td></tr></tbody></table><p>现在，<code>aaabbaacdeefdeaeff</code> 编码后为 <code>00000001101100000101010010101101001000101111</code>。18 个字符共编成 44 个二进制位。压缩比为 $44 \div 54 = 81$%。看起来不多，但是计算机中一个字符需要 8 个位存储，18 个字符共 144 位。这样算下来压缩比直接达到 $44 \div 144 = 30$%！</p><h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><p>伪代码</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="comment">(序列长度 &gt;= 1)</span> &#123;</span><br><span class="line">    将序列排序</span><br><span class="line">    栈顶 <span class="number">2</span> 个元素出栈</span><br><span class="line">    构造子树</span><br><span class="line">    将父结点的值入栈</span><br><span class="line">&#125;</span><br><span class="line">填充权值</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DataElement.h</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> DATAELEMENT_H_INCLUDED</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DATAELEMENT_H_INCLUDED</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXSIZE 10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">    <span class="keyword">char</span> data;</span><br><span class="line">    <span class="keyword">int</span> value;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span>* <span class="title">lNode</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span>* <span class="title">rNode</span>;</span></span><br><span class="line">    <span class="keyword">int</span> lWeight;</span><br><span class="line">    <span class="keyword">int</span> rWeight;</span><br><span class="line">&#125; Node;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Stack</span> &#123;</span></span><br><span class="line">    Node* datas[MAXSIZE];</span><br><span class="line">    <span class="keyword">int</span> top;</span><br><span class="line">&#125; Stack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">char</span> data;</span><br><span class="line">    <span class="keyword">int</span> times;</span><br><span class="line">&#125; seq;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Huffman.h</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> HUFFMAN_H_INCLUDED</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HUFFMAN_H_INCLUDED</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;DataElement.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> len(x) sizeof(x)/sizeof(x[0])</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 将序列排序</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">sort</span><span class="params">(Stack*)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 出栈两个元素</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pop</span><span class="params">(Stack* s, Node* nodeArr[<span class="number">2</span>])</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造子树</span></span><br><span class="line"><span class="function">Node* <span class="title">buildSubTree</span><span class="params">(Node* nodeArr[<span class="number">2</span>])</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 父结点入栈</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">push</span><span class="params">(Stack* s, Node* parent)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">initStack</span><span class="params">(Stack* s, seq arr[], <span class="keyword">int</span> arrLen)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printStack</span><span class="params">(Stack* s)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">frontPrint</span><span class="params">(Node* root)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">midPrint</span><span class="params">(Node* root)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">stuffWeight</span><span class="params">(Node* root)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Huffman.c</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;Huffman.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 将序列排序</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @name 直接插入排序算法</span></span><br><span class="line"><span class="comment"> * 循环数组长度 -1 次，每次循环将当前目标数与前面部分（已排好序）比较</span></span><br><span class="line"><span class="comment"> * 前一个数大于当前数则交换位置，一直比较一直换，直到前面的数小于当前数时，退出比较，换下一个目标数继续比较。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">sort</span><span class="params">(Stack* s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; s-&gt;top + <span class="number">1</span>; i++) &#123; <span class="comment">// 一共循环数组长度 -1 次</span></span><br><span class="line">        <span class="keyword">int</span> j;</span><br><span class="line">        <span class="keyword">for</span> (j = i; j &gt; <span class="number">0</span>; j--) &#123;</span><br><span class="line">            Node* prev = s-&gt;datas[i - <span class="number">1</span>];</span><br><span class="line">            Node* curr = s-&gt;datas[i];</span><br><span class="line">            <span class="keyword">if</span> (prev-&gt;value &lt; curr-&gt;value) &#123; <span class="comment">// 若前一个小于后一个，则交换两个结点，当前目标数位置-1</span></span><br><span class="line">                Node* tmp = s-&gt;datas[i - <span class="number">1</span>];</span><br><span class="line">                s-&gt;datas[i - <span class="number">1</span>] = s-&gt;datas[i];</span><br><span class="line">                s-&gt;datas[i] = tmp;</span><br><span class="line">                tmp = <span class="literal">NULL</span>;</span><br><span class="line">                i--;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 出栈两个元素</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pop</span><span class="params">(Stack* s, Node* nodeArr[<span class="number">2</span>])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    nodeArr[<span class="number">0</span>] = s-&gt;datas[s-&gt;top--];</span><br><span class="line">    nodeArr[<span class="number">1</span>] = s-&gt;datas[s-&gt;top--];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造子树</span></span><br><span class="line"><span class="function">Node* <span class="title">buildSubTree</span><span class="params">(Node* nodeArr[<span class="number">2</span>])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Node* parent = (Node*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Node));</span><br><span class="line">    parent-&gt;data = <span class="string">&#x27;-&#x27;</span>;</span><br><span class="line">    parent-&gt;value = nodeArr[<span class="number">0</span>]-&gt;value + nodeArr[<span class="number">1</span>]-&gt;value;</span><br><span class="line">    parent-&gt;lNode = nodeArr[<span class="number">0</span>];</span><br><span class="line">    parent-&gt;rNode = nodeArr[<span class="number">1</span>];</span><br><span class="line">    parent-&gt;lWeight = parent-&gt;rWeight = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">return</span> parent;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 父结点入栈</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">push</span><span class="params">(Stack* s, Node* parent)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    s-&gt;datas[++s-&gt;top] = parent;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 填充每条路径上的权值</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">stuffWeight</span><span class="params">(Node* root)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (root) &#123;</span><br><span class="line">        <span class="keyword">if</span> (root-&gt;lNode)</span><br><span class="line">            root-&gt;lWeight = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (root-&gt;rNode)</span><br><span class="line">            root-&gt;rWeight = <span class="number">0</span>;</span><br><span class="line">        stuffWeight(root-&gt;lNode);</span><br><span class="line">        stuffWeight(root-&gt;rNode);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化栈</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">initStack</span><span class="params">(Stack* s, seq arr[], <span class="keyword">int</span> arrLen)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; MAXSIZE; i++)</span><br><span class="line">        s-&gt;datas[i] = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    s-&gt;top = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将数组填充进栈里</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; arrLen; i++) &#123;</span><br><span class="line">        Node* node = (Node*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Node));</span><br><span class="line">        node-&gt;data = arr[i].data;</span><br><span class="line">        node-&gt;value = arr[i].times;</span><br><span class="line">        node-&gt;lNode = node-&gt;rNode = <span class="literal">NULL</span>;</span><br><span class="line">        node-&gt;lWeight = node-&gt;rWeight = <span class="number">-1</span>;</span><br><span class="line">        push(s, node);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 前序遍历打印</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">frontPrint</span><span class="params">(Node* root)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (root != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c %2d; %2d, %2d\n&quot;</span>, root-&gt;data, root-&gt;value, root-&gt;lWeight, root-&gt;rWeight);</span><br><span class="line">        frontPrint(root-&gt;lNode);</span><br><span class="line">        frontPrint(root-&gt;rNode);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 中序遍历打印</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">midPrint</span><span class="params">(Node* root)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (root != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        midPrint(root-&gt;lNode);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c %2d; %2d, %2d\n&quot;</span>, root-&gt;data, root-&gt;value, root-&gt;lWeight, root-&gt;rWeight);</span><br><span class="line">        midPrint(root-&gt;rNode);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.c</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;Huffman.c&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;tools.c&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BuildHuffman</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    seq arr[] = &#123; &#123; <span class="string">&#x27;a&#x27;</span>, <span class="number">6</span> &#125;, &#123; <span class="string">&#x27;b&#x27;</span>, <span class="number">2</span> &#125;, &#123; <span class="string">&#x27;c&#x27;</span>, <span class="number">1</span> &#125;, &#123; <span class="string">&#x27;d&#x27;</span>, <span class="number">2</span> &#125;, &#123; <span class="string">&#x27;e&#x27;</span>, <span class="number">4</span> &#125;, &#123; <span class="string">&#x27;f&#x27;</span>, <span class="number">3</span> &#125; &#125;;</span><br><span class="line">    Stack s;</span><br><span class="line">    initStack(&amp;s, arr, len(arr));</span><br><span class="line">    Node* popArr[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (s.top &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">        sort(&amp;s);</span><br><span class="line">        pop(&amp;s, popArr);</span><br><span class="line">        Node* parent = buildSubTree(popArr);</span><br><span class="line">        push(&amp;s, parent);</span><br><span class="line">    &#125;</span><br><span class="line">    stuffWeight(s.datas[s.top]);</span><br><span class="line">    printStack(&amp;s);</span><br><span class="line">    frontPrint(s.datas[s.top]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    midPrint(s.datas[s.top]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    BuildHuffman();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> DataStruction </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构 </tag>
            
            <tag> DataStruction </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DataStruction 0x05 串</title>
      <link href="posts/42822"/>
      <url>posts/42822</url>
      
        <content type="html"><![CDATA[<p>什么是串？</p><span id="more"></span><h1 id="5-串"><a href="#5-串" class="headerlink" title="5-串"></a>5-串</h1><blockquote><p><strong>串</strong>：0或N个字符组成的有限序列，一种限定了元素为字符的线性表。</p></blockquote><p><strong>长度</strong>：字符个数<br><strong>空串</strong>：0个元素<br><strong>子串</strong>：串中任意连续字符组成的子序列<br><strong>主串</strong>：包含子串的串</p><p>存储结构：串的实现可以用定长数组，也可以用变长的动态数组实现。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定长数组</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_SIZE 100</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">char</span> str[MAX_SIZE + <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">int</span> length;</span><br><span class="line">&#125;Str;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 变长动态数组</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">char</span> *str; <span class="comment">// 串</span></span><br><span class="line">    <span class="keyword">int</span> length; <span class="comment">// 串长度</span></span><br><span class="line">&#125;Str;</span><br></pre></td></tr></table></figure><p>基本操作：<strong>赋值、取长度、比较、连接、复制、求子串、清空</strong></p><p>当然串的操作还有非常多，比如返回字符在字符串中的位置，返回子串在字符串中的位置等等。</p><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DataElement.h</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> DATAELEMENT_H_INCLUDED</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DATAELEMENT_H_INCLUDED</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> OK 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ERROR 0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> Status;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 串结构 */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">char</span>* str;</span><br><span class="line">    <span class="keyword">int</span> length;</span><br><span class="line">&#125; Str;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// DATAELEMENT_H_INCLUDED</span></span></span><br></pre></td></tr></table></figure><h3 id="赋值"><a href="#赋值" class="headerlink" title="赋值"></a>赋值</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Status <span class="title">Assign</span><span class="params">(Str* s, <span class="keyword">char</span>* ch)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ch_length = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">char</span>* c = ch;</span><br><span class="line">    <span class="keyword">while</span> (*c) &#123; <span class="comment">// 计算ch字符串长度</span></span><br><span class="line">        ++ch_length;</span><br><span class="line">        ++c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (ch_length == <span class="number">0</span>) &#123; <span class="comment">// 如果是空串</span></span><br><span class="line">        s-&gt;str = <span class="literal">NULL</span>;</span><br><span class="line">        s-&gt;length = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> OK;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 开辟一块空间，+1 是为了放 \0 结束符</span></span><br><span class="line">        s-&gt;str = (<span class="keyword">char</span>*)<span class="built_in">calloc</span>(ch_length + <span class="number">1</span>, <span class="keyword">sizeof</span>(<span class="keyword">char</span>));</span><br><span class="line">        <span class="comment">// 分配失败返回ERROR</span></span><br><span class="line">        <span class="keyword">if</span> (s-&gt;str == <span class="literal">NULL</span>)</span><br><span class="line">            <span class="keyword">return</span> ERROR;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 逐个将ch的字符复制到s-&gt;str</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= ch_length; i++)</span><br><span class="line">            s-&gt;str[i] = *(ch + i);</span><br><span class="line"></span><br><span class="line">        s-&gt;length = ch_length;</span><br><span class="line">        <span class="keyword">return</span> OK;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="取长度"><a href="#取长度" class="headerlink" title="取长度"></a>取长度</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Length</span><span class="params">(Str* s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> s-&gt;length;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="比较"><a href="#比较" class="headerlink" title="比较"></a>比较</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">compare</span><span class="params">(Str* s1, Str* s2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 遍历时将两个字符串逐个比较</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s1-&gt;length &amp;&amp; i &lt; s2-&gt;length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (s1-&gt;str[i] != s2-&gt;str[i]) &#123;</span><br><span class="line">            <span class="keyword">return</span> s1-&gt;str[i] - s2-&gt;str[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>遍历是串中较为重要的操作。</p><p>逐个比较字符的ASCII码，</p><ul><li>若s1 &lt; s2，返回负数；</li><li>若s1 &gt; s2，返回正数；</li><li>若s1 = s2，返回0.</li></ul><h3 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h3><p>连接分两种情况讨论</p><ol><li><p>一种是定长数组实现的字符串的连接</p><ul><li>如果A有剩余空间且剩余空间大于B长度，循环B长度逐个复制到A</li><li>如果A无剩余空间或剩余空间小于B长度，将A扩容，再循环B长度逐个复制到A</li></ul></li><li><p>一种是变长数组实现的字符串的连接</p><p> 变长数组一般没有剩余空间的情况，后面的空间是否是空闲空间也无从得知，所以变长数组的字符串在连接时，通常是开辟一块新的空间，长度为<code>A的长度+B的长度</code>，然后遍历A，逐个复制到新字符串，遍历B，逐个复制到新字符串A的后面，最后补<code>\0</code>。</p></li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将 s2 连接到 s1 后面</span></span><br><span class="line"><span class="function"><span class="keyword">char</span>* <span class="title">contact</span><span class="params">(Str* s1, Str* s2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 创建一块新字符串空间，长度为 s1 + s2</span></span><br><span class="line">    <span class="keyword">char</span>* <span class="keyword">new</span> = (<span class="keyword">char</span>*)<span class="built_in">calloc</span>(s1-&gt;length + s2-&gt;length, <span class="keyword">sizeof</span>(<span class="keyword">char</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; s1-&gt;length) &#123; <span class="comment">// 把 s1 逐个字符赋值给新字符串</span></span><br><span class="line">        <span class="keyword">new</span>[i] = s1-&gt;str[i];</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; s2-&gt;length) &#123; <span class="comment">// 把 s2 逐个字符赋值给新字符串</span></span><br><span class="line">        <span class="keyword">new</span>[s1-&gt;length + i] = s2-&gt;str[i];</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">new</span>[s1-&gt;length + s2-&gt;length] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    s1-&gt;length += s2-&gt;length;</span><br><span class="line">    s1-&gt;str = <span class="keyword">new</span>; <span class="comment">// 让 s1 指向新字符串</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="复制"><a href="#复制" class="headerlink" title="复制"></a>复制</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">char</span>* <span class="title">copy</span><span class="params">(Str* dest, Str* src)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> count = src-&gt;length &lt; dest-&gt;length ? src-&gt;length : dest-&gt;length;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">        dest-&gt;str[i] = src-&gt;str[i];</span><br><span class="line">    &#125;</span><br><span class="line">    dest-&gt;str[count] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> dest-&gt;str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>复制的时候，逐个将 src 字符串的字符 复制到 dest 字符串。</p><p>要注意的是，假设 dest 的长度为10，src 的长度为5，则将 src 覆盖到 dest 上，dest 上后面的几个字符但是不会被读取到</p><p>反过来则是 src 将 dest 整个覆盖，但是只能覆盖 dest 的字符个数，src 超出 dest 长度的字符会被丢弃。</p><p>所以在调用时要保证 dest 的长度比 src 的长。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201120171858449_17718.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201120171858449_17718.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201120171918369_7581.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201120171918369_7581.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h3 id="取子串"><a href="#取子串" class="headerlink" title="取子串"></a>取子串</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @description 从主串 base 的第 idx+1 个开始截取 len 个字符组成新的字符串</span></span><br><span class="line"><span class="comment"> * @param base 主串</span></span><br><span class="line"><span class="comment"> * @param idx 截取的起始下标</span></span><br><span class="line"><span class="comment"> * @param len 截取字符数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">char</span>* <span class="title">sub</span><span class="params">(Str* base, <span class="keyword">int</span> idx, <span class="keyword">int</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 越界或主串为空</span></span><br><span class="line">    <span class="keyword">if</span> (idx + len &gt; base-&gt;length || base-&gt;length == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 分配空间，然后逐字符复制</span></span><br><span class="line">    <span class="keyword">char</span>* substring = (<span class="keyword">char</span>*)<span class="built_in">calloc</span>(len, <span class="keyword">sizeof</span>(<span class="keyword">char</span>));</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        substring[i] = base-&gt;str[idx + i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> substring;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="清空"><a href="#清空" class="headerlink" title="清空"></a>清空</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Status <span class="title">clear</span><span class="params">(Str* s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (s-&gt;length == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> OK;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s-&gt;length; i++) &#123;</span><br><span class="line">        s-&gt;str[i] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    s-&gt;length = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="串的模式匹配"><a href="#串的模式匹配" class="headerlink" title="串的模式匹配"></a>串的模式匹配</h2><blockquote><p>对某子串的定位操作。</p><p>主串也称作<strong>目标串</strong></p><p>子串也称作<strong>模式串</strong></p><p>思想：从主串首个位置起和模式串的首个字符比较，若相等，则逐一比较后续字符，否则从主串第二个字符开始，逐一比较后续字符，以此类推。匹配成功则返回模式串在主串中的位置，匹配失败则返回0.</p></blockquote><h3 id="KMP-算法"><a href="#KMP-算法" class="headerlink" title="KMP 算法"></a>KMP 算法</h3><p>模式匹配主要有 <code>BF 算法</code> 和 <code>KMP 算法</code>。</p><p>BF 算法主要是一种暴力穷举，和上面介绍的思想一致。</p><p>KMP 算法就聪明多了，该算法充分体现了“失败是成功他妈”的道理，积极从上一次失败匹配中汲取信息，并应用到下一次匹配中，比起 BF 那种穷举法，KMP 会将模式串与失败位置对其再重新匹配。</p>]]></content>
      
      
      <categories>
          
          <category> DataStruction </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构 </tag>
            
            <tag> DataStruction </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DataStruction 0x04 队列</title>
      <link href="posts/50917"/>
      <url>posts/50917</url>
      
        <content type="html"><![CDATA[<p>什么是队列？</p><span id="more"></span><h1 id="4-队列"><a href="#4-队列" class="headerlink" title="4-队列"></a>4-队列</h1><blockquote><p>队列是只允许在一端进行插入操作，在另一端进行删除操作的受限的线性表。</p></blockquote><p>队列是一种 <strong>先进先出(FIFO)</strong> 的线性表，就像水管一样，从一头进去，从另一头出来</p><p>队列有两个指针，一个指向<strong>队头</strong>，只允许删除；一个指向<strong>队尾</strong>，只允许插入。</p><p>对于队列的操作有插入和删除，也称作<strong>入队</strong>和<strong>出队</strong>，不能从中间取。</p><ul><li><span class='p blue'>顺序队</span>：队列的每一个元素在一段连续的内存空间，用数组实现。</li><li><span class='p blue'>链队</span>：队列的每一个元素不一定紧挨着，用链表实现。</li><li><span class='p blue'>循环队</span>：队头连接着队尾。</li></ul><p>队的主要操作包括：<strong>创建、初始化、入队、出队、判空、判满、清空队列</strong>。</p><h2 id="循环队"><a href="#循环队" class="headerlink" title="循环队"></a>循环队</h2><p>顺序队是基于数组实现的，当入队一个元素的时候，队尾指针+1，当<code>队尾指针=MAX_SIZE</code>时队满；当出队一个元素的时候，队头指针+1，当<code>队头指针=MAX_SIZE</code>时，说明队空。</p><p>但是！！</p><p>当<code>队头和队尾都 = MAX_SIZE</code> 时，实际上队空，但是却无法入队新元素，这种现象称之为<strong>假溢出</strong>。</p><p>所以为了解决这个问题，我们可以用<strong>循环队列</strong>。</p><div class="gallery stretch" col='3'>              <p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201119211542211_9577.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201119211542211_9577.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="由空队入队两个元素，此时 fron == 0, rear == 2"><br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201119211613695_31001.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201119211613695_31001.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="入队4个元素，出队3个元素，此时 front == 3, rear == 6"><br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201119211651596_11557.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201119211651596_11557.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="入队2个元素，出队4个元素，此时 front == 7, rear == 0"></p>            </div><div class="gallery stretch" col='2'>              <p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201119212126618_6232.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201119212126618_6232.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="队空条件：front == rear"><br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201119212315473_17063.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201119212315473_17063.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="队满条件：(rear + 1)%MAX_SIZE == front"></p>            </div><p>要实现循环队列，最重要的是怎么做才能让队头队尾指针在一个周期中循环。</p><p>答案是 <span class='p green'>front = (front + 1) % MAX_SIZE</span>、<span class='p red'>rear = (rear + 1) % MAX_SIZE</span>。</p><p>假设 <code>MAX_SIZE == 8, front == 1</code>，<code>(front + 1) % MAX_SIZE</code>等价于<code>2 % 8 == 2</code></p><p>所以这条表达式，可以让队头队尾指针在 <code>0~MAX_SIZE-1</code> 这个周期中循环，也就是在 <code>0, 1, 2, ... MAX_SIZE-1</code> 中循环。</p><h3 id="要素"><a href="#要素" class="headerlink" title="要素"></a>要素</h3><p>循环队列的两个状态</p><p>队空： <span class='p blue'>q->rear == q->front</span></p><p>队满： <span class='p red'>(q->rear + 1) % MAX_SIZE == q->front</span></p><p>入队：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">q-&gt;rear = (q-&gt;rear + <span class="number">1</span>) % MAX_SIZE; </span><br><span class="line">q-&gt;data[q-&gt;rear] = x;</span><br></pre></td></tr></table></figure><p>出队：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">q-&gt;front = (q-&gt;front + <span class="number">1</span>) % MAX_SIZE;</span><br><span class="line">X = q-&gt;data[q-&gt;front];</span><br></pre></td></tr></table></figure><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DataElement.h</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> DATAELEMENT_H_INCLUDED</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DATAELEMENT_H_INCLUDED</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_SIZE 10</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> OK 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ERROR 0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> TRUE 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FALSE 0</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> Status;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> Bool;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">char</span>* name;</span><br><span class="line">&#125; Element;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    Element datas[MAX_SIZE];</span><br><span class="line">    <span class="keyword">int</span> front;</span><br><span class="line">    <span class="keyword">int</span> rear;</span><br><span class="line">&#125; SqQueue;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// DATAELEMENT_H_INCLUDED</span></span></span><br></pre></td></tr></table></figure><h3 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Status <span class="title">Create</span><span class="params">(SqQueue* q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    q-&gt;front = <span class="number">0</span>;</span><br><span class="line">    q-&gt;rear = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Status <span class="title">Init</span><span class="params">(SqQueue* q, Element* datas, <span class="keyword">int</span> length)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (length &gt; MAX_SIZE) &#123;</span><br><span class="line">        <span class="keyword">return</span> ERROR;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!(q-&gt;front &amp;&amp; q-&gt;rear))</span><br><span class="line">        Create(q);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">        EnQueue(q, datas[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="入队"><a href="#入队" class="headerlink" title="入队"></a>入队</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Status <span class="title">EnQueue</span><span class="params">(SqQueue* q, Element e)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 如果队满, 无法入队</span></span><br><span class="line">    <span class="keyword">if</span> (isFull(q))</span><br><span class="line">        <span class="keyword">return</span> ERROR;</span><br><span class="line">    q-&gt;rear = (q-&gt;rear + <span class="number">1</span>) % MAX_SIZE; <span class="comment">// 先把队尾移动一格</span></span><br><span class="line">    q-&gt;datas[q-&gt;rear] = e; <span class="comment">// 再把数据放进去</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>因为队尾指针 rear 一直指着最后一个元素，如果直接放数据会覆盖掉原本队尾的数据，所以需要先把队尾指针向后挪一格，再放数据。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201119211613695_31001.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201119211613695_31001.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h3 id="出队"><a href="#出队" class="headerlink" title="出队"></a>出队</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Status <span class="title">DeQueue</span><span class="params">(SqQueue* q, Element* e)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 如果队空，无法出队</span></span><br><span class="line">    <span class="keyword">if</span> (isEmpty(q))</span><br><span class="line">        <span class="keyword">return</span> ERROR;</span><br><span class="line"></span><br><span class="line">    q-&gt;front = (q-&gt;front + <span class="number">1</span>) % MAX_SIZE;</span><br><span class="line">    *e = q-&gt;datas[q-&gt;front];</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>因为队头指针 front 一直指着第一个元素前面一格，直接拿数据就不对了，所以需要先把队头指针先向后挪一个，指向真正的队头元素，再取数据。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201119211613695_31001.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201119211613695_31001.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h3 id="判空"><a href="#判空" class="headerlink" title="判空"></a>判空</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Bool <span class="title">isEmpty</span><span class="params">(SqQueue* q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> q-&gt;front == q-&gt;rear;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="判满"><a href="#判满" class="headerlink" title="判满"></a>判满</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Bool <span class="title">isFull</span><span class="params">(SqQueue* q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> q-&gt;front == (q-&gt;rear + <span class="number">1</span>) % MAX_SIZE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="打印队列"><a href="#打印队列" class="headerlink" title="打印队列"></a>打印队列</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Print</span><span class="params">(SqQueue* q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (isEmpty(q))</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;队列为空！&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = q-&gt;front + <span class="number">1</span>; i &lt; q-&gt;rear + <span class="number">1</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d \t %s \n&quot;</span>, q-&gt;datas[i].id, q-&gt;datas[i].name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="测试数据"><a href="#测试数据" class="headerlink" title="测试数据"></a>测试数据</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.c</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;SqQueue.c&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> len(X) sizeof(X) / sizeof(X[0])</span></span><br><span class="line"></span><br><span class="line">Element datas[] = &#123;</span><br><span class="line">    &#123; <span class="number">1</span>, <span class="string">&quot;Iron Man&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="number">2</span>, <span class="string">&quot;Thor&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="number">3</span>, <span class="string">&quot;Captain&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="number">4</span>, <span class="string">&quot;Green Man&quot;</span> &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    SqQueue q;</span><br><span class="line">    Create(&amp;q);</span><br><span class="line">    Init(&amp;q, datas, len(datas));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;After Init(): \n&quot;</span>);</span><br><span class="line">    Print(&amp;q);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n-------------------------------------\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Element el = &#123; <span class="number">5</span>, <span class="string">&quot;Big Man&quot;</span> &#125;;</span><br><span class="line">    EnQueue(&amp;q, el);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;After EnQueue(): \n&quot;</span>);</span><br><span class="line">    Print(&amp;q);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n-------------------------------------\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    DeQueue(&amp;q, &amp;el);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;After DeQueue(): \n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d \t %s&quot;</span>, el.id, el.name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="链队"><a href="#链队" class="headerlink" title="链队"></a>链队</h2><p>链队相比循环队则简单多了，入队就是链表的插入，出队就是链表的删除，队空就是队头指针和队尾指针都为 NULL ，没有队满。</p><h3 id="定义-1"><a href="#定义-1" class="headerlink" title="定义"></a>定义</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DataElement.h</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> DATAELEMENT_H_INCLUDED</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DATAELEMENT_H_INCLUDED</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> OK 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ERROR 0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> Status;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">char</span>* name;</span><br><span class="line">&#125; Element;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">    Element data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span>* <span class="title">next</span>;</span></span><br><span class="line">&#125; Node;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义链队结构体</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    Node* front;</span><br><span class="line">    Node* rear;</span><br><span class="line">&#125; LinkQueue;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// DATAELEMENT_H_INCLUDED</span></span></span><br></pre></td></tr></table></figure><h3 id="创建-1"><a href="#创建-1" class="headerlink" title="创建"></a>创建</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Status <span class="title">Create</span><span class="params">(LinkStack* q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    q-&gt;front = <span class="literal">NULL</span>;</span><br><span class="line">    q-&gt;rear = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在创建的时候，将两个队头队尾两个指针置空</p><h3 id="初始化-1"><a href="#初始化-1" class="headerlink" title="初始化"></a>初始化</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Status <span class="title">Init</span><span class="params">(LinkQueue* q, Element* datas, <span class="keyword">int</span> length)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!isEmpty(q)) Create(q);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">        EnQueue(q, datas[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="入队-1"><a href="#入队-1" class="headerlink" title="入队"></a>入队</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Status <span class="title">EnQueue</span><span class="params">(LinkQueue* q, Element e)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Node* <span class="keyword">new</span> = (Node*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Node));</span><br><span class="line">    <span class="keyword">new</span>-&gt;data = e;</span><br><span class="line">    <span class="keyword">new</span>-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isEmpty(q)) &#123;   <span class="comment">// 如果队列为空，除了让队尾指向新结点，让队头也指向新结点</span></span><br><span class="line">        q-&gt;front = q-&gt;rear = <span class="keyword">new</span>;</span><br><span class="line">        <span class="keyword">return</span> OK;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;    <span class="comment">// 如果队列不为空，让旧的队尾元素指向新结点，队尾指针指向新结点</span></span><br><span class="line">        q-&gt;rear-&gt;next = <span class="keyword">new</span>;</span><br><span class="line">        q-&gt;rear = <span class="keyword">new</span>;</span><br><span class="line">        <span class="keyword">return</span> OK;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ERROR;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>入队就是让原本的队尾指向新的结点，这一步是让新结点加入链表；<br>然后让队尾指针也指向新的结点，这一步是对队尾指针的更新。</p><p>如果队列为空时，队头指针和队尾指针一起指向新结点。</p><h3 id="出队-1"><a href="#出队-1" class="headerlink" title="出队"></a>出队</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Element <span class="title">DeQueue</span><span class="params">(LinkQueue* q, )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Element e;</span><br><span class="line">    <span class="keyword">if</span> (isEmpty(q)) <span class="keyword">return</span> e;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (q-&gt;front == q-&gt;rear) &#123;  <span class="comment">// 链队中只有一个元素时，出队后队空，所以需要恢复队头和队尾指针为空</span></span><br><span class="line">        e = q-&gt;rear-&gt;data;</span><br><span class="line">        <span class="built_in">free</span>(q-&gt;rear);</span><br><span class="line">        q-&gt;front = q-&gt;rear = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">return</span> e;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 链队中不止一个元素时</span></span><br><span class="line">    <span class="comment">// 1. 取元素</span></span><br><span class="line">    e = q-&gt;front-&gt;data;</span><br><span class="line">    <span class="comment">// 2. 改链</span></span><br><span class="line">    Node* de = q-&gt;front;</span><br><span class="line">    q-&gt;front = de-&gt;next;</span><br><span class="line">    <span class="comment">// 3. 释放空间</span></span><br><span class="line">    <span class="built_in">free</span>(de);</span><br><span class="line">    de = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">return</span> e;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>出队的时候要考虑三种情况：</p><ol><li>队空，则返回一个空元素;</li><li>只有一个元素，出队后队头指针和队尾指针都要置空;</li><li>不止一个元素，则取元素、改链、释放空间，最后返回元素。</li></ol><h3 id="判空-1"><a href="#判空-1" class="headerlink" title="判空"></a>判空</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isEmpty</span><span class="params">(LinkQueue* q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> q-&gt;front == <span class="literal">NULL</span> &amp;&amp; q-&gt;rear == <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="清空链队"><a href="#清空链队" class="headerlink" title="清空链队"></a>清空链队</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Status <span class="title">Clear</span><span class="params">(LinkQueue* q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (isEmpty(q)) <span class="keyword">return</span> OK;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (q-&gt;front) &#123;</span><br><span class="line">        DeQueue(q);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="销毁链队"><a href="#销毁链队" class="headerlink" title="销毁链队"></a>销毁链队</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Status <span class="title">Destory</span><span class="params">(LinkQueue* q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Clear(q);</span><br><span class="line">    <span class="built_in">free</span>(q);</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="打印链队"><a href="#打印链队" class="headerlink" title="打印链队"></a>打印链队</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Print</span><span class="params">(LinkQueue* q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (isEmpty(q)) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;队列为空！&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Node* curr = q-&gt;front;</span><br><span class="line">    <span class="keyword">while</span> (curr) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d \t %s \n&quot;</span>, curr-&gt;data.id, curr-&gt;data.name);</span><br><span class="line">        curr = curr-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><h3 id="顺序队、循环队"><a href="#顺序队、循环队" class="headerlink" title="顺序队、循环队"></a>顺序队、循环队</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DataElement.h</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> DATAELEMENT_H_INCLUDED</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DATAELEMENT_H_INCLUDED</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_SIZE 10</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> OK 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ERROR 0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> TRUE 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FALSE 0</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> Status;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> Bool;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">char</span>* name;</span><br><span class="line">&#125; Element;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    Element datas[MAX_SIZE];</span><br><span class="line">    <span class="keyword">int</span> front;</span><br><span class="line">    <span class="keyword">int</span> rear;</span><br><span class="line">&#125; SqQueue;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// DATAELEMENT_H_INCLUDED</span></span></span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SqQueue.h</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> DQQUEUE_H_INCLUDED</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DQQUEUE_H_INCLUDED</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;DataElement.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">Status <span class="title">Create</span><span class="params">(SqQueue* q)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">Status <span class="title">Init</span><span class="params">(SqQueue* q, Element* datas, <span class="keyword">int</span> length)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">Status <span class="title">EnQueue</span><span class="params">(SqQueue* q, Element e)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">Status <span class="title">DeQueue</span><span class="params">(SqQueue* q, Element* e)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">Bool <span class="title">isEmpty</span><span class="params">(SqQueue* q)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">Bool <span class="title">isFull</span><span class="params">(SqQueue* q)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Print</span><span class="params">(SqQueue* q)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// DQQUEUE_H_INCLUDED</span></span></span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SqQueue.c</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;SqQueue.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">Status <span class="title">Create</span><span class="params">(SqQueue* q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    q-&gt;front = <span class="number">0</span>;</span><br><span class="line">    q-&gt;rear = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Status <span class="title">Init</span><span class="params">(SqQueue* q, Element* datas, <span class="keyword">int</span> length)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (length &gt; MAX_SIZE) &#123;</span><br><span class="line">        <span class="keyword">return</span> ERROR;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!(q-&gt;front &amp;&amp; q-&gt;rear))</span><br><span class="line">        Create(q);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">        EnQueue(q, datas[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Status <span class="title">EnQueue</span><span class="params">(SqQueue* q, Element e)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 如果队满, 无法入队</span></span><br><span class="line">    <span class="keyword">if</span> (isFull(q))</span><br><span class="line">        <span class="keyword">return</span> ERROR;</span><br><span class="line">    q-&gt;rear = (q-&gt;rear + <span class="number">1</span>) % MAX_SIZE; <span class="comment">// 先把队尾移动一格</span></span><br><span class="line">    q-&gt;datas[q-&gt;rear] = e; <span class="comment">// 再把数据放进去</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Status <span class="title">DeQueue</span><span class="params">(SqQueue* q, Element* e)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 如果队空，无法出队</span></span><br><span class="line">    <span class="keyword">if</span> (isEmpty(q))</span><br><span class="line">        <span class="keyword">return</span> ERROR;</span><br><span class="line"></span><br><span class="line">    q-&gt;front = (q-&gt;front + <span class="number">1</span>) % MAX_SIZE;</span><br><span class="line">    *e = q-&gt;datas[q-&gt;front];</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Bool <span class="title">isEmpty</span><span class="params">(SqQueue* q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> q-&gt;front == q-&gt;rear;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Bool <span class="title">isFull</span><span class="params">(SqQueue* q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> q-&gt;front == (q-&gt;rear + <span class="number">1</span>) % MAX_SIZE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Print</span><span class="params">(SqQueue* q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (isEmpty(q))</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;队列为空！&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = q-&gt;front + <span class="number">1</span>; i &lt; q-&gt;rear + <span class="number">1</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d \t %s \n&quot;</span>, q-&gt;datas[i].id, q-&gt;datas[i].name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.c</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;SqQueue.c&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> len(X) sizeof(X) / sizeof(X[0])</span></span><br><span class="line"></span><br><span class="line">Element datas[] = &#123;</span><br><span class="line">    &#123; <span class="number">1</span>, <span class="string">&quot;Iron Man&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="number">2</span>, <span class="string">&quot;Thor&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="number">3</span>, <span class="string">&quot;Captain&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="number">4</span>, <span class="string">&quot;Green Man&quot;</span> &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    SqQueue q;</span><br><span class="line">    Create(&amp;q);</span><br><span class="line">    Init(&amp;q, datas, len(datas));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;After Init(): \n&quot;</span>);</span><br><span class="line">    Print(&amp;q);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n-------------------------------------\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Element el = &#123; <span class="number">5</span>, <span class="string">&quot;Big Man&quot;</span> &#125;;</span><br><span class="line">    EnQueue(&amp;q, el);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;After EnQueue(): \n&quot;</span>);</span><br><span class="line">    Print(&amp;q);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n-------------------------------------\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    DeQueue(&amp;q, &amp;el);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;After DeQueue(): \n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d \t %s&quot;</span>, el.id, el.name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="链队-1"><a href="#链队-1" class="headerlink" title="链队"></a>链队</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DataElement.h</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> DATAELEMENT_H_INCLUDED</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DATAELEMENT_H_INCLUDED</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> OK 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ERROR 0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> Status;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">char</span>* name;</span><br><span class="line">&#125; Element;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">    Element data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span>* <span class="title">next</span>;</span></span><br><span class="line">&#125; Node;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    Node* front;</span><br><span class="line">    Node* rear;</span><br><span class="line">&#125; LinkQueue;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// DATAELEMENT_H_INCLUDED</span></span></span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LinkQueue.h</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> LINKQUEUE_H_INCLUDED</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LINKQUEUE_H_INCLUDED</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;DataElement.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">Status <span class="title">Create</span><span class="params">(LinkQueue* q)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">Status <span class="title">InitLinkQ</span><span class="params">(LinkQueue* q, Element* datas, <span class="keyword">int</span> length)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">Status <span class="title">EnQueue</span><span class="params">(LinkQueue* q, Element e)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">Element <span class="title">DeQueue</span><span class="params">(LinkQueue* q)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">Status <span class="title">Clear</span><span class="params">(LinkQueue* q)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">Status <span class="title">Destory</span><span class="params">(LinkQueue* q)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isEmpty</span><span class="params">(LinkQueue* q)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Print</span><span class="params">(LinkQueue* q)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// LINKQUEUE_H_INCLUDED</span></span></span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LinkQueue.c</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;LinkQueue.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">Status <span class="title">Create</span><span class="params">(LinkQueue* q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    q-&gt;front = <span class="literal">NULL</span>;</span><br><span class="line">    q-&gt;rear = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Status <span class="title">InitLinkQ</span><span class="params">(LinkQueue* q, Element* datas, <span class="keyword">int</span> length)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!isEmpty(q)) &#123;</span><br><span class="line">        Create(q);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">        EnQueue(q, datas[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Status <span class="title">EnQueue</span><span class="params">(LinkQueue* q, Element e)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Node* <span class="keyword">new</span> = (Node*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Node));</span><br><span class="line">    <span class="keyword">new</span>-&gt;data = e;</span><br><span class="line">    <span class="keyword">new</span>-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果队空，让队头也指向新结点</span></span><br><span class="line">    <span class="keyword">if</span> (isEmpty(q)) &#123;</span><br><span class="line">        q-&gt;front = q-&gt;rear = <span class="keyword">new</span>;</span><br><span class="line">        <span class="keyword">return</span> OK;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 队尾元素 指向新结点</span></span><br><span class="line">        q-&gt;rear-&gt;next = <span class="keyword">new</span>;</span><br><span class="line">        <span class="comment">// 队尾指针 指向新结点</span></span><br><span class="line">        q-&gt;rear = <span class="keyword">new</span>;</span><br><span class="line">        <span class="keyword">return</span> OK;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ERROR;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Element <span class="title">DeQueue</span><span class="params">(LinkQueue* q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Element e;</span><br><span class="line">    <span class="keyword">if</span> (isEmpty(q))</span><br><span class="line">        <span class="keyword">return</span> e;</span><br><span class="line">    <span class="comment">// 如果队中只有一个元素</span></span><br><span class="line">    <span class="keyword">if</span> (q-&gt;front == q-&gt;rear) &#123;</span><br><span class="line">        e = q-&gt;front-&gt;data;</span><br><span class="line">        <span class="built_in">free</span>(q-&gt;front);</span><br><span class="line">        q-&gt;front = q-&gt;rear = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">return</span> e;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 改链</span></span><br><span class="line">    Node* de = q-&gt;front;</span><br><span class="line">    q-&gt;front = de-&gt;next;</span><br><span class="line">    <span class="comment">// 2. 取元素</span></span><br><span class="line">    e = de-&gt;data;</span><br><span class="line">    <span class="comment">// 3. 释放空间</span></span><br><span class="line">    <span class="built_in">free</span>(de);</span><br><span class="line">    de = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">return</span> e;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isEmpty</span><span class="params">(LinkQueue* q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> q-&gt;front == <span class="literal">NULL</span> &amp;&amp; q-&gt;rear == <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Status <span class="title">Clear</span><span class="params">(LinkQueue* q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (isEmpty(q)) &#123;</span><br><span class="line">        <span class="keyword">return</span> OK;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (q-&gt;front) &#123;</span><br><span class="line">        DeQueue(q);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Status <span class="title">Destory</span><span class="params">(LinkQueue* q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Clear(q);</span><br><span class="line">    <span class="built_in">free</span>(q);</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Print</span><span class="params">(LinkQueue* q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (isEmpty(q)) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;队列为空！&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Node* curr = q-&gt;front;</span><br><span class="line">    <span class="keyword">while</span> (curr) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d \t %s \n&quot;</span>, curr-&gt;data.id, curr-&gt;data.name);</span><br><span class="line">        curr = curr-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.c</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;LinkQueue.c&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> len(X) sizeof(X) / sizeof(X[0])</span></span><br><span class="line"></span><br><span class="line">Element datas[] = &#123;</span><br><span class="line">    &#123; <span class="number">1</span>, <span class="string">&quot;Iron Man&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="number">2</span>, <span class="string">&quot;Thor&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="number">3</span>, <span class="string">&quot;Captain&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="number">4</span>, <span class="string">&quot;Green Man&quot;</span> &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    LinkQueue q;</span><br><span class="line">    Create(&amp;q);</span><br><span class="line">    InitLinkQ(&amp;q, datas, len(datas));</span><br><span class="line">    Print(&amp;q);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n-------------------------------------\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Element e = &#123; <span class="number">5</span>, <span class="string">&quot;Spider Man&quot;</span> &#125;;</span><br><span class="line">    EnQueue(&amp;q, e);</span><br><span class="line">    Print(&amp;q);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n-------------------------------------\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Element de = DeQueue(&amp;q);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Element deleted: %d \t %s \n&quot;</span>, de.id, de.name);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n-------------------------------------\n&quot;</span>);</span><br><span class="line">    Print(&amp;q);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n-------------------------------------\n&quot;</span>);</span><br><span class="line">    Clear(&amp;q);</span><br><span class="line">    Print(&amp;q);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n-------------------------------------\n&quot;</span>);</span><br><span class="line">    <span class="comment">// Destory(&amp;q);</span></span><br><span class="line">    <span class="comment">// Print(&amp;q);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> DataStruction </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构 </tag>
            
            <tag> DataStruction </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DataStruction 0x03 栈</title>
      <link href="posts/29925"/>
      <url>posts/29925</url>
      
        <content type="html"><![CDATA[<p>什么是栈？</p><span id="more"></span><h1 id="3-栈"><a href="#3-栈" class="headerlink" title="3-栈"></a>3-栈</h1><blockquote><p>栈是一种只允许在一端进行插入和删除操作的操作受限的线性表。</p></blockquote><p>栈的主要特点是**先进后出 (FILO)**，就像子弹夹一样，最先压进去的子弹最后打出来。</p><p>栈有一个指针，永远指向栈的最顶部，称作<strong>栈顶指针</strong>。</p><p>栈的另外一个概念是<strong>栈底指针</strong>，在顺序栈中可不实现，在链栈中必须实现。</p><p>对于栈的操作有插入和删除，也称作<strong>入栈</strong>和<strong>出栈</strong>，不能从中间取出，因为只有一个口。</p><ul><li><span class='p blue'>顺序栈</span>：栈的每一个元素存储在一段连续的内存空间，用数组实现。</li><li><span class='p blue'>链栈</span>：栈的每一个元素不一定紧挨着，用链表实现。</li></ul><p>栈的主要操作包括：<strong>创建、初始化、入栈、出栈、判空、判满、获取栈顶元素、清空栈</strong>。</p><p>栈的应用非常广，例如函数调用就是用栈实现的。栈这种前进后出的特点非常适合解决匹配问题。</p><h2 id="顺序栈"><a href="#顺序栈" class="headerlink" title="顺序栈"></a>顺序栈</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> DATAELEMENT_H_INCLUDED</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DATAELEMENT_H_INCLUDED</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_SIZE 10</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> OK 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ERROR 0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> TRUE 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FALSE 0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> Bool;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> Status;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 数据元素 */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">char</span>* name;</span><br><span class="line">&#125; Element;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/** 栈 */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    Element datas[MAX_SIZE];</span><br><span class="line">    <span class="keyword">int</span> top;<span class="comment">// 栈顶指针</span></span><br><span class="line">&#125; Stack;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// DATAELEMENT_H_INCLUDED</span></span></span><br></pre></td></tr></table></figure><h3 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Status <span class="title">Create</span><span class="params">(Stack *s)</span> </span>&#123;</span><br><span class="line">    s-&gt;top = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>栈空条件有两种：<code>s-&gt;top == -1</code>、<code>s-&gt;top == 0</code></p><p>这里采用 -1 这种，原因是不需要浪费一个元素大小的空间，另外操作起来也方便，因为数组下标是从0开始的。</p><div class="gallery ">              <p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201110215927095_2036.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201110215927095_2036.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201110220021088_9024.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201110220021088_9024.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p>            </div><h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Status <span class="title">Init</span><span class="params">(Stack* s, Element* datas, <span class="keyword">int</span> length)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (length &gt; MAX_SIZE)</span><br><span class="line">        <span class="keyword">return</span> ERROR;</span><br><span class="line">    <span class="keyword">if</span> (s-&gt;top != <span class="number">-1</span>)</span><br><span class="line">        Create(s);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++)</span><br><span class="line">        push(s, datas[i]);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="入栈"><a href="#入栈" class="headerlink" title="入栈"></a>入栈</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Status <span class="title">push</span><span class="params">(Stack* s, Element e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (s-&gt;top &gt;= MAX_SIZE - <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> ERROR;</span><br><span class="line"></span><br><span class="line">    s-&gt;datas[++s-&gt;top] = e;</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们采用的是第一种栈空表示方式，栈顶指针永远指向栈顶元素，所以在将元素赋值压入栈之前，要先把栈顶指针抬起来 1 格，然后再把元素放进去。</p><p><code>s-&gt;datas[++s-&gt;top] = e</code> 等价于 </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s-&gt;top++; </span><br><span class="line">s-&gt;datas[s-&gt;top] = e</span><br></pre></td></tr></table></figure><h3 id="出栈"><a href="#出栈" class="headerlink" title="出栈"></a>出栈</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Element <span class="title">pop</span><span class="params">(Stack* s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> s-&gt;datas[s-&gt;top--];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>出栈的道理相同，先把元素取出来，然后栈顶指针降下去1格。</p><p><code>s-&gt;datas[s-&gt;top--]</code> 等价于 </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s-&gt;datas[s-&gt;top]; </span><br><span class="line">s-&gt;top--;</span><br></pre></td></tr></table></figure><h3 id="获取栈顶元素"><a href="#获取栈顶元素" class="headerlink" title="获取栈顶元素"></a>获取栈顶元素</h3><p>获取栈顶元素不会出栈，就像把弹夹取下来看一眼，并不是打出去。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Element <span class="title">get</span><span class="params">(Stack* s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> s-&gt;datas[s-&gt;top];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="判空"><a href="#判空" class="headerlink" title="判空"></a>判空</h3><p>我们采用的是第一种栈空表示方式，所以只要判断栈顶指针是不是 <code>s-&gt;top == -1</code>即可。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Bool <span class="title">isEmpty</span><span class="params">(Stack* s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> s-&gt;top == <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="判满"><a href="#判满" class="headerlink" title="判满"></a>判满</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Bool <span class="title">isFull</span><span class="params">(Stack* s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> s-&gt;top == MAX_SIZE - <span class="number">1</span> ? TRUE : FALSE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="清空栈"><a href="#清空栈" class="headerlink" title="清空栈"></a>清空栈</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Status <span class="title">Clean</span><span class="params">(Stack* s)</span> </span>&#123;</span><br><span class="line">    s-&gt;top = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>顺序栈的清空很简单，只需要把栈顶指针指向栈底即可，虽然原本的数据没有被销毁，但是后续push的数据会将其覆盖。即使没有覆盖，在栈中我们只需要关注栈顶指针 top 的指向即可，top 所指即为栈顶，不论 top 之上有没有数据。</p><p>至于销毁栈，需要在定义 <code>Stack s</code> 的地方 <code>free(s)</code> 。</p><h3 id="打印栈"><a href="#打印栈" class="headerlink" title="打印栈"></a>打印栈</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Show</span><span class="params">(Stack* s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= s-&gt;top; i++)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d \t %s \n&quot;</span>, s-&gt;datas[i].id, s-&gt;datas[i].name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="测试数据"><a href="#测试数据" class="headerlink" title="测试数据"></a>测试数据</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;SqStack.c&quot;</span></span></span><br><span class="line"></span><br><span class="line">Element datas[] = &#123;</span><br><span class="line">    &#123; <span class="number">1</span>, <span class="string">&quot;Iron Man&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="number">2</span>, <span class="string">&quot;Green Man&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="number">3</span>, <span class="string">&quot;Thor&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="number">4</span>, <span class="string">&quot;Doctor&quot;</span> &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Stack s;</span><br><span class="line">    Create(&amp;s);</span><br><span class="line">    Init(&amp;s, datas, <span class="keyword">sizeof</span> datas / <span class="keyword">sizeof</span> datas[<span class="number">0</span>]);</span><br><span class="line">    Show(&amp;s);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n----------------------------------\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Element e = &#123; <span class="number">5</span>, <span class="string">&quot;Big Man&quot;</span> &#125;;</span><br><span class="line">    push(&amp;s, e);</span><br><span class="line">    Show(&amp;s);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n----------------------------------\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Element pe = pop(&amp;s);</span><br><span class="line">    pop(&amp;s);</span><br><span class="line">    Show(&amp;s);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ---------------------------------------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line"><span class="number">1</span>  Iron Man </span><br><span class="line"><span class="number">2</span>  Green Man </span><br><span class="line"><span class="number">3</span>  Thor </span><br><span class="line"><span class="number">4</span>  Doctor </span><br><span class="line"></span><br><span class="line">----------------------------------</span><br><span class="line"><span class="number">1</span>  Iron Man </span><br><span class="line"><span class="number">2</span>  Green Man </span><br><span class="line"><span class="number">3</span>  Thor </span><br><span class="line"><span class="number">4</span>  Doctor </span><br><span class="line"><span class="number">5</span>  Big Man </span><br><span class="line"></span><br><span class="line">----------------------------------</span><br><span class="line"><span class="number">1</span>  Iron Man </span><br><span class="line"><span class="number">2</span>  Green Man </span><br><span class="line"><span class="number">3</span>  Thor </span><br></pre></td></tr></table></figure><h2 id="链栈"><a href="#链栈" class="headerlink" title="链栈"></a>链栈</h2><h3 id="定义-1"><a href="#定义-1" class="headerlink" title="定义"></a>定义</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> DATAELEMENT_H_INCLUDED</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DATAELEMENT_H_INCLUDED</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_SIZE 10</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> OK 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ERROR 0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> TRUE 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FALSE 0</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> Status;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> Bool;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 数据元素 */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">char</span>* name;</span><br><span class="line">&#125; Element;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/** 链栈结点 */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">    Element data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span>* <span class="title">next</span>;</span></span><br><span class="line">&#125; Node;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/** 链栈 */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    Node* next;</span><br><span class="line">    <span class="keyword">int</span> top;</span><br><span class="line">&#125; LStack;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// DATAELEMENT_H_INCLUDED</span></span></span><br></pre></td></tr></table></figure><p>链栈稍微比顺序栈复杂一点点，但是换来不限栈大小的好处，所以在链栈中没有栈满的概念。</p><p>同时，链栈在入栈的时候需要手动分配空间，在出栈的时候需要把结点中的数据保存起来，销毁结点，再把数据返回。</p><h3 id="创建-1"><a href="#创建-1" class="headerlink" title="创建"></a>创建</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Status <span class="title">Create</span><span class="params">(LStack* s)</span> </span>&#123;</span><br><span class="line">    s-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    s-&gt;top = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="初始化-1"><a href="#初始化-1" class="headerlink" title="初始化"></a>初始化</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Status <span class="title">Init</span><span class="params">(LStack* s, Element* datas, <span class="keyword">int</span> length)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (s-&gt;top != <span class="number">-1</span>)</span><br><span class="line">        Create(s);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++) </span><br><span class="line">        push(s, datas[i]);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="入栈-1"><a href="#入栈-1" class="headerlink" title="入栈"></a>入栈</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Status <span class="title">push</span><span class="params">(LStack* s, Element e)</span> </span>&#123;</span><br><span class="line">4<span class="comment">// 建立新结点，分配空间</span></span><br><span class="line">    Node* <span class="keyword">new</span> = (Node*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Node));</span><br><span class="line">    <span class="comment">// 判断分配空间是否成功</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">new</span>)</span><br><span class="line">        <span class="keyword">return</span> ERROR;</span><br><span class="line">    <span class="keyword">new</span>-&gt;data = e;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 插入到链表的首元结点，成为栈顶元素</span></span><br><span class="line">    <span class="keyword">new</span>-&gt;next = s-&gt;next;</span><br><span class="line">    s-&gt;next = <span class="keyword">new</span>;</span><br><span class="line">    s-&gt;top++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里的入栈使用的是头插法，即每个新插入的元素都会插在链表的首元结点的位置。</p><h3 id="出栈-1"><a href="#出栈-1" class="headerlink" title="出栈"></a>出栈</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Element <span class="title">pop</span><span class="params">(LStack* s)</span> </span>&#123;</span><br><span class="line">    Element res;</span><br><span class="line">    <span class="keyword">if</span> (isEmpty(s)) &#123;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    Element res = s-&gt;next-&gt;data;<span class="comment">// 将栈顶元素的数据复制一份</span></span><br><span class="line">    <span class="comment">// 改链，原本指向栈顶元素，现在指向栈顶的下一个元素，使其成为新的栈顶</span></span><br><span class="line">    Node* p = s-&gt;next;</span><br><span class="line">    s-&gt;next = p-&gt;next;</span><br><span class="line">    <span class="comment">// 将旧的栈顶元素释放空间</span></span><br><span class="line">    <span class="built_in">free</span>(p);</span><br><span class="line">    s-&gt;top--;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>链栈的出栈操作要记得把被弹出栈的旧栈顶元素释放。</p><h3 id="获取栈顶元素-1"><a href="#获取栈顶元素-1" class="headerlink" title="获取栈顶元素"></a>获取栈顶元素</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Element <span class="title">get</span><span class="params">(LStack* s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> s-&gt;next-&gt;data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="判空-1"><a href="#判空-1" class="headerlink" title="判空"></a>判空</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Bool <span class="title">isEmpty</span><span class="params">(LStack* s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> s-&gt;top == <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="清空栈-1"><a href="#清空栈-1" class="headerlink" title="清空栈"></a>清空栈</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Status <span class="title">Clean</span><span class="params">(LStack* s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (s-&gt;top == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> OK;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Node* deleted = s-&gt;next;</span><br><span class="line">    Node* p;</span><br><span class="line">    <span class="keyword">while</span> (deleted) &#123;</span><br><span class="line">        p = deleted-&gt;next;</span><br><span class="line">        <span class="built_in">free</span>(deleted);</span><br><span class="line">        deleted = p;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// s-&gt;next = NULL;</span></span><br><span class="line">    <span class="comment">// s-&gt;top = -1;</span></span><br><span class="line">    Create(s);</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>清空链栈和销毁链表的操作是相同的，需要定义两个结点指针，相互配合实现整表销毁。</p><p>最后将栈置空，栈顶指针恢复到初试状态，所以这里调用了 <code>Create()</code>，等价于其上面两句表达式。</p><h3 id="打印链栈"><a href="#打印链栈" class="headerlink" title="打印链栈"></a>打印链栈</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Show</span><span class="params">(LStack* s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (s-&gt;top == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Stack is EMPTY!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Node* p = s-&gt;next;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = s-&gt;top; i &gt; <span class="number">-1</span>; i--) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d \t %s \n&quot;</span>, p-&gt;data.id, p-&gt;data.name);</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="测试数据-1"><a href="#测试数据-1" class="headerlink" title="测试数据"></a>测试数据</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;LinkStack.c&quot;</span></span></span><br><span class="line"></span><br><span class="line">Element datas[] = &#123;</span><br><span class="line">    &#123; <span class="number">1</span>, <span class="string">&quot;Iron Man&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="number">2</span>, <span class="string">&quot;Green Man&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="number">3</span>, <span class="string">&quot;Thor&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="number">4</span>, <span class="string">&quot;Doctor&quot;</span> &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    LStack s;</span><br><span class="line">    Init(&amp;s, datas, <span class="number">4</span>);</span><br><span class="line">    Show(&amp;s);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n----------------------------------\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Element e = &#123; <span class="number">5</span>, <span class="string">&quot;Big Man&quot;</span> &#125;;</span><br><span class="line">    push(&amp;s, e);</span><br><span class="line">    Show(&amp;s);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n----------------------------------\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Element pe = pop(&amp;s);</span><br><span class="line">    pop(&amp;s);</span><br><span class="line">    Show(&amp;s);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n----------------------------------\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Clean(&amp;s);</span><br><span class="line">    Show(&amp;s);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ---------------------------------------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line"><span class="number">4</span>  Doctor </span><br><span class="line"><span class="number">3</span>  Thor </span><br><span class="line"><span class="number">2</span>  Green Man </span><br><span class="line"><span class="number">1</span>  Iron Man </span><br><span class="line"></span><br><span class="line">----------------------------------</span><br><span class="line"><span class="number">5</span>  Big Man </span><br><span class="line"><span class="number">4</span>  Doctor </span><br><span class="line"><span class="number">3</span>  Thor </span><br><span class="line"><span class="number">2</span>  Green Man </span><br><span class="line"><span class="number">1</span>  Iron Man </span><br><span class="line"></span><br><span class="line">----------------------------------</span><br><span class="line"><span class="number">3</span>  Thor </span><br><span class="line"><span class="number">2</span>  Green Man </span><br><span class="line"><span class="number">1</span>  Iron Man </span><br><span class="line"></span><br><span class="line">----------------------------------</span><br><span class="line">Stack is EMPTY!</span><br></pre></td></tr></table></figure><h2 id="共享栈"><a href="#共享栈" class="headerlink" title="共享栈"></a>共享栈</h2><blockquote><p>共享栈：指的是两个栈共用一个内存空间的一种栈结构。<br>共享栈不需要用链式结构，因为共享栈为的是<strong>节省空间</strong>，用链式没有意义。</p></blockquote><p>两个栈的栈底固定不变，讲两个栈顶设置在数组的两端，即 左边的栈 s0 的栈底设在 <code>0</code> 处，右边的栈 s1 的栈底设在 <code>MAX_SIZE - 1</code> 处。<br>创建共享栈时，左栈的栈顶指针 <code>topL = -1</code>，右栈的栈顶指针 <code>topR = MAX_SIZE</code>，当两个栈顶相遇时栈满，这样可以尽可能地利用空间。</p><p>栈空 ↓ （topL == -1 &amp;&amp; topR == MAX_SIZE）<br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201119150331892_8784.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201119150331892_8784.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="栈空"></p><p>栈满 ↓ (topL == topR - 1)<br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201119150520115_25332.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201119150520115_25332.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="栈满"></p><p>普通状态 ↓<br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201119150750124_24344.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201119150750124_24344.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="普通状态"></p><h3 id="定义-2"><a href="#定义-2" class="headerlink" title="定义"></a>定义</h3><p>共享栈的定义稍稍不同。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> DATAELEMENT_H_INCLUDED</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DATAELEMENT_H_INCLUDED</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_SIZE 10</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> OK 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ERROR 0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> TRUE 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FALSE 0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LEFT 1    <span class="comment">// 和顺序栈的定义相比多一个 LEFT 和 RIGHT 来标记方向</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> RIGHT 999</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> Bool;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> Status;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">char</span>* name;</span><br><span class="line">&#125; Element;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    Element datas[MAX_SIZE];    <span class="comment">// 栈的存储空间，用数组来存储</span></span><br><span class="line">    <span class="keyword">int</span> topL;    <span class="comment">// 左栈的栈顶指针</span></span><br><span class="line">    <span class="keyword">int</span> topR;    <span class="comment">// 右栈的栈顶指针</span></span><br><span class="line">&#125; ShareStack;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// DATAELEMENT_H_INCLUDED</span></span></span><br></pre></td></tr></table></figure><h3 id="创建-2"><a href="#创建-2" class="headerlink" title="创建"></a>创建</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Status <span class="title">Create</span><span class="params">(ShareStack* s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    s-&gt;topL = <span class="number">-1</span>;</span><br><span class="line">    s-&gt;topR = MAX_SIZE;</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>创建时，将两个指针初始化</p><h3 id="初始化-2"><a href="#初始化-2" class="headerlink" title="初始化"></a>初始化</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Status <span class="title">Init</span><span class="params">(ShareStack* s, Element* datas, <span class="keyword">int</span> length, <span class="keyword">int</span> direction)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (length &gt; MAX_SIZE) &#123;</span><br><span class="line">        <span class="keyword">return</span> ERROR;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (direction == LEFT &amp;&amp; !isEmptyL(s)) &#123;</span><br><span class="line">        s-&gt;topL == <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (direction == RIGHT &amp;&amp; !isEmptyR(s)) &#123;</span><br><span class="line">        s-&gt;topR = MAX_SIZE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">        push(s, datas[i], direction);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>共享栈需要多一个参数 direction，来指定将元素放入左栈还是右栈。</p><h3 id="入栈-2"><a href="#入栈-2" class="headerlink" title="入栈"></a>入栈</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Status <span class="title">push</span><span class="params">(ShareStack* s, Element e, <span class="keyword">int</span> direction)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (isFull(s)) &#123;</span><br><span class="line">        <span class="keyword">return</span> ERROR;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (direction) &#123;</span><br><span class="line">    <span class="keyword">case</span> LEFT:</span><br><span class="line">        s-&gt;datas[++s-&gt;topL] = e;</span><br><span class="line">        <span class="keyword">return</span> OK;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> RIGHT:</span><br><span class="line">        s-&gt;datas[--s-&gt;topR] = e;</span><br><span class="line">        <span class="keyword">return</span> OK;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Direction is ILLEGAL PARAMETER!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ERROR;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="出栈-2"><a href="#出栈-2" class="headerlink" title="出栈"></a>出栈</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Element <span class="title">pop</span><span class="params">(ShareStack* s, <span class="keyword">int</span> direction)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Element e;</span><br><span class="line">    <span class="keyword">switch</span> (direction) &#123;</span><br><span class="line">    <span class="keyword">case</span> LEFT:</span><br><span class="line">        <span class="keyword">if</span> (isEmptyL(s)) &#123;</span><br><span class="line">            <span class="keyword">return</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">        e = s-&gt;datas[s-&gt;topL--];</span><br><span class="line">        <span class="keyword">return</span> e;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> RIGHT:</span><br><span class="line">        <span class="keyword">if</span> (isEmptyR(s)) &#123;</span><br><span class="line">            <span class="keyword">return</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">        e = s-&gt;datas[s-&gt;topR--];</span><br><span class="line">        <span class="keyword">return</span> e;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Direction is ILLEGAL PARAMETER!&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="获取栈顶元素-2"><a href="#获取栈顶元素-2" class="headerlink" title="获取栈顶元素"></a>获取栈顶元素</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Element <span class="title">get</span><span class="params">(ShareStack* s, <span class="keyword">int</span> direction)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> s-&gt;datas[direction == LEFT ? s-&gt;topL : s-&gt;topR];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="判空-2"><a href="#判空-2" class="headerlink" title="判空"></a>判空</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Bool <span class="title">isEmpty</span><span class="params">(ShareStack* s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> s-&gt;topL == <span class="number">-1</span> &amp;&amp; s-&gt;topR == MAX_SIZE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Bool <span class="title">isEmptyL</span><span class="params">(ShareStack* s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> s-&gt;topL == <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Bool <span class="title">isEmptyR</span><span class="params">(ShareStack* s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> s-&gt;topR == MAX_SIZE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="判满-1"><a href="#判满-1" class="headerlink" title="判满"></a>判满</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Bool <span class="title">isFull</span><span class="params">(ShareStack* s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> s-&gt;topL == s-&gt;topR - <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="清空栈-2"><a href="#清空栈-2" class="headerlink" title="清空栈"></a>清空栈</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Status <span class="title">Clean</span><span class="params">(ShareStack* s, <span class="keyword">int</span> direction)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (isEmpty(s)) &#123;</span><br><span class="line">        <span class="keyword">return</span> OK;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (direction) &#123;</span><br><span class="line">    <span class="keyword">case</span> LEFT:</span><br><span class="line">        s-&gt;topL = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> RIGHT:</span><br><span class="line">        s-&gt;topR = MAX_SIZE;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> ERROR;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="打印栈-1"><a href="#打印栈-1" class="headerlink" title="打印栈"></a>打印栈</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Show</span><span class="params">(ShareStack* s, <span class="keyword">int</span> direction)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (isEmpty(s)) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;The Whole Share stack is EMPTY!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (direction) &#123;</span><br><span class="line">    <span class="comment">// 打印左栈</span></span><br><span class="line">    <span class="keyword">case</span> LEFT:</span><br><span class="line">        <span class="keyword">if</span> (isEmptyL(s)) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;The Left Share stack is EMPTY!\n&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">1</span>; i &lt;= s-&gt;topL; i++, j++) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;No. %d is: %d \t %s \n&quot;</span>, j, s-&gt;datas[i].id, s-&gt;datas[i].name);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="comment">// 打印右栈</span></span><br><span class="line">    <span class="keyword">case</span> RIGHT:</span><br><span class="line">        <span class="keyword">if</span> (isEmptyR(s)) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;The Right Share stack is EMPTY!\n&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = s-&gt;topR, j = <span class="number">1</span>; i &lt; MAX_SIZE; i++, j++) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;No. %d is: %d \t %s \n&quot;</span>, j, s-&gt;datas[i].id, s-&gt;datas[i].name);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="comment">// 如果传进来的不是 LEFT 也不是 RIGHT，则打印整个栈</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MAX_SIZE; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i &gt; s-&gt;topL &amp;&amp; i &lt; s-&gt;topR) &#123;    <span class="comment">// 超过左栈没到右栈的这段空白</span></span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;No. %d is EMPTY.\n&quot;</span>, i + <span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;No. %d is: %d \t %s \n&quot;</span>, i + <span class="number">1</span>, s-&gt;datas[i].id, s-&gt;datas[i].name);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="测试数据-2"><a href="#测试数据-2" class="headerlink" title="测试数据"></a>测试数据</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;ShareStack.c&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> len(X) sizeof(X) / sizeof(X[0])</span></span><br><span class="line"></span><br><span class="line">Element datas1[] = &#123;</span><br><span class="line">    &#123; <span class="number">1</span>, <span class="string">&quot;Iron Man&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="number">2</span>, <span class="string">&quot;Green Man&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="number">3</span>, <span class="string">&quot;Thor&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="number">4</span>, <span class="string">&quot;Doctor&quot;</span> &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Element datas2[] = &#123;</span><br><span class="line">    &#123; <span class="number">12</span>, <span class="string">&quot;Spider Man&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="number">24</span>, <span class="string">&quot;Wonder Woman&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="number">35</span>, <span class="string">&quot;Bat Man&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="number">40</span>, <span class="string">&quot;Super Man&quot;</span> &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ShareStack ss;</span><br><span class="line">    Create(&amp;ss);</span><br><span class="line">    Init(&amp;ss, datas2, len(datas2), RIGHT);</span><br><span class="line">    Show(&amp;ss, RIGHT);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n----------------------------------\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Init(&amp;ss, datas1, len(datas1), LEFT);</span><br><span class="line">    Show(&amp;ss, LEFT);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n----------------------------------\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Show(&amp;ss, <span class="number">10</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ---------------------------------------------------</span></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line">No. <span class="number">1</span> is: <span class="number">40</span>  Super Man </span><br><span class="line">No. <span class="number">2</span> is: <span class="number">35</span>  Bat Man </span><br><span class="line">No. <span class="number">3</span> is: <span class="number">24</span>  Wonder Woman </span><br><span class="line">No. <span class="number">4</span> is: <span class="number">12</span>  Spider Man </span><br><span class="line"></span><br><span class="line">----------------------------------</span><br><span class="line">No. <span class="number">1</span> is: <span class="number">1</span>  Iron Man </span><br><span class="line">No. <span class="number">2</span> is: <span class="number">2</span>  Green Man </span><br><span class="line">No. <span class="number">3</span> is: <span class="number">3</span>  Thor </span><br><span class="line">No. <span class="number">4</span> is: <span class="number">4</span>  Doctor </span><br><span class="line"></span><br><span class="line">----------------------------------</span><br><span class="line">No. <span class="number">1</span> is: <span class="number">1</span>  Iron Man </span><br><span class="line">No. <span class="number">2</span> is: <span class="number">2</span>  Green Man </span><br><span class="line">No. <span class="number">3</span> is: <span class="number">3</span>  Thor </span><br><span class="line">No. <span class="number">4</span> is: <span class="number">4</span>  Doctor </span><br><span class="line">No. <span class="number">5</span> is EMPTY.</span><br><span class="line">No. <span class="number">6</span> is EMPTY.</span><br><span class="line">No. <span class="number">7</span> is: <span class="number">40</span>  Super Man </span><br><span class="line">No. <span class="number">8</span> is: <span class="number">35</span>  Bat Man </span><br><span class="line">No. <span class="number">9</span> is: <span class="number">24</span>  Wonder Woman </span><br><span class="line">No. <span class="number">10</span> is: <span class="number">12</span>  Spider Man </span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> DataStruction </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构 </tag>
            
            <tag> DataStruction </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DataStruction 0x02 线性表</title>
      <link href="posts/21668"/>
      <url>posts/21668</url>
      
        <content type="html"><![CDATA[<p>什么是线性表？</p><span id="more"></span><h1 id="2-线性表"><a href="#2-线性表" class="headerlink" title="2-线性表"></a>2-线性表</h1><blockquote><p>线性表指 0 或 n 个数据元素的有限序列</p></blockquote><p>特点：</p><ol><li>元素之间有序</li><li>元素个数有限</li><li>第一个无直接前驱元素</li><li>最后一个无直接后继元素</li><li>其余元素都有唯一一个直接前驱元素和唯一一个直接后继元素</li></ol><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201018201506104_12047.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201018201506104_12047.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>线性表元素的个数 $n(n&gt;=0)$ 即为<strong>线性表的长度</strong>；当 n=0 时，称为<strong>空表</strong>。</p><p>非空表中每个数据元素都有一个确定的位置，如$a_1$是首个元素，$a_n$是最后元素，$a_i$是第$i$个元素（称 $i$ 为数据元素 $a_i$ 在线性表中的位序）</p><blockquote><p>说句人话就是，像数组一样的数据结构就是线性表。<br>比如拿 5 个苹果排成一行，从左到右依次编号 12345，<br>第一个苹果前面没有苹果，<br>最后一个苹果后面没有其他苹果，<br>中间第 2、3、4 个苹果都有前一个苹果和后一个苹果，<br>例如第 2 个苹果的前一个苹果是 1 号苹果，后一个是 3 号苹果。</p></blockquote><h2 id="ADT"><a href="#ADT" class="headerlink" title="ADT"></a>ADT</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ADT 线性表(<span class="type">List</span>)</span><br><span class="line">Data</span><br><span class="line">    线性表是数据对象集合为&#123;a1, a2, ..., an&#125;，每个元素的类型均为DataType。</span><br><span class="line">Operation</span><br><span class="line">    InitList(*L):          初始化操作，建立一个空的线性表L。</span><br><span class="line">    ListEmpty(L):          线性表为空返回<span class="literal">True</span>， 否则返回<span class="literal">False</span></span><br><span class="line">    ClearList(*L):         将线性表清空。</span><br><span class="line">    GetElem(L, i, *e):     将线性表L中第i个位置元素的值返回给e。</span><br><span class="line">    LocateElem(L, e):      在线性表L中查找与给定值e相等的元素，查找成功返回元素在表中的序号，失败返回O。</span><br><span class="line">    ListInsert(*L, i, e):  在线性表L中第i个位置插入新元素e。</span><br><span class="line">    ListDelete(*L, i, *e): 删除线性表L中第i个位置元素，并用e返回其值。</span><br><span class="line">    ListLength(L):         返回线性表L的元素个数。</span><br><span class="line">endADT</span><br></pre></td></tr></table></figure><h2 id="顺序结构的线性表"><a href="#顺序结构的线性表" class="headerlink" title="顺序结构的线性表"></a>顺序结构的线性表</h2><blockquote><p>线性表的顺序存储结构，指的是用一段连续的存储单元一次存储线性表的数据元素。<br>例如数组，知道了第一个元素的地址，后面的元素都可以快速的计算出来。<br>假设第一个元素的<strong>地址为 A</strong>，每个元素<strong>占 k 个字节</strong>，则可知<strong>第 i 个元素</strong>的地址为 <span class='p blue'>A + i * k</span>。</p></blockquote><p>顺序结构在查找时，不论要查找的元素在任何位置，时间复杂度都为 $O(1)$，但在插入和删除时，平均时间复杂度为 $O(n)$。</p><h2 id="顺序结构代码实现"><a href="#顺序结构代码实现" class="headerlink" title="顺序结构代码实现"></a>顺序结构代码实现</h2><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201018171008169_28518.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201018171008169_28518.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>先放上各专业术语的关系图，以做对照。</p><h3 id="数据元素"><a href="#数据元素" class="headerlink" title="数据元素"></a>数据元素</h3><p>各种操作的基本单位是<strong>数据元素</strong>，数据元素又由各<strong>数据项</strong>构成。</p><p>在代码中，用 <strong>结构体类型(C语言中是结构体，Java等语言是类)</strong> 来实现数据元素，<br>用各种 <strong>基本类型(int、char、float、其他结构体等)</strong> 来实现数据项。（注意数据项也可以是结构体）</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义结构体</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Student</span>&#123;</span></span><br><span class="line">    <span class="keyword">char</span> name[<span class="number">10</span>];</span><br><span class="line">    <span class="keyword">int</span> age;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Student</span> <span class="title">Stu</span>;</span>    <span class="comment">// 为结构体起别名，后续写代码的时候比较方便</span></span><br></pre></td></tr></table></figure><p>或者写成这种：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span>&#123;</span></span><br><span class="line">    <span class="keyword">char</span> name[<span class="number">10</span>];</span><br><span class="line">    <span class="keyword">int</span> age;</span><br><span class="line">&#125;Stu;</span><br></pre></td></tr></table></figure><p>在实际应用中数据元素（结构体）名字以实际业务为准<br>在以下例子中，则用 Element 指代 数据元素结构体。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span>&#123;</span></span><br><span class="line">    <span class="keyword">char</span> name[<span class="number">10</span>];</span><br><span class="line">    <span class="keyword">int</span> age;</span><br><span class="line">&#125;Element;</span><br></pre></td></tr></table></figure><h3 id="数据对象"><a href="#数据对象" class="headerlink" title="数据对象"></a>数据对象</h3><p>这里数据对象指的就是线性表了。<br>线性表中需要包含 N 个数据元素，N 个数据元素要使用数组存放；再加上一个<code>count</code>来统计数据元素个数。</p><p><strong>注意是元素个数 (count of data elemment) 不是数组长度(length of array)。</strong></p><p>数组长度一开始要预留好，是固定不变的；<br>元素个数是变化的，增删插入之后都会变化，而数组长度不会。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DataElement.h</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> len(X) sizeof X / sizeof X[0]</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_SIZE 5</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span>&#123;</span></span><br><span class="line">    Element elemArr[MAX_SIZE];  <span class="comment">// 用数组存放数据元素</span></span><br><span class="line">    <span class="keyword">int</span> count;                  <span class="comment">// Count of data element.</span></span><br><span class="line">&#125;SqList;</span><br></pre></td></tr></table></figure><h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Status <span class="title">Init</span><span class="params">(SqList *L, Stu *studArr)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> length = len(studArr);          <span class="comment">// 获取数组长度</span></span><br><span class="line">    <span class="keyword">if</span>(length &gt; MAX_SIZE) <span class="keyword">return</span> ERROR; <span class="comment">// 检查数组长度是否超出预设长度</span></span><br><span class="line"></span><br><span class="line">    L-&gt;count = <span class="number">0</span>;   <span class="comment">// count 初始化为 0</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++) </span><br><span class="line">        Insert(L, i, studArr[i]);   <span class="comment">// 调用插入方法将元素插入到数组中（插入方法稍后实现）</span></span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.c</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;DataElement.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 定义一个线性表</span></span><br><span class="line">    SqList L;</span><br><span class="line">    SqList *pL = &amp;L;</span><br><span class="line">    <span class="comment">// 定义一份数据集</span></span><br><span class="line">    Stu studArr = &#123;</span><br><span class="line">        &#123;<span class="string">&quot;Boii&quot;</span>, <span class="number">18</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;Eva&quot;</span>, <span class="number">20</span>&#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// 初始化线性表</span></span><br><span class="line">    Init(pL, studArr);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="获得元素"><a href="#获得元素" class="headerlink" title="获得元素"></a>获得元素</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> OK 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ERROR 0</span></span><br><span class="line"><span class="keyword">typedef</span> uint Status;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用pe返回 在线性表L中第position个元素</span></span><br><span class="line"><span class="comment"> * @param *L        要操作是顺序表</span></span><br><span class="line"><span class="comment"> * @param position  要查找的元素位置</span></span><br><span class="line"><span class="comment"> * @param e         负责带回元素的元素指针</span></span><br><span class="line"><span class="comment"> * @return 获得成功返回OK，失败返回ERROR</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">Status <span class="title">GetElem</span><span class="params">(SqList *L, <span class="keyword">int</span> position, Element *e)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(L-&gt;count == <span class="number">0</span> || position &lt; <span class="number">1</span> || position &gt; L-&gt;count || e == <span class="literal">NULL</span>)</span><br><span class="line">        <span class="keyword">return</span> ERROR;</span><br><span class="line"></span><br><span class="line">    *e = L-&gt;data[position<span class="number">-1</span>];</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//------------------------------------------------</span></span><br><span class="line"><span class="comment">// 调用时</span></span><br><span class="line">SqList L;</span><br><span class="line">SqList *pL = &amp;L;</span><br><span class="line">Element e;</span><br><span class="line">Element *pe = &amp;e;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(GetElem(pL, <span class="number">3</span>, pe))</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s %d&quot;</span>, pe-&gt;name, pe-&gt;age);</span><br></pre></td></tr></table></figure><p>函数中先是判断顺序表是否为空表（空表时 count 为 0），接着对位置进行判断，看看是否在合法范围内，还有指针是否为空；<br>如果满足其中一个条件则返回 ERROR。<br>最后对将目标元素赋值给 pe。</p><p>参数中使用的是 *L，即直接操作目标顺序表<br><code>position</code> 代表的是位置，从1开始的（注意不是下标，下标是从0开始的），所以是将 <code>data[position-1]</code> 返回去<br>例如查找第5个元素，应该1211<br>返回 data[4]</p><h3 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将 e 插入到在线性表L中的第 idx 个元素</span></span><br><span class="line"><span class="comment"> * @param *L   要操作是顺序表</span></span><br><span class="line"><span class="comment"> * @param idx  要插入的元素下标</span></span><br><span class="line"><span class="comment"> * @param e    要插入的元素的指针</span></span><br><span class="line"><span class="comment"> * @return 插入成功返回OK，失败返回ERROR</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">Status <span class="title">Insert</span><span class="params">(SqList *L, <span class="keyword">int</span> idx, Element *e)</span></span>&#123;</span><br><span class="line">    <span class="comment">// 如果顺序表已满、或下标越界，返回ERROR</span></span><br><span class="line">    <span class="keyword">if</span>(L-&gt;count == MAX_SIZE || idx &lt; <span class="number">0</span> || idx &gt; L-&gt;count)</span><br><span class="line">        <span class="keyword">return</span> ERROR;</span><br><span class="line">    <span class="comment">// 如果要插入的位置不在末尾，则从最后一个开始，一个一个往后挪</span></span><br><span class="line">    <span class="keyword">if</span>(idx &lt; L-&gt;count)</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = L-&gt;count - <span class="number">1</span>; i &gt;= idx; i--)</span><br><span class="line">            L-&gt;data[i + <span class="number">1</span>] = L-&gt;data[i];</span><br><span class="line">    <span class="comment">// 将元素插入指定的 idx </span></span><br><span class="line">    L-&gt;data[idx] = *e;</span><br><span class="line">    L-count++;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>思路：</p><ul><li>表满时，插入失败</li><li>下标小于 0 或大于 count - 1 时，插入失败</li><li>插入位置在表尾，即 idx = count，直接插入</li><li>插入位置不在表尾，即 idx &lt; count，从末尾开始后一位给前一位，直到把 data[idx] 空出来</li></ul><h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将线性表L中的第 position 个元素删除，被删元素保存在 e 中</span></span><br><span class="line"><span class="comment"> * @param *L        要操作是顺序表</span></span><br><span class="line"><span class="comment"> * @param position  要查找的元素位置</span></span><br><span class="line"><span class="comment"> * @param e         要删除的元素的指针</span></span><br><span class="line"><span class="comment"> * @return 删除成功返回OK，失败返回ERROR</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">Status <span class="title">Delete</span><span class="params">(SqList *L, <span class="keyword">int</span> position, Element *e)</span></span>&#123;</span><br><span class="line">    <span class="comment">// 如果空表或者位置超出范围，返回ERROR</span></span><br><span class="line">    <span class="keyword">if</span>(L-&gt;count == <span class="number">0</span> || position &lt; <span class="number">1</span> || position &gt; L-&gt;count) <span class="keyword">return</span> ERROR;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将要删除的元素保存起来</span></span><br><span class="line">    <span class="keyword">if</span> (e != <span class="literal">NULL</span>) *e = L-&gt;data[position - <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果删除的不是末尾元素</span></span><br><span class="line">    <span class="keyword">if</span> (position &lt; L-&gt;count)</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = position; i &lt; L-&gt;count; i++)</span><br><span class="line">            L-&gt;data[i - <span class="number">1</span>] = L-&gt;data[i];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 元素个数-1</span></span><br><span class="line">    L-&gt;count--;</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>思路：</p><ul><li>如果空表，或者位置超出范围[1, count]，删除失败</li><li>先将要删除的元素保存起来</li><li>如果删除的不是末尾元素，从删除位置开始到顺序表末尾，后一个赋值给前一个，最后元素个数-1</li><li>如果删除的是末尾元素，直接元素个数-1</li></ul><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>数组在查询时，不管元素在哪个位置，时间复杂度都为 O(1)，<br>在删除和插入时，如果位置靠后则挪动的少，如果位置在最前，则整个数组都要挪动。<br>换言之，插入或删除第 i 个元素，需要移动 i - 1个元素。平均移动次数为 (n - 1)/2。所以时间复杂度为O(n)。</p><p>顺序结构比较适合元素个数不太变化，而是更多存取数据的应用。</p><h2 id="链式结构的线性表"><a href="#链式结构的线性表" class="headerlink" title="链式结构的线性表"></a>链式结构的线性表</h2><blockquote><p>线性表的链式结构是指，指的是用不连续的存储单元存储线性表的数据元素。</p></blockquote><p>在链式结构中，除了存储数据元素之外，还要存储其后继元素的地址。<br>存储数据元素信息的域称为<strong>数据域</strong>，存储后继元素地址的域称为<strong>指针域</strong>；<br>这两部分共同组成一个结点，n个结点链结成一个链表，即为线性表的链式存储结构。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20210711154902.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20210711154902.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>链表的起始结点称为<strong>头结点</strong>，头结点中的指针域称为<strong>头指针</strong>。<br>头结点的数据域可以不存储任何信息，也可以存储线性表长度等附加信息；<br>头结点的指针域指向第一个结点（第一个结点可以称为<strong>首元结点</strong>）；<br>头结点的指针域为空时（即头指针为空时），为空链表。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20210711162258.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20210711162258.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>因此，<br>每个结点只包含一个<strong>后继指针域</strong>（指向后继元素的指针域），称为 <span class='p blue'>单向链表</span>；<br>每个结点包含一个<strong>后继指针域</strong>（指向后继元素的指针域）和一个<strong>前驱指针域</strong>（指向前驱元素的指针域），称为<span class='p blue'>双向链表</span>；</p><p>链表的最后一个结点称为<strong>尾结点</strong>，尾结点的指针域可以为空（通常用 <code>NULL</code> 或 <code>^</code> 表示）<br>尾结点的<strong>后继指针域</strong>为空时，称为 <span class='p blue'>单链表</span>；<br>尾结点的<strong>后继指针域</strong>指向首元结点的地址时（指向首元结点不是头结点），称为 <span class='p blue'>循环链表</span>。</p><p>同理，<br>尾结点的<strong>后继指针域</strong>指 $\to$ 向<strong>首元结点</strong>的地址，首元结点的<strong>前驱指针域</strong>指 $\to$ 向<strong>尾结点</strong>时，称为 <span class='p blue'>双向循环链表</span>。</p><h3 id="单链表的代码实现"><a href="#单链表的代码实现" class="headerlink" title="单链表的代码实现"></a>单链表的代码实现</h3><h4 id="定义结点"><a href="#定义结点" class="headerlink" title="定义结点"></a>定义结点</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义数据元素</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Element</span> &#123;</span></span><br><span class="line">    <span class="keyword">char</span> *name;</span><br><span class="line">    <span class="keyword">int</span> age;</span><br><span class="line">&#125; Element;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义结点</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">    Element data;<span class="comment">// 数据域</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span>* <span class="title">next</span>;</span><span class="comment">// 指针域，指向本身类型定，称为自引用</span></span><br><span class="line">&#125; Node;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为结点指针定义别名</span></span><br><span class="line"><span class="keyword">typedef</span> Node* PNode;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义头结点</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">HeadNode</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> length;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span>* <span class="title">next</span>;</span></span><br><span class="line">&#125; HeadNode;</span><br></pre></td></tr></table></figure><p>代码中，先是定义了数据元素的结构，然后定义结点。</p><p>定义结点的时候，分别定义了数据域和指针域。可以看到指针域其实是自身的指针，这样的实现称为<strong>自引用</strong>。</p><p>假设 p 是指向第 i 个结点的移动指针，则 p-&gt;data 的值第 i 个结点的数据，而 p-&gt;next 的值为下一个结点（即第 i + 1个结点）的地址。<br>用 <code>p = p-&gt;next;</code> 可以让移动指针移动到第 i + 1 个结点，这时再使用 <code>p-&gt;data</code> 的值就为第 i + 1 个结点的数据。</p><p>最后为了方便表示，为这个结点类型的指针定义了一个类型别名 <code>PNode</code>。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PNode p;</span><br></pre></td></tr></table></figure><h4 id="创建链表"><a href="#创建链表" class="headerlink" title="创建链表"></a>创建链表</h4><p>创建链表其实就是创建一个头结点，这个头结点很重要，对链表的操作都是从头结点开始的。</p><p>这里形参用的是指针形式，即直接操作该指针。所以在调用 <code>Create()</code> 时取了 link 的地址。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Status <span class="title">Create</span><span class="params">(HeadNode *head)</span> </span>&#123;</span><br><span class="line">    head-&gt;length = <span class="number">0</span>;</span><br><span class="line">    head-&gt;next = null;</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用时</span></span><br><span class="line">HeadNode link;</span><br><span class="line">Create(&amp;link);</span><br></pre></td></tr></table></figure><h4 id="插入结点"><a href="#插入结点" class="headerlink" title="插入结点"></a>插入结点</h4><p>插入节点的思路为：</p><ol><li>创建新结点并给结点的数据域赋值</li><li>如果要插入的位置为 1（即首元节点），则将头结点的 next 给新节点，然后头结点的 next 指向新节点，长度 +1；</li><li>如果要插入的位置不为 1，则利用一个 node 指针遍历链表找到要插入位置的前一个结点，将前一个结点的 next 给新节点，然后前一个结点的 next 指向 新节点，长度 +1；</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Status <span class="title">Insert</span><span class="params">(HeadNode *head, Element e, <span class="keyword">int</span> pos)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 如果插入位置超过数组长度，则返回ERROR</span></span><br><span class="line">    <span class="keyword">if</span>(pos &gt; head-&gt;length) <span class="keyword">return</span> ERROR;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 创建新节点并给新结点的数据域赋值</span></span><br><span class="line">    Node* newNode = (Node*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span> Node);</span><br><span class="line">    newNode-&gt;data = e;</span><br><span class="line">    newNode-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 如果插入的位置为首元节点</span></span><br><span class="line">    <span class="keyword">if</span>(pos == <span class="number">1</span>)&#123;</span><br><span class="line">        newNode-&gt;next = head-&gt;next;</span><br><span class="line">        head-&gt;next = newNode;</span><br><span class="line">        head-&gt;length++;</span><br><span class="line">        <span class="keyword">return</span> OK;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 如果插入的位置不是首元节点</span></span><br><span class="line">    <span class="comment">//    声明一个移动指针遍历遍历直到达到要插入的位置的前一个结点</span></span><br><span class="line">    <span class="comment">//    因为要到达前一个结点，所以这里走到 pos - 1 即可</span></span><br><span class="line">    Node* p = head-&gt;next;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; p &amp;&amp; i &lt; pos - <span class="number">1</span>; i++)&#123;</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    newNode-&gt;next = p-&gt;next;</span><br><span class="line">    p-&gt;next = newNode;</span><br><span class="line">    head-&gt;length++;</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用时</span></span><br><span class="line">Element e = &#123;<span class="string">&quot;Boii&quot;</span>, <span class="number">18</span>&#125;;</span><br><span class="line">Insert(&amp;head, e, <span class="number">4</span>);</span><br></pre></td></tr></table></figure><blockquote><p> 链表插入的重点在于要先将 <strong>前一个结点的指针域 新节点的指针域 newNode-&gt;next = p-&gt;next</strong> ，然后再把 <strong>新节点的地址给前一个结点的指针域 p-&gt;next = newNode</strong> ，这两者顺序不能颠倒，否则会插入失败。</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20210711164948.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20210711164948.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h4 id="初始化链表"><a href="#初始化链表" class="headerlink" title="初始化链表"></a>初始化链表</h4><p>初始化链表时需要将<strong>头结点</strong>和<strong>元素数组</strong>传给函数</p><p>上面我们已经定义好了 创建链表函数，插入结点函数，所以在初始化时非常方便，只需要调用<code>Create()</code>创建链表，然后遍历元素数组，调用<code>Insert()</code>即可。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Status <span class="title">Init</span><span class="params">(HeadNode *head, Element *datas)</span></span>&#123;</span><br><span class="line">    <span class="comment">// 创建链表</span></span><br><span class="line">    <span class="keyword">if</span>(Create(head))&#123;</span><br><span class="line">        <span class="comment">// 遍历元素数组</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; (<span class="keyword">sizeof</span> datas / <span class="keyword">sizeof</span> datas[<span class="number">0</span>]); i++)</span><br><span class="line">            Insert(head, datas[i], i + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> OK;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ERROR;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用时</span></span><br><span class="line">Element datas = &#123;</span><br><span class="line">    &#123;<span class="string">&quot;Alice&quot;</span>, <span class="number">18</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;Boii&quot;</span>, <span class="number">20</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;Candy&quot;</span>, <span class="number">22</span>&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">HeadNode head;</span><br><span class="line">Init(&amp;head, datas);</span><br></pre></td></tr></table></figure><h4 id="读取结点"><a href="#读取结点" class="headerlink" title="读取结点"></a>读取结点</h4><p>假设现在要读取第 i 个结点，在读取结点之前，要先找到结点，然后把数据保存起来。</p><p>获得链表第 i 个数据的思路：</p><ol><li>声明一个移动指针 p，让 p 指向第一个结点；</li><li>声明一个计数器 j， 初始化 j 从 1 开始（因为 j 是用来和 i 做比较的，i 是从1开始算的）；</li><li>当 j &lt; i 时，就遍历链表，一直让移动指针 p 向后移动并且 j++，直到 j == i；</li><li>若到链表末尾 p 为空，则说明没找到第 i 个数据；</li><li>否则查找成功，返回 p 指向的结点的数据。</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Status <span class="title">GetElem</span><span class="params">(PNode List, <span class="keyword">int</span> i, Element *e)</span> </span>&#123;</span><br><span class="line">    PNode p = List-&gt;next;   <span class="comment">// 指向头结点；</span></span><br><span class="line">    <span class="keyword">int</span> j = <span class="number">1</span>;              <span class="comment">// 初始化计数器</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(j &lt; i || p ) &#123;</span><br><span class="line">        p = p-&gt;next;    <span class="comment">// 让移动指针指向下一个结点</span></span><br><span class="line">        j++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果 p 为空 或者 j &gt; i, 说明没找到，返回 error</span></span><br><span class="line">    <span class="keyword">if</span>(!p || j &gt; i) <span class="keyword">return</span> ERROR;</span><br><span class="line"></span><br><span class="line">    *e = p-&gt;data;</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="删除结点"><a href="#删除结点" class="headerlink" title="删除结点"></a>删除结点</h4><p>删除思路：</p><ol><li>创建一个结点指针 <code>Node*</code>来暂存要被删除的结点的地址</li><li>找到要被删除的结点的前一个结点</li><li>让前一个结点的 next 指向被删结点的 下一个结点</li><li>free 释放被删结点的内存</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Status <span class="title">Delete</span><span class="params">(HeadNode *head, <span class="keyword">int</span> pos)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(pos &gt; head-&gt;length)</span><br><span class="line">        <span class="keyword">return</span> ERROR;</span><br><span class="line"></span><br><span class="line">    Node* p = head-&gt;next;</span><br><span class="line">    <span class="comment">/* 1. 如果删除的是首元节点 */</span></span><br><span class="line">    <span class="keyword">if</span>(pos == <span class="number">1</span>)&#123;</span><br><span class="line">        head-&gt;next = p-&gt;next;</span><br><span class="line">        head-&gt;length--;</span><br><span class="line">        <span class="built_in">free</span>(p);</span><br><span class="line">        <span class="keyword">return</span> OK;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* 2. 如果删除的不是首元结点 */</span></span><br><span class="line">    <span class="comment">/* 先找到要删除结点的前一个结点 */</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; p &amp;&amp; i &lt; pos - <span class="number">1</span>; i++)&#123;</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* 然后删除目标结点 */</span></span><br><span class="line">    Node *q = p-&gt;next;<span class="comment">// 创建一个Node型指针暂存被删结点</span></span><br><span class="line">    p-&gt;next = q-&gt;next;<span class="comment">// 让被删结点的前驱元素的 next 指向被删结点的后驱元素</span></span><br><span class="line">    head-&gt;length--;<span class="comment">// 长度-1</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">free</span>(q);<span class="comment">// 释放被删结点的空间</span></span><br><span class="line">    q = p = <span class="literal">NULL</span>;<span class="comment">// 指针置空</span></span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>C语言需要自己管理内存，自己管理指针释放指针，所以在删除之前要先将被删除结点保存起来，改链（p-&gt;next = q-&gt;next）之后将被删除结点的内存释放，最后把函数里创建的指针置空。</p><p>删除 i 结点其实就是让 i - 1 结点指向 i + 1.</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20210711171703.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20210711171703.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h3 id="循环链表"><a href="#循环链表" class="headerlink" title="循环链表"></a>循环链表</h3><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20210711171957.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20210711171957.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>循环链表与单链表相比多了一个<strong>尾元结点指向首元节点</strong>。可以把尾元结点的指针称为<strong>尾指针</strong>。</p><p>当遍历循环链表时，可以通过判断 <code>尾元结点-&gt;next == 头结点-&gt;next</code>得知是否遍历了一圈了。</p><p>其实循环链表可以有2种实现形式：</p><ol><li>尾指针指向头结点</li><li>尾指针指向首元结点</li></ol><p>可根据需要选择相应的设计。</p><p>在操作上，循环链表和单链表的区别主要在<strong>插入</strong>和<strong>删除</strong>上。</p><h4 id="插入操作"><a href="#插入操作" class="headerlink" title="插入操作"></a>插入操作</h4><p>循环链表的插入操作要考虑4种情况</p><ol><li>链表是否为空</li><li>插入位置为首元节点</li><li>插入位置为尾元结点</li><li>插入位置为中间结点</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Status <span class="title">Insert</span><span class="params">(HeadNode *head, Element e, <span class="keyword">int</span> pos)</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(pos &gt; head-&gt;length) <span class="keyword">return</span> ERROR;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建新结点</span></span><br><span class="line">    Node *newNode = (Node*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span> Node);</span><br><span class="line">    newNode-&gt;data = e;</span><br><span class="line">    newNode-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 1. 链表为空 */</span></span><br><span class="line">    <span class="keyword">if</span>(!head-&gt;length)&#123;</span><br><span class="line">        newNode-&gt;next = newNode;    <span class="comment">// 让新结点的后继指针指向自己</span></span><br><span class="line">        head-&gt;next = newNode;       <span class="comment">// 让头结点指向新结点</span></span><br><span class="line">        head-&gt;length++;</span><br><span class="line">        <span class="keyword">return</span> OK;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 链表不为空 */</span></span><br><span class="line">    <span class="comment">/** 2. 插入位置为首元结点 */</span></span><br><span class="line">    <span class="keyword">if</span>(pos == <span class="number">1</span>)&#123;</span><br><span class="line">        <span class="comment">// 先把新结点做插入操作</span></span><br><span class="line">        newNode-&gt;next = head-&gt;next;</span><br><span class="line">        head-&gt;next = newNode;</span><br><span class="line">        head-&gt;length++;</span><br><span class="line">        <span class="comment">// 找到尾结点</span></span><br><span class="line">        Node *last = head-&gt;next;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; head-&gt;length; i++) last = last-&gt;next;</span><br><span class="line">        <span class="comment">// 让尾指针指向新结点</span></span><br><span class="line">        last-&gt;next = newNode;</span><br><span class="line">        <span class="keyword">return</span> OK;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 3. 插入位置为尾元结点 */</span></span><br><span class="line">    <span class="keyword">if</span>(pos == head-&gt;length)&#123;</span><br><span class="line">        <span class="comment">// 找到尾结点</span></span><br><span class="line">        Node *last = head-&gt;next;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; head-&gt;length; i++) last = last-&gt;next;</span><br><span class="line">        <span class="comment">// 让新结点指向头结点，让尾结点指向新结点</span></span><br><span class="line">        newNode-&gt;next = head-&gt;next;</span><br><span class="line">        last-&gt;next = newNode;</span><br><span class="line">        head-&gt;length++;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> OK;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 4. 插入位置为中间结点*/</span></span><br><span class="line">    <span class="keyword">if</span>(pos != head-&gt;length)&#123;</span><br><span class="line">        <span class="comment">// 找到目标位置的前一个</span></span><br><span class="line">        Node *p = head-&gt;next;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; p &amp;&amp; i &lt; pos - <span class="number">1</span>; i++) p = p-&gt;next;</span><br><span class="line">        <span class="comment">// 做普通插入操作</span></span><br><span class="line">        newNode-&gt;next = p-&gt;next;</span><br><span class="line">        p-&gt;next = newNode;</span><br><span class="line">        head-&gt;length++;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> OK;</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>当链表为空时，插入新结点只需要让新结点指向自己，然后让头结点指向新结点即可<br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201108141810398_2941.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201108141810398_2941.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></li><li><p>当链表不为空</p><ul><li>插入位置为首元结点时，先做一个普通的插入操作，然后找到尾结点让尾指针指向新结点即可<br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201108142944261_12884.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201108142944261_12884.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="><br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201108143058806_22741.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201108143058806_22741.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="><br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201108143136326_25958.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201108143136326_25958.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="><br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201108143218765_26724.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201108143218765_26724.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></li><li>插入位置为尾元结点时，找到尾元结点，让新结点指向头结点，让尾指针指向新结点即可<br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201108143435454_10891.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201108143435454_10891.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="><br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201108143551702_29475.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/20201108143551702_29475.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></li><li>插入位置为中间结点时，找到目标位置前一个结点，做一个普通插入操作即可</li></ul></li></ul><h4 id="循环链表删除操作"><a href="#循环链表删除操作" class="headerlink" title="循环链表删除操作"></a>循环链表删除操作</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Status <span class="title">DeteleCLinkList</span><span class="params">(HeadNode* head, <span class="keyword">int</span> pos)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 判断位置是否正确，或是否为空链表</span></span><br><span class="line">    <span class="keyword">if</span> (isEmptyC(head) || pos &gt; head-&gt;length)</span><br><span class="line">        <span class="keyword">return</span> ERROR;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果是删除首元结点</span></span><br><span class="line">    <span class="keyword">if</span> (pos == <span class="number">1</span>) &#123;</span><br><span class="line">        Node* first = head-&gt;next;</span><br><span class="line">        head-&gt;next = first-&gt;next;</span><br><span class="line"></span><br><span class="line">        Node* last = GetLast(head);</span><br><span class="line">        last-&gt;next-&gt;next = head-&gt;next;</span><br><span class="line"></span><br><span class="line">        head-&gt;length--;</span><br><span class="line">        <span class="built_in">free</span>(first);</span><br><span class="line">        <span class="keyword">return</span> OK;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果是删除尾元结点</span></span><br><span class="line">    <span class="keyword">if</span> (pos == head-&gt;length) &#123;</span><br><span class="line">        Node* last = GetLast(head);</span><br><span class="line">        last-&gt;next = head-&gt;next;</span><br><span class="line"></span><br><span class="line">        head-&gt;length--;</span><br><span class="line">        <span class="built_in">free</span>(last);</span><br><span class="line">        <span class="keyword">return</span> OK;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 1、找到目标结点</span></span><br><span class="line">    Node* current = head-&gt;next;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; pos - <span class="number">1</span>; i++) &#123;</span><br><span class="line">        current = current-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2、进行删除操作</span></span><br><span class="line">    Node* q = current-&gt;next;</span><br><span class="line">    current-&gt;next = q-&gt;next;</span><br><span class="line">    head-&gt;length--;</span><br><span class="line">    <span class="built_in">free</span>(q);</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/** 返回尾结点的前驱结点 */</span></span><br><span class="line"><span class="function">Node* <span class="title">GetLast</span><span class="params">(HeadNode* head)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!head-&gt;length) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;链表为空！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (head-&gt;length == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> head-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Node* last = head-&gt;next;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; head-&gt;length - <span class="number">1</span>; i++) &#123;</span><br><span class="line">        last = last-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> last;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> DataStruction </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构 </tag>
            
            <tag> DataStruction </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DataStruction 0x01 算法</title>
      <link href="posts/17036"/>
      <url>posts/17036</url>
      
        <content type="html"><![CDATA[<p>什么是算法？</p><span id="more"></span><h1 id="1-算法"><a href="#1-算法" class="headerlink" title="1-算法"></a>1-算法</h1><p><strong>算法</strong>：是解决特定问题求解步骤的描述；在计算机中表现为指令的有限序列，并且每条指令表示一个或多个操作。</p><p>算法特性：</p><ol><li><strong>输入</strong>：算法具有0或n个输入；</li><li><strong>输出</strong>：算法至少有1或n个输出；</li><li><strong>有穷性</strong>：算法在执行有限的步骤之后，自动结束而不会出现无限循环，并且每一步骤在可接受的时间内完成；</li><li><strong>确定性</strong>：算法的每一步骤都具有确定的含义，不会出现二义性；</li><li><strong>可行性</strong>：算法的每一步骤都能够通过执行有限次数完成。</li></ol><p>算法设计的要求：</p><ol><li><strong>正确性</strong>：指算法至少应该具有输入、输出和加工处理无歧义性、能正确反映问题的需求、能得到问题的正确答案；</li><li><strong>可读性</strong>：算法设计的另一目的是为了便于阅读、理解和交流；</li><li><strong>健壮性</strong>：当输入不合法数据时，算法也能做出相关处理，而不是产生异常；</li><li><strong>高效性</strong>：算法设计应该尽量满足时间效率高和存储量低的需求。</li></ol><h2 id="算法效率的度量方法"><a href="#算法效率的度量方法" class="headerlink" title="算法效率的度量方法"></a>算法效率的度量方法</h2><p>一个程序的运行时间，依赖于算法的好坏和问题的输入规模（输入规模：输入量的多少）。</p><p>测定运算时间最可靠的方法就是计算<strong>对运行时间有消耗的基本操作</strong>的执行次数。<br>在分析程序运行时间时，最重要的是把程序看成是独立于程序设计语言的算法或一系列步骤。</p><p>当输入规模变大以后，<strong>常数项、非最高阶项</strong>的影响微乎其微，所以判断一个算法的效率时，函数中的参数和其他次要项常常可以忽略，应该更关注主项（最高阶项）的阶数。</p><h2 id="算法时间复杂度"><a href="#算法时间复杂度" class="headerlink" title="算法时间复杂度"></a>算法时间复杂度</h2><blockquote><p>在进行算法分析时，语句总的执行次数 $T(n)$ 是关于问题规模 $n$的函数，进而分析 $T(n)$ 随 $n$ 的变化情况并确定 $T(n)$ 的数量级。<br>算法的时间复杂度，记作：$T(n) = O(f(n))$。表示随着问题规模 $n$ 的增大，算法执行时间的增长率和 $f(n)$ 的增长率相同。</p></blockquote><p>算法时间复杂度常用大O表示法<br>$O(1)$常数阶、$O(n)$线性阶、$O(n^2)$平方阶</p><p>大O阶的推导步骤为：</p><ol><li>用常数1取代运行时间中所有的常数</li><li>只保留最高阶</li><li>除了$O(1)$，去除最高阶的系数</li></ol><p>时间复杂度排序：<br>$O(1) &lt; O(logn) &lt; O(n) &lt; O(nlogn) &lt; O(n^2) &lt; O(n^3) &lt; O(2^n) &lt; O(n!) &lt; O(n^n)$</p>]]></content>
      
      
      <categories>
          
          <category> DataStruction </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构 </tag>
            
            <tag> DataStruction </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DataStruction 0x00 绪论</title>
      <link href="posts/44644"/>
      <url>posts/44644</url>
      
        <content type="html"><![CDATA[<p>什么是数据结构？</p><span id="more"></span><div class="note warning"><p>本系列文章系个人总结所写，执笔上偏于新手向，会有诸多用词不严谨之处，只为了方便理解。欢迎指正，拒绝指责。</p></div><hr><h1 id="绪论"><a href="#绪论" class="headerlink" title="绪论"></a>绪论</h1><div class="note quote"><p><strong>程序</strong> 是一系列指令的集合。程序设计 = 数据结构 + 算法</p></div><p>数据，由 N 个 <span class='p blue'>0</span> 和 <span class='p blue'>1</span> 组成，本质上是一串二进制代码，利于计算机计算，但不利于人类阅读思考。<br>所以在此之上经过层层抽象，将计算机中的数据抽象出诸如 <code>对象、实例、结点、数据对象</code> 等概念。</p><blockquote><p><strong>数据结构</strong>，就是以 <code>对象、实例、结点、数据对象</code> 为<strong>单位</strong>，研究各个单位之间的<strong>关系</strong>。<br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/4177948790941.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/4177948790941.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="><br>由此明确，在数据结构中需要研究两个东西： <span class='p h4 green'>单位、关系</span></p></blockquote><h2 id="单位"><a href="#单位" class="headerlink" title="单位"></a>单位</h2><p>数据的单位在数据结构中通常称为 <strong>数据对象</strong>，数据对象可以是一个人、一辆车、一个数字、一个字符、或者多种数据的组合，在代码中表现为<span class='p blue'>结构体变量或对象</span>。</p><p>而一个人，会有多种数据：名字（name）、年龄（age）、学号（ID），在代码中表现为<span class='p blue'>结构体成员变量或对象成员变量</span>。</p><p>而名字、年龄、学号这些，我们称为 <strong>数据项</strong>。</p><blockquote><p>即 N 个数据项构成了数据对象<br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/575267796809.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/575267796809.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></blockquote><p>每个人都有学号、姓名、年龄，例如张三李四王五，但张三不是李四、王五不是赵六，他们都是各自独立的。</p><p>但他们都是人类，所以我们把人类称为 <strong>数据元素</strong>，在代码中表现为 <span class='p blue'>结构体定义或类定义</span>。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/3421217982465.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/3421217982465.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 结构体定义 &lt;--&gt; 数据元素</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="comment">// 结构体成员变量 &lt;--&gt; 数据项</span></span><br><span class="line">    <span class="keyword">long</span> ID;</span><br><span class="line">    <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">char</span>* name;</span><br><span class="line">&#125; Person;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数据对象 &lt;--&gt; 结构体变量</span></span><br><span class="line">Person Zhangsan = &#123;</span><br><span class="line">    <span class="number">1213</span>, </span><br><span class="line">    <span class="number">18</span>, </span><br><span class="line">    <span class="string">&quot;Boii&quot;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="关系"><a href="#关系" class="headerlink" title="关系"></a>关系</h2><p>说完单位，剩下就是关系了。</p><p>这些单位之间的关系，理论上有很多种：线性表、广义表、链表、栈、队、树、图；这种我们称为 <span class='p blue'>逻辑结构</span>。</p><p>而在代码、或者说物理上的实现，只有两种：顺序存储结构、链式存储结构；这些我们称为 <span class='p blue'>物理结构</span>。</p><h3 id="逻辑结构"><a href="#逻辑结构" class="headerlink" title="逻辑结构"></a>逻辑结构</h3><p>逻辑上的各种关系可以分为 4 大类：</p><ol><li>集合结构：各个单位之间，除了同属一个集合，没有别的关系；各个单位是“平等”的。</li><li>线性结构：各个单位之间是<strong>一对一</strong>的关系</li><li>树形结构：各个单位之间是<strong>一对多</strong>的关系</li><li>图形结构：各个单位之间是<strong>多对多</strong>的关系</li></ol><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/3222300666995.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/3222300666995.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>集合结构比较少见，这里暂时不做讨论。<br>我们主要讨论常见的线性、树形、图形结构。</p><h3 id="物理结构"><a href="#物理结构" class="headerlink" title="物理结构"></a>物理结构</h3><p>程序是运行在内存中的，而内存是顺序排列的，没那么多花里胡哨的，而且受计算机物理实现所束缚，物理结构中：</p><p>要么是一个挨着一个的<strong>顺序存储结构</strong>，要么是单位（数据对象）之间并不一定挨着的<strong>链式存储结构</strong>。</p><p>两种结构都有各自的特点。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/4827351761135.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/4827351761135.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p><strong>顺序存储结构</strong></p><ul><li><strong>特点</strong>：数据对象之间在物理上一个挨着一个、有序，只要知道了第一个数据对象的地址，可以很快找到后面其他的数据对象。与此同时，为了保持这种一个挨着一个和有序的特点，当插入或者删除某一个数据对象时，后面的数据对象要一个一个往后挪腾出中间的位置，或者一个一个往前挪填补中间的空缺，导致插入和删除很慢。</li><li><strong>优点</strong>：查找速度快。</li><li><strong>缺点</strong>：插入和删除慢。</li></ul><p><strong>链式存储结构</strong></p><ul><li><strong>特点</strong>：数据对象之间在物理上并不一定相互挨着、无序，要查找某一个数据对象时需要从第一个数据对象开始，一个接着一个往后一路查下去才能找到。与此同时，因为物理上不一定相互挨着，所以插入和删除时只需要修改前后的链条即可。</li><li><strong>优点</strong>：插入和删除快。</li><li><strong>缺点</strong>：查找速度慢。</li></ul><p>这里的快慢，指的是计算机需要执行多次计算称为慢，计算机需要执行少量计算称为快。</p><h3 id="ADT-抽象数据类型"><a href="#ADT-抽象数据类型" class="headerlink" title="ADT 抽象数据类型"></a>ADT 抽象数据类型</h3><p>抽象数据类型是用来<span class='p green'>表示某一种逻辑结构（栈、队、树、...）的具体信息，具有什么样的操作</span> 等等。</p><p>描述 ADT 的标准格式：</p><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">ADT 抽象数据类型名</span><br><span class="line">Data</span><br><span class="line">    数据元素之间逻辑关系的定义</span><br><span class="line">Operation</span><br><span class="line">    操作<span class="number">1</span></span><br><span class="line">        初始条件</span><br><span class="line">        操作结果描述</span><br><span class="line">    操作<span class="number">2</span></span><br><span class="line">        ...</span><br><span class="line">        ...</span><br><span class="line">    操作n</span><br><span class="line">        ...</span><br><span class="line">        ...</span><br><span class="line"><span class="keyword">end</span>AD</span><br></pre></td></tr></table></figure><p>ADT 就像一张蓝图。<br>在建房子之前我们需要先设计好房子的功能、结构等，之后再依照图纸开工。<br>ADT 就是数据结构的图纸，事先定义好各种关系和操作，写起代码来才能有条不紊。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/DataStruction/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p>]]></content>
      
      
      <categories>
          
          <category> DataStruction </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构 </tag>
            
            <tag> DataStruction </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo-文件下载功能</title>
      <link href="posts/22089"/>
      <url>posts/22089</url>
      
        <content type="html"><![CDATA[<p>So easy~</p><span id="more"></span><h2 id="操作方法"><a href="#操作方法" class="headerlink" title="操作方法"></a>操作方法</h2><p>效果：<a href="/download/%E5%A4%A7%E8%AF%9D%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.pdf">点击下载</a></p><ol><li>在source目录下，新建download目录，和_posts、About、tags、categories等目录并列</li><li>将你需要分享的文件或者需要展示的图片之类，统一放到该download下<br> <img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Hexo-download/1.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Hexo-download/1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="1"></li><li>在写文章时，通过诸如 <code>[点击下载](/download/xx.exe)</code> 这样的链接，直接写入。其他，照旧<br> <img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Hexo-download/2.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Hexo-download/2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2"></li><li>在 <span class='btn'><a class="button" href='https://volantis.js.org/' title='volantis主题'>volantis主题</a></span>下，可以这样写 <code>&#123;% btn 点击下载, /download/xx.exe, fas fa-download %&#125;</code></li></ol><blockquote><p>注意：</p><ol><li>全半角不要搞错。</li><li>必须是<strong>压缩文件（.exe | .zip | .rar | 7z |…）</strong>，否则跳过去直接给你展示了不会触发下载的。</li></ol></blockquote>]]></content>
      
      
      <categories>
          
          <category> HEXO </category>
          
          <category> Git </category>
          
          <category> Note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HEXO </tag>
            
            <tag> note </tag>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python【Buildins】re</title>
      <link href="posts/25647"/>
      <url>posts/25647</url>
      
        <content type="html"><![CDATA[<p>Python的内置库——正则表达式</p><span id="more"></span><p>正则表达式是用来<strong>处理字符串</strong>的，重在处理<strong>规则</strong></p><p>常用正则</p><ul><li>年份匹配：<code>^((19|20)\d&#123;2&#125;)$</code></li><li>手机号码：<code>^1[3456789]\d&#123;9&#125;$</code></li><li>E-mail地址：<code>^[\w-]+(\.[\w-]+)*@[\w-]+(\.[\w-]+)+$</code></li><li>网址URL：<code>http://(/[\w-]+\.)+[\w-]+(/[\w-./?%&amp;=])</code></li></ul><blockquote><p><code>re.findall(goal, source)</code><br>匹配成功 返回一个列表，列表中有<code>goal</code>的字符串，<strong>找到n次就有n个</strong><br>匹配失败 返回一个空列表</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 普通字符正则的匹配</span></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> re</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;python&#x27;</span>))</span><br><span class="line">[<span class="string">&#x27;p&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">&#x27;python&#x27;</span>, <span class="string">&#x27;I like python&#x27;</span>))</span><br><span class="line">[<span class="string">&#x27;python&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;I love python&#x27;</span>))</span><br><span class="line">[<span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;o&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;1234567890abcdefg&#x27;</span>))</span><br><span class="line">[<span class="string">&#x27;2&#x27;</span>]</span><br></pre></td></tr></table></figure><h2 id="预定义字符"><a href="#预定义字符" class="headerlink" title="预定义字符"></a>预定义字符</h2><blockquote><p><code>\d</code>、<code>\D</code>、<code>\s</code>、<code>\S</code>、<code>\w</code>、<code>\W</code></p></blockquote><ul><li><code>\d</code>：匹配所有<strong>数字</strong>，<code>0~9</code></li><li><code>\w</code>：匹配包含下划线<strong>字符</strong> <code>[a-z|A-Z|0-9|_]</code></li><li><code>\s</code>：匹配<strong>空白符、制表符、换行符</strong> <code>[\n \t]</code></li></ul><hr><ul><li><code>\D</code>：匹配所有<strong>非数字</strong>，<code>^[0-9]</code></li><li><code>\W</code>：匹配<strong>非正常字符</strong> <code>^[a-z|A-Z|0-9|_]</code></li><li><code>\S</code>：匹配<strong>非空白符、制表符、换行符</strong> <code>^[\n \t]</code></li></ul><hr><ul><li><code>.</code>：除了换行符之外所有字符</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;\d&quot;</span>, <span class="string">&quot;1234657890abcdefg&quot;</span>))</span><br><span class="line">[<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;0&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;\D&quot;</span>, <span class="string">&quot;1234657890abcdefg&quot;</span>))</span><br><span class="line">[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;g&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;\w&quot;</span>, <span class="string">&quot;1234657890abcd_%$#efg&quot;</span>))</span><br><span class="line">[<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;g&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;\W&quot;</span>, <span class="string">&quot;1234657890abcd_%$#efg&quot;</span>))</span><br><span class="line">[<span class="string">&#x27;%&#x27;</span>, <span class="string">&#x27;$&#x27;</span>, <span class="string">&#x27;#&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;\s&quot;</span>, <span class="string">&quot;1234 657\n890ab\tcd_%$#efg&quot;</span>))</span><br><span class="line">[<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;\t&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;\S&quot;</span>, <span class="string">&quot;1234 657\n890ab\tcd_%$#efg&quot;</span>))</span><br><span class="line">[<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;%&#x27;</span>, <span class="string">&#x27;$&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;g&#x27;</span>]</span><br></pre></td></tr></table></figure><h2 id="元字符"><a href="#元字符" class="headerlink" title="元字符"></a>元字符</h2><blockquote><p><code>[]</code>、<code>&#123;n&#125;</code>、<code>^</code>、<code>-</code></p></blockquote><ul><li><code>[]</code>：匹配一个字符，括号内是<strong>或者</strong>的关系</li><li><code>^</code>：取反 (和这些元字符或\d这些预定义字符一起用才是取反，否则和$一起做位置匹配)</li><li><code>-</code>：区间</li><li><code>()</code>：分组，匹配括号内的内容，不要括号两边的内容</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 区间</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 匹配123任意单个字符</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;[123]&quot;</span>, <span class="string">&quot;1234 657\n890ab\tcd_%$#efg&quot;</span>))</span><br><span class="line">[<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 匹配单个数字（\d）或 空格换行制表符（\s）</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;[\d\s]&quot;</span>, <span class="string">&quot;1234 657\n890ab\tcd_%$#efg&quot;</span>))</span><br><span class="line">[<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;\t&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 取反</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 匹配单个非数字、非空格换行制表符</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;[^\d\s]&quot;</span>, <span class="string">&quot;1234 657\n890ab\tcd_%$#efg&quot;</span>))</span><br><span class="line">[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;%&#x27;</span>, <span class="string">&#x27;$&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;g&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 范围</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 匹配单个1-7之间的数字</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;[1-7]&quot;</span>, <span class="string">&quot;1234 657\n890ab\tcd_%$#efg&quot;</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 匹配单个a-d之间的字母</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;[a-d]&quot;</span>, <span class="string">&quot;1234 657\n890ab\tcd_%$#efg&quot;</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 匹配单个 1-7 或 a-d 的字符</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;[1-7a-d]&quot;</span>, <span class="string">&quot;1234 657\n890ab\tcd_%$#efg&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 分组</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 匹配 左边a右边是a或b或c的两个字符</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;a[abc]&quot;</span>, <span class="string">&quot;aaabacad&quot;</span>))</span><br><span class="line">[<span class="string">&#x27;aa&#x27;</span>, <span class="string">&#x27;ab&#x27;</span>, <span class="string">&#x27;ac&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 第一步，匹配到[&#x27;aa&#x27;, &#x27;ab&#x27;, &#x27;ac&#x27;]</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 第二步，不要括号两边的字符，也就是不要a，得到[&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;]</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;a([abc])&quot;</span>, <span class="string">&quot;aaabacad&quot;</span>))</span><br><span class="line">[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]</span><br></pre></td></tr></table></figure><h2 id="重复匹配"><a href="#重复匹配" class="headerlink" title="重复匹配"></a>重复匹配</h2><p>重复匹配默认是贪婪匹配的，会尽量匹配多位</p><ul><li><code>&#123;n&#125;</code>：表示前面的字符重复n次才被匹配成功。<code>a&#123;3&#125;</code>就匹配出：aaa</li><li><code>&#123;n,m&#125;</code>：表示前面的字符至少出现n次，至多出现m次，<strong>逗号左右不能有空格</strong>，贪婪匹配</li><li><code>&#123;n,m&#125;?</code>：表示前面的字符至少出现n次，至多出现m次，<strong>逗号左右不能有空格</strong>，<strong>非</strong>贪婪匹配</li><li><code>&#123;n,&#125;</code>：表示前面的字符至少出现n次，至多出现无穷次</li></ul><hr><ul><li><code>?</code>：相当于<code>&#123;0,1&#125;</code>，表示前面的字符出现0次或1次</li><li><code>+</code>：相当于<code>&#123;1,&#125;</code>，表示前面的字符至少出现1次</li><li><code>*</code>：相当于<code>&#123;0,&#125;</code>，表示前面的字符出现0次或无穷次，贪婪匹配</li><li><code>+?</code>：相当于<code>&#123;1,&#125;?</code>、<code>&#123;1&#125;</code>，表示前面的字符至少出现1次，非贪婪匹配</li><li><code>*?</code>：相当于<code>&#123;0,&#125;?</code>、<code>&#123;0&#125;</code>，表示前面的字符至少出现0次，非贪婪匹配</li></ul><hr><ul><li><code>\</code>：转义符，在需要匹配上面<code>?+*</code>几个符号的时候需要加上斜杠<code>\</code></li></ul><hr><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#123;n&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 贪婪匹配连续3位都是数字</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;\d&#123;3&#125;&quot;</span>, <span class="string">&quot;1234567890abcdefg&quot;</span>))</span><br><span class="line">[<span class="string">&#x27;123&#x27;</span>, <span class="string">&#x27;456&#x27;</span>, <span class="string">&#x27;789&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 贪婪匹配连续2位都是正常字符</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;\w&#123;2&#125;&quot;</span>, <span class="string">&quot;12a3456789b0abcdefg&quot;</span>))</span><br><span class="line">[<span class="string">&#x27;12&#x27;</span>, <span class="string">&#x27;a3&#x27;</span>, <span class="string">&#x27;45&#x27;</span>, <span class="string">&#x27;67&#x27;</span>, <span class="string">&#x27;89&#x27;</span>, <span class="string">&#x27;b0&#x27;</span>, <span class="string">&#x27;ab&#x27;</span>, <span class="string">&#x27;cd&#x27;</span>, <span class="string">&#x27;ef&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 贪婪匹配至少2位至多4位的数字</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;\d&#123;2,4&#125;&quot;</span>, <span class="string">&quot;1234567890abcdefg&quot;</span>))</span><br><span class="line">[<span class="string">&#x27;1234&#x27;</span>, <span class="string">&#x27;5678&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;\d&#123;2,4&#125;&quot;</span>, <span class="string">&quot;12a3456789b0abcdefg&quot;</span>))</span><br><span class="line">[<span class="string">&#x27;12&#x27;</span>, <span class="string">&#x27;3456&#x27;</span>, <span class="string">&#x27;789&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 非贪婪匹配至少2位至多4位的数字</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;\d&#123;2,4&#125;?&quot;</span>, <span class="string">&quot;12a3456789b0abcdefg&quot;</span>))</span><br><span class="line">[<span class="string">&#x27;12&#x27;</span>, <span class="string">&#x27;34&#x27;</span>, <span class="string">&#x27;56&#x27;</span>, <span class="string">&#x27;78&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 贪婪匹配出现至少2位的数字</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;\d&#123;2,&#125;&quot;</span>, <span class="string">&quot;12a3456789b0abcdefg165465165&quot;</span>))</span><br><span class="line">[<span class="string">&#x27;12&#x27;</span>, <span class="string">&#x27;3456789&#x27;</span>, <span class="string">&#x27;165465165&#x27;</span>]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ? + *</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 贪婪匹配0或1个数字，0个也在匹配范围内，所以匹配到非数字的时候是空字符串</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;\d?&quot;</span>, <span class="string">&quot;12a3456789b0abcde_%&quot;</span>))</span><br><span class="line">[<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 贪婪匹配1或n个数字</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;\d+&quot;</span>, <span class="string">&quot;12a3456789b0abcde_%&quot;</span>))</span><br><span class="line">[<span class="string">&#x27;12&#x27;</span>, <span class="string">&#x27;3456789&#x27;</span>, <span class="string">&#x27;0&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 非贪匹配1或n个数字</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;\d+?&quot;</span>, <span class="string">&quot;12a3456789b0abcde_%&quot;</span>))</span><br><span class="line">[<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;0&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 贪婪匹配1或n个数字</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;\d*&quot;</span>, <span class="string">&quot;1234567890abcdefg&quot;</span>))</span><br><span class="line">[<span class="string">&#x27;1234567890&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 非贪匹配1或n个数字</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;\d*?&quot;</span>, <span class="string">&quot;1234567890abcdefg&quot;</span>))</span><br><span class="line">[<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 转义符</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 匹配a*b</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;a\*b&quot;</span>, <span class="string">&quot;aab*ab*aaa*ba*b*a&quot;</span>))</span><br><span class="line">[<span class="string">&#x27;a*b&#x27;</span>, <span class="string">&#x27;a*b&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 匹配b前面至少出现0次a</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;a*b&quot;</span>, <span class="string">&quot;aab*ab*aaa*ba*b*a&quot;</span>))</span><br><span class="line">[<span class="string">&#x27;aab&#x27;</span>, <span class="string">&#x27;ab&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;b&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 匹配a+b</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;a\+b&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">[<span class="string">&#x27;a+b&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 匹配b前面至少出现1次a</span></span><br><span class="line"><span class="built_in">print</span>(re.findall(<span class="string">r&quot;a+b&quot;</span>, <span class="string">&quot;aab*ab*aa?ba*ba*b*a+b&quot;</span>))</span><br><span class="line">[<span class="string">&#x27;aab&#x27;</span>, <span class="string">&#x27;ab&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 匹配a?b</span></span><br><span class="line"><span class="built_in">print</span>(re.findall(<span class="string">r&quot;a\?b&quot;</span>, <span class="string">&quot;aab*ab*aa?ba*ba*b*a+b&quot;</span>))</span><br><span class="line">[<span class="string">&#x27;a?b&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 匹配b前面至少出现0次至多出现1次a</span></span><br><span class="line"><span class="built_in">print</span>(re.findall(<span class="string">r&quot;a?b&quot;</span>, <span class="string">&quot;aab*ab*aa?ba*ba*b*a+b&quot;</span>))</span><br><span class="line">[<span class="string">&#x27;ab&#x27;</span>, <span class="string">&#x27;ab&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;b&#x27;</span>]</span><br></pre></td></tr></table></figure><h2 id="贪婪和非贪"><a href="#贪婪和非贪" class="headerlink" title="贪婪和非贪"></a>贪婪和非贪</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 贪婪匹配 d开头d结尾，中间至少出现1位正常字符</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;d\w+d&quot;</span>, <span class="string">&quot;dxxxxxxdxxxxxxd&quot;</span>))</span><br><span class="line">[<span class="string">&#x27;dxxxxxxdxxxxxxd&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 非贪匹配 d开头d结尾，中间至少出现1位正常字符</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;d\w+?d&quot;</span>, <span class="string">&quot;dxxxxxxdxxxxxxd&quot;</span>))</span><br><span class="line">[<span class="string">&#x27;dxxxxd&#x27;</span>]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>html = <span class="string">&quot;&lt;li&gt;Boii&lt;/li&gt;&lt;li&gt;$18&lt;/li&gt;&lt;li&gt;男&lt;/li&gt;&lt;li&gt;i@tcp404.com&lt;/li&gt;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># .是除了换行符以外所有字符</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 贪婪匹配 &lt;li&gt;开头，&lt;/li&gt;结尾，中间至少一个非换行符的字符，共1个</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;&lt;li&gt;.+&lt;/li&gt;&quot;</span>, html))</span><br><span class="line">[<span class="string">&#x27;&lt;li&gt;Boii&lt;/li&gt;&lt;li&gt;$18&lt;/li&gt;&lt;li&gt;男&lt;/li&gt;&lt;li&gt;i@tcp404.com&lt;/li&gt;&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 非贪匹配 &lt;li&gt;开头，&lt;/li&gt;结尾，中间至少一个非换行符的字符，共3个</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;&lt;li&gt;.+?&lt;/li&gt;&quot;</span>, html))</span><br><span class="line">[<span class="string">&#x27;&lt;li&gt;Boii&lt;/li&gt;&#x27;</span>, <span class="string">&#x27;&lt;li&gt;$18&lt;/li&gt;&#x27;</span>, <span class="string">&#x27;&lt;li&gt;男&lt;/li&gt;&#x27;</span>, <span class="string">&#x27;&lt;li&gt;i@tcp404.com&lt;/li&gt;&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 非贪匹配 &lt;li&gt;开头，&lt;/li&gt;结尾，中间至少一个非换行符的字符，且舍去开头结尾，</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 即只取&lt;li&gt;&lt;/li&gt;中的内容，共3个</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;&lt;li&gt;(.+?)&lt;/li&gt;&quot;</span>, html))</span><br><span class="line">[<span class="string">&#x27;Boii&#x27;</span>, <span class="string">&#x27;$18&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;i@tcp404.com&#x27;</span>]</span><br></pre></td></tr></table></figure><h2 id="反向引用"><a href="#反向引用" class="headerlink" title="反向引用"></a>反向引用</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>wordstr = <span class="string">&quot;&quot;&quot; &#x27;hello&#x27;, &quot;python&quot;, &#x27;love&quot;, &quot;haha&#x27; &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 匹配 开头和结尾都是单引号或双引号，中间至少一个正常字符</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;[&#x27;|\&quot;]\w+[&#x27;|\&quot;]&quot;</span>, wordstr))</span><br><span class="line">[<span class="string">&quot;&#x27;hello&#x27;&quot;</span>, <span class="string">&#x27;&quot;python&quot;&#x27;</span>, <span class="string">&#x27;\&#x27;love&quot;&#x27;</span>, <span class="string">&#x27;&quot;haha\&#x27;&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 匹配 开头和结尾都是单引号或双引号，中间至少一个正常字符，舍弃中间</span></span><br><span class="line"><span class="comment"># 即 开头和结尾都是单或双引号，中间至少一个正常字符，然后把开头分一组，结尾分一组，中间无分组被舍弃</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;(&#x27;|\&quot;)\w+(&#x27;|\&quot;)&quot;</span>, wordstr))</span><br><span class="line">[(<span class="string">&quot;&#x27;&quot;</span>, <span class="string">&quot;&#x27;&quot;</span>), (<span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>), (<span class="string">&quot;&#x27;&quot;</span>, <span class="string">&#x27;&quot;&#x27;</span>), (<span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&quot;&#x27;&quot;</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 匹配 开头和结尾都是单引号或双引号，中间至少一个正常字符，开头一组，中间一组，结尾一组，找到一份则组合成一个元组</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;(&#x27;|\&quot;)(\w+)(&#x27;|\&quot;)&quot;</span>, wordstr))</span><br><span class="line">[(<span class="string">&quot;&#x27;&quot;</span>, <span class="string">&#x27;hello&#x27;</span>, <span class="string">&quot;&#x27;&quot;</span>), (<span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;python&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>), (<span class="string">&quot;&#x27;&quot;</span>, <span class="string">&#x27;love&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>), (<span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;haha&#x27;</span>, <span class="string">&quot;&#x27;&quot;</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 匹配 开头是单双引号，中间至少一个正常字符，结尾要与开头对应开头一组那个组相同</span></span><br><span class="line"><span class="comment"># 开头一组，中间一组，结尾一组，找到一份则组合成一个元组</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;(&#x27;|\&quot;)(\w+)(\1)&quot;</span>, wordstr))</span><br><span class="line">[(<span class="string">&quot;&#x27;&quot;</span>, <span class="string">&#x27;hello&#x27;</span>, <span class="string">&quot;&#x27;&quot;</span>), (<span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;python&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用列表生成式取出每份的1号元素，就得到了内容。</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>res = re.findall(<span class="string">r&quot;(&#x27;|\&quot;)(\w+)(\1)&quot;</span>, wordstr)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>li = [x[<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> res]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(li)</span><br><span class="line">[<span class="string">&#x27;hello&#x27;</span>, <span class="string">&#x27;python&#x27;</span>]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 校验密码，同样的字符不能连续出现3次</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;(\w)(\1&#123;2,&#125;)&quot;</span>, <span class="string">&quot;44888813abgggs&quot;</span>))</span><br><span class="line">[(<span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;888&#x27;</span>), (<span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;gg&#x27;</span>)]</span><br><span class="line"><span class="comment"># 第一个分组(\w)匹配到是4，进入下一个元组，看到\1替换成4，开始匹配重复：4出现至少2次则匹配成功，后面紧跟着只有一个4，所以匹配失败</span></span><br><span class="line"><span class="comment"># 接着匹配到(\w)是8，进入下一个分组，看到\1替换成8，从第2个8开始匹配重复：8至少出现2次则匹配成功，除去第一个8被第一个分组取走，还剩3个8，匹配成功，这是贪婪匹配，所以会一直吃下去吃到遇见不是8停止，打包成元组</span></span><br><span class="line"><span class="comment"># 接着1匹配失败，3匹配失败，ab都匹配失败</span></span><br><span class="line"><span class="comment"># 接着匹配到(\w)是g，进入下一个分组，看到\1替换成g，从第2个g开始匹配重复：g至少出现2次则匹配成功，除去第一个g被第一个分组取走，还剩2个g，匹配成功，这是贪婪匹配，所以会一直吃下去吃到遇见不是g停止，打包成元组...</span></span><br><span class="line"></span><br><span class="line">res = re.findall(<span class="string">r&quot;(\w)(\1&#123;2,&#125;)&quot;</span>, <span class="string">&quot;44888813abgggs&quot;</span>)</span><br><span class="line">li = [x[<span class="number">0</span>]+x[<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> res]</span><br><span class="line"><span class="built_in">print</span>(li)        <span class="comment"># [&#x27;8888&#x27;, &#x27;ggg&#x27;]</span></span><br></pre></td></tr></table></figure><h2 id="位置匹配"><a href="#位置匹配" class="headerlink" title="位置匹配"></a>位置匹配</h2><ul><li><code>^</code>：开头</li><li><code>$</code>：结尾</li></ul><p>这两个经常一起使用，用来限定位置<br>常用于检验手机号、用户名、email地址等</p><p>例如匹配手机号</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 手机位数正常的时候可以匹配成功</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;\d&#123;11&#125;&quot;</span>, <span class="string">&quot;13700001111&quot;</span>))</span><br><span class="line">[<span class="string">&#x27;13700001111&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 但是手机位数不正常的时候也匹配成功了，所以要加以位置限制</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;\d&#123;11&#125;&quot;</span>, <span class="string">&quot;137000011112233445&quot;</span>))</span><br><span class="line">[<span class="string">&#x27;13700001111&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;^\d&#123;11&#125;$&quot;</span>, <span class="string">&quot;13700001111&quot;</span>))</span><br><span class="line">[<span class="string">&#x27;13700001111&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(re.findall(<span class="string">r&quot;^\d&#123;11&#125;$&quot;</span>, <span class="string">&quot;137000011112233445&quot;</span>))</span><br><span class="line">[]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
          <category> 内置库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> 正则表达式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python【Buildins】json</title>
      <link href="posts/41814"/>
      <url>posts/41814</url>
      
        <content type="html"><![CDATA[<p>Python的内置库——json处理</p><span id="more"></span><blockquote><p><code>&#123;&quot;firstName&quot;:&quot;John&quot;, &quot;lastName&quot;:&quot;Doe&quot;&#125;</code></p></blockquote><blockquote><p>对于dictionaries，keys需要是字符串类型(字典中任何非字符串类型的key在编码时会先转换为字符串)。而且，在web应用程序中，顶层对象被编码为一个字典是一个标准做法。</p></blockquote><p>这句话大概意思是：</p><ol><li>用<code>&#123;&#125;</code> 开头和结尾</li><li>用<code>str</code>表示 key</li><li>用<code>str, int, list, dict</code> 表示 value</li><li>list用<code>[index]</code>访问</li><li>dict用<code>.key</code>访问</li></ol><p>json 字符串生成 python 对象：<code>json.load()</code><br>python 对象格式化为 json 字符串：<code>json.dump()</code></p><h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><p>转换对应表（python -&gt; json）</p><table><thead><tr><th align="left">Python</th><th align="left">JSON</th></tr></thead><tbody><tr><td align="left">dict</td><td align="left">object</td></tr><tr><td align="left">list, tuple</td><td align="left">array</td></tr><tr><td align="left">str</td><td align="left">string</td></tr><tr><td align="left">int, float</td><td align="left">number</td></tr><tr><td align="left">True</td><td align="left">true</td></tr><tr><td align="left">False</td><td align="left">false</td></tr><tr><td align="left">None</td><td align="left">null</td></tr></tbody></table><p>转换对应表（json -&gt; python）</p><table><thead><tr><th align="left">JSON</th><th align="left">Python</th></tr></thead><tbody><tr><td align="left">object</td><td align="left">dict</td></tr><tr><td align="left">array</td><td align="left">list</td></tr><tr><td align="left">string</td><td align="left">str</td></tr><tr><td align="left">number(int)</td><td align="left">int</td></tr><tr><td align="left">number(real)</td><td align="left">float</td></tr><tr><td align="left">true</td><td align="left">True</td></tr><tr><td align="left">false</td><td align="left">False</td></tr><tr><td align="left">null</td><td align="left">None</td></tr></tbody></table><h2 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h2><table><thead><tr><th align="left">方法</th><th align="left">功能</th><th align="left">总结</th></tr></thead><tbody><tr><td align="left">json.dump(obj,fp)</td><td align="left">将python数据类型转换并保存到json格式文件内</td><td align="left">p -&gt; j,写入文件</td></tr><tr><td align="left">json.dumps(obj)</td><td align="left">将python数据类型转换为json格式的字符串</td><td align="left">p -&gt; j</td></tr><tr><td align="left">json.load(fp)</td><td align="left">从json格式的文件中读取数据并转换为python的类型</td><td align="left">从文件读, j -&gt; p</td></tr><tr><td align="left">json.loads(str)</td><td align="left">将json格式的字符串转换为python的类型</td><td align="left">j -&gt; p</td></tr></tbody></table><p>带s的是处理字符串<br>不带s的是从文件里处理</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/Buildins-json.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/Buildins-json.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="json"></p><h3 id="Python-gt-JSON"><a href="#Python-gt-JSON" class="headerlink" title="Python -&gt; JSON"></a>Python -&gt; JSON</h3><blockquote><p><code>json.dump(obj, fp, *, skipkeys=False, ensure_ascii=True, check_circular=True, allow_nan=True, cls=None, indent=None, separators=None, default=None, sort_keys=False, **kw)</code></p></blockquote><blockquote><p><code>json.dumps(obj, *, skipkeys=False, ensure_ascii=True, check_circular=True, allow_nan=True, cls=None, indent=None, separators=None, default=None, sort_keys=False, **kw)</code></p></blockquote><ul><li><code>obj</code>：需要被转换的Python对象</li><li><code>fp</code>：文件对象，要写入的文件</li><li><code>skipkeys</code>：<ul><li>Fasle时：不是基本对象(int、str、bool、float)的键不会被跳过</li><li>True时：不是基本对象(int、str、bool、float)的键会被跳过</li></ul></li><li><code>ensure_ascii</code>：<ul><li>True：将非ASCII字符转义，例如中文</li><li>False：将非ASCII字符原样输出</li></ul></li><li><code>allow_nan</code>：<ul><li>True：对json规格范围外的float类型(nan、inf、-inf)序列化时会引发<code>ValueError</code></li><li>False：对json规格范围外的float类型(nan、inf、-inf)序列化时使用等价形式(NaN、Infinity、-Infinity)</li></ul></li><li><code>indent</code>：指定缩进等级（非负整数/字符串）<ul><li>0、负数、””：只添加换行符</li><li>None：不缩进</li><li>正整数：每层缩进同样数量的空格</li><li>字符串：如<code>\t</code>，该字符串将被用于缩进每一层</li></ul></li><li><code>sort_keys</code>：按字典的键排序</li><li><code>default</code>：其应该是一个函数，每当某个对象无法被序列化时它会被调用。它应该返回该对象的一个可以被 JSON 编码的版本或者引发一个 <code>TypeError</code>。</li></ul><ol><li>使用<code>dumps()</code></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这是一个 python 字典对象</span></span><br><span class="line">py_dic = &#123;</span><br><span class="line">    <span class="string">&#x27;firstName&#x27;</span>: <span class="string">&#x27;Boii&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;j&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;x&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&#x27;y&#x27;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">        <span class="string">&#x27;z&#x27;</span>: <span class="number">3</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;lastName&quot;</span>: <span class="string">&quot;Pro&quot;</span>,</span><br><span class="line">    <span class="string">&#x27;li&#x27;</span>: [<span class="string">&quot;A&quot;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="number">3</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Python对象：&#x27;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(py_dic, end=<span class="string">&quot;\t&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(py_dic))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将一个 Python 对象转换成 json 字符串</span></span><br><span class="line">json_str = json.dumps(py_dic, sort_keys=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;JSON字符串：&#x27;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(json_str, end=<span class="string">&quot;\t&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(json_str))</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">Python对象：&#123;<span class="string">&#x27;firstName&#x27;</span>: <span class="string">&#x27;Boii&#x27;</span>, <span class="string">&#x27;j&#x27;</span>: &#123;<span class="string">&#x27;x&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;y&#x27;</span>: <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;z&#x27;</span>: <span class="number">3</span>&#125;, <span class="string">&#x27;lastName&#x27;</span>: <span class="string">&#x27;Pro&#x27;</span>, <span class="string">&#x27;li&#x27;</span>: [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="number">3</span>]&#125;    &lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">dict</span>&#x27;&gt;</span></span><br><span class="line"><span class="class"><span class="title">JSON</span>字符串：&#123;&quot;<span class="title">firstName</span>&quot;:</span> <span class="string">&quot;Boii&quot;</span>, <span class="string">&quot;j&quot;</span>: &#123;<span class="string">&quot;x&quot;</span>: <span class="number">1</span>, <span class="string">&quot;y&quot;</span>: <span class="string">&quot;2&quot;</span>, <span class="string">&quot;z&quot;</span>: <span class="number">3</span>&#125;, <span class="string">&quot;lastName&quot;</span>: <span class="string">&quot;Pro&quot;</span>, <span class="string">&quot;li&quot;</span>: [<span class="string">&quot;A&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="number">3</span>]&#125;    &lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">str</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure><p>可以发现，Python中都是使用单引号<code>&#39;</code>，JSON中都是使用双引号<code>&quot;</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这是一个python 列表对象</span></span><br><span class="line">py_list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Python对象：&#x27;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(py_list, end=<span class="string">&quot;\t&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(py_list))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将一个 Python 对象转换成 json 字符串</span></span><br><span class="line">json_str = json.dumps(py_list, sort_keys=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;JSON字符串：&#x27;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(json_str, end=<span class="string">&quot;\t&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(json_str))</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">Python对象：[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]   &lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">list</span>&#x27;&gt;</span></span><br><span class="line"><span class="class"><span class="title">JSON</span>字符串：[1, 2, 3]   &lt;<span class="title">class</span> &#x27;<span class="title">str</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>使用<code>dump()</code></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">py_dic = &#123;</span><br><span class="line">    <span class="string">&#x27;firstName&#x27;</span>: <span class="string">&#x27;Boii&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;j&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;x&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&#x27;y&#x27;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">        <span class="string">&#x27;z&#x27;</span>: <span class="number">3</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;lastName&quot;</span>: <span class="string">&quot;Pro&quot;</span>,</span><br><span class="line">    <span class="string">&#x27;li&#x27;</span>: [<span class="string">&quot;A&quot;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="number">3</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将一个 Python 对象转换成 json 字符串，然后写入文件</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./py_dic.json&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    json.dump(py_dic, f, sort_keys=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">没有输出，因为输出到文件中了</span><br><span class="line"></span><br><span class="line"><span class="comment"># py_dic.json</span></span><br><span class="line">&#123;<span class="string">&quot;firstName&quot;</span>: <span class="string">&quot;Boii&quot;</span>, <span class="string">&quot;j&quot;</span>: &#123;<span class="string">&quot;x&quot;</span>: <span class="number">1</span>, <span class="string">&quot;y&quot;</span>: <span class="string">&quot;2&quot;</span>, <span class="string">&quot;z&quot;</span>: <span class="number">3</span>&#125;, <span class="string">&quot;lastName&quot;</span>: <span class="string">&quot;Pro&quot;</span>, <span class="string">&quot;li&quot;</span>: [<span class="string">&quot;A&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="number">3</span>]&#125;</span><br></pre></td></tr></table></figure><p>有些教程中直接使用<code>open()</code>打开一个文件对象，然后将文件对象作为参数传入<code>dump()</code>，却没有使用<code>close()</code>关闭文件对象。这是错误的，会造成文件对象一直没有关闭而持续占用计算机资源。</p><p><strong>解决方法</strong>：要么手动调用<code>close()</code>方法，要么用<code>with语句</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;./py_dic.json&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">json.dump(py_dic, f, sort_keys=<span class="literal">True</span>)</span><br><span class="line">f.close()</span><br><span class="line"></span><br><span class="line">或</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./py_dic.json&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    json.dump(py_dic, f, sort_keys=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><h3 id="JSON-gt-Python"><a href="#JSON-gt-Python" class="headerlink" title="JSON -&gt; Python"></a>JSON -&gt; Python</h3><blockquote><p><code>json.load(fp, *, cls=None, object_hook=None, parse_float=None, parse_int=None, parse_constant=None, object_pairs_hook=None, **kw)</code></p></blockquote><blockquote><p><code>json.loads(s, *, cls=None, object_hook=None, parse_float=None, parse_int=None, parse_constant=None, object_pairs_hook=None, **kw)</code></p></blockquote><ul><li><code>fp</code>：文件对象，要写入的文件</li><li><code>object_hook</code>：是一个可选的函数，它会被调用于每一个解码出的对象字面量（即一个 dict）。object_hook 的返回值会取代原本的 dict。这一特性能够被用于实现自定义解码器（如 JSON-RPC 的类型提示)。</li><li><code>parse_float</code>、<code>parse_int</code>、<code>parse_constant</code>、 <code>object_pairs_hook</code>：都是编码解码器需要的参数</li></ul><ol><li>使用<code>loads()</code></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">Str = <span class="string">&#x27;&#123;&quot;name&quot;: &quot;Boii&quot;, &quot;age&quot;: 30, &quot;tel&quot;:[&quot;13800000000&quot;, &quot;13100880088&quot;], &quot;isonly&quot;:true&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;JSON字符串：&#x27;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(Str, end=<span class="string">&#x27;\t&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(Str))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将一个 json 字符串 转换成 Python 对象</span></span><br><span class="line">pythonObj = json.loads(Str)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Python对象：&#x27;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(pythonObj, end=<span class="string">&#x27;\t&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(pythonObj))</span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line"></span><br><span class="line">JSON字符串：&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Boii&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">30</span>, <span class="string">&quot;tel&quot;</span>:[<span class="string">&quot;13800000000&quot;</span>, <span class="string">&quot;13100880088&quot;</span>], <span class="string">&quot;isonly&quot;</span>:true&#125;    &lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">str</span>&#x27;&gt;</span></span><br><span class="line"><span class="class"><span class="title">Python</span>对象：&#123;&#x27;<span class="title">name</span>&#x27;:</span> <span class="string">&#x27;Boii&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">30</span>, <span class="string">&#x27;tel&#x27;</span>: [<span class="string">&#x27;13800000000&#x27;</span>, <span class="string">&#x27;13100880088&#x27;</span>], <span class="string">&#x27;isonly&#x27;</span>: <span class="literal">True</span>&#125;    &lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">dict</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure><p>可以发现，Python中都是使用单引号<code>&#39;</code>，JSON中都是使用双引号<code>&quot;</code></p><ol start="2"><li>使用<code>load()</code>从json文件中读取转换成Python对象</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># py.json</span></span><br><span class="line">&#123;<span class="string">&quot;firstName&quot;</span>: <span class="string">&quot;Boii&quot;</span>, <span class="string">&quot;j&quot;</span>: &#123;<span class="string">&quot;x&quot;</span>: <span class="number">2</span>, <span class="string">&quot;y&quot;</span>: <span class="string">&quot;2&quot;</span>, <span class="string">&quot;z&quot;</span>: <span class="number">3</span>&#125;, <span class="string">&quot;lastName&quot;</span>: <span class="string">&quot;Pro&quot;</span>, <span class="string">&quot;li&quot;</span>: [<span class="string">&quot;A&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="number">3</span>]&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># j2p.py</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./j2p.py&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    pythonObj = json.load(f)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Python对象：&#x27;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(pythonObj)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(pythonObj))</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">Python对象：&#123;<span class="string">&#x27;firstName&#x27;</span>: <span class="string">&#x27;Boii&#x27;</span>, <span class="string">&#x27;j&#x27;</span>: &#123;<span class="string">&#x27;x&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;y&#x27;</span>: <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;z&#x27;</span>: <span class="number">3</span>&#125;, <span class="string">&#x27;lastName&#x27;</span>: <span class="string">&#x27;Pro&#x27;</span>, <span class="string">&#x27;li&#x27;</span>: [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="number">3</span>]&#125;</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">dict</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Writing JSON data</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;data.json&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    json.dump(data, f)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Reading data back</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;data.json&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = json.load(f)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
          <category> 内置库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> json </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python【Crawler】通用爬虫</title>
      <link href="posts/33364"/>
      <url>posts/33364</url>
      
        <content type="html"><![CDATA[<p>爬虫的基本用法</p><span id="more"></span><p>Python 中原生的一款基于网络请求的模块，功能强大，简单便捷，效率极高。</p><blockquote><p>&gt;_: pip install requests</p></blockquote><h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2><ol><li>指定URL</li><li>UA伪装</li><li>发起请求 —— <code>requests.get()</code> 或 <code>requests.post()</code></li><li>获取响应数据 —— <code>.json()</code>或<code>.text</code></li><li>持久化存储 —— <code>f.write()</code> 或 <code>json.dump()</code></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="comment"># 1. 指定url</span></span><br><span class="line">    url = <span class="string">&quot;https://www.sou.com&quot;</span></span><br><span class="line">    <span class="comment"># 2. UA伪装</span></span><br><span class="line">    header = &#123;<span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.89 Safari/537.36 Edg/84.0.522.44&quot;</span>&#125;</span><br><span class="line">    <span class="comment"># 3. 发起请求</span></span><br><span class="line">    response = requests.get(url=url, headers=header)</span><br><span class="line">    <span class="comment"># 4. 获取响应数据</span></span><br><span class="line">    page_text = response.text</span><br><span class="line">    <span class="comment"># 5. 持久化存储</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;sogou.html&quot;</span>, <span class="string">&quot;w&quot;</span>, <span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.wirte(page_text)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;END&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __naim__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>这种就是最基本的模拟浏览器进行爬取。<br>通过<code>requests</code>就可以进行网络请求，从返回对象中得到数据。</p><p>url的获取方式主要通过自己查找分析<br>如果只是普通的浏览网页，一般使用的是<code>get方式</code><br>如果携带参数，需要观察url中 <code>？</code> 后面的字段。</p><h2 id="携带参数"><a href="#携带参数" class="headerlink" title="携带参数"></a>携带参数</h2><p>http协议中的请求方式分为<code>get</code>、<code>post</code>、<code>put</code>、<code>patch</code>、<code>head</code>、<code>delete</code>。<br>最常用的请求为 <code>get()</code> 和 <code>post()</code>，这两种请求方式都可以携带参数。<br>在浏览器中分析的时候可以观察 <code>?</code> 后面的字段，有的是<code>query</code>，有的是<code>q</code>，可以通过浏览器中抓包工具进行分析<br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/crawler/1-1.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/crawler/1-1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="1"></p><ol><li>由此就可以确定 <code>?</code> 前面是我们要的url： <code>https://www.sogou.com/web?</code>；url中的问号<code>?</code>可写可不写</li><li>接着可以确定查询字段是<code>query</code>，用个字典包装起来：<code>param = &#123;&#39;query&#39;: &#39;python&#39;&#125;</code></li><li>同时在请求url下面可以看到请求方式是get，所以可以使用get方法进行请求：<code>res = requests.get(url, param, headers=header)</code></li><li>观察响应标头的<code>Content-Type</code>发现，返回格式为text，则调用res.text获得返回内容：<code>res_text = res.text</code></li><li>将返回的内容存储起来。搞定。</li></ol><p>完整代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">header = &#123;<span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.89 Safari/537.36 Edg/84.0.522.44&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="comment"># 1. 指定url</span></span><br><span class="line">    url = <span class="string">&quot;https://www.sogou.com/web?&quot;</span></span><br><span class="line">    <span class="comment"># 2. 获取查询内容</span></span><br><span class="line">    q = <span class="built_in">input</span>(<span class="string">&#x27;Enter the contend you want to search: &#x27;</span>)</span><br><span class="line">    <span class="comment"># 3. 设置好传输参数</span></span><br><span class="line">    param = &#123;<span class="string">&#x27;query&#x27;</span>: q&#125;</span><br><span class="line">    <span class="comment"># 4. 发送请求</span></span><br><span class="line">    res = requests.get(url=url, params=param, headers=header)</span><br><span class="line">    <span class="comment"># 5. 获取返回内容</span></span><br><span class="line">    res_text = res.text</span><br><span class="line">    <span class="comment"># 6. 写入文件</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./sogou.html&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(res_text)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">Enter the contend you want to search: Python</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># sogou.html</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">data-vtype</span>=<span class="string">&quot;default&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=Edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;x-dns-prefetch-control&quot;</span> <span class="attr">content</span>=<span class="string">&quot;on&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;referrer&quot;</span> <span class="attr">content</span>=<span class="string">&quot;always&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="comment">&lt;!-- BottomViewEnd opt --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">crossorigin</span>=<span class="string">&quot;anonymous&quot;</span> <span class="attr">src</span>=<span class="string">&quot;//dlweb.sogoucdn.com/hhytrace/trace_2020072915.js&quot;</span> <span class="attr">async</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="comment">&lt;!-- bodyViewEnd --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span><span class="comment">&lt;!-- 1596006531756 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--STATUS total 14 time 1596006531756 page 0 maxEnd 1000 totalItems 8955--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--real_pageno:1--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--nodeserverinfo:rsync.doc04.web.1.gd.ted--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--searchhubserverinfo:doc09.web.1.gd.ted:5555--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--zly--&gt;</span></span><br></pre></td></tr></table></figure><p>requests模块中的<code>get()</code>、<code>post()</code>、<code>put()</code>等请求方法其实都是调用了<code>request()</code>方法。</p><blockquote><p><code>request(method, url, **kwargs)</code><br><code>get(url, params=None, **kwargs)</code><br><code>post(url, data=None, json=None, **kwargs)</code></p></blockquote><p>这里注意区分，get的参数是<code>params</code>，post的参数的<code>data</code></p><h2 id="抓取动态内容"><a href="#抓取动态内容" class="headerlink" title="抓取动态内容"></a>抓取动态内容</h2><p>网页中有些数据不是静态的，而是动态获取，通过Ajax局部刷新。<br>例如百度翻译<br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/crawler/1-2.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/crawler/1-2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2"></p><p>红框中的内容会根据输入框中内容的变化而变化，这就是<strong>动态获取</strong><br>当内容改变的时候，返回来的结果只会改变页面中红框的部分，这就是<strong>局部刷新</strong></p><p>这种数据直接抓取页面是无效的，所以我们要通过浏览器抓包工具进行观察</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/crawler/1-3.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/crawler/1-3.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="3"></p><ol><li>可以把筛选器设置到 XHR ，这样可以只查看刷新时返回的数据</li><li>通过观察可以发现每输入一个字符就会发送一个sug，所以请求url应该是<code>https://fanyi.baidu.com/sug</code>才对</li><li>请求方式是<code>post</code>，携带参数是kw，所以参数部分应该这样写：<code>data = &#123;kw: &#39;document&#39;&#125;</code></li><li>接着看到 <code>Content-Type</code>，返回数据格式是 json，那么就需要用 json 模块来处理。<code>res_json = res.json()</code></li><li>最后可以使用 <code>json.dump()</code>将json格式直接写入数据，或者使用<code>json.loads()</code>转换成python对象，再用<code>f.write()</code>写入文件。</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">header = &#123;<span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.89 Safari/537.36 Edg/84.0.522.44&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="comment"># 1. 指定url</span></span><br><span class="line">    url = <span class="string">&#x27;https://fanyi.baidu.com/sug&#x27;</span></span><br><span class="line">    <span class="comment"># 2. 获取查询内容，设置好请求参数</span></span><br><span class="line">    query = <span class="built_in">input</span>(<span class="string">&quot;Enter the word you want to translate: &quot;</span>)</span><br><span class="line">    data = &#123;<span class="string">&#x27;kw&#x27;</span>: query&#125;</span><br><span class="line">    <span class="comment"># 3. 发送请求</span></span><br><span class="line">    res = requests.post(url=url, data=data, headers=header)</span><br><span class="line">    <span class="comment"># 4. 获取返回内容</span></span><br><span class="line">    res_json = res.json()</span><br><span class="line">    <span class="comment"># 5. 写入文件</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./translation.json&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        json.dump(res_json, fp, ensure_ascii=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
          <category> 爬虫 </category>
          
          <category> 基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> 爬虫 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python【Crawler】聚焦爬虫</title>
      <link href="posts/28995"/>
      <url>posts/28995</url>
      
        <content type="html"><![CDATA[<p>过滤爬取到的数据，取出想要的部分</p><span id="more"></span><p>聚焦爬虫：爬取页面中指定的页面内容</p><ul><li><p>编码流程</p><ol><li>指定url</li><li>发起请求</li><li>获取响应数据</li><li>数据解析</li><li>持久化存储</li></ol></li><li><p>数据解析分类</p><ol><li>正则表达式</li><li>bs4</li><li>xpath (*)</li></ol></li></ul><p>数据解析原理<br>    - 解析的局部文本内容都会在标签之间或标签的属性中存储<br>    - 1. 进行标签的定位<br>    - 2. 标签或者标签对应的属性中存储的数据值进行提取（即解析~~~~）</p><h2 id="正则表达式爬取"><a href="#正则表达式爬取" class="headerlink" title="正则表达式爬取"></a>正则表达式爬取</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment"># UA伪装</span></span><br><span class="line">UA = <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.89 Safari/537.36 Edg/84.0.522.44&#x27;</span></span><br><span class="line">header = &#123;<span class="string">&#x27;User-Agent&#x27;</span>: UA&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 存储目录</span></span><br><span class="line">folder = <span class="string">&#x27;./qiushi&#x27;</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(folder):</span><br><span class="line">    os.mkdir(folder)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="comment"># 分页处理</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">3</span>):</span><br><span class="line">        url = <span class="string">f&quot;https://www.qiushibaike.com/imgrank/page/<span class="subst">&#123;i&#125;</span>/&quot;</span></span><br><span class="line">        <span class="comment"># 1. 爬取整张页面</span></span><br><span class="line">        page_text = requests.get(url=url, headers=header).text</span><br><span class="line">        <span class="comment"># 2. 使用聚焦爬虫进行数据解析</span></span><br><span class="line">        images = data_parse(page_text)</span><br><span class="line"></span><br><span class="line">        length = <span class="built_in">len</span>(images)  <span class="comment"># 进度条所需</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> index, image <span class="keyword">in</span> <span class="built_in">enumerate</span>(images):</span><br><span class="line">            <span class="comment"># 3. 发起请求并获得数据</span></span><br><span class="line">            image_content = requests.get(url=image, headers=header).content</span><br><span class="line">            <span class="comment"># 4. 持久化存储</span></span><br><span class="line">            image_name = image.split(<span class="string">&#x27;/&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">            image_path = os.path.join(folder, image_name)</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(image_path, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(image_content)</span><br><span class="line">                <span class="comment"># 进度打印</span></span><br><span class="line">                <span class="built_in">print</span>(image_name + <span class="string">&#x27; 下载成功！&#x27;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;index&#125;</span> / <span class="subst">&#123;length&#125;</span>&#x27;</span>, end=<span class="string">&#x27;\r&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">str</span>(i) + <span class="string">&quot;/ 2 page&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">data_parse</span>(<span class="params">page_text</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; 解析出每张图片的url &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 分析网页后整理出正则表达式</span></span><br><span class="line">    ex = <span class="string">r&#x27;&lt;div class=&quot;thumb&quot;&gt;.*?&lt;img src=&quot;(.*?)&quot; alt.*?&gt;&lt;/div&gt;&#x27;</span></span><br><span class="line">    images = re.findall(ex, page_text, re.S)</span><br><span class="line">    images = [<span class="string">&#x27;https:&#x27;</span> + x <span class="keyword">for</span> x <span class="keyword">in</span> images]  <span class="comment"># 解析出来没有协议头，给增加上</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> images</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line"></span><br><span class="line">K7EUFEUIV3QY37P1.jpg 下载成功！</span><br><span class="line">DFIAAL32X5J35JP2.jpg 下载成功！</span><br><span class="line">...</span><br><span class="line">NXUA4X1CMQP22UPP.jpg 下载成功！</span><br><span class="line">FQILIKXCVMUIRXL8.jpg 下载成功！</span><br><span class="line"><span class="number">1</span>/ <span class="number">2</span> page</span><br><span class="line">95GRCYEUZANQ361J.jpg 下载成功！</span><br><span class="line">2SXBFKSSK3JD3G2M.jpg 下载成功！</span><br><span class="line">...</span><br><span class="line">5YTNS4JH0PLZAO58.jpg 下载成功！</span><br><span class="line">59CN77YAL198SM6M.jpg 下载成功！</span><br><span class="line"><span class="number">2</span>/ <span class="number">2</span> page</span><br></pre></td></tr></table></figure><h2 id="示例网页"><a href="#示例网页" class="headerlink" title="示例网页"></a>示例网页</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>测试bs4<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>百里守约<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;song&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>李清照<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>王安石<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>苏轼<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>柳宗元<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.song.com&quot;</span> <span class="attr">title</span>=<span class="string">&quot;赵匡胤&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_self&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span>&gt;</span>this is span<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            宋朝是最强大的王朝，不是军队的强大，而是经济很强大，国民都很有钱</span><br><span class="line">        <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;du&quot;</span>&gt;</span>总为浮云能避日，长安不见使人愁<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://www.baidu.com/meinv.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;tang&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.baidu.com&quot;</span> <span class="attr">title</span>=<span class="string">&quot;qing&quot;</span>&gt;</span>清明时节雨纷纷，路上行人欲断魂。借问酒家何处有，牧童遥指杏花村。<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.163.com&quot;</span> <span class="attr">title</span>=<span class="string">&quot;qin&quot;</span>&gt;</span>秦时明月汉时光，万里长征人未还。但使龙城飞将在，不教胡马度阴山。<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.126.com&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;qi&quot;</span>&gt;</span>岐王宅里寻常见，崔久堂前几度闻。正是江南好风景，落花时节又逢君。<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.sina.com&quot;</span> <span class="attr">class</span>=<span class="string">&quot;du&quot;</span>&gt;</span>杜甫<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.dudu.com&quot;</span> <span class="attr">class</span>=<span class="string">&quot;du&quot;</span>&gt;</span>杜牧<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>杜小月<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">i</span>&gt;</span>度蜜月<span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.haha.com&quot;</span> <span class="attr">id</span>=<span class="string">&quot;feng&quot;</span>&gt;</span>凤凰台上凤凰游，凤去台空江自流。吴宫花草埋幽径，晋代衣冠成古丘。<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/crawler/2-1.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/crawler/2-1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="1"><br><strong>以下爬虫示例均以此网页示例为基础</strong><br>有点丑，将就一下。</p></blockquote><h2 id="bs4爬取"><a href="#bs4爬取" class="headerlink" title="bs4爬取"></a>bs4爬取</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>win 下：<br>&gt;_ pip install bs4<br>&gt;_ pip install lxml</p><p>Linux 下：<br>&gt;_ pip install Beautifulsoup4</p><h3 id="导入"><a href="#导入" class="headerlink" title="导入"></a>导入</h3><blockquote><p><code>from bs4 import BeautifulSoup</code></p></blockquote><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><ul><li>创建bs对象并传入待解析对象<ol><li>传入待解析对象为本地文件 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./bs_test.html&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    bs = BeautifulSoup(f, <span class="string">&#x27;lxml&#x27;</span>)    <span class="comment"># 创建bs对象</span></span><br></pre></td></tr></table></figure></li><li>传入待解析对象为网络请求 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://www.baidu.com&quot;</span></span><br><span class="line">page_text = requests.get(url=url).text</span><br><span class="line">bs = BeautifulSoup(page_text, <span class="string">&#x27;lxml&#x27;</span>)    <span class="comment"># 创建bs对象</span></span><br></pre></td></tr></table></figure></li></ol></li></ul><h4 id="定位数据"><a href="#定位数据" class="headerlink" title="定位数据"></a>定位数据</h4><table><thead><tr><th align="left">方法</th><th align="left">用</th><th>返值</th></tr></thead><tbody><tr><td align="left">tagName</td><td align="left">返回首tagName标签</td><td>bs4.element.Tag</td></tr><tr><td align="left">find(‘tagName’)</td><td align="left">返回首tagName标签</td><td>bs4.element.Tag</td></tr><tr><td align="left">find(‘tagName’, class_/id/attrName=’value’)</td><td align="left">返回首属性为value的tagName标签</td><td>bs4.element.Tag</td></tr><tr><td align="left">find_all(‘tagName’)</td><td align="left">返回所符合要求的标签</td><td>bs4.element.ResultSet</td></tr><tr><td align="left">select([‘selector’ + ]’tagName’)</td><td align="left">通过CS选择器+标签名定位标签,返回多个</td><td>bs4.element.ResultSet</td></tr><tr><td align="left">select_one([‘selector’ + ]’tagName’)</td><td align="left">通过CS选择器+标签名定位标签,返回一个</td><td>bs4.element.Tag</td></tr></tbody></table><h5 id="bs-tagName"><a href="#bs-tagName" class="headerlink" title="bs.tagName"></a>bs.tagName</h5><ol><li><p><code>bs.tagName</code>：返回文档中<strong>第一次</strong>出现tagName对应的标签</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./bs_test.html&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    bs = BeautifulSoup(f, <span class="string">&#x27;lxml&#x27;</span>)    <span class="comment"># 创建bs对象</span></span><br><span class="line">    </span><br><span class="line">    tag_a = bs.a        <span class="comment"># 定位数据</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(tag_a)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(tag_a))  <span class="comment"># &lt;class &#x27;bs4.element.Tag&#x27;&gt;</span></span><br><span class="line">--------------------------------------------------</span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">&lt;a href=<span class="string">&quot;https://www.song.com&quot;</span> target=<span class="string">&quot;_self&quot;</span> title=<span class="string">&quot;赵匡胤&quot;</span>&gt;</span><br><span class="line">&lt;span&gt;this <span class="keyword">is</span> span&lt;/span&gt;</span><br><span class="line">    宋朝是最强大的王朝，不是军队的强大，而是经济很强大，国民都很有钱</span><br><span class="line">&lt;/a&gt;</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">bs4</span>.<span class="title">element</span>.<span class="title">Tag</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure><h5 id="bs-find"><a href="#bs-find" class="headerlink" title="bs.find()"></a>bs.find()</h5></li><li><p><code>bs.find()</code>：</p><ol><li><code>find(&#39;tagName&#39;)</code>：等同于 bs.tagName <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./bs_test.html&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    bs = BeautifulSoup(f, <span class="string">&#x27;lxml&#x27;</span>)    <span class="comment"># 创建bs对象</span></span><br><span class="line">    </span><br><span class="line">    tag_div = bs.find(<span class="string">&#x27;div&#x27;</span>)         <span class="comment"># 定位数据</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(tag_div)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(tag_div))  <span class="comment"># &lt;class &#x27;bs4.element.Tag&#x27;&gt;</span></span><br><span class="line">--------------------------------------------------</span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">&lt;div&gt;</span><br><span class="line">&lt;p&gt;百里守约&lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">bs4</span>.<span class="title">element</span>.<span class="title">Tag</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure></li><li><code>find(&#39;tagName&#39;, class_/is/attrName=&#39;value&#39;)</code>：通过限定属性来定位标签 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./bs_test.html&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    bs = BeautifulSoup(f, <span class="string">&#x27;lxml&#x27;</span>)                  <span class="comment"># 创建bs对象</span></span><br><span class="line">    </span><br><span class="line">    tag_a = bs.find(<span class="string">&#x27;a&#x27;</span>, class_=<span class="string">&#x27;du&#x27;</span>)        <span class="comment"># 定位数据</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(tag_a)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(tag_a))  <span class="comment"># &lt;class &#x27;bs4.element.Tag&#x27;&gt;</span></span><br><span class="line">--------------------------------------------------</span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">&lt;a <span class="class"><span class="keyword">class</span>=&quot;<span class="title">du</span>&quot; <span class="title">href</span>=&quot;&quot;&gt;总为浮云能避日，长安不见使人愁&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> &#x27;<span class="title">bs4</span>.<span class="title">element</span>.<span class="title">Tag</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure></li><li><code>bs.find_all(&#39;tagName&#39;)</code>：返回复合要求的所有标签（集合） <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./bs_test.html&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    bs = BeautifulSoup(f, <span class="string">&#x27;lxml&#x27;</span>)       <span class="comment"># 创建bs对象</span></span><br><span class="line">    </span><br><span class="line">    tag_p = bs.find_all(<span class="string">&#x27;p&#x27;</span>)        <span class="comment"># 定位数据</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(tag_p)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(tag_p))  <span class="comment"># &lt;class &#x27;bs4.element.ResultSet&#x27;&gt;</span></span><br><span class="line">--------------------------------------------------</span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">[&lt;p&gt;百里守约&lt;/p&gt;, &lt;p&gt;李清照&lt;/p&gt;, &lt;p&gt;王安石&lt;/p&gt;, &lt;p&gt;苏轼&lt;/p&gt;, &lt;p&gt;柳宗元&lt;/p&gt;]</span><br></pre></td></tr></table></figure><h5 id="bs-select"><a href="#bs-select" class="headerlink" title="bs.select()"></a>bs.select()</h5></li></ol></li><li><p><code>bs.select(&#39;selector&#39; + &#39;tagName&#39;)</code>：可以通过<strong>CSS择器+标签名</strong>定位，包括层级选择器、标签选择器等</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./bs_test.html&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    bs = BeautifulSoup(f, <span class="string">&#x27;lxml&#x27;</span>)       <span class="comment"># 创建bs对象</span></span><br><span class="line">    </span><br><span class="line">    tag_div = bs.select(<span class="string">&#x27;#feng&#x27;</span>)        <span class="comment"># 定位数据</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(tag_div)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(tag_div))  <span class="comment"># &lt;class &#x27;bs4.element.ResultSet&#x27;&gt;</span></span><br><span class="line">--------------------------------------------------</span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">[&lt;a href=<span class="string">&quot;https://www.haha.com&quot;</span> <span class="built_in">id</span>=<span class="string">&quot;feng&quot;</span>&gt;凤凰台上凤凰游，凤去台空江自流。吴宫花草埋幽径，晋代衣冠成古丘。&lt;/a&gt;]</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">bs4</span>.<span class="title">element</span>.<span class="title">ResultSet</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./bs_test.html&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    bs = BeautifulSoup(f, <span class="string">&#x27;lxml&#x27;</span>)               <span class="comment"># 创建bs对象</span></span><br><span class="line">    </span><br><span class="line">    tag1_a = bs.select(<span class="string">&#x27;.tang &gt; ul &gt; li &gt; a&#x27;</span>)  <span class="comment"># 定位数据</span></span><br><span class="line">    tag2_a = bs.select(<span class="string">&#x27;.tang &gt;ul a&#x27;</span>)          <span class="comment"># 定位数据</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(tag1_a)</span><br><span class="line">    <span class="built_in">print</span>(tag2_a)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(tag1_a))  <span class="comment"># &lt;class &#x27;bs4.element.ResultSet&#x27;&gt;</span></span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">[&lt;a href=<span class="string">&quot;https://www.baidu.com&quot;</span> title=<span class="string">&quot;qing&quot;</span>&gt;清明时节雨纷纷，路上行人欲断魂。借问酒家何处有，牧童遥指杏花村。&lt;/a&gt;, &lt;a href=<span class="string">&quot;https://www.163.com&quot;</span> title=<span class="string">&quot;qin&quot;</span>&gt;秦时明月汉时光，万里长征人未还。但使龙城飞将在，不教胡马度阴山。&lt;/a&gt;, &lt;a alt=<span class="string">&quot;qi&quot;</span> href=<span class="string">&quot;https://www.126.com&quot;</span>&gt;岐王宅里寻常见，崔久堂前几度闻。正是江南好风景，落花时节又逢君。&lt;/a&gt;, &lt;a <span class="class"><span class="keyword">class</span>=&quot;<span class="title">du</span>&quot; <span class="title">href</span>=&quot;<span class="title">https</span>:</span>//www.sina.com<span class="string">&quot;&gt;杜甫&lt;/a&gt;, &lt;a class=&quot;</span>d<span class="string">u&quot; href=&quot;</span>https://www.dudu.com<span class="string">&quot;&gt;杜牧&lt;/a&gt;, &lt;a href=&quot;</span>https://www.haha.com<span class="string">&quot; id=&quot;</span>feng<span class="string">&quot;&gt;凤凰台上凤凰游，凤去台空江自流。吴宫花草埋幽径，晋代衣冠成古丘。&lt;/a&gt;]</span></span><br><span class="line"><span class="string">[&lt;a href=&quot;</span>https://www.baidu.com<span class="string">&quot; title=&quot;</span>qing<span class="string">&quot;&gt;清明时节雨纷纷，路上行人欲断魂。借问酒家何处有，牧童遥指杏花村。&lt;/a&gt;, &lt;a href=&quot;</span>https://www<span class="number">.163</span>.com<span class="string">&quot; title=&quot;</span>qin<span class="string">&quot;&gt;秦时明月汉时光，万里长征人未还。但使龙城飞将在，不教胡马度阴山。&lt;/a&gt;, &lt;a alt=&quot;</span>qi<span class="string">&quot; href=&quot;</span>https://www<span class="number">.126</span>.com<span class="string">&quot;&gt;岐王宅里寻常见，崔久堂前几度闻。正是江南好风景，落花时节又逢君。&lt;/a&gt;, &lt;a class=&quot;</span>d<span class="string">u&quot; href=&quot;</span>https://www.sina.com<span class="string">&quot;&gt;杜甫&lt;/a&gt;, &lt;a class=&quot;</span>d<span class="string">u&quot; href=&quot;</span>https://www.dudu.com<span class="string">&quot;&gt;杜牧&lt;/a&gt;, &lt;a href=&quot;</span>https://www.haha.com<span class="string">&quot; id=&quot;</span>feng<span class="string">&quot;&gt;凤凰台上凤凰游，凤去台空江自流。吴宫花草埋幽径，晋代衣冠成古丘。&lt;/a&gt;]</span></span><br><span class="line"><span class="string">&lt;class &#x27;bs4.element.ResultSet&#x27;&gt;</span></span><br></pre></td></tr></table></figure> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./bs_test.html&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    bs = BeautifulSoup(f, <span class="string">&#x27;lxml&#x27;</span>)       <span class="comment"># 创建bs对象</span></span><br><span class="line">    </span><br><span class="line">    tag_div = bs.select_one(<span class="string">&#x27;.du&#x27;</span>)    <span class="comment"># 定位数据</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(tag_div)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(tag_div))  <span class="comment"># &lt;class &#x27;bs4.element.Tag&#x27;&gt;</span></span><br><span class="line">    </span><br><span class="line">--------------------------------------------------</span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">&lt;a <span class="class"><span class="keyword">class</span>=&quot;<span class="title">du</span>&quot; <span class="title">href</span>=&quot;&quot;&gt;总为浮云能避日，长安不见使人愁&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> &#x27;<span class="title">bs4</span>.<span class="title">element</span>.<span class="title">Tag</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h4 id="解析数据"><a href="#解析数据" class="headerlink" title="解析数据"></a>解析数据</h4><table><thead><tr><th align="left">方法</th><th align="left">用</th><th align="left">返值</th></tr></thead><tbody><tr><td align="left">.text</td><td align="left">返回标签下所有<strong>直系和非直系标签</strong>的所有本</td><td align="left">str</td></tr><tr><td align="left">.get_text()</td><td align="left">返回标签下所有<strong>直系和非直系标签</strong>的所有本</td><td align="left">str</td></tr><tr><td align="left">.string</td><td align="left">返回标签下所有<strong>直系标签</strong>的所有本</td><td align="left">bs4.element.NavigableString</td></tr></tbody></table><h5 id="获取文本"><a href="#获取文本" class="headerlink" title="获取文本"></a>获取文本</h5><ol><li><code>bs.tagName.text/string/get_text()</code>：获取标签之间的<em>所有文本</em>*<ol><li><code>text/get_text()</code>：可以获取标签下<strong>直系和非直系</strong>的所有文本 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./bs_test.html&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    bs = BeautifulSoup(f, <span class="string">&#x27;lxml&#x27;</span>)       <span class="comment"># 创建bs对象</span></span><br><span class="line">    </span><br><span class="line">    txt_li = bs.find(<span class="string">&#x27;li&#x27;</span>).text</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(txt_li)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(txt_li))    <span class="comment"># &lt;class &#x27;str&#x27;&gt;</span></span><br><span class="line">    </span><br><span class="line">--------------------------------------------------</span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">清明时节雨纷纷，路上行人欲断魂。借问酒家何处有，牧童遥指杏花村。</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">str</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./bs_test.html&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    bs = BeautifulSoup(f, <span class="string">&#x27;lxml&#x27;</span>)       <span class="comment"># 创建bs对象</span></span><br><span class="line">    </span><br><span class="line">    txt_li = bs.find(<span class="string">&#x27;li&#x27;</span>).get_text()</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(txt_li)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(txt_li))    <span class="comment"># &lt;class &#x27;str&#x27;&gt;</span></span><br><span class="line">    </span><br><span class="line">--------------------------------------------------</span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">清明时节雨纷纷，路上行人欲断魂。借问酒家何处有，牧童遥指杏花村。</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">str</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure></li><li><code>string</code>：只能获取标签下<strong>直系</strong>的文本，没有返回 None <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./bs_test.html&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    bs = BeautifulSoup(f, <span class="string">&#x27;lxml&#x27;</span>)       <span class="comment"># 创建bs对象</span></span><br><span class="line">    </span><br><span class="line">    txt_li = bs.find(<span class="string">&#x27;li&#x27;</span>).string</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(txt_li)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(txt_li))    <span class="comment"># &lt;class &#x27;bs4.element.NavigableString&#x27;&gt;</span></span><br><span class="line">    </span><br><span class="line">--------------------------------------------------</span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">清明时节雨纷纷，路上行人欲断魂。借问酒家何处有，牧童遥指杏花村。</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">bs4</span>.<span class="title">element</span>.<span class="title">NavigableString</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure></li></ol></li></ol><h5 id="获取属性"><a href="#获取属性" class="headerlink" title="获取属性"></a>获取属性</h5><ol><li><code>bs.tagName[&#39;attrName&#39;]</code>：获取标签中的<strong>属性内容</strong><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./bs_test.html&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    bs = BeautifulSoup(f, <span class="string">&#x27;lxml&#x27;</span>)       <span class="comment"># 创建bs对象</span></span><br><span class="line">    </span><br><span class="line">    txt_href = bs.find(<span class="string">&#x27;a&#x27;</span>)[<span class="string">&#x27;href&#x27;</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(txt_href)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(txt_href))    <span class="comment"># &lt;class &#x27;str&#x27;&gt;</span></span><br><span class="line">    </span><br><span class="line">--------------------------------------------------</span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">https://www.song.com</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">str</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h3><blockquote><p>从诗词名句网下载一整部《论语》</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">UA = <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.89 Safari/537.36 Edg/84.0.522.44&#x27;</span></span><br><span class="line">header = &#123;<span class="string">&#x27;User-Agent&#x27;</span>: UA&#125;</span><br><span class="line"></span><br><span class="line">folder = <span class="string">&#x27;.\\爬虫\\论语&#x27;</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(folder):</span><br><span class="line">    os.mkdir(folder)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">req_catalog</span>(<span class="params">url</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; 请求目录列表 &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> requests.get(url=url, headers=header).text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">catalog_parse</span>(<span class="params">res_text</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; 解析目录列表 &quot;&quot;&quot;</span></span><br><span class="line">    bs = BeautifulSoup(res_text, <span class="string">&#x27;lxml&#x27;</span>)</span><br><span class="line">    links = bs.select(<span class="string">&#x27;.book-mulu &gt; ul &gt; li &gt; a&#x27;</span>)</span><br><span class="line">    catalog_list = [[x.string, x[<span class="string">&#x27;href&#x27;</span>]] <span class="keyword">for</span> x <span class="keyword">in</span> links]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> catalog_list</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_content</span>(<span class="params">catalog_list</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; 请求内容页 &quot;&quot;&quot;</span></span><br><span class="line">    url = <span class="string">&#x27;https://www.shicimingju.com&#x27;</span></span><br><span class="line">    length = <span class="built_in">len</span>(catalog_list)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> index, elem <span class="keyword">in</span> <span class="built_in">enumerate</span>(catalog_list):</span><br><span class="line">        <span class="comment"># 请求数据</span></span><br><span class="line">        content_text = requests.get(url=url + elem[<span class="number">1</span>], headers=header).text</span><br><span class="line">        <span class="comment"># 解析数据</span></span><br><span class="line">        content = contents_parse(content_text)</span><br><span class="line">        <span class="comment"># 持久化存储</span></span><br><span class="line">        filename = <span class="built_in">str</span>(index + <span class="number">1</span>) + <span class="string">&#x27;-&#x27;</span> + elem[<span class="number">0</span>] + <span class="string">&#x27;.txt&#x27;</span></span><br><span class="line">        filepath = os.path.join(folder, filename)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(filepath, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(content)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;已下载：&quot;</span> + <span class="built_in">str</span>(index + <span class="number">1</span>) + <span class="string">&quot; / &quot;</span> + <span class="built_in">str</span>(length), end=<span class="string">&quot;\r&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">contents_parse</span>(<span class="params">page_text</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; 解析内容 &quot;&quot;&quot;</span></span><br><span class="line">    bs = BeautifulSoup(page_text, <span class="string">&#x27;lxml&#x27;</span>)</span><br><span class="line">    contents = bs.select(<span class="string">&#x27;.chapter_content &gt; p&#x27;</span>)  <span class="comment"># 取出所有p标签</span></span><br><span class="line">    texts = [x.string <span class="keyword">for</span> x <span class="keyword">in</span> contents]          <span class="comment"># 取出内容，过滤掉P标签</span></span><br><span class="line">    content = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> texts:</span><br><span class="line">        content += <span class="built_in">str</span>(i)</span><br><span class="line">    <span class="keyword">return</span> content</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    url = <span class="string">&quot;https://www.shicimingju.com/book/lunyu.html&quot;</span></span><br><span class="line"></span><br><span class="line">    catalog_list = <span class="built_in">list</span>()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        catalog_text = req_catalog(url)</span><br><span class="line">        catalog_list = catalog_parse(catalog_text)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;下载成功！&quot;</span>) <span class="keyword">if</span> download_content(catalog_list) <span class="keyword">else</span> <span class="built_in">print</span>(<span class="string">&quot;下载失败&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> TimeoutError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;TimeoutError\n&quot;</span>)</span><br><span class="line">        time.sleep(<span class="number">2</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;下载成功！&quot;</span>) <span class="keyword">if</span> download_content(catalog_list) <span class="keyword">else</span> <span class="built_in">print</span>(<span class="string">&quot;下载失败&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Exception\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="xpath爬取"><a href="#xpath爬取" class="headerlink" title="xpath爬取"></a>xpath爬取</h2><p>最常用、通用性最强的，最便捷高效的一种解析方式。</p><h3 id="解析步骤"><a href="#解析步骤" class="headerlink" title="解析步骤"></a>解析步骤</h3><ol><li>实例化一个etree对象，并且需要将被解析的页面源码数据加载到该对象中。</li><li>通过调用etree对象中的xpath方法结合着xpath表达式实现标签的定位和内容的捕获</li><li>xpath定位到数据后返回的不是数据的内容，而已一个列表，里面放置了解析出来的<strong>Element对象</strong></li></ol><h3 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h3><p>&gt;_: pip install lxml</p><h3 id="导入-1"><a href="#导入-1" class="headerlink" title="导入"></a>导入</h3><blockquote><p><code>from lxml import etree</code></p></blockquote><h3 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h3><ul><li><p>创建etree对象并传入待解析对象</p><ol><li>传入待解析对象为本地文件 <code>tree = etree.parse(filePath)</code></li><li>传入待解析对象为网络请求 <code>tree = etree.HTML(&#39;page_text&#39;)</code></li></ol></li><li><p>定位数据：<code>tree.xpath(xpath表达式)</code><br>  在XPath中有7种节点：元素、属性、文本、文档、命名空间、处理指令、注释。<br>  元素、属性、文本 为常用节点。</p>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span> 为文档节点</span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span>小米<span class="tag">&lt;/<span class="name">li</span>&gt;</span> 为元素节点</span><br><span class="line">class=&#x27;blank&#x27; 为属性节点</span><br><span class="line"><span class="comment">&lt;!-- 这里是注释 --&gt;</span> 为注释节点</span><br></pre></td></tr></table></figure><table><thead><tr><th align="left">expression</th><th align="left">description</th></tr></thead><tbody><tr><td align="left">nodeName</td><td align="left">选择nodeName节点的所有子节点</td></tr><tr><td align="left">/</td><td align="left">从根节点或/前的节点开始，不跨层级匹配</td></tr><tr><td align="left">//</td><td align="left">从//前的节点开始，跨层级匹配</td></tr><tr><td align="left">.</td><td align="left">选择当前节点</td></tr><tr><td align="left">..</td><td align="left">选择当前节点的父节点</td></tr><tr><td align="left">@</td><td align="left">匹配元素属性</td></tr><tr><td align="left">*</td><td align="left">匹配所有节点</td></tr><tr><td align="left">@*</td><td align="left">匹配节点所有属性</td></tr><tr><td align="left">[]</td><td align="left">按索引定位</td></tr></tbody></table><ol><li><p><code>/</code>：表示从根节点开始定位</p><blockquote><p>/ 放在最前面的时候表示根节点，不是放在最前面的时候表示</p></blockquote> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./test.html&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f_content = f.read()</span><br><span class="line">    tree = etree.HTML(f_content)</span><br><span class="line">    r = tree.xpath(<span class="string">&#x27;/html/body/div/p&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(r)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(r))</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line">xpath 在匹配的时候是贪婪的，示例中有两个 div 下都有 p，所以匹配到了<span class="number">5</span>个</span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">[&lt;Element p at <span class="number">0x252e2de8780</span>&gt;,</span><br><span class="line"> &lt;Element p at <span class="number">0x252e2de87c0</span>&gt;,</span><br><span class="line"> &lt;Element p at <span class="number">0x252e2de8800</span>&gt;,</span><br><span class="line"> &lt;Element p at <span class="number">0x252e2de8840</span>&gt;,</span><br><span class="line"> &lt;Element p at <span class="number">0x252e2de8880</span>&gt;]</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">list</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><code>//</code>：表示匹配多级</p><blockquote><p>/a/b//c，就表示匹配 a 标签下的 b 标签下所有c标签</p></blockquote> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./test.html&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f_content = f.read()</span><br><span class="line">    tree = etree.HTML(f_content)</span><br><span class="line">    r = tree.xpath(<span class="string">&#x27;/html//a&#x27;</span>)        <span class="comment"># 等价于 r = tree.xpath(&#x27;//a&#x27;)</span></span><br><span class="line">    <span class="built_in">print</span>(r)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(r))</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line">html节点下总共有<span class="number">8</span>个a标签，所以匹配到<span class="number">8</span>个element对象</span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">[&lt;Element a at <span class="number">0x1e5f55e9680</span>&gt;,</span><br><span class="line"> &lt;Element a at <span class="number">0x1e5f55e96c0</span>&gt;,</span><br><span class="line"> &lt;Element a at <span class="number">0x1e5f55e9700</span>&gt;,</span><br><span class="line"> &lt;Element a at <span class="number">0x1e5f55e9740</span>&gt;,</span><br><span class="line"> &lt;Element a at <span class="number">0x1e5f55e9780</span>&gt;,</span><br><span class="line"> &lt;Element a at <span class="number">0x1e5f55e9800</span>&gt;,</span><br><span class="line"> &lt;Element a at <span class="number">0x1e5f55e9840</span>&gt;,</span><br><span class="line"> &lt;Element a at <span class="number">0x1e5f55e9880</span>&gt;]</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">list</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><code>@</code>：表示通过属性定位</p><blockquote><p><code>tag[@attrName=&quot;attrValue&quot;]</code><br>@后面加上属性名，比如class、id、href、src等等</p></blockquote> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./test.html&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f_content = f.read()</span><br><span class="line">    tree = etree.HTML(f_content)</span><br><span class="line">    r = tree.xpath(<span class="string">&#x27;/html//div[@class=&quot;song&quot;]&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(r)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(r))</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line">html节点下总共有<span class="number">8</span>个a标签，所以匹配到<span class="number">8</span>个element对象</span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">[&lt;Element div at <span class="number">0x24d64839640</span>&gt;]</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">list</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><code>[]</code>：表示通过索引定位</p><blockquote><p><code>tag[index]</code><br>这里是索引是<strong>从1开始的</strong></p></blockquote> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./test.html&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f_content = f.read()</span><br><span class="line">    tree = etree.HTML(f_content)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(tree.xpath(<span class="string">&#x27;/html//div[@class=&quot;song&quot;]/p[1]&#x27;</span>))</span><br><span class="line">    <span class="built_in">print</span>(tree.xpath(<span class="string">&#x27;/html//div[@class=&quot;song&quot;]/p[1]/text()&#x27;</span>))</span><br><span class="line">    <span class="built_in">print</span>(tree.xpath(<span class="string">&#x27;/html//div[@class=&quot;song&quot;]/p[2]&#x27;</span>))</span><br><span class="line">    <span class="built_in">print</span>(tree.xpath(<span class="string">&#x27;/html//div[@class=&quot;song&quot;]/p[3]&#x27;</span>))</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line">这里的下标是从<span class="number">1</span>开始的</span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">[&lt;Element p at <span class="number">0x1df3d4395c0</span>&gt;]</span><br><span class="line">[<span class="string">&#x27;李清照&#x27;</span>]</span><br><span class="line">[&lt;Element p at <span class="number">0x1df3d439580</span>&gt;]</span><br><span class="line">[&lt;Element p at <span class="number">0x1df3d439600</span>&gt;]</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">list</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><code>/text()</code>：返回标签之间的文本，<strong>取文本</strong></p><blockquote><p><code>tag/text()</code>：获取tag下<strong>直系</strong>的文本<br><code>tag//text()</code>：获取tag下<strong>直系和非直系</strong>的文本</p></blockquote> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./test.html&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f_content = f.read()</span><br><span class="line">    tree = etree.HTML(f_content)</span><br><span class="line">    r1 = tree.xpath(<span class="string">&#x27;/html//div[@class=&quot;song&quot;]/p[3]&#x27;</span>)</span><br><span class="line">    r2 = tree.xpath(<span class="string">&#x27;/html//div[@class=&quot;song&quot;]/p[3]/text()&#x27;</span>)</span><br><span class="line">    r3 = tree.xpath(<span class="string">&#x27;/html//div[@class=&quot;song&quot;]/p[3]/text()&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">    <span class="built_in">print</span>(r1)</span><br><span class="line">    <span class="built_in">print</span>(r2)</span><br><span class="line">    <span class="built_in">print</span>(r3)</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">[&lt;Element p at <span class="number">0x1d4e4c29540</span>&gt;]</span><br><span class="line">[<span class="string">&#x27;苏轼&#x27;</span>]</span><br><span class="line">苏轼</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">list</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><code>/@attrName</code>：返回标签的attrName属性的值</p><blockquote><p><code>tag/@attrName</code>：获取tag标签中的attrName属性的值</p></blockquote> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./test.html&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f_content = f.read()</span><br><span class="line">    tree = etree.HTML(f_content)</span><br><span class="line">    r1 = tree.xpath(<span class="string">&#x27;//div[@class=&quot;song&quot;]/a/@href&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(r1)</span><br><span class="line"></span><br><span class="line">    r2 = tree.xpath(<span class="string">&#x27;//div[@class=&quot;song&quot;]/img/@src&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(r2)</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">[<span class="string">&#x27;https://www.song.com&#x27;</span>, <span class="string">&#x27;&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;https://www.baidu.com/meinv.jpg&#x27;</span>]</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">list</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><code>/@*</code>：返回标签的所有属性的值</p><blockquote><p><code>tag/@*</code>：获取tag标签中的所有属性的值</p></blockquote> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./test.html&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f_content = f.read()</span><br><span class="line">    tree = etree.HTML(f_content)</span><br><span class="line">    r1 = tree.xpath(<span class="string">&#x27;//div[@class=&quot;song&quot;]/a[@target=&quot;_self&quot;]/@*&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(r1)</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">[<span class="string">&#x27;https://www.song.com&#x27;</span>, <span class="string">&#x27;赵匡胤&#x27;</span>, <span class="string">&#x27;_self&#x27;</span>]</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">list</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure></li></ol></li></ul><h3 id="案例-1"><a href="#案例-1" class="headerlink" title="案例"></a>案例</h3><blockquote><p>从彼岸图网下载4K图保存至本地</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">UA = <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.89 Safari/537.36 Edg/84.0.522.44&#x27;</span></span><br><span class="line">header = &#123;<span class="string">&#x27;User-Agent&#x27;</span>: UA&#125;</span><br><span class="line"></span><br><span class="line">path = <span class="string">&#x27;./爬虫/4k&#x27;</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(path):</span><br><span class="line">    os.mkdir(path)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_url</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; 获取所有图片地址 &quot;&quot;&quot;</span></span><br><span class="line">    url = <span class="string">&#x27;http://pic.netbian.com/4kmeinv/&#x27;</span></span><br><span class="line">    index_text = requests.get(url=url, headers=header).text</span><br><span class="line"></span><br><span class="line">    tree = etree.HTML(index_text)</span><br><span class="line">    a_list = tree.xpath(<span class="string">&#x27;//div[@id=&quot;main&quot;]/div[3]/ul/li/a&#x27;</span>)</span><br><span class="line">    <span class="comment"># response.encoding = &#x27;utf-8&#x27;   # 处理中文乱码方式1，不一定有效</span></span><br><span class="line"></span><br><span class="line">    img_list = <span class="built_in">list</span>()</span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> a_list:</span><br><span class="line">        src: <span class="built_in">str</span> = <span class="string">&#x27;http://pic.netbian.com&#x27;</span> + a.xpath(<span class="string">&#x27;./@href&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">        title: <span class="built_in">str</span> = a.xpath(<span class="string">&#x27;./b/text()&#x27;</span>)[<span class="number">0</span>] + <span class="string">&#x27;.jpg&#x27;</span></span><br><span class="line">        title = title.encode(<span class="string">&#x27;iso-8859-1&#x27;</span>).decode(<span class="string">&#x27;gbk&#x27;</span>)  <span class="comment"># 处理中文乱码方式2</span></span><br><span class="line">        img_list.append((title, src))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> img_list</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_img</span>(<span class="params">img_info</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; 下载图片 &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    img_content = requests.get(url=img_info[<span class="number">1</span>], headers=header).content</span><br><span class="line">    filepath = os.path.join(path, img_info[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filepath, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(img_content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    img_list = get_url()</span><br><span class="line">    <span class="keyword">for</span> img_info <span class="keyword">in</span> img_list:</span><br><span class="line">        download_img(img_info)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
          <category> 爬虫 </category>
          
          <category> 基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> 爬虫 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python【Crawler】爬虫总叙</title>
      <link href="posts/28223"/>
      <url>posts/28223</url>
      
        <content type="html"><![CDATA[<p>工具人，啊不，工具蜘蛛。</p><span id="more"></span><h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><ul><li><strong>通用爬虫</strong>：抓取系统重要组成部分，抓取的是<strong>一整张页面数据</strong>。</li><li><strong>聚焦爬虫</strong>：建立在通用爬虫之上，抓取的是页面中<strong>特定的局部内容</strong>。</li><li><strong>增量爬虫</strong>：检测网站中数据更新的情况，只会抓取网站中<strong>最新的数据</strong>。</li></ul><h2 id="矛与盾"><a href="#矛与盾" class="headerlink" title="矛与盾"></a>矛与盾</h2><ul><li><p>反爬机制：门户网站，可以通过指定相应的策略或技术手段，防止爬虫程序进行爬取</p><ul><li>检查User-Agent</li><li>IP屏蔽</li></ul></li><li><p>抗反爬策略：通过制定相关策略或技术手段破解门户网站的反爬机制。</p><ul><li>UA伪装</li><li>IP代理</li></ul></li><li><p>robots.txt 协议 —— 君子协议：规定了网站中哪些数据可以被爬虫爬取，哪些数据不可以被爬取</p></li><li><p>http</p><ul><li>概念：服务器与客户端数据交互的一种形式</li><li>常用请求头信息：<ul><li>User-Agent：请求载体的身份载体</li><li>Connection：请求完毕后，是否断开连接</li></ul></li><li>常用响应头信息：<ul><li>Content-Type：服务器响应回客户端的数据类型</li></ul></li></ul></li><li><p>https<br>  安全的http协议</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
          <category> 爬虫 </category>
          
          <category> 基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> 爬虫 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python【Type】String</title>
      <link href="posts/32620"/>
      <url>posts/32620</url>
      
        <content type="html"><![CDATA[<p>关于String的详细笔记</p><span id="more"></span><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="string">&#x27;hello&#x27;</span></span><br><span class="line">b = <span class="string">&quot;good&quot;</span></span><br><span class="line">c = <span class="string">&quot;&quot;&quot; 哈哈哈 &quot;&quot;&quot;</span></span><br><span class="line">d = <span class="string">&#x27;&#x27;&#x27; 呵呵呵 &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">str1 = <span class="string">&#x27;OK&#x27;</span>                     <span class="comment"># OK</span></span><br><span class="line">str2 = <span class="string">&quot;OK&quot;</span>                     <span class="comment"># OK</span></span><br><span class="line">str3 = <span class="string">&#x27;&#x27;&#x27;I&#x27;m OK.&#x27;&#x27;&#x27;</span>            <span class="comment"># I&#x27;m OK.</span></span><br><span class="line">str4 = <span class="string">&quot;&quot;&quot;哈哈哈&quot;&quot;&quot;</span>              <span class="comment"># 哈哈哈</span></span><br><span class="line">str4 = <span class="string">&quot;I&#x27;m ok.&quot;</span>                <span class="comment"># I&#x27;m ok.</span></span><br><span class="line">str5 = <span class="string">&#x27;I\&#x27;m ok.&#x27;</span>               <span class="comment"># I&#x27;m ok.</span></span><br><span class="line">str6= <span class="string">&quot;I\&quot;m ok.&quot;</span>               <span class="comment"># I&quot;m ok.</span></span><br><span class="line">str7 = <span class="string">&#x27;I&quot;m ok.&#x27;</span>                <span class="comment"># I&quot;m ok.</span></span><br><span class="line">str8 = <span class="string">&quot;&quot;&quot;I&#x27;m &quot;Iron Man&quot;.&quot;&quot;&quot;</span>    <span class="comment"># I&#x27;m &quot;Iron Man&quot;.</span></span><br><span class="line">str9 = <span class="string">r&#x27;ab\ncd&#x27;</span>                 <span class="comment"># ab\ncd</span></span><br><span class="line">str0 = <span class="string">R&#x27;ab\ncd&#x27;</span>                 <span class="comment"># ab\ncd</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">str_1 = <span class="string">&#x27;&#x27;&#x27;这是一个段落，所以可以直接换行，不需反斜杠来声明语句未结束</span></span><br><span class="line"><span class="string">    直到遇到下一个三单引号，才认为结束</span></span><br><span class="line"><span class="string">但是换行会跟着换行，空格会跟着空格&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">str_1输出为：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">这是一个段落，所以可以直接换行，不需反斜杠来声明语句未结束</span></span><br><span class="line"><span class="string">    直到遇到下一个三单引号，才认为结束</span></span><br><span class="line"><span class="string">但是换行会跟着换行，空格会跟着空格</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">\n 换行    \t 缩进</span><br><span class="line"></span><br><span class="line"># 使用转义字符</span><br><span class="line">str_2 = &#x27;ab\ncd&#x27;</span><br><span class="line"></span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">str_2输出为：</span><br><span class="line">ab</span><br><span class="line">cd</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r&#x27;字符串&#x27; 表示不转义</span><br><span class="line"></span><br><span class="line"># 不转义</span><br><span class="line">str_3 = r&#x27;ab\ncd&#x27;    # ab\ncd</span><br></pre></td></tr></table></figure><p>转义字符</p><table><thead><tr><th align="center">转义字符</th><th align="center">描述</th></tr></thead><tbody><tr><td align="center">\</td><td align="center">续行符</td></tr><tr><td align="center">\</td><td align="center">反斜杠</td></tr><tr><td align="center">&#39;</td><td align="center">单引号</td></tr><tr><td align="center">&quot;</td><td align="center">双引号</td></tr><tr><td align="center">\a</td><td align="center">响铃</td></tr><tr><td align="center">\b</td><td align="center">退格</td></tr><tr><td align="center">\e</td><td align="center">转义</td></tr><tr><td align="center">\000</td><td align="center">空</td></tr><tr><td align="center">\n</td><td align="center">换行</td></tr><tr><td align="center">\v</td><td align="center">纵向制表符</td></tr><tr><td align="center">\t</td><td align="center">横向制表符</td></tr><tr><td align="center">\r</td><td align="center">回车</td></tr><tr><td align="center">\f</td><td align="center">换页</td></tr><tr><td align="center">\o</td><td align="center">八进制</td></tr><tr><td align="center">\x</td><td align="center">十六进制</td></tr></tbody></table><h2 id="下标"><a href="#下标" class="headerlink" title="下标"></a>下标</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">|  P  |  y  |  t  |  h  |  o  |  n  |</span><br><span class="line">   <span class="number">0</span>     <span class="number">1</span>     <span class="number">2</span>     <span class="number">3</span>     <span class="number">4</span>     <span class="number">5</span></span><br><span class="line">  -<span class="number">6</span>    -<span class="number">5</span>    -<span class="number">4</span>    -<span class="number">3</span>    -<span class="number">2</span>    -<span class="number">1</span></span><br></pre></td></tr></table></figure><h2 id="查找-find、index、rfind、rindex"><a href="#查找-find、index、rfind、rindex" class="headerlink" title="查找 find、index、rfind、rindex"></a>查找 find、index、rfind、rindex</h2><blockquote><p>s.find(sub[, start[, end]) -&gt; int<br>s.rfind(sub[, start[, end]) -&gt; int<br>s.index(sub[, start[, end]) -&gt; int<br>s.rindex(sub[, start[, end]) -&gt; int</p></blockquote><p>没r找第一个，有r找最后一个<br>find找不到返回-1，index找不到报错</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&#x27;abcdefghijkl abundance gg&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(s.find(<span class="string">&#x27;g&#x27;</span>))     <span class="comment"># 返回字符串中第一个 g 的下标：6</span></span><br><span class="line"><span class="built_in">print</span>(s.find(<span class="string">&#x27;z&#x27;</span>))     <span class="comment"># 找不到则返回 -1</span></span><br><span class="line"><span class="built_in">print</span>(s.index(<span class="string">&#x27;g&#x27;</span>))    <span class="comment"># 返回字符串中第一个 g 的下标：6</span></span><br><span class="line"><span class="built_in">print</span>(s.index(<span class="string">&#x27;z&#x27;</span>))    <span class="comment"># 找不到则报错</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(s.rfind(<span class="string">&#x27;g&#x27;</span>))    <span class="comment"># 返回字符串中最后一个 g 的下标：24</span></span><br><span class="line"><span class="built_in">print</span>(s.rfind(<span class="string">&#x27;z&#x27;</span>))    <span class="comment"># 找不到则返回 -1</span></span><br><span class="line"><span class="built_in">print</span>(s.rindex(<span class="string">&#x27;g&#x27;</span>))   <span class="comment"># 返回字符串中最后一个 g 的下标：24</span></span><br><span class="line"><span class="built_in">print</span>(s.rindex(<span class="string">&#x27;z&#x27;</span>))   <span class="comment"># 找不到则报错</span></span><br></pre></td></tr></table></figure><h2 id="判断"><a href="#判断" class="headerlink" title="判断"></a>判断</h2><table><thead><tr><th align="left">方法名</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">startswith(value)</td><td align="left">判断是否以 value 开始</td></tr><tr><td align="left">endswith(value)</td><td align="left">判断是否以 value 结束</td></tr><tr><td align="left">isalpha()</td><td align="left">判断是否全是字母</td></tr><tr><td align="left">isdigit()</td><td align="left">判断是否全是数字</td></tr><tr><td align="left">isalnum()</td><td align="left">判断是否全是字母或数字或字母+数字</td></tr><tr><td align="left">isdecimal()</td><td align="left">判断是否全是浮点数</td></tr><tr><td align="left">isnumeric()</td><td align="left">判断是否全是数值</td></tr><tr><td align="left">islower()</td><td align="left">判断是否全小写</td></tr><tr><td align="left">isupper()</td><td align="left">判断是否全大写</td></tr><tr><td align="left">isspace()</td><td align="left">判断是否全空格或\t或\n或\r</td></tr><tr><td align="left">istitle()</td><td align="left">判断是否所有单词都是首字母大写</td></tr></tbody></table><h3 id="isdigit-VS-isdecimal-VS-isnumeric"><a href="#isdigit-VS-isdecimal-VS-isnumeric" class="headerlink" title="isdigit() VS isdecimal() VS isnumeric()"></a>isdigit() VS isdecimal() VS isnumeric()</h3><p><strong>isdigit()</strong><br>True: Unicode数字，byte数字（单字节），全角数字（双字节），罗马数字<br>False: 汉字数字<br>Error: 无</p><p><strong>isdecimal()</strong><br>True: Unicode数字，，全角数字（双字节）<br>False: 罗马数字，汉字数字<br>Error: byte数字（单字节）</p><p><strong>isnumeric()</strong><br>True: Unicode数字，全角数字（双字节），罗马数字，汉字数字<br>False: 无<br>Error: byte数字（单字节）</p><h2 id="计数-count"><a href="#计数-count" class="headerlink" title="计数 count"></a>计数 count</h2><blockquote><p>s.count(sub[, start[, end]) -&gt; int</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&#x27;abcdefghijkl abundance gg&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(s.count(<span class="string">&#x27;g&#x27;</span>))        <span class="comment"># 3. 字母 g 一共出现了3次</span></span><br></pre></td></tr></table></figure><h2 id="替换-replace"><a href="#替换-replace" class="headerlink" title="替换 replace"></a>替换 replace</h2><blockquote><p>s.replace(old, new[, count]) -&gt; str<br>替换字符串中指定的内容，如果指定次数count， 则替换不会超过count次。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&#x27;abcdefghijkl abundance gg&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(s.replace(<span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;*&#x27;</span>))        <span class="comment"># abcdef*hijkl abundance **</span></span><br><span class="line"><span class="built_in">print</span>(s.replace(<span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;*&#x27;</span>, <span class="number">2</span>))     <span class="comment"># abcdef*hijkl abundance *g</span></span><br></pre></td></tr></table></figure><h2 id="分割-split、rsplit、partition、rpartition、splitlines"><a href="#分割-split、rsplit、partition、rpartition、splitlines" class="headerlink" title="分割 split、rsplit、partition、rpartition、splitlines"></a>分割 split、rsplit、partition、rpartition、splitlines</h2><blockquote><p><code>s.split(sep[, maxsplit]) -&gt; list[str]</code>：按 sep 分割，从左边开始，只分割两次<br><code>s.rsplit(sep[, maxsplit]) -&gt; list[str]</code>：按 sep 分割，从右边开始，只分割两次<br><code>s.patition(sep) -&gt; tuple(str, str, str)</code>：按 sep 分割，从左边开始，分成 (前部，分割符号，后部)<br><code>s.rpartition(sep) -&gt; tuple(str, str, str)</code>：按 sep 分割，从右边开始，分成 (前部，分割符号，后部)</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">s1 = <span class="string">&#x27;Alice,Boii,Candy,Dannis,Eva,Fiona&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(s1.split(<span class="string">&#x27;,&#x27;</span>))                    <span class="comment"># [&#x27;Alice&#x27;, &#x27;Boii&#x27;, &#x27;Candy&#x27;, &#x27;Dannis&#x27;, &#x27;Eva&#x27;, &#x27;Fiona&#x27;]</span></span><br><span class="line"><span class="built_in">print</span>(s1.split(<span class="string">&#x27;,&#x27;</span>, <span class="number">2</span>))                 <span class="comment"># [&#x27;Alice&#x27;, &#x27;Boii&#x27;, &#x27;Candy,Dannis,Eva,Fiona&#x27;]</span></span><br><span class="line"><span class="built_in">print</span>(s1.rsplit(<span class="string">&#x27;,&#x27;</span>, <span class="number">2</span>))                <span class="comment"># [&#x27;Alice,Boii,Candy,Dannis&#x27;, &#x27;Eva&#x27;, &#x27;Fiona&#x27;]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s2 = <span class="string">&#x27;2020.8.8拍摄.mp4&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(s2.partition(<span class="string">&#x27;.&#x27;</span>))                <span class="comment"># (&#x27;2020&#x27;, &#x27;.&#x27;, &#x27;8.8拍摄.mp4&#x27;)</span></span><br><span class="line"><span class="built_in">print</span>(s2.rpartition(<span class="string">&#x27;.&#x27;</span>))               <span class="comment"># (&#x27;2020.8.8拍摄&#x27;, &#x27;.&#x27;, &#x27;mp4&#x27;)</span></span><br></pre></td></tr></table></figure><blockquote><p><code>s.splitlines([keepends]) -&gt; list[str]</code>：按换行符（\n，\r，\r\n）分割<br>keepends – 在输出结果里是否保留换行符(‘\r’, ‘\r\n’, \n’)，默认为 False，不包含换行符，如果为 True，则保留换行符。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">str1 = <span class="string">&#x27;ab c\n\nde fg\rkl\r\n&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(str1.splitlines())        <span class="comment"># [&#x27;ab c&#x27;, &#x27;&#x27;, &#x27;de fg&#x27;, &#x27;kl&#x27;]</span></span><br><span class="line"></span><br><span class="line">str2 = <span class="string">&#x27;ab c\n\nde fg\rkl\r\n&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(str2.splitlines(<span class="literal">True</span>))    <span class="comment"># [&#x27;ab c\n&#x27;, &#x27;\n&#x27;, &#x27;de fg\r&#x27;, &#x27;kl\r\n&#x27;]</span></span><br></pre></td></tr></table></figure><h2 id="切片"><a href="#切片" class="headerlink" title="切片"></a>切片</h2><p>从字符串里截取一段指定的内容，生成一个新的字符串<br>切片都是<strong>包头不包尾</strong></p><p>具体参考 <a href="">高级特性-&gt;切片</a></p><h2 id="转换大小写"><a href="#转换大小写" class="headerlink" title="转换大小写"></a>转换大小写</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&#x27;hello woRlD.good mornIng&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将第一个字符转成大写，其他字符转成小写</span></span><br><span class="line"><span class="built_in">print</span>(s.capitalize())   <span class="comment"># Hello world.good morning</span></span><br><span class="line"><span class="comment"># 将全部字符转成大写</span></span><br><span class="line"><span class="built_in">print</span>(s.upper())        <span class="comment"># HELLO WORLD.GOOD MORNING</span></span><br><span class="line"><span class="comment"># 将全部字符转成小写</span></span><br><span class="line"><span class="built_in">print</span>(s.lower())        <span class="comment"># hello world.good morning</span></span><br><span class="line"><span class="comment"># 将每个单词首字母转成大写</span></span><br><span class="line"><span class="built_in">print</span>(s.title())        <span class="comment"># Hello World.Good Morning</span></span><br></pre></td></tr></table></figure><h2 id="填充"><a href="#填充" class="headerlink" title="填充"></a>填充</h2><blockquote><p><code>s.ljust(weight, fillchar=&#39;&#39;) -&gt; str</code><br><code>s.rjust(weight, fillchar=&#39;&#39;) -&gt; str</code><br><code>s.center(weight, fillchar=&#39;&#39;) -&gt; str</code></p></blockquote><p>不足 weight 的话，用 fillchar 填充，fillchar默认空格</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;|&#x27;</span> + <span class="string">&#x27;Monday&#x27;</span>.ljust(<span class="number">10</span>) + <span class="string">&#x27;|&#x27;</span>)        <span class="comment"># |Monday    |</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;|&#x27;</span> + <span class="string">&#x27;Monday&#x27;</span>.ljust(<span class="number">10</span>, <span class="string">&#x27;^&#x27;</span>) + <span class="string">&#x27;|&#x27;</span>)   <span class="comment"># |Monday^^^^|</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;|&#x27;</span> + <span class="string">&#x27;Monday&#x27;</span>.rjust(<span class="number">10</span>) + <span class="string">&#x27;|&#x27;</span>)        <span class="comment"># |    Monday|</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;|&#x27;</span> + <span class="string">&#x27;Monday&#x27;</span>.rjust(<span class="number">10</span>, <span class="string">&#x27;#&#x27;</span>) + <span class="string">&#x27;|&#x27;</span>)   <span class="comment"># |####Monday|</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;|&#x27;</span> + <span class="string">&#x27;Friday&#x27;</span>.center(<span class="number">20</span>, <span class="string">&#x27;*&#x27;</span>) + <span class="string">&#x27;|&#x27;</span>)  <span class="comment"># |*******Friday*******|</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;|&#x27;</span> + <span class="string">&#x27;Friday&#x27;</span>.center(<span class="number">4</span>, <span class="string">&#x27;*&#x27;</span>) + <span class="string">&#x27;|&#x27;</span>)   <span class="comment"># |Friday|</span></span><br></pre></td></tr></table></figure><h2 id="修剪"><a href="#修剪" class="headerlink" title="修剪"></a>修剪</h2><blockquote><p><code>s.lstrip(chars) -&gt; str</code><br><code>s.rstrip(chars) -&gt; str</code><br><code>s.strip(chars) -&gt; str</code></p></blockquote><p>删除字符串 左边 / 右边 / 左边+右边 的 chars 字符</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;|&#x27;</span> + <span class="string">&#x27;   Couldy Sunny   &#x27;</span>.lstrip() + <span class="string">&#x27;|&#x27;</span>)      <span class="comment"># |Couldy Sunny   |</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;|&#x27;</span> + <span class="string">&#x27;   Couldy Sunny   &#x27;</span>.rstrip() + <span class="string">&#x27;|&#x27;</span>)      <span class="comment"># |   Couldy Sunny|</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;|&#x27;</span> + <span class="string">&#x27;   Couldy Sunny   &#x27;</span>.strip() + <span class="string">&#x27;|&#x27;</span>)       <span class="comment"># |Couldy Sunny|</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;|&#x27;</span> + <span class="string">&#x27;   Couldy+Sunny+++&#x27;</span>.lstrip(<span class="string">&#x27;+&#x27;</span>) + <span class="string">&#x27;|&#x27;</span>)   <span class="comment"># |   Couldy+Sunny+++|</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;|&#x27;</span> + <span class="string">&#x27;   Couldy+Sunny+++&#x27;</span>.rstrip(<span class="string">&#x27;+&#x27;</span>) + <span class="string">&#x27;|&#x27;</span>)   <span class="comment"># |   Couldy+Sunny|</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;|&#x27;</span> + <span class="string">&#x27;   Couldy+Sunny+++&#x27;</span>.strip(<span class="string">&#x27;+&#x27;</span>) + <span class="string">&#x27;|&#x27;</span>)    <span class="comment"># |   Couldy+Sunny|</span></span><br></pre></td></tr></table></figure><h2 id="拼接"><a href="#拼接" class="headerlink" title="拼接"></a>拼接</h2><blockquote><p><code>s.join(iterable) -&gt; str</code><br>将 s 拼接到 iterable 的每一个元素上</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">li = [<span class="string">&#x27;Alice&#x27;</span>, <span class="string">&#x27;Boii&#x27;</span>, <span class="string">&#x27;Candy&#x27;</span>, <span class="string">&#x27;Dannis&#x27;</span>, <span class="string">&#x27;Eva&#x27;</span>, <span class="string">&#x27;Fiona&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27; - &#x27;</span>.join(li))       <span class="comment"># Alice - Boii - Candy - Dannis - Eva - Fiona</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;+&#x27;</span>.join(<span class="string">&#x27;Hello&#x27;</span>))    <span class="comment"># H+e+l+l+o</span></span><br><span class="line"></span><br><span class="line">dic = &#123;<span class="string">&#x27;name1&#x27;</span>: <span class="string">&#x27;Alice&#x27;</span>, <span class="string">&#x27;name2&#x27;</span>: <span class="string">&#x27;Boii&#x27;</span>&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27; - &#x27;</span>.join(dic))      <span class="comment"># name1 - name2</span></span><br></pre></td></tr></table></figure><h2 id="编码"><a href="#编码" class="headerlink" title="编码"></a>编码</h2><ul><li><strong>ASCII</strong><br>  0~127共128个，占用 1byte 即 8bit 的长度，共使用了7位的长度，从0000 0000 到 0111 1111。<br>  48-57 -&gt; 0-9，65-90 -&gt; A-Z，97-122 -&gt; a-z</li><li><strong>ISO-8859-1</strong><br>  0<del>255共256个，占用 1byte 即 8bit 的长度，共使用了8位的长度，从 0000 0000到1111 1111。<br>  0</del>127与ASCII完全兼容，128~255是一些欧洲字母</li><li><strong>Unicode</strong><br>  万国码，汉字每个占 3byte</li><li><strong>GBK</strong><br>  国标扩，汉字每个占 2byte</li></ul><h2 id="长度"><a href="#长度" class="headerlink" title="长度"></a>长度</h2><h2 id="格式化"><a href="#格式化" class="headerlink" title="格式化"></a>格式化</h2><h2 id="不可变性"><a href="#不可变性" class="headerlink" title="不可变性"></a>不可变性</h2><p>字符串是不可变对象。<br>当执行一个 <code>str = &#39;abc&#39;</code> 的语句时，<br>python在字符串池中创建了一个字符串 <code>&#39;abc&#39;</code> ，<br>然后在内存中创建一个变量 <code>str</code>指向字符串池中的 <code>&#39;abc&#39;</code></p><p>如果对<code>str</code>进行修改 <code>str = &#39;xyz&#39;</code><br>python会在字符串池中再创建一个字符串 <code>&#39;xyz&#39;</code>，<br>然后让变量 <code>str</code> 指向字符串池中的 <code>&#39;xyz&#39;</code><br>此时字符串池其实有 <code>&#39;abc&#39;</code> 和 <code>&#39;xyz&#39;</code>，只不过<code>&#39;abc&#39;</code>没有被指向， <code>&#39;xyz&#39;</code> 被<code>str</code>指向</p><blockquote><p>所以，对于不变对象来说，<br>调用对象自身的任意方法，也不会改变该对象自身的内容。<br>相反，这些方法会创建新的对象并返回<br>这样，就保证了不可变对象本身永远是不可变的。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
          <category> 基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python【Feature】函数式编程</title>
      <link href="posts/31044"/>
      <url>posts/31044</url>
      
        <content type="html"><![CDATA[<p>Python的高级特性2</p><span id="more"></span><p>函数式编程的一个特点就是，允许把函数本身作为参数传入另一个函数，还允许返回一个函数！</p><h2 id="函数的本质"><a href="#函数的本质" class="headerlink" title="函数的本质"></a>函数的本质</h2><p>在学C语言指针的时候，会接触到一个概念：函数名是函数所在内存的地址，类似-数组名是数组的首元素的地址。</p><p>即使Python中没有指针一说，但是本质还是一样的。<br>变量名是一个变量的地址<br>函数名是一个函数的地址<br>调用函数的时候其实是把参数传到函数本身所在的那块内存中去，函数名不过是一个媒介而已。<br>在C中可以说，函数名就是个指针，指向一个函数<br>在Python中可以说，函数名就是个变量，指向一个函数</p><p>既然函数名只是指向函数本身所在地址，那我换个名来指不也可以。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sum</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line">f = <span class="built_in">sum</span></span><br><span class="line">f(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">---------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure><p>如果放到交互模式中，可以更明显的看出来</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义一个函数</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">sum</span>(<span class="params">a, b</span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> a + b</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">sum</span></span><br><span class="line">&lt;function <span class="built_in">sum</span> at <span class="number">0x000001F25AF6B280</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f=<span class="built_in">sum</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f</span><br><span class="line">&lt;function <span class="built_in">sum</span> at <span class="number">0x000001F25AF6B280</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"><span class="number">7</span></span><br></pre></td></tr></table></figure><p>大概就这么回事儿</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/No-Feature-1.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/No-Feature-1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="1"></p><h2 id="高阶函数"><a href="#高阶函数" class="headerlink" title="高阶函数"></a>高阶函数</h2><blockquote><p>高阶函数：接受函数作为参数的函数<br><code>def heigh_fn(a, b, fn)</code></p></blockquote><p>既然变量可以指向函数，函数的参数能接收变量，那么一个函数就可以接收另一个函数作为参数，这种函数就称之为高阶函数。</p><p>一个最简单的高阶函数：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">abs</span>(<span class="params">num</span>):</span></span><br><span class="line">    <span class="keyword">return</span> (num) <span class="keyword">if</span> num &gt;= <span class="number">0</span> <span class="keyword">else</span> (-num)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">abs_add</span>(<span class="params">a, b, fn</span>):</span></span><br><span class="line">    <span class="keyword">return</span> fn(a) + fn(b)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(abs_add(<span class="number">8</span>, -<span class="number">4</span>, <span class="built_in">abs</span>))</span><br><span class="line"></span><br><span class="line">---------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line"><span class="number">12</span></span><br></pre></td></tr></table></figure><p>这个高阶函数的过程大概是这样的<br>a = 8<br>b = -4<br>fn = abs<br>fn(a) + fn(b) ==&gt; abs(8) + abs(-4) ==&gt; 12</p><h2 id="返回函数"><a href="#返回函数" class="headerlink" title="返回函数"></a>返回函数</h2><blockquote><p>返回函数：返回值为函数的函数</p></blockquote><p>通常函数都是返回int、str、list 这些变量，但是变量可以指向函数，<br>那函数可以返回一个变量，不就也可以返回一个函数。</p><p>举个栗子<br>实现一个求和函数。参数可变，可以是1个也可以是多个。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cal_sum</span>(<span class="params">*args</span>):</span></span><br><span class="line">    <span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> args:</span><br><span class="line">        <span class="built_in">sum</span> += n</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sum</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">result = cal_sum(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line">---------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line"><span class="number">15</span></span><br></pre></td></tr></table></figure><p>好，现在再写一个函数<code>lazy_sum()</code>，把这个函数<code>cal_sum()</code>作为返回值返回</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lazy_sum</span>(<span class="params">*args</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">cal_sum</span>():</span></span><br><span class="line">        <span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> args:</span><br><span class="line">            <span class="built_in">sum</span> += n</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span></span><br><span class="line">    <span class="keyword">return</span> cal_sum</span><br></pre></td></tr></table></figure><p>可以看到最后一句<code>return cal_sum</code>就把函数返回出来了。<br>那么函数<code>lazy_sum()</code>就是一个返回函数</p><p>现在调用一下这个返回函数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lazy_sum</span>(<span class="params">*args</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;I am the return function.&#x27;</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">cal_sum</span>():</span></span><br><span class="line">        <span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> args:</span><br><span class="line">            <span class="built_in">sum</span> += n</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span></span><br><span class="line">    <span class="keyword">return</span> cal_sum</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">result = lazy_sum(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line">---------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">I am the <span class="keyword">return</span> function.</span><br><span class="line">&lt;function lazy_sum.&lt;<span class="built_in">locals</span>&gt;.cal_sum at <span class="number">0x000001C8765CB310</span>&gt;</span><br></pre></td></tr></table></figure><p>哦嚯，<code>lazy_sum()</code>没有进行计算，但也看出来，<code>lazy_sum()</code>返回的是一个函数<br><code>result</code>此时是一个函数，这时候我们要去调用一次返回值<code>result</code>，才会进行计算</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lazy_sum</span>(<span class="params">*args</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;I am the return function.&#x27;</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">cal_sum</span>():</span></span><br><span class="line">        <span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> args:</span><br><span class="line">            <span class="built_in">sum</span> += n</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span></span><br><span class="line">    <span class="keyword">return</span> cal_sum</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">result = lazy_sum(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line">res = result()</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line">---------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">I am the <span class="keyword">return</span> function.</span><br><span class="line">&lt;function lazy_sum.&lt;<span class="built_in">locals</span>&gt;.cal_sum at <span class="number">0x000001E02D07B310</span>&gt;</span><br><span class="line"><span class="number">15</span></span><br></pre></td></tr></table></figure><p>这就是为什么说 返回函数是<code>惰性</code>的。就是这么来的</p><h3 id="为什么要返回一个函数"><a href="#为什么要返回一个函数" class="headerlink" title="为什么要返回一个函数"></a>为什么要返回一个函数</h3><p>在<code>lazy_sum()</code>中，有一句<code>print</code>语句。<br>从输出中可以看出，返回函数本身是立即执行的，但是它返回出来的函数要再进行一次调用才会执行。</p><p>单独一个返回函数并没有太大作用，但是返回函数和高阶函数结合起来，是不是就有意思了。<br>接收一个函数，然后把这个函数返回出去。在返回之前是不是可以进行一些操作？</p><p>假如现在有一个需求：求和；实现完了之后，产品经理又加需求：除了<code>求和</code>还要打印一下求和用了多长时间，也就是<code>计时功能</code>。<br>那么现在你有两个办法</p><ul><li>一是在<code>求和函数</code>里实现这个<code>计时功能</code>，但是这样就在一个函数里做了两件事情。即不优雅，也不好维护。这里举例是简单的求和，实际开发中可能是跟复杂的功能。</li><li>二是把<code>计时函数</code>写出来，然后把<code>求和函数</code>传给<code>计时函数</code>，在<code>计时函数</code>中给<code>求和函数</code>加上<code>计时功能</code>，之后再把这个<code>有计时功能的求和函数</code>返回出去。</li></ul><p><code>计时函数</code>这种<code>接收函数 -&gt; 增强函数 -&gt; 返回函数</code>的函数就叫<code>闭包</code></p><p>不仅可以用在<code>计时功能</code>，还能用在<code>日志功能</code>，我只要把<code>求和函数</code>写好，传给<code>日志函数</code>就可以获得<code>日志功能</code>。<br>函数只做一件事情，其他事情由别的函数做，需要什么功能把函数往里面一丢，还你一个增强版的。Amazing！这就叫<code>面向切面编程</code></p><h2 id="闭包、装饰器、面向切面编程"><a href="#闭包、装饰器、面向切面编程" class="headerlink" title="闭包、装饰器、面向切面编程"></a>闭包、装饰器、面向切面编程</h2><h3 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h3><blockquote><p>闭包 = 高阶函数 + 返回函数<br>即，一个<code>接收函数作为参数，又返回一个函数</code>的函数，就叫做闭包<br>作用：增强函数功能、面向切面编程（AOP）</p></blockquote><h4 id="无参闭包"><a href="#无参闭包" class="headerlink" title="无参闭包"></a>无参闭包</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_hello</span>():</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;hello!&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cal_time</span>(<span class="params">fn</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">improve_fn</span>():</span></span><br><span class="line">        start_time = time.time()</span><br><span class="line">        fn()</span><br><span class="line">        end_time = time.time()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;耗时：&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(end_time - start_time))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> improve_fn</span><br><span class="line"></span><br><span class="line">improve_print_hello = cal_time(print_hello)</span><br><span class="line">improve_print_hello()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 也可以写做 cal_time(print_hello)()</span></span><br><span class="line"></span><br><span class="line">---------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">hello!</span><br><span class="line">耗时：<span class="number">0.0009620189666748047</span></span><br></pre></td></tr></table></figure><p>栗子中，<code>print_hello()</code>只负责打印hello，<code>cal_time()</code>负责把传进来的函数增强然后返回出去<br>所以<code>cal_time</code>就是一个闭包</p><h4 id="带参闭包"><a href="#带参闭包" class="headerlink" title="带参闭包"></a>带参闭包</h4><p>上面的栗子，<code>print_hello()</code>不需要参数，所以在无参闭包中可以顺利通过<br>但是如果一个函数有参，那无参闭包就会抛出<code>TypeError</code>错误。</p><p>想要带参很简单。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(a + b)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cal_time</span>(<span class="params">fn</span>):</span></span><br><span class="line marked">    <span class="function"><span class="keyword">def</span> <span class="title">improve_fn</span>(<span class="params">*args, **kwargs</span>):</span>    <span class="comment"># 在这里写下形参</span></span><br><span class="line">        start_time = time.time()</span><br><span class="line marked">        fn(*args, **kwargs)        <span class="comment"># 调用的时候传进去</span></span><br><span class="line">        end_time = time.time()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;耗时：&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(end_time - start_time))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> improve_fn</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cal_time(add)(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">---------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line">耗时：<span class="number">0.00800633430480957</span></span><br></pre></td></tr></table></figure><h4 id="接收的函数有返回值"><a href="#接收的函数有返回值" class="headerlink" title="接收的函数有返回值"></a>接收的函数有返回值</h4><p>接收的函数有返回值的话，应该在闭包里对函数调用的时候把参数接收下来，然后进行返回。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cal_time</span>(<span class="params">fn</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">improve_fn</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">        start_time = time.time()</span><br><span class="line">        count = fn(*args, **kwargs)     <span class="comment"># 调用函数之后用一个变量接收返回值</span></span><br><span class="line">        end_time = time.time()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;耗时：&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(end_time - start_time))</span><br><span class="line">        <span class="keyword">return</span> count                    <span class="comment"># 然后把返回值返回出去</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> improve_fn</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">result = cal_time(add)(<span class="number">5</span>, <span class="number">12</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line">---------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">耗时：<span class="number">0.0009620189666748047</span></span><br><span class="line"><span class="number">17</span></span><br></pre></td></tr></table></figure><h3 id="装饰器"><a href="#装饰器" class="headerlink" title="装饰器"></a>装饰器</h3><blockquote><p>装饰器是闭包的语法糖——<code>@闭包名</code>或<code>@闭包名(参数)</code><br>语法糖只是一个更方便的写法，完全可以等价转换为非语法糖的代码</p></blockquote><p>装饰器、闭包，本质上也是函数，说装饰器的同时也是在说闭包</p><h4 id="保留原函数的元信息"><a href="#保留原函数的元信息" class="headerlink" title="保留原函数的元信息"></a>保留原函数的元信息</h4><p>装饰器（闭包）的原理就是把原函数当作参数传进装饰器中，经过增强后返回一个新的<code>增强版原函数</code><br>这说明返回出来的<code>增强版函数</code>和原来的函数不是同一个了（在内存中创建了一个新的）</p><p>既然不是在原函数上进行改造，这就导致函数的元信息（文档字符串、注解、参数签名等）都丢失了<br>解决方法就是使用<code>functools</code>库中的<code>@wraps</code>装饰器来把原函数的元信息复制过来。</p><p>先看看<code>不</code>保留元信息的样子</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 装饰器函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cal_time</span>(<span class="params">fn</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    Decorator that report the execution time.</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">improve_fn</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">        start = time.time()</span><br><span class="line">        result = fn(*args, **kwargs)</span><br><span class="line">        end = time.time()</span><br><span class="line">        <span class="built_in">print</span>(fn.__name__, end - start)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> improve_fn</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 原函数</span></span><br><span class="line"><span class="meta">@cal_time</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">countdown</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    Count down</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">        n -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    countdown(<span class="number">10_000</span>)</span><br><span class="line">    <span class="built_in">print</span>(countdown.__doc__)    <span class="comment"># 没有使用wrap，所以元信息都丢失了</span></span><br><span class="line"></span><br><span class="line">---------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">countdown <span class="number">0.0010008811950683594</span></span><br><span class="line"><span class="literal">None</span></span><br></pre></td></tr></table></figure><p>再看看使用了<code>@wraps</code>的样子</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"></span><br><span class="line"><span class="comment"># 装饰器函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cal_time</span>(<span class="params">fn</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    Decorator that report the execution time.</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="meta">    @wraps(<span class="params">fn</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">improve_fn</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">        start = time.time()</span><br><span class="line">        result = fn(*args, **kwargs)</span><br><span class="line">        end = time.time()</span><br><span class="line">        <span class="built_in">print</span>(fn.__name__, end - start)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> improve_fn</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 原函数</span></span><br><span class="line"><span class="meta">@cal_time</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">countdown</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    Count down</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">        n -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    countdown(<span class="number">10000</span>)</span><br><span class="line">    <span class="built_in">print</span>(countdown.__doc__)    <span class="comment"># 使用了wrap，所以元信息没有丢失</span></span><br><span class="line"></span><br><span class="line">---------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">countdown <span class="number">0.0010025501251220703</span></span><br><span class="line"></span><br><span class="line">    Count down</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="无参装饰器"><a href="#无参装饰器" class="headerlink" title="无参装饰器"></a>无参装饰器</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cal_time</span>(<span class="params">fn</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    Decorator that report the execution time.</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="meta">    @wraps(<span class="params">fn</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">improve_fn</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">        start = time.time()</span><br><span class="line">        result = fn(*args, **kwargs)</span><br><span class="line">        end = time.time()</span><br><span class="line">        <span class="built_in">print</span>(fn.__name__, <span class="string">&#x27;used time:&#x27;</span>, end - start)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> improve_fn</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 装饰器里不需要携带参数</span></span><br><span class="line"><span class="meta">@cal_time</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line">res = add(<span class="number">5</span>, <span class="number">6</span>)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 等价于</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># def add(a, b):</span></span><br><span class="line"><span class="comment">#     return a + b</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># improve_add = cal_time(add)</span></span><br><span class="line"><span class="comment"># res = improve_add(5, 6)</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">---------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">add used time: <span class="number">0.0</span></span><br><span class="line"><span class="number">11</span></span><br></pre></td></tr></table></figure><h4 id="带参装饰器"><a href="#带参装饰器" class="headerlink" title="带参装饰器"></a>带参装饰器</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cal_time</span>(<span class="params">msg</span>):</span>    <span class="comment"># 第一层，接收装饰器参数</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;First floor:&#x27;</span>, msg)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorator</span>(<span class="params">fn</span>):</span>    <span class="comment"># 第二层，接收函数</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Second floor:&#x27;</span>, msg)</span><br><span class="line"></span><br><span class="line"><span class="meta">        @wraps(<span class="params">fn</span>)</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">improve_fn</span>(<span class="params">*args, **kwargs</span>):</span>    <span class="comment"># 第三层，增强函数</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Third floor:&#x27;</span>, msg)</span><br><span class="line"></span><br><span class="line">            start = time.time()</span><br><span class="line">            result = fn(*args, **kwargs)</span><br><span class="line">            end = time.time()</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Used time:&#x27;</span>, end - start)</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> improve_fn</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> decorator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@cal_time(<span class="params"><span class="string">&#x27;I am the message.&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">countdown</span>(<span class="params">time=<span class="number">10000</span></span>):</span></span><br><span class="line">    <span class="keyword">while</span> time &gt; <span class="number">0</span>:</span><br><span class="line">        time -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    countdown()</span><br><span class="line"></span><br><span class="line">---------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">First floor: I am the message.</span><br><span class="line">Second floor: I am the message.</span><br><span class="line">Third floor: I am the message.</span><br><span class="line">Used time: <span class="number">0.000997781753540039</span></span><br></pre></td></tr></table></figure><p>有参装饰器和无参装饰器的区别仅仅只是多了一层函数而已<br>也就是在无参装饰器的基础上多一层函数来接收装饰器参数而已。<strong>注意带参装饰器即使不填参数也要写上括号</strong></p><blockquote><p>装饰器只在第一次被调用去装饰函数时对原函数进行增强</p><ul><li>增强时机：第一调用之前</li><li>增强次数：只增强一次</li></ul></blockquote><h3 id="面向切面编程"><a href="#面向切面编程" class="headerlink" title="面向切面编程"></a>面向切面编程</h3><p>如果说类里面的继承是纵向继承，那面向切面编程可以理解为横向继承</p><p>纵向继承中，子类继承了父类非私有属性和方法；同属一个父类的子类都有相同的父类属性和方法<br>横向继承中，是给子类增加了一些功能；同属一个父类的子类不见得有相同的功能。</p><p>就好比，一个爹生了两个娃，两个娃都有手有脚的，这是继承自爹那里的（纵向继承）<br>但是一个娃点亮了游泳的技能，另一个娃点亮了跳舞的技能（横向继承）<br>这俩娃生了俩孙子，肯定也是有手有脚的，但不一定会游泳跳舞。</p><p>所以面向切面编程中，这种闭包、装饰器之类的通常是用在编写通用工具类上。</p><h2 id="匿名函数"><a href="#匿名函数" class="headerlink" title="匿名函数"></a>匿名函数</h2><blockquote><p><code>lambda [parameters]: expression</code><br>冒号前面的<code>parameters</code>表示匿名函数的形参列表，冒号后面的<code>expression</code>表示要return的语句<br><code>parameters</code>可以有也可以没有。<br>匿名函数有个限制——<strong>只能有一个表达式</strong>，不用写<code>return</code>，返回值就是该表达式的结果。</p></blockquote><p>匿名函数类似于 es6 中的简头函数</p><p>举个栗子：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br></pre></td></tr></table></figure><p>写成匿名函数就是</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">lambda</span> a, b: a + b</span><br></pre></td></tr></table></figure><p>写成简头函数就是</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(a, b) =&gt; a + b</span><br></pre></td></tr></table></figure><p>匿名函数可以作为实参、返回值，在这些场景中应用的比较多。</p><p>匿名函数作为实参</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 普通写法</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">abs</span>(<span class="params">num</span>):</span></span><br><span class="line">    <span class="keyword">return</span> (num) <span class="keyword">if</span> num &gt;= <span class="number">0</span> <span class="keyword">else</span> (-num)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">abs_add</span>(<span class="params">a, b, fn</span>):</span></span><br><span class="line">    <span class="keyword">return</span> fn(a) + fn(b)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(abs_add(<span class="number">8</span>, -<span class="number">4</span>, <span class="built_in">abs</span>))</span><br><span class="line"></span><br><span class="line">---------------------------------</span><br><span class="line"><span class="comment"># 匿名函数写法</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">abs_add</span>(<span class="params">a, b, fn</span>):</span></span><br><span class="line">    <span class="keyword">return</span> fn(a) + fn(b)</span><br><span class="line"></span><br><span class="line">result = abs_add(<span class="number">8</span>, -<span class="number">4</span>, <span class="keyword">lambda</span> x: x <span class="keyword">if</span> x &gt;= <span class="number">0</span> <span class="keyword">else</span> -x)    <span class="comment"># 匿名函数作为实参</span></span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line">---------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line"><span class="number">12</span></span><br></pre></td></tr></table></figure><p>匿名函数作为返回值</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">build</span>(<span class="params">x, y</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">lambda</span>: x * x + y * y        <span class="comment"># 匿名函数作为返回值</span></span><br><span class="line"></span><br><span class="line">build(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">---------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line"><span class="number">13</span></span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol><li>函数名的本质：函数起始地址</li><li>高阶函数：接收函数作为参数的函数</li><li>返回函数：返回一个函数（即返回一个函数地址）的函数，是惰性的</li><li>闭包：接收函数作为参数，并返回一个函数的函数（闭包=高阶函数+返回函数）</li><li>装饰器：闭包的语法糖，@闭包名字</li><li>匿名函数：<code>lambda 参数: 返回值</code></li></ol>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
          <category> 高级特性 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> 函数式编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python【Feature】工具类</title>
      <link href="posts/18591"/>
      <url>posts/18591</url>
      
        <content type="html"><![CDATA[<p>Python的高级特性3</p><span id="more"></span><h2 id="map"><a href="#map" class="headerlink" title="map"></a>map</h2><p>将传入的函数作用于可迭代对象的每一个元素上</p><blockquote><p><code>map(function, iterable)</code><br>参数：map 可以接受两个参数，第一个是函数，第二个是可迭代对象<br>作用：将可迭代对象的每一个元素放在 function 中进行处理<br>返回：map 返回的是一个 map 对象，这是一个可迭代对象</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/No-Feature-map.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/No-Feature-map.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="map"></p><p>举个栗子：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用map示例</span></span><br><span class="line">alpha = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;z&#x27;</span>]</span><br><span class="line">m = <span class="built_in">map</span>(<span class="keyword">lambda</span> x: x + <span class="string">&#x27;i&#x27;</span>, alpha)</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>(m))    <span class="comment"># 返回的map对象用m接收，然后转换成列表，打印出来</span></span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">&lt;<span class="built_in">map</span> <span class="built_in">object</span> at <span class="number">0x000001D50CEBAD00</span>&gt;</span><br><span class="line">[<span class="string">&#x27;ai&#x27;</span>, <span class="string">&#x27;bi&#x27;</span>, <span class="string">&#x27;ci&#x27;</span>, <span class="string">&#x27;xi&#x27;</span>, <span class="string">&#x27;yi&#x27;</span>, <span class="string">&#x27;zi&#x27;</span>]</span><br></pre></td></tr></table></figure><p>如果不使用 map 函数，应该这样写</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 不适用map的示例</span></span><br><span class="line">alpha = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;z&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_alpha</span>(<span class="params">list1</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; 遍历list1，每个元素都加上 i 然后放进 list2 中 &quot;&quot;&quot;</span></span><br><span class="line">    list2 = <span class="built_in">list</span>()</span><br><span class="line">    <span class="keyword">for</span> alpha <span class="keyword">in</span> list1:</span><br><span class="line">        list2.append(alpha + <span class="string">&#x27;i&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> list2</span><br><span class="line"></span><br><span class="line">m = add_alpha(alpha)</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(m))</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">[<span class="string">&#x27;ai&#x27;</span>, <span class="string">&#x27;bi&#x27;</span>, <span class="string">&#x27;ci&#x27;</span>, <span class="string">&#x27;xi&#x27;</span>, <span class="string">&#x27;yi&#x27;</span>, <span class="string">&#x27;zi&#x27;</span>]</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">list</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure><p>效果是一样的，但是并没有像 map 那么简洁</p><p>同样，上面的示例还可以使用更简洁的办法，用列表生成式<br>前提是其逻辑比较简单，如果复杂还是要另外编写 操作函数，然后传给 map()</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">alpha = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;z&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span>([x + <span class="string">&#x27;i&#x27;</span> <span class="keyword">for</span> x <span class="keyword">in</span> alpha])</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">[<span class="string">&#x27;ai&#x27;</span>, <span class="string">&#x27;bi&#x27;</span>, <span class="string">&#x27;ci&#x27;</span>, <span class="string">&#x27;xi&#x27;</span>, <span class="string">&#x27;yi&#x27;</span>, <span class="string">&#x27;zi&#x27;</span>]</span><br></pre></td></tr></table></figure><p>此外，因为返回出来的已经不是原本放进去的可迭代对象了，所以即使元组不能修改，map 也能进行操作</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对元组进行操作</span></span><br><span class="line">m = (<span class="number">12</span>, <span class="number">23</span>, <span class="number">28</span>, <span class="number">19</span>, <span class="number">16</span>, <span class="number">30</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;m source:  &#x27;</span>, <span class="built_in">id</span>(m))    <span class="comment"># 打印原元组的地址</span></span><br><span class="line">m = <span class="built_in">map</span>(<span class="keyword">lambda</span> x: x * x, m)    <span class="comment"># 对元组进行操作</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;m operated:&#x27;</span>, <span class="built_in">id</span>(m))    <span class="comment"># 打印修改后元组的地址</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;m is a&#x27;</span>, m)             <span class="comment"># 打印结果显示 m 是个 map对象</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>(m))                 <span class="comment"># 把 m 转成列表打印出来</span></span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">m source:   <span class="number">2599500087840</span></span><br><span class="line">m operated: <span class="number">2599500555024</span></span><br><span class="line">m <span class="keyword">is</span> a &lt;<span class="built_in">map</span> <span class="built_in">object</span> at <span class="number">0x0000025D3E4EA310</span>&gt;</span><br><span class="line">[<span class="number">144</span>, <span class="number">529</span>, <span class="number">784</span>, <span class="number">361</span>, <span class="number">256</span>, <span class="number">900</span>]</span><br></pre></td></tr></table></figure><h2 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h2><p>对可迭代对象进行过滤<br>Python2 中 filter 是个内置函数, Python3 中 filter 是个内置类</p><blockquote><p><code>filter(condition_function, iterable)</code><br>参数：filter 可以接收两个参数，第一个是函数，第二个是可迭代对象<br>作用：将 可迭代对象 的每一个元素放在 function 中进行过滤，满足 function 中的过滤规则便返回<br>返回：filter 返回的是一个 filter对象，这是一个可迭代对象。</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/No-Feature-filter.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/No-Feature-filter.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="filter"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># filter 示例</span></span><br><span class="line">f = [<span class="number">12</span>, <span class="number">23</span>, <span class="number">28</span>, <span class="number">19</span>, <span class="number">16</span>, <span class="number">30</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;f source:  &#x27;</span>, <span class="built_in">id</span>(f))             <span class="comment"># 打印原元组的地址</span></span><br><span class="line">f = <span class="built_in">filter</span>(<span class="keyword">lambda</span> x: x &gt;= <span class="number">18</span>, f)        <span class="comment"># 对 列表进行过滤，过滤出大于等于18的元素</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;f operated:&#x27;</span>, <span class="built_in">id</span>(f))             <span class="comment"># 打印修改后元组的地址</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;f is a&#x27;</span>, f)                      <span class="comment"># 打印结果显示 f 是个 filter对象</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>(f))                          <span class="comment"># 把 f 转成列表打印出来</span></span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">f source:   <span class="number">2379695132608</span></span><br><span class="line">f operated: <span class="number">2379696090368</span></span><br><span class="line">f <span class="keyword">is</span> a &lt;<span class="built_in">filter</span> <span class="built_in">object</span> at <span class="number">0x0000022A10F0AD00</span>&gt;</span><br><span class="line">[<span class="number">23</span>, <span class="number">28</span>, <span class="number">19</span>, <span class="number">30</span>]</span><br></pre></td></tr></table></figure><p>同样，filter 也可以对元组操作，简单的过滤规则也可以用列表生成式代替</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用列表生成式实现简单过滤</span></span><br><span class="line">f = [<span class="number">12</span>, <span class="number">23</span>, <span class="number">28</span>, <span class="number">19</span>, <span class="number">16</span>, <span class="number">30</span>]</span><br><span class="line"><span class="built_in">print</span>([x <span class="keyword">for</span> x <span class="keyword">in</span> f <span class="keyword">if</span> x &gt;= <span class="number">18</span>])</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">[<span class="number">23</span>, <span class="number">28</span>, <span class="number">19</span>, <span class="number">30</span>]</span><br></pre></td></tr></table></figure><h2 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h2><p>reduce 不是内置函数，必须导入</p><blockquote><p><code>from functools import reduce</code><br><code>reduce(function, sequence, initial=_initial_missing)</code></p></blockquote><p>参数：reduce 第一个参数接收一个带两个形参的函数，第二个参数接收一个序列<br>作用：把函数作用在一个序列上，函数必须接收两个参数，reduce 把结果继续和序列的下一个元素做累计运算<br>返回：一个计算结果</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/No-Feature-reduce.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/No-Feature-reduce.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="reduce"></p><p>听起来有点绕，用示例解释</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>(<span class="params">x, y</span>):</span></span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line"></span><br><span class="line">scores = [<span class="number">100</span>, <span class="number">89</span>, <span class="number">76</span>, <span class="number">87</span>]</span><br><span class="line">r = reduce(foo, scores)</span><br><span class="line"><span class="built_in">print</span>(r)</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line"><span class="number">352</span></span><br></pre></td></tr></table></figure><p>在 reduce 中会一次次调用scores中的元素放到foo函数中进行计算<br>第一轮：x = 100, y = 89, result = 189<br>第二轮：x = result, y = 76, result = 265 (即 189 + 76)<br>第三轮：x = result, y = 87, result = 352 (即 265 + 87)<br>最后把 result 也就是 352 返回出去</p><p>上面的例子中的序列还是比较简单的，如果遇到复杂的数据对象，则不能这么简单处理</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"></span><br><span class="line">dic = [</span><br><span class="line">    &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Alice&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">18</span>, <span class="string">&#x27;score&#x27;</span>: <span class="number">78</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Boii&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">17</span>, <span class="string">&#x27;score&#x27;</span>: <span class="number">89</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Candy&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">19</span>, <span class="string">&#x27;score&#x27;</span>: <span class="number">65</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Dannis&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">22</span>, <span class="string">&#x27;score&#x27;</span>: <span class="number">99</span>&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>(<span class="params">x, y</span>):</span></span><br><span class="line">    <span class="keyword">return</span> x[<span class="string">&#x27;score&#x27;</span>] + y[<span class="string">&#x27;score&#x27;</span>]    <span class="comment"># 第二轮就会出错</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r = reduce(foo, dic)</span><br><span class="line"><span class="built_in">print</span>(r)</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;d:/---Programming---/Python/Project/练习/mo2.py&quot;</span>, line <span class="number">58</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    r = reduce(foo, dic)</span><br><span class="line">  File <span class="string">&quot;d:/---Programming---/Python/Project/练习/mo2.py&quot;</span>, line <span class="number">55</span>, <span class="keyword">in</span> foo</span><br><span class="line">    <span class="keyword">return</span> x + y[<span class="string">&#x27;score&#x27;</span>]</span><br><span class="line">TypeError: unsupported operand <span class="built_in">type</span>(s) <span class="keyword">for</span> +: <span class="string">&#x27;dict&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;int&#x27;</span></span><br></pre></td></tr></table></figure><p>哦嚯，报错。<br>报错信息为：unsupported operand type(s) for +: ‘dict’ and ‘int’<br>不支持 字典对象和整型做 相加操作</p><p>既然说相加，看来问题出在foo函数身上<br>以上面的方式再进行一次推导<br>第一轮：<br>x = {‘name’: ‘Alice’, ‘age’: 18, ‘score’: 78}, y = {‘name’: ‘Boii’, ‘age’: 17, ‘score’: 89},<br>则 x[‘score’] = 78, y[‘score’] = 89, result = 167<br>第二轮：<br>x = result, y = {‘name’: ‘Candy’, ‘age’: 19, ‘score’: 65},<br>则 x[‘score’] =…     <strong>问题就出在这</strong></p><p>第一次计算之后result 给了x，x就成了整型，当然取不出 score</p><p>解决方法，改为 <code>return x + y[&#39;score&#39;]</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"></span><br><span class="line">dic = [</span><br><span class="line">    &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Alice&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">18</span>, <span class="string">&#x27;score&#x27;</span>: <span class="number">78</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Boii&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">17</span>, <span class="string">&#x27;score&#x27;</span>: <span class="number">89</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Candy&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">19</span>, <span class="string">&#x27;score&#x27;</span>: <span class="number">65</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Dannis&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">22</span>, <span class="string">&#x27;score&#x27;</span>: <span class="number">99</span>&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>(<span class="params">x, y</span>):</span></span><br><span class="line">    <span class="keyword">return</span> x + y[<span class="string">&#x27;score&#x27;</span>]    <span class="comment"># 一个字典 + 一个整型，依然报错</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r = reduce(foo, dic)</span><br><span class="line"><span class="built_in">print</span>(r)</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;d:/---Programming---/Python/Project/练习/mo2.py&quot;</span>, line <span class="number">58</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    r = reduce(foo, dic)</span><br><span class="line">  File <span class="string">&quot;d:/---Programming---/Python/Project/练习/mo2.py&quot;</span>, line <span class="number">55</span>, <span class="keyword">in</span> foo</span><br><span class="line">    <span class="keyword">return</span> x + y[<span class="string">&#x27;score&#x27;</span>]</span><br><span class="line">TypeError: unsupported operand <span class="built_in">type</span>(s) <span class="keyword">for</span> +: <span class="string">&#x27;dict&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;int&#x27;</span></span><br></pre></td></tr></table></figure><p>依然报错，这回问题出在第一轮<br>x = {‘name’: ‘Alice’, ‘age’: 18, ‘score’: 78}，y[‘score’] = 89<br>一个是字典一个是整型</p><p><strong>解决方法，设置初始值</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"></span><br><span class="line">dic = [</span><br><span class="line">    &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Alice&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">18</span>, <span class="string">&#x27;score&#x27;</span>: <span class="number">78</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Boii&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">17</span>, <span class="string">&#x27;score&#x27;</span>: <span class="number">89</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Candy&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">19</span>, <span class="string">&#x27;score&#x27;</span>: <span class="number">65</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Dannis&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">22</span>, <span class="string">&#x27;score&#x27;</span>: <span class="number">99</span>&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>(<span class="params">x, y</span>):</span></span><br><span class="line">    <span class="keyword">return</span> x + y[<span class="string">&#x27;score&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r = reduce(foo, dic, <span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(r)</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line"><span class="number">331</span></span><br></pre></td></tr></table></figure><p>第一轮：<br>x = 0, y = {‘name’: ‘Alice’, ‘age’: 18, ‘score’: 78}, 则 y[‘score’] = 78, result = 78<br>第二轮：<br>x = result, y ={‘name’: ‘Boii’, ‘age’: 17, ‘score’: 89}, 则 y[‘score’] = 89, result = 167<br>第三轮：<br>x = result, y ={‘name’: ‘Candy’, ‘age’: 19, ‘score’: 65}, 则 y[‘score’] = 65, result = 232<br>第四轮：<br>x = result, y ={‘name’: ‘Dannis’, ‘age’: 22, ‘score’: 99}, 则 y[‘score’] = 99, result = 331<br>最后把 331 返回出去</p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
          <category> 高级特性 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> 函数式编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python【Feature】高级特性</title>
      <link href="posts/44742"/>
      <url>posts/44742</url>
      
        <content type="html"><![CDATA[<p>Python的高级特性1</p><span id="more"></span><h2 id="切片-Slice"><a href="#切片-Slice" class="headerlink" title="切片 Slice"></a>切片 Slice</h2><blockquote><p>[startWith : end : step]<br>切片适用于 list、tuple、string<br>startWith是包含，end则不包含</p><p>注意：<br>切片是从左往右切的<br>如果用正索引开始，就要用 正索引 或 逆索引 结束，例如 <code>s[1:5] 或 s[1:-3]</code></p><p>！如果用逆索引开始，就要用 逆索引 结束（<code>s[-1:1]</code> 这样只会返回空字符串，<strong>正确</strong>应该是  <code>s[-5:-1]</code>）<br>！逆索引记得不要弄颠倒了。（<code>s[-1:-3]</code> 这样只会返回空字符串，<strong>正确</strong>应该是<code>s[-3:-1]</code>）</p></blockquote><h3 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">|  P  |  y  |  t  |  h  |  o  |  n  |</span><br><span class="line">   <span class="number">0</span>     <span class="number">1</span>     <span class="number">2</span>     <span class="number">3</span>     <span class="number">4</span>     <span class="number">5</span>            <span class="comment"># 从左往右，下标从0开始</span></span><br><span class="line">  -<span class="number">6</span>    -<span class="number">5</span>    -<span class="number">4</span>    -<span class="number">3</span>    -<span class="number">2</span>    -<span class="number">1</span>            <span class="comment"># 从右往左，下标从-1开始</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">&#x27;Python&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s[<span class="number">0</span>]</span><br><span class="line"><span class="string">&#x27;P&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s[<span class="number">0</span>:-<span class="number">1</span>]     <span class="comment"># 结束索引不被截取</span></span><br><span class="line"><span class="string">&#x27;Pytho&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s[:<span class="number">5</span>]       <span class="comment"># 起始索引可以省略不写，代表从第一位开始截取</span></span><br><span class="line"><span class="string">&#x27;Pytho&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s[<span class="number">0</span>:]       <span class="comment"># 结束索引可以省略不写，代表截取至最后一位</span></span><br><span class="line"><span class="string">&#x27;Python&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s[:]        <span class="comment"># 等于复制了一整个</span></span><br><span class="line"><span class="string">&#x27;Python&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s[<span class="number">1</span>:<span class="number">4</span>]</span><br><span class="line"><span class="string">&#x27;yth&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s[<span class="number">1</span>:-<span class="number">2</span>]</span><br><span class="line"><span class="string">&#x27;yth&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s[-<span class="number">2</span>:<span class="number">1</span>]     <span class="comment"># 逆索引开始，不能以正索引结束</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s[-<span class="number">5</span>:-<span class="number">2</span>]</span><br><span class="line"><span class="string">&#x27;yth&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s[-<span class="number">2</span>:-<span class="number">5</span>]    <span class="comment"># 只能从左往右切</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>l = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">100</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l[<span class="number">10</span>:<span class="number">20</span>]</span><br><span class="line">[<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l[<span class="number">10</span>:<span class="number">20</span>:<span class="number">3</span>]</span><br><span class="line">[<span class="number">10</span>, <span class="number">13</span>, <span class="number">16</span>, <span class="number">19</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l[<span class="number">80</span>::<span class="number">3</span>]</span><br><span class="line">[<span class="number">80</span>, <span class="number">83</span>, <span class="number">86</span>, <span class="number">89</span>, <span class="number">92</span>, <span class="number">95</span>, <span class="number">98</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l[:<span class="number">10</span>:<span class="number">3</span>]</span><br><span class="line">[<span class="number">0</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">9</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l[::<span class="number">10</span>]</span><br><span class="line">[<span class="number">0</span>, <span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>, <span class="number">60</span>, <span class="number">70</span>, <span class="number">80</span>, <span class="number">90</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l[::-<span class="number">10</span>]</span><br><span class="line">[<span class="number">99</span>, <span class="number">89</span>, <span class="number">79</span>, <span class="number">69</span>, <span class="number">59</span>, <span class="number">49</span>, <span class="number">39</span>, <span class="number">29</span>, <span class="number">19</span>, <span class="number">9</span>]</span><br></pre></td></tr></table></figure><h2 id="迭代-Iteration"><a href="#迭代-Iteration" class="headerlink" title="迭代 Iteration"></a>迭代 Iteration</h2><h3 id="判断是否迭代对象"><a href="#判断是否迭代对象" class="headerlink" title="判断是否迭代对象"></a>判断是否迭代对象</h3><blockquote><p>可以用过 collections 的 Iterable 类型，用 <code>isinstance()</code>判断 <code>一个对象是否是可迭代对象</code></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Iterable</span><br><span class="line"></span><br><span class="line"><span class="built_in">str</span> = <span class="string">&#x27;abc&#x27;</span></span><br><span class="line">l = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">t = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">d = &#123;<span class="number">1</span>: <span class="number">1</span>, <span class="number">2</span>: <span class="number">2</span>, <span class="number">3</span>: <span class="number">3</span>&#125;</span><br><span class="line">s = (&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">isinstance</span>(<span class="built_in">str</span>, Iterable))    <span class="comment"># True</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">isinstance</span>(l, Iterable))      <span class="comment"># True</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">isinstance</span>(t, Iterable))      <span class="comment"># True</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">isinstance</span>(d, Iterable))      <span class="comment"># True</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">isinstance</span>(s, Iterable))      <span class="comment"># True</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">isinstance</span>(<span class="number">123</span>, Iterable))    <span class="comment"># False  整数字面量不是可迭代对象</span></span><br></pre></td></tr></table></figure><h3 id="迭代-List-列表类型数据"><a href="#迭代-List-列表类型数据" class="headerlink" title="迭代 List 列表类型数据"></a>迭代 List 列表类型数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&#x27;abcdefg&#x27;</span></span><br><span class="line"><span class="keyword">for</span> value <span class="keyword">in</span> s:</span><br><span class="line">    <span class="built_in">print</span>(value, end=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output：</span></span><br><span class="line">a b c d e f g</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 可以通过 enumerate() 给string，list，tuple 等生成下标</span></span><br><span class="line"></span><br><span class="line">s = <span class="string">&#x27;abcdefg&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i, value <span class="keyword">in</span> <span class="built_in">enumerate</span>(s):</span><br><span class="line">    <span class="built_in">print</span>(i, value)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output：</span></span><br><span class="line"><span class="number">0</span> a</span><br><span class="line"><span class="number">1</span> b</span><br><span class="line"><span class="number">2</span> c</span><br><span class="line"><span class="number">3</span> d</span><br><span class="line"><span class="number">4</span> e</span><br><span class="line"><span class="number">5</span> f</span><br><span class="line"><span class="number">6</span> g</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">l = [<span class="string">&#x27;a&#x27;</span>, <span class="literal">True</span>, (<span class="number">1</span>, <span class="number">2</span>), <span class="number">43</span>]</span><br><span class="line"><span class="keyword">for</span> i, value <span class="keyword">in</span> <span class="built_in">enumerate</span>(l):</span><br><span class="line">    <span class="built_in">print</span>(i, value)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line"><span class="number">0</span> a</span><br><span class="line"><span class="number">1</span> <span class="literal">True</span></span><br><span class="line"><span class="number">2</span> (<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="number">3</span> <span class="number">43</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 同时引用两个变量</span></span><br><span class="line"><span class="keyword">for</span> x, y <span class="keyword">in</span> [(<span class="number">11</span>, <span class="number">12</span>), (<span class="number">21</span>, <span class="number">22</span>), (<span class="number">31</span>, <span class="number">32</span>)]:</span><br><span class="line">    <span class="built_in">print</span>(x, y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line"><span class="number">11</span> <span class="number">12</span></span><br><span class="line"><span class="number">21</span> <span class="number">22</span></span><br><span class="line"><span class="number">31</span> <span class="number">32</span></span><br><span class="line"></span><br><span class="line"><span class="comment">######################################################</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x, y, z <span class="keyword">in</span> [(<span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>), (<span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>), (<span class="number">31</span>, <span class="number">32</span>, <span class="number">33</span>)]:</span><br><span class="line">    <span class="built_in">print</span>(x, y, z)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line"><span class="number">11</span> <span class="number">12</span> <span class="number">13</span></span><br><span class="line"><span class="number">21</span> <span class="number">22</span> <span class="number">23</span></span><br><span class="line"><span class="number">31</span> <span class="number">32</span> <span class="number">33</span></span><br></pre></td></tr></table></figure><h3 id="迭代-Dict-键-值对类型数据"><a href="#迭代-Dict-键-值对类型数据" class="headerlink" title="迭代 Dict 键-值对类型数据"></a>迭代 Dict 键-值对类型数据</h3><blockquote><p>默认情况下，Dict迭代的是key，如果要迭代value，可以用 <code>for value in d.values()</code><br>如果要同时迭代key 和 value， 可以用 <code>for k, v in d.items()</code></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">d = &#123;<span class="string">&#x27;a&#x27;</span>: <span class="string">&#x27;Alice&#x27;</span>, <span class="string">&#x27;b&#x27;</span>: <span class="string">&#x27;Boii&#x27;</span>, <span class="string">&#x27;c&#x27;</span>: <span class="string">&#x27;Cai&#x27;</span>&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> d:</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">a</span><br><span class="line">b</span><br><span class="line">c</span><br><span class="line"></span><br><span class="line"><span class="comment">#############################################</span></span><br><span class="line"></span><br><span class="line">d = &#123;<span class="string">&#x27;a&#x27;</span>: <span class="string">&#x27;Alice&#x27;</span>, <span class="string">&#x27;b&#x27;</span>: <span class="string">&#x27;Boii&#x27;</span>, <span class="string">&#x27;c&#x27;</span>: <span class="string">&#x27;Cai&#x27;</span>&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> d.values():</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">Alice</span><br><span class="line">Boii</span><br><span class="line">Cai</span><br><span class="line"></span><br><span class="line"><span class="comment">#############################################</span></span><br><span class="line"></span><br><span class="line">d = &#123;<span class="string">&#x27;a&#x27;</span>: <span class="string">&#x27;Alice&#x27;</span>, <span class="string">&#x27;b&#x27;</span>: <span class="string">&#x27;Boii&#x27;</span>, <span class="string">&#x27;c&#x27;</span>: <span class="string">&#x27;Cai&#x27;</span>&#125;</span><br><span class="line"><span class="keyword">for</span> k, v <span class="keyword">in</span> d.items():</span><br><span class="line">    <span class="built_in">print</span>(k, <span class="string">&#x27;-&#x27;</span>, v)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">a - Alice</span><br><span class="line">b - Boii</span><br><span class="line">c - Cai</span><br></pre></td></tr></table></figure><h2 id="列表生成式-List-Comprehensions"><a href="#列表生成式-List-Comprehensions" class="headerlink" title="列表生成式 List Comprehensions"></a>列表生成式 List Comprehensions</h2><h3 id="列表生成式"><a href="#列表生成式" class="headerlink" title="列表生成式"></a>列表生成式</h3><blockquote><p>[ i-expression <strong>for</strong> i <strong>in</strong> Iterations ]<br>[ i-expression <strong>for</strong> i <strong>in</strong> Iterations <strong>if</strong> expression ]<br>[ i-expression <strong>if</strong> expression <strong>else</strong> expression <strong>for</strong> i <strong>in</strong> Iterations ]</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[ ··· <span class="keyword">for</span> ··· <span class="keyword">in</span> ··· ]</span><br><span class="line">[ ··· <span class="keyword">for</span> ··· <span class="keyword">in</span> ··· <span class="keyword">if</span> ··· ]</span><br><span class="line">[ ··· <span class="keyword">if</span> ··· <span class="keyword">else</span> ··· <span class="keyword">for</span> ··· <span class="keyword">in</span> ··· ]</span><br></pre></td></tr></table></figure><p>列表生成式是一种非常简洁的语法，可以大幅度的压缩代码<br>阅读方式：</p><ul><li><code>[i-expression for i in Iterations]</code><br>遍历迭代对象 Iterations，将每个元素 e 放到 i-expression中运算后，作为这个列表 list 的元素</li><li><code>[i-expression for i in Iterations if expression]</code><br>遍历迭代对象 Iterations，将每个元素 e 放到 if 中的 expression中运算后，放到 i-expression 中运算，然后作为这个列表 list 的元素</li><li><code>[i-expression if expression else expression for i in Iterations]</code><br>遍历迭代对象 Iterations，将每个元素 e 放到 if else 中的 expression中运算后，放到 i-expression 中运算，然后作为这个列表 list 的元素</li></ul><p>for 前的 if else 可以看成三目运算符，这样比较好理解</p><ol><li>三目运算符：True时执行 <strong>if</strong> expression <strong>else</strong> Flase时执行</li><li>对比一下：[ i-expression <strong>if</strong> expression <strong>else</strong> expression for i in Iterations ]</li><li>代入一下：[ True时执行 <strong>if</strong> expression <strong>else</strong> Flase时执行 for i in Iterations ]</li></ol><p><strong>一句话：原本有10个，for…if 后不一定有 10 个， if…else…for 以后有10个，不过可能不尽相同。</strong><br><strong>两句话：for 前必 else，for 后不else。</strong></p><blockquote><p>注意：i-expression 的<code>计算变量</code>和 for 里的<code>临时变量</code>要相同</p></blockquote><p>普通列表生成式</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># range(1, 11) 生成1~10 [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</span></span><br><span class="line"><span class="comment"># for in 遍历这10个数</span></span><br><span class="line"><span class="comment"># 每次遍历都把当前元素拿到 i-expression 即 x * x 做相乘计算</span></span><br><span class="line"><span class="comment"># 然后作为列表的元素</span></span><br><span class="line"><span class="comment"># 注意 for 的临时变量是 x，i-expression 的变量也是 x，这两个要相同</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里是计算出1~10每个数的平方</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[x * x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">11</span>)]</span><br><span class="line">[<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">25</span>, <span class="number">36</span>, <span class="number">49</span>, <span class="number">64</span>, <span class="number">81</span>, <span class="number">100</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 把一个 List 中所有字符串变小写</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>L = [<span class="string">&#x27;Hello&#x27;</span>, <span class="string">&#x27;World&#x27;</span>, <span class="string">&#x27;IBM&#x27;</span>, <span class="string">&#x27;Apple&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[s.lower() <span class="keyword">for</span> s <span class="keyword">in</span> L]</span><br><span class="line">[<span class="string">&#x27;hello&#x27;</span>, <span class="string">&#x27;world&#x27;</span>, <span class="string">&#x27;ibm&#x27;</span>, <span class="string">&#x27;apple&#x27;</span>]</span><br></pre></td></tr></table></figure><p>for 里带 if 筛选的列表生成式</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># range(1, 11) 生成1~10 [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</span></span><br><span class="line"><span class="comment"># for in 遍历这10个数</span></span><br><span class="line"><span class="comment"># 每次遍历都把当前元素拿到 if 里计算, 得到 [2, 4, 6, 8, 10]</span></span><br><span class="line"><span class="comment"># 然后放到 i-expression 即 x * x 做相乘计算得到 [4, 16, 36, 64, 100]</span></span><br><span class="line"><span class="comment"># 最后作为列表的元素</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里是筛选出偶数，然后计算平方</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[x * x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">11</span>) <span class="keyword">if</span> x % <span class="number">2</span> == <span class="number">0</span>]</span><br><span class="line">[<span class="number">4</span>, <span class="number">16</span>, <span class="number">36</span>, <span class="number">64</span>, <span class="number">100</span>]</span><br></pre></td></tr></table></figure><p>双循环的列表生成式</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 还可以使用双循环，生成全排列</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[m + n <span class="keyword">for</span> m <span class="keyword">in</span> <span class="string">&#x27;ABC&#x27;</span> <span class="keyword">for</span> n <span class="keyword">in</span> <span class="string">&#x27;XYZ&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;AX&#x27;</span>, <span class="string">&#x27;AY&#x27;</span>, <span class="string">&#x27;AZ&#x27;</span>, <span class="string">&#x27;BX&#x27;</span>, <span class="string">&#x27;BY&#x27;</span>, <span class="string">&#x27;BZ&#x27;</span>, <span class="string">&#x27;CX&#x27;</span>, <span class="string">&#x27;CY&#x27;</span>, <span class="string">&#x27;CZ&#x27;</span>]</span><br></pre></td></tr></table></figure><p>多变量的列表生成式</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一个循环多个变量也是可以的</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d = &#123;<span class="string">&#x27;x&#x27;</span>: <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;y&#x27;</span>: <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;z&#x27;</span>: <span class="string">&#x27;C&#x27;</span> &#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[k + <span class="string">&#x27;-&#x27;</span> + v <span class="keyword">for</span> k, v <span class="keyword">in</span> d.items()]</span><br><span class="line">[<span class="string">&#x27;y-B&#x27;</span>, <span class="string">&#x27;x-A&#x27;</span>, <span class="string">&#x27;z-C&#x27;</span>]</span><br></pre></td></tr></table></figure><p>for 前带 if 的列表生成式</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># # range(1, 11) 生成1~10 [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</span></span><br><span class="line"><span class="comment"># for in 遍历这10个数</span></span><br><span class="line"><span class="comment"># 每次遍历都把当前元素拿到 for 前的 if else三目运算符里计算</span></span><br><span class="line"><span class="comment"># x if x % 2 == 0 else -x ,偶数正常输出, 奇数变负数，得到 [-1, 2, -3, 4, -5, 6, -7, 8, -9, 10]</span></span><br><span class="line"><span class="comment"># 最后作为列表的元素</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[x <span class="keyword">if</span> x % <span class="number">2</span> == <span class="number">0</span> <span class="keyword">else</span> -x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">11</span>)]</span><br><span class="line">[-<span class="number">1</span>, <span class="number">2</span>, -<span class="number">3</span>, <span class="number">4</span>, -<span class="number">5</span>, <span class="number">6</span>, -<span class="number">7</span>, <span class="number">8</span>, -<span class="number">9</span>, <span class="number">10</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 再稍微改动下</span></span><br><span class="line"><span class="comment"># 把 x if x % 2 == 0 else x + 10 看作三目运算符就很好理解</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[x <span class="keyword">if</span> x % <span class="number">2</span> == <span class="number">0</span> <span class="keyword">else</span> x + <span class="number">10</span> <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">11</span>)]</span><br><span class="line">[<span class="number">11</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">4</span>, <span class="number">15</span>, <span class="number">6</span>, <span class="number">17</span>, <span class="number">8</span>, <span class="number">19</span>, <span class="number">10</span>]</span><br></pre></td></tr></table></figure><h3 id="其他生成式"><a href="#其他生成式" class="headerlink" title="其他生成式"></a>其他生成式</h3><p>除了列表生成式，还有<code>字典生成式</code>、<code>元组生成式</code>，其实现都是一样的</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;k: v <span class="keyword">for</span> k, v <span class="keyword">in</span> d.items()&#125;</span><br><span class="line">&#123;k: v <span class="keyword">for</span> k, v <span class="keyword">in</span> d.items() <span class="keyword">if</span> condition&#125;</span><br><span class="line">&#123;k: v <span class="keyword">if</span> condition <span class="keyword">else</span> k: -v <span class="keyword">for</span> k, v <span class="keyword">in</span> d.items() &#125;</span><br></pre></td></tr></table></figure><p>元组生成式 生成一个生成器对象，下面将会讲到。</p><h3 id="错误示范"><a href="#错误示范" class="headerlink" title="错误示范"></a>错误示范</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># for 后 if 加 else</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">11</span>) <span class="keyword">if</span> x % <span class="number">2</span> == <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span>]</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span></span><br><span class="line">    [x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">11</span>) <span class="keyword">if</span> x % <span class="number">2</span> == <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span>]</span><br><span class="line">                                              ^</span><br><span class="line">SyntaxError: invalid syntax</span><br><span class="line"></span><br><span class="line"><span class="comment"># for 前 if 不加 else</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[x <span class="keyword">if</span> x % <span class="number">2</span> == <span class="number">0</span> <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">11</span>)]</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span></span><br><span class="line">    [x <span class="keyword">if</span> x % <span class="number">2</span> == <span class="number">0</span> <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">11</span>)]</span><br><span class="line">                     ^</span><br><span class="line">SyntaxError: invalid syntax</span><br></pre></td></tr></table></figure><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul><li><code>for...in...</code> 最先，<code>if 或 if else</code> 随后，<code>i-expression</code> 最后</li><li><code>for 前 if</code> 必加 else，<code>for 后 if</code> 不加 else</li><li><code>for 前 if</code> 是对 for的输出进行处理，<code>for 后 if</code> 是对for的输出进行控制过滤</li></ul><h2 id="生成器-Generator"><a href="#生成器-Generator" class="headerlink" title="生成器 Generator"></a>生成器 Generator</h2><h3 id="普通形式"><a href="#普通形式" class="headerlink" title="普通形式"></a>普通形式</h3><p>元组生成式 生成一个生成器对象，通过for或者next遍历,遍历后，原生成器对象就不存在了</p><blockquote><p>( i-expression <strong>for</strong> i <strong>in</strong> Iterations )<br>( i-expression <strong>for</strong> i <strong>in</strong> Iterations <strong>if</strong> expression )<br>( i-expression <strong>if</strong> expression <strong>else</strong> expression <strong>for</strong> i <strong>in</strong> Iterations )</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(··· <span class="keyword">for</span> ··· <span class="keyword">in</span> ··· )</span><br><span class="line">(··· <span class="keyword">for</span> ··· <span class="keyword">in</span> ··· <span class="keyword">if</span> ··· )</span><br><span class="line">(··· <span class="keyword">if</span> ··· <span class="keyword">else</span> ··· <span class="keyword">for</span> ··· <span class="keyword">in</span> ··· )</span><br></pre></td></tr></table></figure><p>生成器，是一种一边循环一边计算的机制<br>比如现在需要一个<code>1到100W的平方</code>的列表，用列表生成式表示为<code>[ x * x for x in range(1000000)]</code><br>但如果只需要经常访问前面几个元素，则浪费了很大的空间<br>而<strong>生成器是保存了一种算法，它不会直接创建100W个数，而是等到调用的时候通过计算获得</strong><br>也就是说：列表生成式是一种缩写，生成器是一种算法</p><blockquote><p>生成器 vs 列表生成式：<br>列表生成式 是使用 <code>[]</code>，生成器 是使用 <code>()</code><br>列表生成式是一个列表，可以直接列出所有元素；生成器要用<code>next()</code>或<code>遍历</code>来列出所有元素</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>L = [ x * x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>L</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">25</span>, <span class="number">36</span>, <span class="number">49</span>, <span class="number">64</span>, <span class="number">81</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>G = ( x * x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>) )</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>G</span><br><span class="line">&lt;generator <span class="built_in">object</span> &lt;genexpr&gt; at <span class="number">0x00000204807D8D60</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(G)</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(G)</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(G)</span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(G)</span><br><span class="line"><span class="number">9</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(G)</span><br><span class="line"><span class="number">16</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(G)</span><br><span class="line"><span class="number">25</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(G)</span><br><span class="line"><span class="number">36</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(G)</span><br><span class="line"><span class="number">49</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(G)</span><br><span class="line"><span class="number">64</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(G)</span><br><span class="line"><span class="number">81</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(G)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">StopIteration</span><br></pre></td></tr></table></figure><p><strong>生成器是算法，是规律，是计算方式</strong>，通过<code>next(G)</code>计算出G的下一个元素的值，直到最后一个元素<br>没有更多元素的时候，抛出<code>StopIteration</code>错误<br>但是这种不断调用<code>next()</code>的方法显然不科学，</p><p>所以一般都是用<code>for循环</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">G = ( x * x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>) )</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> G:</span><br><span class="line">    <span class="built_in">print</span>(i, end=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">4</span> <span class="number">9</span> <span class="number">16</span> <span class="number">25</span> <span class="number">36</span> <span class="number">49</span> <span class="number">64</span> <span class="number">81</span></span><br></pre></td></tr></table></figure><h3 id="函数形式"><a href="#函数形式" class="headerlink" title="函数形式"></a>函数形式</h3><p>生成器的另一种实现方式是 <code>函数形式</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">funcName</span>():</span></span><br><span class="line">    sth</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">yield</span> sth</span><br><span class="line">        sth</span><br></pre></td></tr></table></figure><blockquote><p>普通函数通过<code>return语句</code>返回<br>生成器通过<code>yield语句</code>返回，并在下次调用时从<code>yield语句</code>处继续<br><code>yield</code>可以看成<code>return</code>，都是返回一个值出去<br>只不过使用<code>yield</code>在下次调用时会从<code>yield</code>处继续。</p></blockquote><h4 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h4><p>例如打印杨辉三角</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">          <span class="number">1</span></span><br><span class="line">         / <span class="string">\</span></span><br><span class="line">        <span class="number">1</span>   <span class="number">1</span></span><br><span class="line">       / <span class="string">\</span> / <span class="string">\</span></span><br><span class="line">      <span class="number">1</span>   <span class="number">2</span>   <span class="number">1</span></span><br><span class="line">     / <span class="string">\</span> / <span class="string">\</span> / <span class="string">\</span></span><br><span class="line">    <span class="number">1</span>   <span class="number">3</span>   <span class="number">3</span>   <span class="number">1</span></span><br><span class="line">   / <span class="string">\</span> / <span class="string">\</span> / <span class="string">\</span> / <span class="string">\</span></span><br><span class="line">  <span class="number">1</span>   <span class="number">4</span>   <span class="number">6</span>   <span class="number">4</span>   <span class="number">1</span></span><br><span class="line"> / <span class="string">\</span> / <span class="string">\</span> / <span class="string">\</span> / <span class="string">\</span> / <span class="string">\</span></span><br><span class="line"><span class="number">1</span>   <span class="number">5</span>   <span class="number">10</span>  <span class="number">10</span>  <span class="number">5</span>   <span class="number">1</span></span><br></pre></td></tr></table></figure><p>期待输出是这样的</p><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># [1]</span></span><br><span class="line"><span class="meta"># [1, 1]</span></span><br><span class="line"><span class="meta"># [1, 2, 1]</span></span><br><span class="line"><span class="meta"># [1, 3, 3, 1]</span></span><br><span class="line"><span class="meta"># [1, 4, 6, 4, 1]</span></span><br><span class="line"><span class="meta"># [1, 5, 10, 10, 5, 1]</span></span><br><span class="line"><span class="meta"># [1, 6, 15, 20, 15, 6, 1]</span></span><br><span class="line"><span class="meta"># [1, 7, 21, 35, 35, 21, 7, 1]</span></span><br><span class="line"><span class="meta"># [1, 8, 28, 56, 70, 56, 28, 8, 1]</span></span><br><span class="line"><span class="meta"># [1, 9, 36, 84, 126, 126, 84, 36, 9, 1]</span></span><br></pre></td></tr></table></figure><p>实现思路：<br>先看杨辉三角的规律：头尾都是1，中间是上一层<code>第n个</code>+<code>第n+1个</code>，每一层都是list<br>而且第一层比较特殊，是 [1]<br>可以先把杨辉三角核心的算法搞定。</p><h5 id="核心算法"><a href="#核心算法" class="headerlink" title="核心算法"></a>核心算法</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">L = [<span class="number">1</span>]</span><br><span class="line">L = [<span class="number">1</span>] + [L[n] + L[n+<span class="number">1</span>] <span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(L)-<span class="number">1</span>)] +[<span class="number">1</span>]</span><br></pre></td></tr></table></figure><p><code>[1] + [L[n] + L[n+1] for n in range(len(L)-1)] +[1]</code> 就是核心算法了<br>把他拆开来看，可以发现这个表达式是由中间段加上头尾的 <code>[1]</code> 组成的</p><p>再看中间段 <code>[L[n] + L[n+1] for n in range(len(L)-1)]</code><br>这是一个列表生成式<br><code>range(len(L)-1)</code>会生成 0 1 2 …</p><p>假设当前为第5层，准备生成 [1, 4, 6, 4, 1]<br>当前的 L 是 [1, 3, 3, 1]，那么<code>len(L)</code>则是4，<br><code>range(len(L) - 1)</code>则等价于<code>range(3)</code>,会生成 0 1 2</p><p><code>[L[n] + L[n+1] for n in range(len(L)-1)]</code>则等价于<br><code>[L[0]+L[1], L[1]+L[2], L[2]+L[3]]</code> 则等价于<br><code>[  1 + 3,     3 + 3,     3 + 1  ]</code>则等价于<br><code>[4, 6, 4]</code> 正好就是中间段<br>再加上头尾两个 [1]： <code>[1, 4, 6, 4, 1]</code></p><h5 id="做成生成器"><a href="#做成生成器" class="headerlink" title="做成生成器"></a>做成生成器</h5><p>因为第一层 特殊，所以用小括号列表生成式<code>()</code>做不出来，改用函数形式</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">triangles</span>():</span></span><br><span class="line">    L = [<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">yield</span> L</span><br><span class="line">        L = [<span class="number">1</span>] + [L[x]+L[x+<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(L)-<span class="number">1</span>)] + [<span class="number">1</span>]</span><br></pre></td></tr></table></figure><p>第一次迭代生成器triangles时，会执行 <code>L = [1]</code>，然后进入循环，遇到<code>yield L</code>把L返回出去</p><p>第二次迭代生成器triangles时，会从<code>yield L</code>处继续，<br>然后执行核心算法 <code>L = [1] + [L[x]+L[x+1] for x in range(len(L)-1)] + [1]</code><br>之后继续循环，又遇到<code>yield L</code>，把更新过的 L 返回出去</p><p>接着第三次，第四次…</p><p>其实有点类似 C 语言中被<code>static</code>修饰的局部变量，函数调用完不会被销毁，程序结束才销毁</p><h5 id="遍历输出"><a href="#遍历输出" class="headerlink" title="遍历输出"></a>遍历输出</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> n, t <span class="keyword">in</span> <span class="built_in">enumerate</span>(triangles()):</span><br><span class="line">    results.append(t)</span><br><span class="line">    n += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">10</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>生成器也是一个可迭代对象，所以可以用 <code>for...in...</code>来迭代输出<br><code>enumerate()</code>赋予了对应的下标<br>这个生成器可以无限循环下去，可以获得无穷层，这里打印10层作为示范即可</p><p>最后可以得到期待输出：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>]</span><br><span class="line">[<span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>]</span><br><span class="line">[<span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">1</span>]</span><br><span class="line">[<span class="number">1</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">1</span>]</span><br><span class="line">[<span class="number">1</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">5</span>, <span class="number">1</span>]</span><br><span class="line">[<span class="number">1</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">20</span>, <span class="number">15</span>, <span class="number">6</span>, <span class="number">1</span>]</span><br><span class="line">[<span class="number">1</span>, <span class="number">7</span>, <span class="number">21</span>, <span class="number">35</span>, <span class="number">35</span>, <span class="number">21</span>, <span class="number">7</span>, <span class="number">1</span>]</span><br><span class="line">[<span class="number">1</span>, <span class="number">8</span>, <span class="number">28</span>, <span class="number">56</span>, <span class="number">70</span>, <span class="number">56</span>, <span class="number">28</span>, <span class="number">8</span>, <span class="number">1</span>]</span><br><span class="line">[<span class="number">1</span>, <span class="number">9</span>, <span class="number">36</span>, <span class="number">84</span>, <span class="number">126</span>, <span class="number">126</span>, <span class="number">84</span>, <span class="number">36</span>, <span class="number">9</span>, <span class="number">1</span>]</span><br></pre></td></tr></table></figure><h5 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">triangles</span>():</span></span><br><span class="line">    L = [<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">yield</span> L</span><br><span class="line">        L = [<span class="number">1</span>] + [L[x]+L[x+<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(L)-<span class="number">1</span>)] + [<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">results = []</span><br><span class="line"><span class="keyword">for</span> n, t <span class="keyword">in</span> <span class="built_in">enumerate</span>(triangles()):</span><br><span class="line">    results.append(t)</span><br><span class="line">    n += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">10</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> results:</span><br><span class="line">    <span class="built_in">print</span>(t)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> results == [</span><br><span class="line">    [<span class="number">1</span>],</span><br><span class="line">    [<span class="number">1</span>, <span class="number">1</span>],</span><br><span class="line">    [<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>],</span><br><span class="line">    [<span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">1</span>],</span><br><span class="line">    [<span class="number">1</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">1</span>],</span><br><span class="line">    [<span class="number">1</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">5</span>, <span class="number">1</span>],</span><br><span class="line">    [<span class="number">1</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">20</span>, <span class="number">15</span>, <span class="number">6</span>, <span class="number">1</span>],</span><br><span class="line">    [<span class="number">1</span>, <span class="number">7</span>, <span class="number">21</span>, <span class="number">35</span>, <span class="number">35</span>, <span class="number">21</span>, <span class="number">7</span>, <span class="number">1</span>],</span><br><span class="line">    [<span class="number">1</span>, <span class="number">8</span>, <span class="number">28</span>, <span class="number">56</span>, <span class="number">70</span>, <span class="number">56</span>, <span class="number">28</span>, <span class="number">8</span>, <span class="number">1</span>],</span><br><span class="line">    [<span class="number">1</span>, <span class="number">9</span>, <span class="number">36</span>, <span class="number">84</span>, <span class="number">126</span>, <span class="number">126</span>, <span class="number">84</span>, <span class="number">36</span>, <span class="number">9</span>, <span class="number">1</span>]</span><br><span class="line">]:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;测试通过!&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;测试失败!&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><p>普通形式-生成器：把列表生成式的<code>[]</code>换成<code>()</code><br>函数形式-生成器：函数中带<code>yield</code>，下一次调用时会从<code>yield</code>处继续</p><h2 id="迭代器-Iterator"><a href="#迭代器-Iterator" class="headerlink" title="迭代器 Iterator"></a>迭代器 Iterator</h2><blockquote><p>可以被<code>next()</code>函数调用并不断返回下一个值的对象称为迭代<strong>器</strong>：<code>Iterator</code>。</p></blockquote><blockquote><p>可迭代<strong>对象</strong>：<br>可以直接作用于 for 循环的对象统称为可迭代<strong>对象</strong><code>Iterable</code><br>可迭代<strong>对象</strong><code>Iterable</code>：</p><ol><li>List、Tuple、Dict、Set、String；</li><li>生成器Generator、带<code>yield</code>的Generator Function</li></ol><p>可以用<code>isinstance(obj, Iterable)</code>判断是否是可迭代<strong>对象</strong></p></blockquote><blockquote><p>迭代<strong>器</strong>：<br>不但可以作用于 for 循环，还可以被<code>next()</code>函数调用并不断返回下一个值则称为迭代<strong>器</strong>：<code>Iterator</code>。<br>生成器Generator、带<code>yield</code>的Generator Function就是迭代<strong>器</strong><br>可以用<code>isinstance(obj, Iterator)</code>判断是否是迭代<strong>器</strong></p></blockquote><p>所以：Generator、Generator Function 既是 <code>Iterator</code>，也是 <code>Iterable</code><br>而 List、Tuple、Dict、Set、String 仅仅只是 <code>Iterable</code>，<strong>但是</strong>，使用<code>iter()</code>函数可以使他们变成迭代<strong>器</strong><code>Iterator</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>(<span class="built_in">iter</span>([]), Iterator)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>(<span class="built_in">iter</span>(<span class="string">&#x27;Boii&#x27;</span>), Iterator)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure><h3 id="迭代器的本质"><a href="#迭代器的本质" class="headerlink" title="迭代器的本质"></a>迭代器的本质</h3><p>Python的<code>Iterator对象</code>表示的是一个数据流，<code>Iterator对象</code>可以被<code>next()函数</code>调用并不断返回下一个数据，直到没有数据时抛出<code>StopIteration</code>错误。<br>可以把这个数据流看做是一个有序序列，但我们却不能提前知道序列的长度<br>只能不断通过<code>next()函数</code>实现按需计算下一个数据，所以<code>Iterator</code>的计算是<strong>惰性</strong>的，只有在需要返回下一个数据时它才会计算</p><h3 id="自定义可迭代类"><a href="#自定义可迭代类" class="headerlink" title="自定义可迭代类"></a>自定义可迭代类</h3><p>只要类中实现了<code>__iter__()</code>方法，这个类的对象就是可迭代<strong>对象</strong><code>Iterable</code>。<br>只要类中实现了<code>__iter__()</code>和<code>__next__()</code>方法，这个类就是个迭代<strong>器</strong><code>Iteratorn</code>。</p><p><code>__iter__()</code>方法必须返回一个迭代<strong>器</strong>。<br>那么代码就是这样子：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 创建一个类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Classmate</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.names = <span class="built_in">list</span>()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">self, value</span>):</span></span><br><span class="line">        self.names.append(value)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. 实现__iter__方法，返回一个迭代器</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;只有实现了__iter__方法，才能可迭代&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> ClassmateIterator(self)  <span class="comment"># __iter__ 必须返回一个迭代器对象</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 创建一个迭代器</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassmateIterator</span>:</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;实现了__iter__和__next__方法，才是一个迭代器&quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, obj</span>):</span></span><br><span class="line">        self.obj = obj</span><br><span class="line">        self.current_num = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 4. 迭代器需要实现 __iter__, __next__方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__next__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;实现了__iter__和__next__方法，才是一个迭代器&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> self.current_num &lt; <span class="built_in">len</span>(self.obj.names):</span><br><span class="line">            res = self.obj.names[self.current_num]</span><br><span class="line">            self.current_num += <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span> res</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> StopIteration</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    clsm = Classmate()</span><br><span class="line">    clsm.add(<span class="number">123</span>)</span><br><span class="line">    clsm.add(<span class="number">456</span>)</span><br><span class="line">    clsm.add(<span class="number">789</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 通过循环检查classmate对象是否可迭代</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> clsm:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line"><span class="number">123</span></span><br><span class="line"><span class="number">456</span></span><br><span class="line"><span class="number">789</span></span><br></pre></td></tr></table></figure><p>总结起来就是：<br>创建一个类并实现<code>__iter__()</code>方法去返回一个迭代器<br>创建一个类并实现<code>__iter__()</code>和<code>__next__()</code>方法，使其成为迭代器。</p><p>这样看起来好像为了实现一个迭代器又生成了一个迭代器<br>既然我是想造一个迭代器，<code>__iter__()</code>方法有需要返回一个迭代器对象，那我返回自己不行吗？</p><p>可以！</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 创建一个类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Classmate</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.names = <span class="built_in">list</span>()</span><br><span class="line">        self.current_num = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">self, value</span>):</span></span><br><span class="line">        self.names.append(value)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2. 实现__iter__方法，返回一个迭代器</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;只有实现了__iter__方法，才能可迭代&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> self  <span class="comment"># __iter__ 必须返回一个迭代器对象，这里就返回自己就行</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3. 实现__next__方法，这个方法会在外部使用next(Iterator)时调用。</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__next__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;实现了__iter__和__next__方法，才是一个迭代器&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> self.current_num &lt; <span class="built_in">len</span>(self.names):</span><br><span class="line">            res = self.names[self.current_num]</span><br><span class="line">            self.current_num += <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span> res</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> StopIteration</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    clsm = Classmate()</span><br><span class="line">    clsm.add(<span class="number">123</span>)</span><br><span class="line">    clsm.add(<span class="number">456</span>)</span><br><span class="line">    clsm.add(<span class="number">789</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 通过循环检查classmate对象是否可迭代</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> clsm:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line"><span class="number">123</span></span><br><span class="line"><span class="number">456</span></span><br><span class="line"><span class="number">789</span></span><br></pre></td></tr></table></figure><h3 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h3><ol><li>可迭代对象和迭代器，通过函数<code>iter()</code>转换</li><li>迭代器：数据流，变长，惰性的 </li><li>继承关系：Iterable&gt;Iterator&gt;Generator(参考python doc)</li><li>Iterable：list、tuple、dict、set、str、Iterator、Generator等</li><li>Iterator转化成Iterator：Iterator=iter(Iterable)</li><li>自定义迭代类时必须实现<code>__iter__()</code>和<code>__next__()</code>方法</li><li><code>__iter__()</code>方法必须返回一个迭代器</li></ol>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
          <category> 高级特性 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python【No-20】操作文件和目录</title>
      <link href="posts/9832"/>
      <url>posts/9832</url>
      
        <content type="html"><![CDATA[<p>文件正常操作</p><span id="more"></span><p>Python的自带模块 <code>os</code> 可以进行许多与操作系统相关的操作。</p><p>例如<strong>查看当前系统类型</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> os</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.name</span><br><span class="line"><span class="string">&#x27;nt&#x27;</span></span><br></pre></td></tr></table></figure><p><code>nt</code>表示<code>windows</code>，<code>posix</code>表示<code>Linux/Unix/Mac OS X</code></p><p>在<code>Linux/Unix/Max OS X</code>上想获得更详细的信息，可以使用<code>uname()</code>，不过在<code>windows</code>上不提供</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> os</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.uname()</span><br><span class="line">posix.uname_result(sysname=<span class="string">&#x27;Darwin&#x27;</span>, nodename=<span class="string">&#x27;MichaelMacPro.local&#x27;</span>, release=<span class="string">&#x27;14.3.0&#x27;</span>, version=<span class="string">&#x27;Darwin Kernel Version 14.3.0: Mon Mar 23 11:59:05 PDT 2015; root:xnu-2782.20.48~5/RELEASE_X86_64&#x27;</span>, machine=<span class="string">&#x27;x86_64&#x27;</span>)</span><br></pre></td></tr></table></figure><p>再例如<strong>查看环境变量</strong>，<code>os.environ</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> os</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.environ</span><br><span class="line">environ(&#123;<span class="string">&#x27;ALLUSERSPROFILE&#x27;</span>: <span class="string">&#x27;C:\\ProgramData&#x27;</span>, <span class="string">&#x27;APPDATA&#x27;</span>: <span class="string">&#x27;C:\\Users\\pr919\\AppData\\Roaming&#x27;</span>, <span class="string">&#x27;ASL.LOG&#x27;</span>: <span class="string">&#x27;Destination=file&#x27;</span>, <span class="string">&#x27;CATALINA_HOME&#x27;</span>: <span class="string">&#x27;D:\\---Programming---\\IntelliJ IDEA\\apache-tomcat-8.5.42&#x27;</span>, ..., <span class="string">&#x27;WT_SESSION&#x27;</span>: <span class="string">&#x27;245de0da-1ef4-4cda-93ca-c132289e2c9c&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure><p>这样就列出了所有环境变量了</p><p>如果要获得某一条，可以用<code>os.environ.get(&#39;key&#39;)</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> os</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.environ.get(<span class="string">&#x27;JAVA_HOME&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;C:\\Program Files\\Java\\jdk1.8.0_201&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="获得当前目录-getcwd"><a href="#获得当前目录-getcwd" class="headerlink" title="获得当前目录 getcwd"></a>获得当前目录 getcwd</h2><blockquote><p><code>os.getcwd()</code></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> os</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.getcwd()</span><br><span class="line"><span class="string">&#x27;C:\\Users\\pr919&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="列出目录-listdir、walk"><a href="#列出目录-listdir、walk" class="headerlink" title="列出目录 listdir、walk"></a>列出目录 listdir、walk</h2><blockquote><p><code>os.listdir(path)</code>，单层列出；path可以是绝对路径或相对路径，不填默认当前目录<br><code>os.walk(path)</code>，遍历列出；</p></blockquote><p>listdir() 列出path下一层的目录和文件，不包括子目录</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> os</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.listdir()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.listdir(<span class="string">r&#x27;D:\---Programming---\Python\Python&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;DLLs&#x27;</span>, <span class="string">&#x27;Doc&#x27;</span>, <span class="string">&#x27;include&#x27;</span>, <span class="string">&#x27;Lib&#x27;</span>, <span class="string">&#x27;libs&#x27;</span>, <span class="string">&#x27;LICENSE.txt&#x27;</span>, <span class="string">&#x27;NEWS.txt&#x27;</span>, <span class="string">&#x27;python-3.8.3-amd64.exe&#x27;</span>, <span class="string">&#x27;python.exe&#x27;</span>, <span class="string">&#x27;python3.dll&#x27;</span>, <span class="string">&#x27;python38.dll&#x27;</span>, <span class="string">&#x27;pythonw.exe&#x27;</span>, <span class="string">&#x27;Scripts&#x27;</span>, <span class="string">&#x27;tcl&#x27;</span>, <span class="string">&#x27;Tools&#x27;</span>, <span class="string">&#x27;vcruntime140.dll&#x27;</span>, <span class="string">&#x27;vcruntime140_1.dll&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span> os.listdir(<span class="string">r&#x27;D:\---Programming---\Python\Python&#x27;</span>):</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(i)</span><br><span class="line">...</span><br><span class="line">DLLs</span><br><span class="line">Doc</span><br><span class="line">include</span><br><span class="line">Lib</span><br><span class="line">libs</span><br><span class="line">LICENSE.txt</span><br><span class="line">NEWS.txt</span><br><span class="line">python-<span class="number">3.8</span><span class="number">.3</span>-amd64.exe</span><br><span class="line">python.exe</span><br><span class="line">python3.dll</span><br><span class="line">python38.dll</span><br><span class="line">pythonw.exe</span><br><span class="line">Scripts</span><br><span class="line">tcl</span><br><span class="line">Tools</span><br><span class="line">vcruntime140.dll</span><br><span class="line">vcruntime140_1.dll</span><br></pre></td></tr></table></figure><p>walk() 列出path下的目录和文件，包括子目录</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">cwd = os.getcwd()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> os.walk(cwd):</span><br><span class="line">    <span class="built_in">print</span>(i, end=<span class="string">&#x27;\n\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">(<span class="string">&#x27;D:\\Project&#x27;</span>, </span><br><span class="line"> [<span class="string">&#x27;weather&#x27;</span>, <span class="string">&#x27;__pycache__&#x27;</span>], </span><br><span class="line"> [<span class="string">&#x27;app.config&#x27;</span>, <span class="string">&#x27;io.txt&#x27;</span>, <span class="string">&#x27;mo.py&#x27;</span>, <span class="string">&#x27;mo2.py&#x27;</span>, <span class="string">&#x27;my.log&#x27;</span>, <span class="string">&#x27;test.py&#x27;</span>])</span><br><span class="line"></span><br><span class="line">(<span class="string">&#x27;D:\\Project\\weather&#x27;</span>,</span><br><span class="line"> [<span class="string">&#x27;.idea&#x27;</span>, <span class="string">&#x27;__pycache__&#x27;</span>],</span><br><span class="line"> [<span class="string">&#x27;city_code.csv&#x27;</span>, <span class="string">&#x27;city_code.txt&#x27;</span>, <span class="string">&#x27;query.py&#x27;</span>, <span class="string">&#x27;Ui_weather.py&#x27;</span>, <span class="string">&#x27;weather.py&#x27;</span>, <span class="string">&#x27;weather.ui&#x27;</span>])</span><br><span class="line"></span><br><span class="line">(<span class="string">&#x27;D:\\Project\\weather\\.idea&#x27;</span>,</span><br><span class="line"> [<span class="string">&#x27;inspectionProfiles&#x27;</span>],</span><br><span class="line"> [<span class="string">&#x27;misc.xml&#x27;</span>, <span class="string">&#x27;modules.xml&#x27;</span>, <span class="string">&#x27;weather.iml&#x27;</span>, <span class="string">&#x27;workspace.xml&#x27;</span>])</span><br><span class="line"></span><br><span class="line">(<span class="string">&#x27;D:\\Project\\weather\\.idea\\inspectionProfiles&#x27;</span>,</span><br><span class="line"> [],</span><br><span class="line"> [<span class="string">&#x27;Project_Default.xml&#x27;</span>])</span><br><span class="line"></span><br><span class="line">(<span class="string">&#x27;D:\\Project\\weather\\__pycache__&#x27;</span>,</span><br><span class="line"> [],</span><br><span class="line"> [<span class="string">&#x27;query.cpython-37.pyc&#x27;</span>, <span class="string">&#x27;Ui_weather.cpython-37.pyc&#x27;</span>])</span><br><span class="line"></span><br><span class="line">(<span class="string">&#x27;D:\\Project\\__pycache__&#x27;</span>,</span><br><span class="line"> [],</span><br><span class="line"> [<span class="string">&#x27;mo.cpython-38.pyc&#x27;</span>, <span class="string">&#x27;Person.cpython-38.pyc&#x27;</span>])</span><br></pre></td></tr></table></figure><p><code>os.walk(path)</code>返回的是一个<code>生成器 generator</code><br>每次返回一个元组，元组中共有三个元素：(root, dirs, files)</p><ol><li>第一个<code>root</code>是一个string，表示当前层的<strong>路径</strong></li><li>第二个<code>dirs</code>是一个list，表示当前层<strong>拥有的目录</strong></li><li>第三个<code>files</code>是一个list，表示当前层<strong>拥有的文件</strong></li></ol><h2 id="创建目录-mkdir、makedirs"><a href="#创建目录-mkdir、makedirs" class="headerlink" title="创建目录 mkdir、makedirs"></a>创建目录 mkdir、makedirs</h2><blockquote><p><code>os.mkdir(path)</code>，<strong>创建单层目录</strong>；path可以是相对路径或绝对路径<br>如果目录已存在，会抛出<code>FileExistsError</code>错误。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 标准创建目录流程</span></span><br><span class="line">dirpath = <span class="string">&#x27;iodir&#x27;</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(dirpath):</span><br><span class="line">    os.mkdir(dirpath)</span><br></pre></td></tr></table></figure><blockquote><p><code>os.makedirs(dir/subdir)</code>，<strong>创建多层目录</strong>；<br>如果目录已存在，会抛出<code>FileExistsError</code>错误。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建多层目录</span></span><br><span class="line">dirpath = <span class="string">&#x27;iodir/subiodir&#x27;</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(dirpath):</span><br><span class="line">    os.makedirs(dirpath)</span><br></pre></td></tr></table></figure><h2 id="删除目录-rmdir、shutil-rmtree"><a href="#删除目录-rmdir、shutil-rmtree" class="headerlink" title="删除目录 rmdir、shutil.rmtree"></a>删除目录 rmdir、shutil.rmtree</h2><blockquote><p><code>os.rmdir(path)</code>，<strong>删除空目录</strong>；path可以说相对路径或绝对路径<br>如果目录不存在，会抛出<code>FileNotFoundError</code>错误。<br>如果目录不为空，会抛出<code>OSError</code>错误。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 标准删除目录流程</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">dirpath = <span class="string">&#x27;iodir&#x27;</span></span><br><span class="line"><span class="keyword">if</span> os.path.exists(dirpath):</span><br><span class="line">    os.rmdir(dirpath)</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">没任何输出，删除目录成功</span><br><span class="line"></span><br><span class="line">目录下不为空，输出：</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  ...</span><br><span class="line">OSError: [WinError <span class="number">145</span>] 目录不是空的。: <span class="string">&#x27;iodir&#x27;</span></span><br></pre></td></tr></table></figure><blockquote><p><code>shutil,rmtree(path)</code>，<strong>删除非空目录</strong>；<br>如果目录不存在，会抛出<code>FileNotFoundError</code>错误。</p></blockquote><p><code>iodir</code>下有一个<code>io.txt</code>文件，执行<code>shuitl.rmtree()</code>如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os, shuitl</span><br><span class="line"></span><br><span class="line">dirpath = <span class="string">&#x27;iodir&#x27;</span></span><br><span class="line"><span class="keyword">if</span> os.path.exists(dirpath):</span><br><span class="line">    shuitl.rmtree(dirpath)</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">没任何输出，删除目录成功</span><br><span class="line"></span><br><span class="line">目录不存在，输出：</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  ...</span><br><span class="line">FileNotFoundError: [WinError <span class="number">3</span>] 系统找不到指定的路径。: <span class="string">&#x27;iodir&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="删除文件"><a href="#删除文件" class="headerlink" title="删除文件"></a>删除文件</h2><blockquote><p><code>os.remove(filename)</code>；<strong>删除单个文件</strong></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">filename = <span class="string">&#x27;io.txt&#x27;</span></span><br><span class="line"><span class="keyword">if</span> os.path.exists(filename):</span><br><span class="line">    os.remove(filename)</span><br></pre></td></tr></table></figure><h2 id="路径拼接-join"><a href="#路径拼接-join" class="headerlink" title="路径拼接 join"></a>路径拼接 join</h2><blockquote><p><code>os.path.join()</code><br>不用的操作系统路径分隔符是不同的<br>例如在<code>windows</code>下是<code>\</code>，在<code>Linux/Unix/Mac OS X</code>下是<code>/</code><br>所以保险起见，在拼接路径的时候用os提供的<code>os.path.join()</code>函数。<br>这样在不同操作系统中运行代码的时候都可以得到正确的路径拼接。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="built_in">dir</span> = os.path.join(<span class="string">&#x27;gpdir&#x27;</span>, <span class="string">&#x27;padir&#x27;</span>, <span class="string">&#x27;subdir&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">dir</span>)</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output in windows:</span></span><br><span class="line">gpdir\padir\subdir</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output in Linux/Unix</span></span><br><span class="line">gpdir/padir/subdir</span><br></pre></td></tr></table></figure><h2 id="路径拆分-split"><a href="#路径拆分-split" class="headerlink" title="路径拆分 split"></a>路径拆分 split</h2><blockquote><p><code>os.path.split()</code><br>返回值是一个<strong>双元素元组</strong>，第一个元素是路径的前部分，第二个元素是最后级别的目录或文件名</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.path.split(<span class="string">&#x27;gpdir\padir\subdir&#x27;</span>)</span><br><span class="line">(<span class="string">&#x27;gpdir\\padir&#x27;</span>, <span class="string">&#x27;subdir&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.path.split(<span class="string">&#x27;gpdir/padir/subdir&#x27;</span>)</span><br><span class="line">(<span class="string">&#x27;gpdir/padir&#x27;</span>, <span class="string">&#x27;subdir&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="获取文件扩展名-splitext"><a href="#获取文件扩展名-splitext" class="headerlink" title="获取文件扩展名 splitext"></a>获取文件扩展名 splitext</h2><blockquote><p><code>os.path.splitext()</code><br>返回值是一个<strong>双元素元组</strong>，第一个元素是路径前部分，第二个元素是最后级别文件的扩展名</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.path.splitext(<span class="string">&#x27;gpdir/padir/subdir/io.txt&#x27;</span>)</span><br><span class="line">(<span class="string">&#x27;gpdir/padir/subdir/io&#x27;</span>, <span class="string">&#x27;.txt&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.path.splitext(<span class="string">&#x27;gpdir/padir/subdir&#x27;</span>)</span><br><span class="line">(<span class="string">&#x27;gpdir/padir/subdir&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.path.splitext(<span class="string">&#x27;gpdir\padir\subdir\io.txt&#x27;</span>)</span><br><span class="line">(<span class="string">&#x27;gpdir\\padir\\subdir\\io&#x27;</span>, <span class="string">&#x27;.txt&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.path.splitext(<span class="string">&#x27;gpdir\padir\subdir&#x27;</span>)</span><br><span class="line">(<span class="string">&#x27;gpdir\\padir\\subdir&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="文件、目录重命名"><a href="#文件、目录重命名" class="headerlink" title="文件、目录重命名"></a>文件、目录重命名</h2><blockquote><p><code>os.rename(oldName, newName)</code><br>可以对文件或目录进行重命名</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>.rename(<span class="string">&#x27;testdir&#x27;</span>, <span class="string">&#x27;newtestdir&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.rename(<span class="string">&#x27;test.txt&#x27;</span>, <span class="string">&#x27;iotest.py&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="判断是目录还是文件"><a href="#判断是目录还是文件" class="headerlink" title="判断是目录还是文件"></a>判断是目录还是文件</h2><blockquote><p><code>os.path.isdir(path)</code><br><code>os.path.isfile(path)</code></p></blockquote><h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p>列出当前目录下所有目录</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>[x <span class="keyword">for</span> x <span class="keyword">in</span> os.listdir() <span class="keyword">if</span> os.path.isdir(x)]</span><br><span class="line">[<span class="string">&#x27;.lein&#x27;</span>, <span class="string">&#x27;.local&#x27;</span>, <span class="string">&#x27;.m2&#x27;</span>, <span class="string">&#x27;.npm&#x27;</span>, <span class="string">&#x27;.ssh&#x27;</span>, <span class="string">&#x27;.vim&#x27;</span>, <span class="string">&#x27;Applications&#x27;</span>, <span class="string">&#x27;Desktop&#x27;</span>, ...]</span><br></pre></td></tr></table></figure><p>列出当前目录下所有<code>.py</code>文件</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>[x <span class="keyword">for</span> x <span class="keyword">in</span> os.listdir() <span class="keyword">if</span> os.path.isfile(x) <span class="keyword">and</span> os.path.splitext(x)[<span class="number">1</span>] == <span class="string">&#x27;.py&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;apis.py&#x27;</span>, <span class="string">&#x27;config.py&#x27;</span>, <span class="string">&#x27;models.py&#x27;</span>, <span class="string">&#x27;test_db.py&#x27;</span>, <span class="string">&#x27;urls.py&#x27;</span>, <span class="string">&#x27;wsgiapp.py&#x27;</span>]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
          <category> 进阶 </category>
          
          <category> IO </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python【No-19】文件读写</title>
      <link href="posts/3887"/>
      <url>posts/3887</url>
      
        <content type="html"><![CDATA[<p>文件基本操作</p><span id="more"></span><p>同步和异步的区别就在于是否等待IO执行的结果。好比你去麦当劳点餐，<br>你说“来个汉堡”，服务员告诉你，对不起，汉堡要现做，需要等5分钟，于是你站在收银台前面等了5分钟，拿到汉堡再去逛商场，这是<strong>同步IO</strong>。</p><p>你说“来个汉堡”，服务员告诉你，汉堡需要等5分钟，你可以先去逛商场，等做好了，我们再通知你，这样你可以立刻去干别的事情（逛商场），这是<strong>异步IO</strong>。</p><p>很明显，使用异步IO来编写程序性能会远远高于同步IO，但是异步IO的缺点是编程模型复杂。想想看，你得知道什么时候通知你“汉堡做好了”，而通知你的方法也各不相同。如果是服务员跑过来找到你，这是<strong>回调模式</strong>，如果服务员发短信通知你，你就得不停地检查手机，这是<strong>轮询模式</strong>。总之，异步IO的复杂度远远高于同步IO。</p><p>文件读写其实都是由操作系统完成的，现代操作系统是不允许普通程序直接操作磁盘的，所以读写文件就是请求操作系统打开一个<code>文件对象</code>（又称：文件描述符），通过操作系统提供的接口从这个<code>文件对象</code>中读取数据或写入数据</p><h2 id="同步IO"><a href="#同步IO" class="headerlink" title="同步IO"></a>同步IO</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;r/w/a&#x27;</span>) <span class="keyword">as</span> alias:</span><br><span class="line">···     do sth</span><br></pre></td></tr></table></figure><p><code>r</code>  ：读<br><code>w</code>  ：覆盖写<br><code>a+</code>：追加写</p><h3 id="读-read"><a href="#读-read" class="headerlink" title="读 read"></a>读 read</h3><p>读取的过程：1. 打开文件；2. 读取文件；3. 关闭文件</p><ul><li><p>第一步：<code>f = open(&#39;/user/boii/io_note.txt&#39;, &#39;r&#39;)</code><br>  用python内置的<code>open()</code>函数打开一个文件对象，<br>  第一个参数传入读的文件的路径，第二个参数传入<code>r</code>为读取的意思<br>  如果打开成功，<code>open()</code>会返回一个<code>文件对象</code>；<br>  如果打开失败，<code>open()</code>会抛出一个<code>IOError</code>错误。</p></li><li><p>第二步：<code>f.read()</code><br>  通过<code>read()</code>方法，可以将全部内容读取出来。</p></li><li><p>第三步：<code>f.close()</code><br>  文件打开成功后，必须使用<code>close()</code>方法关闭文件。<br>  因为文件对象会占用操作系统资源，且操作系统同一时间能打开的文件数量也有限。<br>  文件打开失败后，会产生<code>IOError</code>，则不会调用<code>f.close()</code></p></li></ul><p>综合起来可以这么写：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    f = <span class="built_in">open</span>(<span class="string">&#x27;/user/boii/io_note.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>)    <span class="comment"># 打开文件</span></span><br><span class="line">    <span class="built_in">print</span>(f.read())    <span class="comment"># 读取文件</span></span><br><span class="line"><span class="keyword">except</span> IOError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(e)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    f.close()    <span class="comment"># 关闭文件</span></span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line"><span class="comment"># 如果文件打开成功，会输出（文件全部内容）：io</span></span><br><span class="line"><span class="comment"># 如果文件打开失败，会输出：[Errno 2] No such file or directory: &#x27;/user/boii/io_note.txt&#x27;</span></span><br></pre></td></tr></table></figure><p>但是这样太繁琐，一点也不符合Python优雅的气质。<br>所以 Python 引入了<code>with</code>语句来自动帮我们调用<code>close()</code>方法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;/user/boii/io_note.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="built_in">print</span>(f.read())</span><br></pre></td></tr></table></figure><h4 id="指定字节-read-size"><a href="#指定字节-read-size" class="headerlink" title="指定字节 read(size)"></a>指定字节 read(size)</h4><blockquote><p><code>file_obj.read(size)</code></p></blockquote><p><code>read()</code>方法不填写参数，直接读取文件全部内容。如果一个文件太大，全部读取会爆内存的。<br>所以可以通过指定 size 的方式指定读取 size 个字节的内容。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># io.txt</span></span><br><span class="line">Hello Python!</span><br><span class="line">I am Boii.</span><br><span class="line">I am learning.</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># io_read.py</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;io.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = f.read(<span class="number">8</span>)    <span class="comment"># 读取前8个字节</span></span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">Hello Py</span><br></pre></td></tr></table></figure><h4 id="跳过字节-seek-size"><a href="#跳过字节-seek-size" class="headerlink" title="跳过字节 seek(size)"></a>跳过字节 seek(size)</h4><blockquote><p><code>file_obj.seek(size)</code></p></blockquote><p>通过 <code>seek()</code>可以在读取之前跳过 size 个字节，再开始读取</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># io.txt</span></span><br><span class="line">Hello Python!</span><br><span class="line">I am Boii.</span><br><span class="line">I am learning.</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># io_read.py</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;io.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.seek(<span class="number">3</span>)</span><br><span class="line">    data = f.read(<span class="number">8</span>)    <span class="comment"># 读取前8个字节</span></span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">lo Pytho</span><br></pre></td></tr></table></figure><h4 id="读取一行-readline"><a href="#读取一行-readline" class="headerlink" title="读取一行 readline()"></a>读取一行 readline()</h4><blockquote><p><code>file_obj.readline()</code></p></blockquote><p><code>readline()</code>方法会读取文件的一行，遇到<code>\n</code>就认为是一行</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># io.txt</span></span><br><span class="line">Hello Python!</span><br><span class="line">I am Boii.</span><br><span class="line">I am learning.</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># io_read.py</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;io.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = f.readline()    <span class="comment"># 读取第一行</span></span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">Hello Python!</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这样只能读取一行，可以使用 <code>while</code> 循环一行一行的读取</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># io.txt</span></span><br><span class="line">Hello Python!</span><br><span class="line">I am Boii.</span><br><span class="line">I am learning.</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># io_read.py</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;io.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = f.readline()    <span class="comment"># 读取第一行</span></span><br><span class="line">    <span class="keyword">while</span> data:</span><br><span class="line">        <span class="built_in">print</span>(data, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        data = f.readline()    <span class="comment"># 接着读下一行</span></span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">Hello Python!</span><br><span class="line">I am Boii.</span><br><span class="line">I am learning.</span><br></pre></td></tr></table></figure><h4 id="读取多行-readlines"><a href="#读取多行-readlines" class="headerlink" title="读取多行 readlines()"></a>读取多行 readlines()</h4><blockquote><p><code>file_obj.readlines()</code></p></blockquote><p><code>readlines()</code>方法会一次性读取文件中多行内容，最后返回一个 list，一个元素一行内容。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># io.txt</span></span><br><span class="line">Hello Python!</span><br><span class="line">I am Boii.</span><br><span class="line">I am learning.</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># io_read.py</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;io.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    datas = f.readlines()    <span class="comment"># 读取多行</span></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> datas:</span><br><span class="line">        <span class="built_in">print</span>(line, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">Hello Python!</span><br><span class="line">I am Boii.</span><br><span class="line">I am learning.</span><br></pre></td></tr></table></figure><p>效果是一样的。</p><h3 id="写-write"><a href="#写-write" class="headerlink" title="写 write"></a>写 write</h3><p>写入的过程：1. 打开文件；2. 写入文件；3. 关闭文件</p><p>写入同样可以使用<code>with</code>语句，<code>with</code>语句自动会关闭文件<br>读文件的时候如果文件不存在，会抛出 <code>IOError</code> 错误<br>写文件的时候如果文件不存在，会创建文件</p><p>写入有两种，一种是覆盖原有内容写入新内容；一种是在原有内容基础上追加新内容。<br>覆盖写在<code>open()</code>函数中要传入 <code>w</code>，追加写在<code>open()</code>函数中要传入<code>a</code></p><h4 id="写入单行-wirte"><a href="#写入单行-wirte" class="headerlink" title="写入单行 wirte()"></a>写入单行 wirte()</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># io_write.py</span></span><br><span class="line">contend = <span class="string">&#x27;&#x27;&#x27;I am the contend which be writed down into file.</span></span><br><span class="line"><span class="string">Hello Python!&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;io.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(contend)    <span class="comment"># 写入文件</span></span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># io.txt</span></span><br><span class="line">I am the contend which be writed down into file.</span><br><span class="line">Hello Python!</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="写入多行-writelines"><a href="#写入多行-writelines" class="headerlink" title="写入多行 writelines()"></a>写入多行 writelines()</h4><blockquote><p><code>file_obj.writelines(str)</code></p></blockquote><p>当有多行要写入的时候，除了上面用 <code>&#39;&#39;&#39;</code>的多行字符串，可以用 <code>writelines(list)</code>来将内容一次写入。第一个参数接受的是一个 list 列表 或 string 字符串</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># io_write.py</span></span><br><span class="line">datas = [<span class="string">&#x27;Hello Python!&#x27;</span>, <span class="string">&#x27;I am Boii&#x27;</span>, <span class="string">&#x27;I like coding&#x27;</span>]</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;io.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.writelines(datas)    <span class="comment"># 写入文件</span></span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># io.txt</span></span><br><span class="line">Hello Python!I am BoiiI like coding</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>跟预设结果不一样，并没有换行符。可以直接给<code>datas</code>的每个元素加上<code>\n</code><br>但是这种办法很费力，且很多时候内容不是你决定的，这时候 列表生成式 就排上用场了。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># io_write.py</span></span><br><span class="line">datas = [<span class="string">&#x27;Hello Python!&#x27;</span>, <span class="string">&#x27;I am Boii&#x27;</span>, <span class="string">&#x27;I like coding&#x27;</span>]</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;io.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    new_datas = [line + <span class="string">&#x27;\n&#x27;</span> <span class="keyword">for</span> line <span class="keyword">in</span> datas]</span><br><span class="line">    f.writelines(new_datas)    <span class="comment"># 写入文件</span></span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># io.txt</span></span><br><span class="line">Hello Python!</span><br><span class="line">I am Boii</span><br><span class="line">I like coding</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="追加写"><a href="#追加写" class="headerlink" title="追加写"></a>追加写</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># io_write.py</span></span><br><span class="line">contend = <span class="string">&#x27;&#x27;&#x27;I am the contend which be writed down into file.</span></span><br><span class="line"><span class="string">Hello Python!&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;io.txt&#x27;</span>, <span class="string">&#x27;a&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(contend)    <span class="comment"># 写入文件</span></span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># io.txt 第一次执行</span></span><br><span class="line">I am the contend which be writed down into file.</span><br><span class="line">Hello Python!</span><br><span class="line"></span><br><span class="line"><span class="comment"># io.txt 第二次执行</span></span><br><span class="line">I am the contend which be writed down into file.</span><br><span class="line">Hello Python!I am the contend which be writed down into file.</span><br><span class="line">Hello Python!</span><br></pre></td></tr></table></figure><h3 id="打开模式"><a href="#打开模式" class="headerlink" title="打开模式"></a>打开模式</h3><p>打开模式有很多，大致分为：</p><table><thead><tr><th align="left">字符</th><th align="left">意义</th></tr></thead><tbody><tr><td align="left">r</td><td align="left">读取（默认）</td></tr><tr><td align="left">w</td><td align="left">覆盖写</td></tr><tr><td align="left">a</td><td align="left">追加写</td></tr><tr><td align="left">x</td><td align="left">排他性创建，如果文件已存在则失败</td></tr><tr><td align="left">b</td><td align="left">二进制模式</td></tr><tr><td align="left">t</td><td align="left">文本模式（默认）</td></tr><tr><td align="left">+</td><td align="left">可读可写</td></tr></tbody></table><p>表中的字符组合起来就有丰富的打开方式<br><code>r</code>只读，<code>r+</code>可读可写，<code>rb</code>只读一个二进制文件（图片音视频等）<br><code>w</code>只覆盖写，<code>w+</code>可读可覆盖写，<code>wb</code>只覆盖写一个二进制文件<br><code>a</code>只追加写，<code>a+</code>可读可追加写，以此类推</p><h3 id="字符编码"><a href="#字符编码" class="headerlink" title="字符编码"></a>字符编码</h3><p>要读取非UTF-8编码的文件，需要给<code>open()</code>函数传入<code>encoding</code>参数</p><p>例如打开一个GBK编码的文件</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;io.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;gbk&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">···    <span class="built_in">print</span>(f.read())</span><br><span class="line">Hello Python!</span><br></pre></td></tr></table></figure><p>但有时候打开的文件编码不规范，混杂了多种编码的字符，<br>而打开时只能按一种编码打开，所以势必会造成乱码。<br>这种乱码的处理可以用 <code>errors</code>参数。</p><blockquote><p><code>open(filepath, mode, encoding=&#39;value&#39;, errors=&#39;value&#39;)</code><br><code>errors</code>参数的值有</p></blockquote><ul><li>ignore：直接忽略</li><li>strict：引发<code>ValueError</code>异常。与默认值<code>None</code>效果相同</li><li>replace_sign：会将错误的地方替换为指定的<code>replace_sign</code>符号</li><li>其他</li></ul>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
          <category> 进阶 </category>
          
          <category> IO </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python【No-18】协程</title>
      <link href="posts/37243"/>
      <url>posts/37243</url>
      
        <content type="html"><![CDATA[<p>协程，时间管理大师</p><span id="more"></span><blockquote><p><strong>线程</strong>是系统级别的，由操作系统调度<br><strong>协程</strong>是程序级别的，由程序根据需要自己调度</p></blockquote><p>协程可以想象成线程里的线程，也就是将一个线程里多个任务分拆给多个协程。</p><p>使用线程的时候是：线程执行遇到耗时（阻塞）的地方，再开一个线程，去执行这个耗时的任务，原本的线程继续执行。<br>就好比我在算题，算着算着计算量比较大比较耗时，我就叫了小明帮我算，我继续算下面的。</p><p>使用协程的时候是：利用别的协程执行耗时操作时的那点时间切换去别的协程继续执行，也就是在协程之间反复横跳。<br>就好比我在算题，算着算着计算量有点大，就先做别的题，回头自己再继续把题算完</p><p>协程的优点：</p><ol><li>无需线程上下文切换的开销，因为都在同一个线程里，避免了无意义的调度，由此可以提高性能。</li><li>无需原子操作锁定及同步的开销</li><li>方便切换控制流，简化编程模型</li><li>高并发+高扩展性+低成本：一个CPU支持上万个协程都不是问题。所以很适合高并发处理。</li></ol><p>缺点：</p><ol><li>因为协程都是程序调度的，所以需要程序员承担调度的责任，同时也失去了标准线程使用多CPU的能力</li><li>无法利用多核资源：协程的本质是个单线程，不能同时用上单个CPU的多个核。协程需要和进程配合才能运行在多CPU上，不过绝大部分应用都没有这个必要，除非是CPU密集型应用</li><li>进行阻塞操作（如IO）会阻塞掉整个程序。</li></ol><h2 id="使用-yield-实现并发"><a href="#使用-yield-实现并发" class="headerlink" title="使用 yield 实现并发"></a>使用 yield 实现并发</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task_1</span>():</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;&#123;:-^16s&#125;&quot;</span>.<span class="built_in">format</span>(<span class="string">&quot;task_1&quot;</span>))</span><br><span class="line">        time.sleep(<span class="number">0.1</span>)</span><br><span class="line">        <span class="keyword">yield</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task_2</span>():</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;&#123;:-^16s&#125;&quot;</span>.<span class="built_in">format</span>(<span class="string">&quot;task_2&quot;</span>))</span><br><span class="line">        time.sleep(<span class="number">0.1</span>)</span><br><span class="line">        <span class="keyword">yield</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    t1 = task_1()</span><br><span class="line">    t2 = task_2()</span><br><span class="line">    <span class="comment"># 先让t1运行一会儿，当t1中遇到yield的时候，再返回到main()的while循环</span></span><br><span class="line">    <span class="comment"># 然后执行t2，当它遇到yield的时候，再次切换到t1中</span></span><br><span class="line">    <span class="comment"># 就这样t1/t2/t1/t2...交替运行，最终实现了多任务...协程</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="built_in">next</span>(t1)</span><br><span class="line">        <span class="built_in">next</span>(t2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">-----task_1-----</span><br><span class="line">-----task_2-----</span><br><span class="line">-----task_1-----</span><br><span class="line">-----task_2-----</span><br><span class="line">-----task_1-----</span><br><span class="line">-----task_2-----</span><br><span class="line">-----task_1-----</span><br><span class="line">-----task_2-----</span><br><span class="line">-----task_1-----</span><br><span class="line">-----task_2-----</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h2 id="使用-greenlet-实现并发"><a href="#使用-greenlet-实现并发" class="headerlink" title="使用 greenlet 实现并发"></a>使用 greenlet 实现并发</h2><p>&gt;_: pip install greenlet</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> greenlet <span class="keyword">import</span> greenlet</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task_1</span>():</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;&#123;:-^16s&#125;&quot;</span>.<span class="built_in">format</span>(<span class="string">&quot;task_1&quot;</span>))</span><br><span class="line">        gr2.switch()        <span class="comment"># 切换到 gr2中，也就是 task_2() 中运行</span></span><br><span class="line">        time.sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task_2</span>():</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;&#123;:-^16s&#125;&quot;</span>.<span class="built_in">format</span>(<span class="string">&quot;task_2&quot;</span>))</span><br><span class="line">        gr1.switch()        <span class="comment"># 切换到 gr1中，也就是 task_1() 中运行</span></span><br><span class="line">        time.sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line">gr1 = greenlet(task_1)</span><br><span class="line">gr2 = greenlet(task_2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换到 gr1中，也就是 task_1() 中运行</span></span><br><span class="line">gr1.switch</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">-----task_1-----</span><br><span class="line">-----task_2-----</span><br><span class="line">-----task_1-----</span><br><span class="line">-----task_2-----</span><br><span class="line">-----task_1-----</span><br><span class="line">-----task_2-----</span><br><span class="line">-----task_1-----</span><br><span class="line">-----task_2-----</span><br><span class="line">-----task_1-----</span><br><span class="line">-----task_2-----</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h2 id="使用-gevent-实现并发"><a href="#使用-gevent-实现并发" class="headerlink" title="使用 gevent 实现并发"></a>使用 gevent 实现并发</h2><blockquote><p><code>import gevent</code><br><code>gevent.spawn(funcName, args)</code></p></blockquote><p>先看看没有阻塞操作的时候：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 没有阻塞</span></span><br><span class="line"><span class="keyword">import</span> gevent</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task_1</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="built_in">print</span>(gevent.getcurrent(), i)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task_2</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="built_in">print</span>(gevent.getcurrent(), i)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task_3</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="built_in">print</span>(gevent.getcurrent(), i)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    g1 = gevent.spawn(task_1, <span class="number">5</span>)</span><br><span class="line">    g2 = gevent.spawn(task_2, <span class="number">5</span>)</span><br><span class="line">    g3 = gevent.spawn(task_3, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">    g1.join()</span><br><span class="line">    g2.join()</span><br><span class="line">    g3.join()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1f6eaf0cd00</span>: task_1(<span class="number">5</span>)&gt; <span class="number">0</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1f6eaf0cd00</span>: task_1(<span class="number">5</span>)&gt; <span class="number">1</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1f6eaf0cd00</span>: task_1(<span class="number">5</span>)&gt; <span class="number">2</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1f6eaf0cd00</span>: task_1(<span class="number">5</span>)&gt; <span class="number">3</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1f6eaf0cd00</span>: task_1(<span class="number">5</span>)&gt; <span class="number">4</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1f6eaf0ce10</span>: task_2(<span class="number">5</span>)&gt; <span class="number">0</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1f6eaf0ce10</span>: task_2(<span class="number">5</span>)&gt; <span class="number">1</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1f6eaf0ce10</span>: task_2(<span class="number">5</span>)&gt; <span class="number">2</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1f6eaf0ce10</span>: task_2(<span class="number">5</span>)&gt; <span class="number">3</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1f6eaf0ce10</span>: task_2(<span class="number">5</span>)&gt; <span class="number">4</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1f6eaf0cbf0</span>: task_3(<span class="number">5</span>)&gt; <span class="number">0</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1f6eaf0cbf0</span>: task_3(<span class="number">5</span>)&gt; <span class="number">1</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1f6eaf0cbf0</span>: task_3(<span class="number">5</span>)&gt; <span class="number">2</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1f6eaf0cbf0</span>: task_3(<span class="number">5</span>)&gt; <span class="number">3</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1f6eaf0cbf0</span>: task_3(<span class="number">5</span>)&gt; <span class="number">4</span></span><br></pre></td></tr></table></figure><p>gevent 是利用协程阻塞的时候去执行别的协程<br>这里没有阻塞操作，所以并不会发生什么变化，跟普通函数调用一样，更提不上并发</p><p>现在来加点阻塞操作看看</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 有阻塞</span></span><br><span class="line"><span class="keyword">import</span> gevent</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task_1</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="built_in">print</span>(gevent.getcurrent(), i)</span><br><span class="line">        <span class="comment"># time.sleep(0.1)    # 在gevent中，time.sleep()这种阻塞操作是不起作用的</span></span><br><span class="line">        gevent.sleep(<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task_2</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="built_in">print</span>(gevent.getcurrent(), i)</span><br><span class="line">        gevent.sleep(<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task_3</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="built_in">print</span>(gevent.getcurrent(), i)</span><br><span class="line">        gevent.sleep(<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    g1 = gevent.spawn(task_1, <span class="number">5</span>)</span><br><span class="line">    g2 = gevent.spawn(task_2, <span class="number">5</span>)</span><br><span class="line">    g3 = gevent.spawn(task_3, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">    g1.join()</span><br><span class="line">    g2.join()</span><br><span class="line">    g3.join()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1433a62b370</span>: task_1(<span class="number">5</span>)&gt; <span class="number">0</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1433a62b590</span>: task_2(<span class="number">5</span>)&gt; <span class="number">0</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1433a62b480</span>: task_3(<span class="number">5</span>)&gt; <span class="number">0</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1433a62b370</span>: task_1(<span class="number">5</span>)&gt; <span class="number">1</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1433a62b590</span>: task_2(<span class="number">5</span>)&gt; <span class="number">1</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1433a62b480</span>: task_3(<span class="number">5</span>)&gt; <span class="number">1</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1433a62b370</span>: task_1(<span class="number">5</span>)&gt; <span class="number">2</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1433a62b590</span>: task_2(<span class="number">5</span>)&gt; <span class="number">2</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1433a62b480</span>: task_3(<span class="number">5</span>)&gt; <span class="number">2</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1433a62b370</span>: task_1(<span class="number">5</span>)&gt; <span class="number">3</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1433a62b590</span>: task_2(<span class="number">5</span>)&gt; <span class="number">3</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1433a62b480</span>: task_3(<span class="number">5</span>)&gt; <span class="number">3</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1433a62b370</span>: task_1(<span class="number">5</span>)&gt; <span class="number">4</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1433a62b590</span>: task_2(<span class="number">5</span>)&gt; <span class="number">4</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1433a62b480</span>: task_3(<span class="number">5</span>)&gt; <span class="number">4</span></span><br></pre></td></tr></table></figure><p>上述代码 建立了三个 gevent 对象，里面分别转载了 task_1、task_2、task_3 三个执行函数。<br>接着三个 gevent 对象都使用 join 方法运行了执行函数<br>在三个执行函数中又用了 gevent.sleep() 模拟阻塞操作（在实际开发中并不会专门用sleep去阻塞，而是在执行到 IO 等耗时操作时，gevent自动切换。）</p><p>在执行 task_1 的时候，打印了第一句，然后遇到了 gevent.sleep() 的阻塞操作，切换到 task_2 ，打印了第二局，又遇到阻塞，又切换…一直到全部执行完毕</p><p>另外，task_1 中的 time.sleep() 在 gevent 管理的协程中是不起作用的，需要使用 gevent.sleep() 才行。</p><p>这就带来一个问题：如果我的代码是开发完了才加入了 gevent ，那岂不是要把很多地方手动改到 gevent 能接受。还好 gevent 提供了一个补丁</p><h3 id="gevent-补丁"><a href="#gevent-补丁" class="headerlink" title="gevent 补丁"></a>gevent 补丁</h3><blockquote><p><code>from gevent import monkey</code><br><code>monkey.patch_all()</code><br>一定要写在最上方</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> gevent</span><br><span class="line"><span class="keyword">from</span> gevent <span class="keyword">import</span> monkey</span><br><span class="line"></span><br><span class="line">monkey.patch_all()    <span class="comment"># 打补丁</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task_1</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="built_in">print</span>(gevent.getcurrent(), i)</span><br><span class="line">        time.sleep(<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task_2</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="built_in">print</span>(gevent.getcurrent(), i)</span><br><span class="line">        time.sleep(<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task_3</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="built_in">print</span>(gevent.getcurrent(), i)</span><br><span class="line">        time.sleep(<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    g1 = gevent.spawn(task_1, <span class="number">5</span>)</span><br><span class="line">    g2 = gevent.spawn(task_2, <span class="number">5</span>)</span><br><span class="line">    g3 = gevent.spawn(task_3, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">    g1.join()</span><br><span class="line">    g2.join()</span><br><span class="line">    g3.join()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1433a62b370</span>: task_1(<span class="number">5</span>)&gt; <span class="number">0</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1433a62b590</span>: task_2(<span class="number">5</span>)&gt; <span class="number">0</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1433a62b480</span>: task_3(<span class="number">5</span>)&gt; <span class="number">0</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1433a62b370</span>: task_1(<span class="number">5</span>)&gt; <span class="number">1</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1433a62b590</span>: task_2(<span class="number">5</span>)&gt; <span class="number">1</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1433a62b480</span>: task_3(<span class="number">5</span>)&gt; <span class="number">1</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1433a62b370</span>: task_1(<span class="number">5</span>)&gt; <span class="number">2</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1433a62b590</span>: task_2(<span class="number">5</span>)&gt; <span class="number">2</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1433a62b480</span>: task_3(<span class="number">5</span>)&gt; <span class="number">2</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1433a62b370</span>: task_1(<span class="number">5</span>)&gt; <span class="number">3</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1433a62b590</span>: task_2(<span class="number">5</span>)&gt; <span class="number">3</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1433a62b480</span>: task_3(<span class="number">5</span>)&gt; <span class="number">3</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1433a62b370</span>: task_1(<span class="number">5</span>)&gt; <span class="number">4</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1433a62b590</span>: task_2(<span class="number">5</span>)&gt; <span class="number">4</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x1433a62b480</span>: task_3(<span class="number">5</span>)&gt; <span class="number">4</span></span><br></pre></td></tr></table></figure><h3 id="joinall"><a href="#joinall" class="headerlink" title="joinall"></a>joinall</h3><p>有没有发现</p><p>g1.join()<br>g2.join()<br>g3.join()</p><p>写了三个join<br>不如给他来个一次性</p><blockquote><p><code>gevent.joinall(spawn_list, timeout=None, raise_error=False, count=None)</code></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> gevent</span><br><span class="line"><span class="keyword">from</span> gevent <span class="keyword">import</span> monkey</span><br><span class="line"></span><br><span class="line">monkey.patch_all()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task_1</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="built_in">print</span>(gevent.getcurrent(), i)</span><br><span class="line">        time.sleep(<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task_2</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="built_in">print</span>(gevent.getcurrent(), i)</span><br><span class="line">        time.sleep(<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task_3</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="built_in">print</span>(gevent.getcurrent(), i)</span><br><span class="line">        time.sleep(<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="comment"># joinall 接受一个 spawn 列表</span></span><br><span class="line">    gevent.joinall([</span><br><span class="line">        gevent.spawn(task_1, <span class="number">5</span>),</span><br><span class="line">        gevent.spawn(task_2, <span class="number">5</span>),</span><br><span class="line">        gevent.spawn(task_3, <span class="number">5</span>)</span><br><span class="line">    ]， timeout=<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x12e8cba9d00</span>: task_1(<span class="number">5</span>)&gt; <span class="number">0</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x12e8cba9e10</span>: task_2(<span class="number">5</span>)&gt; <span class="number">0</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x12e8cba9bf0</span>: task_3(<span class="number">5</span>)&gt; <span class="number">0</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x12e8cba9d00</span>: task_1(<span class="number">5</span>)&gt; <span class="number">1</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x12e8cba9e10</span>: task_2(<span class="number">5</span>)&gt; <span class="number">1</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x12e8cba9bf0</span>: task_3(<span class="number">5</span>)&gt; <span class="number">1</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x12e8cba9d00</span>: task_1(<span class="number">5</span>)&gt; <span class="number">2</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x12e8cba9e10</span>: task_2(<span class="number">5</span>)&gt; <span class="number">2</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x12e8cba9bf0</span>: task_3(<span class="number">5</span>)&gt; <span class="number">2</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x12e8cba9d00</span>: task_1(<span class="number">5</span>)&gt; <span class="number">3</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x12e8cba9e10</span>: task_2(<span class="number">5</span>)&gt; <span class="number">3</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x12e8cba9bf0</span>: task_3(<span class="number">5</span>)&gt; <span class="number">3</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x12e8cba9d00</span>: task_1(<span class="number">5</span>)&gt; <span class="number">4</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x12e8cba9e10</span>: task_2(<span class="number">5</span>)&gt; <span class="number">4</span></span><br><span class="line">&lt;Greenlet at <span class="number">0x12e8cba9bf0</span>: task_3(<span class="number">5</span>)&gt; <span class="number">4</span></span><br></pre></td></tr></table></figure><p>只管在 joinall 里创建 spawn 对象就行，其他不用管，gevent 自己会处理好的<br>这也是最常用的方法</p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
          <category> 进阶 </category>
          
          <category> 进程、线程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python【No-17】线程</title>
      <link href="posts/34736"/>
      <url>posts/34736</url>
      
        <content type="html"><![CDATA[<p>线程，是操作系统调度的单位</p><span id="more"></span><p>一个程序写完了，放在硬盘里不运行，叫做<strong>程序</strong><br>一个程序写完了，放到内存里跑起来，叫做<strong>进程</strong><br>一个进程中至少有一个<strong>线程</strong>，称为<strong>主线程</strong><br>一个线程要干很多事情，有些事情很耗时，就创建个<strong>子线程</strong>，让子线程去做，主线程继续下一步</p><p>当有多个线程的时候，CPU会轮流切换执行，每个线程执行多长时间叫做<strong>时间片</strong><br>比如 t1 分到了0.001秒的时间片，t2 分到了0.002秒的时间片<br>显然这么短时间是不够执行的，所以CPU会快速的切来切去，这样就看起来好像能执行<strong>多任务</strong><br>多任务就是你可以同时听歌、写文档、挂QQ等等，但其实同一时刻CPU只执行一个线程<br>只不过切换的快，时间片也很小，所以人感觉不出来。</p><p>线程的执行顺序是由操作系统决定的，开发者左右不了。</p><blockquote><p>子线程由主线程创建，子线程关闭后留下的辣鸡由主线程清理<br>一旦主线程挂了，子线程全部挂掉。<br>主线程会等待所有子线程结束后才结束</p></blockquote><p>单线程操作</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">say_hi</span>():</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Hi!&#x27;</span>)</span><br><span class="line">        time.sleep(<span class="number">1</span>)    <span class="comment"># 耗时操作</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">say_yes</span>():</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Yes!&#x27;</span>)</span><br><span class="line">        time.sleep(<span class="number">1</span>)    <span class="comment"># 耗时操作</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    say_hi()</span><br><span class="line">    say_yes()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">Hi!</span><br><span class="line">Hi!</span><br><span class="line">Hi!</span><br><span class="line">Hi!</span><br><span class="line">Hi!</span><br><span class="line">Yes!</span><br><span class="line">Yes!</span><br><span class="line">Yes!</span><br><span class="line">Yes!</span><br><span class="line">Yes!</span><br></pre></td></tr></table></figure><p>多线程操作</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> threading    <span class="comment"># 导入 threading 模块</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">say_hi</span>():</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Hi!&#x27;</span>)</span><br><span class="line">        time.sleep(<span class="number">1</span>)    <span class="comment"># 耗时操作</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">say_yes</span>():</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Yes!&#x27;</span>)</span><br><span class="line">        time.sleep(<span class="number">1</span>)    <span class="comment"># 耗时操作</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    t1 = threading.Thread(target=say_hi)    <span class="comment"># 创建一个线程对象</span></span><br><span class="line">    t2 = threading.Thread(target=say_yes)   <span class="comment"># 创建一个线程对象</span></span><br><span class="line">    t1.start()    <span class="comment"># 启动线程</span></span><br><span class="line">    t2.start()    <span class="comment"># 启动线程</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">Hi!</span><br><span class="line">Yes!</span><br><span class="line">Hi!</span><br><span class="line">Yes!</span><br><span class="line">Hi!</span><br><span class="line">Yes!</span><br><span class="line">Yes!</span><br><span class="line">Hi!</span><br><span class="line">Hi!</span><br><span class="line">Yes!</span><br></pre></td></tr></table></figure><p>单线程和多线程的区别就像这个栗子</p><p>你要来一段热舞rap，</p><ul><li>单线程的操作是：rap完再热舞，或者热舞完再rap</li><li>多线程的操作是：边热舞边rap</li></ul><h2 id="创建子线程并启动"><a href="#创建子线程并启动" class="headerlink" title="创建子线程并启动"></a>创建子线程并启动</h2><p>创建线程操作可以分为三步：</p><ol><li>导入 threading 模块</li><li>创建一个Thread对象</li><li>通过Thread对象启动线程</li></ol><p>创建一个Thread对象的时候可以传入参数<br><code>threading.Thread(group=None, target=None, name=None, args=(), kwargs=&#123;&#125;, *, daemon=None)</code></p><ul><li>group 应该为 None；为了日后扩展 ThreadGroup 类实现而保留。</li><li>target：<strong>线程中需要执行的函数</strong>。默认是 None，表示不需要调用任何方法。</li><li>name：<strong>线程名称</strong>。默认情况下，由 “Thread-N” 格式构成一个唯一的名称，其中 N 是小的十进制数。</li><li>args：用于调用目标函数的<strong>参数元组</strong>。默认是 ()。<code>（必须是可迭代对象）</code></li><li>kwargs：用于调用目标函数的关键字<strong>参数字典</strong>。默认是 {}。<code>（必须是可迭代对象）</code></li><li><code>daemon不是None</code>，线程将被显式的设置为<code>守护模式</code>，不管该线程是否是守护模式。</li><li><code>daemon=None</code>，线程将继承当前线程的守护模式属性。</li><li>如果子类重载了构造函数，必须先调用父类构造器<code>Thread.__init__()</code>，再做其他事情。</li></ul><h3 id="函数方式"><a href="#函数方式" class="headerlink" title="函数方式"></a>函数方式</h3><p>函数方式适合于 —— 一个线程中要做的事情比较少，一个函数就能搞定。</p><ol><li>导入 threading 模块</li><li>创建一个Thread对象并把函数传进去</li><li>通过Thread对象启动线程</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading    <span class="comment"># 1. 导入 thrading 模块</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">funcName</span>():</span>     <span class="comment"># 需要子线程执行的函数</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">t1 = threading.Thread(target=funcName)    <span class="comment"># 2. 创建一个Thread对象并把函数传进去</span></span><br><span class="line">t1.start()    <span class="comment"># 3. 启动线程</span></span><br></pre></td></tr></table></figure><h3 id="继承方式"><a href="#继承方式" class="headerlink" title="继承方式"></a>继承方式</h3><p>继承方式适合于 —— 一个线程里面做的事情比较复杂，需要分成多个函数来做。</p><ol><li>导入 threading 模块</li><li>创建一个类继承 Thread 类</li><li>重写 run 方法</li><li>创建一个继承了 Thread 类的对象</li><li>用start方法启动线程</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading    <span class="comment"># 1. 导入 threading 模块</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">clsName</span>(<span class="params">threading.Thread</span>):</span>    <span class="comment"># 2. 继承Thread类</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span>                  <span class="comment"># 3. 重写run方法</span></span><br><span class="line">        <span class="built_in">print</span>(self.name)    <span class="comment"># self.name 保存的是当前线程的名称</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">t1 = clsName()    <span class="comment"># 4. 创建一个继承了 Thread 类的对象</span></span><br><span class="line">t1.start()        <span class="comment"># 5. 启动线程</span></span><br></pre></td></tr></table></figure><p><code>t1.start()</code>只会去调用<code>run</code>方法。如果类中还有其他方法，只能在类中调用，不能用 <code>t1</code>去调用。<br>也就是说，继承了 Thread 的类的之类，除了run方法，其他方法都可以定义成私有的（公有的外面也不能调用啊）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span>(<span class="params">threading.Thread</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(self.name)</span><br><span class="line">        self.__say_hi()</span><br><span class="line">        self.__say_yes()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__say_hi</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Hi!&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__say_yes</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Yes!&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">t1 = MyThread()</span><br><span class="line">t1.start()</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">Thread-<span class="number">1</span></span><br><span class="line">Hi!</span><br><span class="line">Yes!</span><br></pre></td></tr></table></figure><h2 id="插队-join"><a href="#插队-join" class="headerlink" title="插队 join()"></a>插队 join()</h2><blockquote><p><code>join([timeout])</code><br>当某个线程对象成功调用了 join() 方法之后，会优先获得CPU的资源，让其他线程等待<br>知道这个线程对象执行结束后，才把资源让给别的线程</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="built_in">print</span>(threading.current_thread().getName())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f2</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="built_in">print</span>(threading.current_thread().getName() + <span class="string">&quot;------&quot;</span> + <span class="built_in">str</span>(i))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    t1 = threading.Thread(target=f1, args=(<span class="number">5</span>,))</span><br><span class="line">    t2 = threading.Thread(target=f2, args=(<span class="number">5</span>,))</span><br><span class="line">    t1.start()</span><br><span class="line">    t2.start()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        <span class="built_in">print</span>(threading.current_thread().getName())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">Thread-<span class="number">1</span></span><br><span class="line">Thread-<span class="number">1</span></span><br><span class="line">MainThread</span><br><span class="line">Thread-<span class="number">2</span>------<span class="number">0</span></span><br><span class="line">MainThread</span><br><span class="line">Thread-<span class="number">2</span>------<span class="number">1</span></span><br><span class="line">MainThread</span><br><span class="line">Thread-<span class="number">2</span>------<span class="number">2</span></span><br><span class="line">MainThread</span><br><span class="line">MainThread</span><br><span class="line">Thread-<span class="number">2</span>------<span class="number">3</span></span><br><span class="line">Thread-<span class="number">2</span>------<span class="number">4</span></span><br><span class="line">Thread-<span class="number">1</span></span><br><span class="line">Thread-<span class="number">1</span></span><br><span class="line">Thread-<span class="number">1</span></span><br></pre></td></tr></table></figure><p>可以看到，没有加 join 方法，所以主线程 和 t1 和 t2 相互争抢资源。<br>如果现在需要 t1 这个线程执行完再给其他线程执行，也就是说要求 t1 独占一段时间<br>那就让 t1 调用 join() 方法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="built_in">print</span>(threading.current_thread().getName())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f2</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="built_in">print</span>(threading.current_thread().getName() + <span class="string">&quot;------&quot;</span> + <span class="built_in">str</span>(i))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    t1 = threading.Thread(target=f1, args=(<span class="number">5</span>,))</span><br><span class="line">    t2 = threading.Thread(target=f2, args=(<span class="number">5</span>,))</span><br><span class="line">    t1.start()</span><br><span class="line">    t1.join()</span><br><span class="line">    t2.start()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        <span class="built_in">print</span>(threading.current_thread().getName())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">Thread-<span class="number">1</span></span><br><span class="line">Thread-<span class="number">1</span></span><br><span class="line">Thread-<span class="number">1</span></span><br><span class="line">Thread-<span class="number">1</span></span><br><span class="line">Thread-<span class="number">1</span></span><br><span class="line">Thread-<span class="number">2</span>------<span class="number">0</span></span><br><span class="line">Thread-<span class="number">2</span>------<span class="number">1</span></span><br><span class="line">MainThread</span><br><span class="line">Thread-<span class="number">2</span>------<span class="number">2</span></span><br><span class="line">MainThread</span><br><span class="line">Thread-<span class="number">2</span>------<span class="number">3</span></span><br><span class="line">MainThread</span><br><span class="line">Thread-<span class="number">2</span>------<span class="number">4</span></span><br><span class="line">MainThread</span><br><span class="line">MainThread</span><br></pre></td></tr></table></figure><p>这样就实现了 t1 独占资源，完成后才给其他线程</p><h2 id="查看所有线程"><a href="#查看所有线程" class="headerlink" title="查看所有线程"></a>查看所有线程</h2><blockquote><p><code>threading.enumerate()</code><br>以列表形式返回当前所有存活的 Thread 对象。<br>该列表包含守护线程，current_thread() 创建的虚拟线程对象和主线程。<br>它不包含已终结的线程和尚未开始的线程。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">say_hi</span>():</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Hi!&#x27;</span>)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">say_yes</span>():</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Yes!&#x27;</span>)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    t1 = threading.Thread(target=say_hi)</span><br><span class="line">    t2 = threading.Thread(target=say_yes)</span><br><span class="line"></span><br><span class="line">    t1.start()</span><br><span class="line">    t2.start()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="built_in">print</span>(threading.<span class="built_in">enumerate</span>())</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(threading.<span class="built_in">enumerate</span>()) &lt;= <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">Hi!</span><br><span class="line">Yes!</span><br><span class="line">[&lt;_MainThread(MainThread, started <span class="number">1292</span>)&gt;, &lt;Thread(Thread-<span class="number">1</span>, started <span class="number">7968</span>)&gt;, &lt;Thread(Thread-<span class="number">2</span>, started <span class="number">3796</span>)&gt;]</span><br><span class="line">[&lt;_MainThread(MainThread, started <span class="number">1292</span>)&gt;, &lt;Thread(Thread-<span class="number">1</span>, started <span class="number">7968</span>)&gt;, &lt;Thread(Thread-<span class="number">2</span>, started <span class="number">3796</span>)&gt;]</span><br><span class="line">Hi!</span><br><span class="line">Yes!</span><br><span class="line">Hi!</span><br><span class="line">Yes!</span><br><span class="line">[&lt;_MainThread(MainThread, started <span class="number">1292</span>)&gt;, &lt;Thread(Thread-<span class="number">1</span>, started <span class="number">7968</span>)&gt;, &lt;Thread(Thread-<span class="number">2</span>, started <span class="number">3796</span>)&gt;]</span><br><span class="line">[&lt;_MainThread(MainThread, started <span class="number">1292</span>)&gt;, &lt;Thread(Thread-<span class="number">1</span>, started <span class="number">7968</span>)&gt;]</span><br></pre></td></tr></table></figure><h2 id="多线程共享全局变量"><a href="#多线程共享全局变量" class="headerlink" title="多线程共享全局变量"></a>多线程共享全局变量</h2><p>假设现在有个任务，去抓取某个网站上所有的照片，然后发送到某个邮箱。<br>这里就可以分成两个子任务，一个抓取照片，一个发送照片<br>于是我们可以创建一个线程负责抓取照片，一个线程负责发送照片</p><p>那么可以发现，<code>照片</code>是两个线程都要用到的数据。<br>所以我们应该把<code>照片</code>设置为<strong>全局变量</strong>，这样两个线程才可以进行合作。</p><blockquote><p>在多线程任务中，<code>全局变量</code>是可以给每一个线程共享的。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">g_num = <span class="number">10</span>    <span class="comment"># 全局变量</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add1</span>():</span></span><br><span class="line">    <span class="keyword">global</span> g_num</span><br><span class="line">    g_num += <span class="number">5</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;add1----------- %d&quot;</span> % g_num)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add2</span>():</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;add2----------- %d&quot;</span> % g_num)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    t1 = threading.Thread(target=add1, name=<span class="string">&#x27;add1&#x27;</span>)</span><br><span class="line">    t2 = threading.Thread(target=add2, name=<span class="string">&#x27;add2&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    t1.start()</span><br><span class="line">    t2.start()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;main----------- %d&quot;</span> % g_num)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">add1----------- <span class="number">15</span></span><br><span class="line">add2----------- <span class="number">15</span></span><br><span class="line">main----------- <span class="number">15</span></span><br></pre></td></tr></table></figure><p>从栗子中可以看出，线程<code>t1</code>中的<code>add1</code>对全局变量<code>g_num</code>进行了修改<br>在线程<code>t2</code>的<code>add2</code>对<code>g_num</code>进行访问的时候访问到的是修改后的值<br>在主线程的<code>main</code>方法中访问也是修改后的值。</p><p>所以：全局变量对于任何一个线程，包括主线程，来说都是共享的。</p><h2 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h2><p>全局变量对于任何一个线程来说都是共享的，那就一定会引发争抢资源的情况，这是由CPU的运行机制导致的。<br>如果对同一个全局变量，两个线程一个写一个读倒还好，但是如果两个同时写就会引发各种问题。<br>特别是在银行、金融领域，会引发更大的问题。比如一边转了帐还没收到突然出现问题，转账的扣钱了，收账的没收到，那就凉凉了~</p><p>所以为了解决这种缺陷，引入了锁的概念。<br>举个栗子，很多人上一个厕所，前面的进去了得锁门吧？办完事了开锁出来后面的才能进去，上锁，办事儿。<br>锁就是这样的概念。哪个线程先抢到锁哪个就先执行，执行完了释放锁，下一个线程抢到了就锁上…..<br>这叫做<strong>同步控制</strong></p><p>互斥锁</p><blockquote><p>创建锁：<code>mutex = threading.Lock()</code>，默认没有上锁的<br>锁定：<code>mutex.acquire(blocking=True, timeout=1)</code><br>解锁：<code>mutex.release()</code></p></blockquote><ol><li><code>acquire(blocking=True, timeout=1)</code>    成功获得锁返回True，否则返回Flase</li></ol><ul><li>blocking：设置为<code>True</code>时，会一直等到前面的锁释放然后锁定，设置为<code>Flase</code>则不会。</li><li>timeout：浮点型，单位——秒；<ul><li>值为正数时，等待时长为设定的秒数</li><li>值为-1时，将无限等待</li><li><code>blocking=Flase</code>时，timeout不起作用。</li></ul></li></ul><ol start="2"><li><code>release()</code>    锁被锁定时，重置为未锁定。锁没被锁定时，引发<code>RuntimeError</code>错误。</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">g_num = <span class="number">0</span></span><br><span class="line">mutex = threading.Lock()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add1</span>(<span class="params">num</span>):</span></span><br><span class="line">    <span class="keyword">global</span> g_num</span><br><span class="line">    mutex.acquire()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num):</span><br><span class="line">        g_num += <span class="number">1</span></span><br><span class="line">    mutex.release()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;add1----------- %d&quot;</span> % g_num)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add2</span>(<span class="params">num</span>):</span></span><br><span class="line">     <span class="keyword">global</span> g_num</span><br><span class="line">    mutex.acquire()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num):</span><br><span class="line">        g_num += <span class="number">1</span></span><br><span class="line">    mutex.release()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;add2----------- %d&quot;</span> % g_num)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    t1 = threading.Thread(target=add1, args=(<span class="number">1_000_000</span>, ))</span><br><span class="line">    t2 = threading.Thread(target=add2, args=(<span class="number">1_000_000</span>, ))</span><br><span class="line"></span><br><span class="line">    t1.start()</span><br><span class="line">    t2.start()</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;main----------- %d&quot;</span> % g_num)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">add1----------- <span class="number">1000000</span></span><br><span class="line">add2----------- <span class="number">2000000</span></span><br><span class="line">main----------- <span class="number">2000000</span></span><br></pre></td></tr></table></figure><h3 id="死锁"><a href="#死锁" class="headerlink" title="死锁"></a>死锁</h3><p>锁并非只有一个，可以有多个。有多个锁，就可能发生死锁。</p><p>举个栗子，<br>电影里经常能看见的镜头——俩人打架不分上下，A锁住了B的脚踝，B锁住了A的脖子。<br>A：你放开我<br>B：你先放开我<br>A：你放开我我就放开你<br>B：你先放开我，我再放开你<br>A：凭什么我先放<br>B：那我也不放<br>…2000 year later…<br>两人死了。<br>The end.</p><p>这就是死锁，互不相让，互相锁了对方需要的资源，都等着对方先释放</p><p>线程A上了A锁干活，线程B上了B锁，这是两把锁，所以相安无事。<br>运行着运行着线程A需要一份资源，这份资源被线程B上了锁用着呢；线程B也需要一份资源，这份资源被线程A上了锁用着呢。<br>这时候线程A和线程B都在等对方释放锁，就这么一直等一直等</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadLockA</span>(<span class="params">theading.Thread</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">        mutexA.acquire()    <span class="comment"># 使用A锁上锁</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(self.name + <span class="string">&#x27;-----------doA--up--&#x27;</span>)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 这里会上锁失败，因为上面 time.sleep(1)的时候B锁已经被上锁了</span></span><br><span class="line">        <span class="comment"># 或者此线程后执行，A锁已经被上锁了，会上锁失败。</span></span><br><span class="line">        <span class="comment"># 所以死锁会发生在这</span></span><br><span class="line">        mutexB.acquire()    <span class="comment"># 请求B锁上锁</span></span><br><span class="line">        <span class="built_in">print</span>(self.name + <span class="string">&#x27;-----------doA--down--&#x27;</span>)</span><br><span class="line">        mutexB.release()</span><br><span class="line"></span><br><span class="line">        mutexA.release()    <span class="comment"># 对A锁进行解锁</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadLockB</span>(<span class="params">threading.Thread</span>)；</span></span><br><span class="line"><span class="class">    <span class="title">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">        mutexB.acquire()    <span class="comment"># 使用B锁上锁</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(self.name + <span class="string">&#x27;-----------doB--up--&#x27;</span>)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 这里会上锁失败，因为上面 time.sleep(1)的时候A锁已经被上锁了</span></span><br><span class="line">        <span class="comment"># 或者此线程后执行，A锁已经被上锁了，会上锁失败。</span></span><br><span class="line">        <span class="comment"># 所以死锁会发生在这</span></span><br><span class="line">        mutexA.acquire()</span><br><span class="line">        <span class="built_in">print</span>(self.name + <span class="string">&#x27;-----------doB--down--&#x27;</span>)</span><br><span class="line">        mutexA.release()</span><br><span class="line"></span><br><span class="line">        mutexB.release()    <span class="comment"># 对B锁进行解锁</span></span><br><span class="line"></span><br><span class="line">mutexA = threading.Lock()</span><br><span class="line">mutexB = threading.Lock()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    t1 = ThreadLockA()</span><br><span class="line">    t2 = ThreadLockB()</span><br><span class="line">    t1.start()</span><br><span class="line">    t2.start()</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">-----------doA--up--</span><br><span class="line">-----------doB--up--</span><br><span class="line"></span><br><span class="line">···</span><br><span class="line">这里已经卡死了</span><br></pre></td></tr></table></figure><p>为了避免这种情况，又两种方法</p><ol><li>程序设计时要尽量避免（使用银行家算法）</li><li>添加超时时间等</li></ol>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
          <category> 进阶 </category>
          
          <category> 进程、线程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python【No-16】进程</title>
      <link href="posts/19751"/>
      <url>posts/19751</url>
      
        <content type="html"><![CDATA[<p>进程，是资源分配的单位</p><span id="more"></span><p>程序：例如<code>xxx.py</code>这是程序，是静态的<br>进程：一个程序运行起来后，代码+用到的资源 称之为进程，它是操作系统分配资源的<code>基本单元</code>。</p><p>进程，是资源分配的单位<br>线程，是操作系统调度的单位</p><h2 id="进程的状态"><a href="#进程的状态" class="headerlink" title="进程的状态"></a>进程的状态</h2><p>工作中，任务数往往大于CPU核心数，即一定有一些任何正在执行，而另外一些任务在等待CPU进行执行<br>因此进程有不同的状态</p><p>进程的状态分为：<code>新建</code>、<code>就绪</code>、<code>运行</code>、<code>等待（堵塞）</code>、<code>死亡</code></p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/15-3.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/15-3.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="状态"></p><ul><li>就绪态：运行的条件都已经具备，正在等在CPU执行</li><li>执行态：CPU正在执行其功能</li><li>等待态：等待某些条件满足；例如一个程序sleep了，就处于等待态</li></ul><p>进程就好像流水线。<br>一个进程就是一条流水线，每条流水线之间是相互独立的；<br>流水线履带上的产品就是全局变量；<br>流水线上的工人就是线程；</p><p>产品（全局变量）对于同一条流水线的工人（线程）来说是共享的，每个人都可以访问<br>流水线（进程）之间是相互独立的，不能流水线A的产品可以被流水线B访问，那不就乱套了。</p><h2 id="创建进程"><a href="#创建进程" class="headerlink" title="创建进程"></a>创建进程</h2><p>创建进程分为三步：</p><ol><li>导入 multiprocessing 模块</li><li>创建一个 Process 对象</li><li>通过 Process 对象启动线程</li></ol><p>创建一个 Process对象的时候可以传入参数<br><code>multiprocessing.Process(group=None, target=None, name=None, args=(), kwargs=&#123;&#125;, *, daemon=None)</code></p><ul><li>应始终使用关键字参数调用构造函数。</li><li>group：应该始终是 None ；它仅用于兼容 threading.Thread 。</li><li>target：是由 run() 方法调用的可调用对象。它默认为 None ，意味着什么都没有被调用。</li><li>name：是进程名称</li><li>args：是目标调用的参数元组。</li><li>kwargs：是目标调用的关键字参数字典。</li><li>daemon：<ul><li>如果提供，则键参数 daemon 将进程 daemon 标志设置为 True 或 False 。</li><li>如果是 None （默认值），则该标志将从创建的进程继承。</li></ul></li><li>如果子类重载了构造函数，必须先调用父类构造器<code>Process.__init__()</code>，再做其他事情。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">say_hi</span>():</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Hi-------&quot;</span>)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">say_yes</span>():</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Yes------&quot;</span>)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    p1 = multiprocessing.Process(target=say_hi)</span><br><span class="line">    p2 = multiprocessing.Process(target=say_yes)</span><br><span class="line">    p1.start()</span><br><span class="line">    p2.start()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">Hi-------</span><br><span class="line">Yes------</span><br><span class="line">Hi-------</span><br><span class="line">Yes------</span><br><span class="line">Hi-------</span><br><span class="line">Yes------</span><br><span class="line">Hi-------</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h2 id="进程间通信"><a href="#进程间通信" class="headerlink" title="进程间通信"></a>进程间通信</h2><p>进程间的通信有很多中方式，比如通过带网络功能的<code>socket</code>，或者队列<code>Queue</code></p><p>假设两个进程之间要通信，进程A向内存中的<code>Queue</code>放要通信的内容，进程B去<code>Queue</code>中取即可。<br>进程是运行在内存中的，<code>Queue</code>也是运行在内存中的，所以速度很快。<br><code>Queue</code>对于进程来说是共享的。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing <span class="keyword">as</span> p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_from_web</span>(<span class="params">q</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;下载数据&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 模拟从网上下载的数据</span></span><br><span class="line">    data = [<span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>, <span class="number">44</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 向队列中写入数据</span></span><br><span class="line">    <span class="keyword">for</span> temp <span class="keyword">in</span> data:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> q.full():    <span class="comment"># 如果队列未满</span></span><br><span class="line">        q.put(temp)    <span class="comment"># 通过 put 将内容放进队列</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;download: 下载完成并存入队列&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">analysis_data</span>(<span class="params">q</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;数据处理&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 从队列中获取数据</span></span><br><span class="line">    data = <span class="built_in">list</span>()</span><br><span class="line">    <span class="comment"># 模拟数据处理</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data.append(q.get())    <span class="comment"># 通过 get 取队列中的内容</span></span><br><span class="line">        <span class="keyword">if</span> q.empty():    <span class="comment"># 如果队列为空则退出</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;analysis:&quot;</span>, data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="comment"># 1.创建一个队列</span></span><br><span class="line">    q = p.Queue(<span class="number">3</span>)</span><br><span class="line">    <span class="comment"># 2.创建多个进程，将队列的应用当作实参传递到里面</span></span><br><span class="line">    p1 = p.Process(target=download_from_web, args=(q, ))</span><br><span class="line">    p2 = p.Process(target=analysis_data, args=(q, ))</span><br><span class="line"></span><br><span class="line">    p1.start()</span><br><span class="line">    p2.start()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_from_web</span>(<span class="params">q</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;下载数据&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 模拟从网上下载的数据</span></span><br><span class="line">    data = [<span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>, <span class="number">44</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 向队列中写入数据</span></span><br><span class="line">    <span class="keyword">for</span> temp <span class="keyword">in</span> data:</span><br><span class="line">        q.put(temp)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;download: 下载完成并存入队列&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">analysis_data</span>(<span class="params">q</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;数据处理&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 从队列中获取数据</span></span><br><span class="line">    data = <span class="built_in">list</span>()</span><br><span class="line">    <span class="comment"># 模拟数据处理</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data.append(q.get())</span><br><span class="line">        <span class="keyword">if</span> q.empty():</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;analysis:&quot;</span>, data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="comment"># 1.创建一个队列</span></span><br><span class="line">    q = p.Queue(<span class="number">3</span>)</span><br><span class="line">    <span class="comment"># 2.创建多个进程，将队列的应用当作实参传递到里面</span></span><br><span class="line">    p1 = p.Process(target=download_from_web, args=(q, ))</span><br><span class="line">    p2 = p.Process(target=analysis_data, args=(q, ))</span><br><span class="line"></span><br><span class="line">    p1.start()</span><br><span class="line">    p2.start()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">download: 下载完成并存入队列</span><br><span class="line">analysis: [<span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>, <span class="number">44</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol><li><code>q.put(obj[, block[, timeout])</code></li></ol><ul><li>obj：要传递的内容</li><li>block：阻塞，默认True<ul><li>True，队列满了以后会一直等待</li><li>Flase，队列满了之后会抛出<code>queue.Full</code>错误</li></ul></li><li>timeout：浮点型，单位——秒，默认None；<ul><li>值为正数时，等待时长为设定的秒数</li><li>值为-1时，将无限等待</li><li>blocking=Flase时，timeout不起作用。</li></ul></li><li>如果队列关闭已经关闭会抛出<code>ValueError</code>（3.8+）<br><code>q.put_nowait(obj)</code>相当于<code>q.put(block=Flase)</code></li></ul><ol start="2"><li><code>q.get([block[, timeout])</code></li></ol><ul><li>block：阻塞，默认True<ul><li>True，队列空了以后会一直等待</li><li>Flase，队列空了之后会抛出<code>queue.Empty</code>错误</li></ul></li><li>timeout：浮点型，单位——秒，默认None；<ul><li>值为正数时，等待时长为设定的秒数</li><li>值为-1时，将无限等待</li><li>blocking=Flase时，timeout不起作用。</li></ul></li><li>如果队列关闭已经关闭会抛出<code>ValueError</code>（3.8+）<br><code>q.get_nowait()</code>相当于<code>q.get(block=Flase)</code></li></ul><h2 id="进程池"><a href="#进程池" class="headerlink" title="进程池"></a>进程池</h2><p>进程的创建和消费是很耗费资源的，而实际情况中可能出现成千上百万个进程需要执行，这时候不可能每个进程都单独创建和销毁<br>这些进程大同小异，但是进程的创建和销毁是相同的。<br>于是我们可以把创建和销毁的工作抽取出来，通过更换进程的内容，以此达到较小开销的目的。<br>这种技术叫做 <strong>进程池</strong></p><p>进程池就好比公园里的湖，进程就好比船。<br>你作为老板，今天来了一个人要划船，你去买一艘船，客人划完了你把船卖了。<br>明天再来两个客人，你又去买两艘船，客人划完了你又把船卖了。<br>万一来了一万个客人，你…没钱买船了哈哈哈。<br><strong>这是普通的进程使用方法。</strong></p><p>你作为老板，先买好N艘船（开启进程池），来了一个客人，上船，用完了换你，下一个客人上去…<br>等到哪天生意不做了关门，就把船一起卖掉关门（关闭进程池）。<br><strong>这是进程池的使用方法</strong>。省下了买船卖船（创建和销毁进程）的功夫。</p><p>进程池中最大容量能同时容纳多少个进程是由开发者指定的，具体多少个要经过测试人员压力测试以后得出一个合适的数量。<br>当进程池创建以后，不会立即工作，而是等到有进程被创建了才开始工作。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">work</span>(<span class="params">msg</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Process-&#123;&#125; running, pid：&#123;&#125;&quot;</span>.<span class="built_in">format</span>(msg, os.getpid()))</span><br><span class="line">    start = time.time()</span><br><span class="line">    time.sleep(random.random() * <span class="number">2</span>)</span><br><span class="line">    end = time.time()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Process-&#123;&#125; finish, time consuming：&#123;:.2f&#125;&quot;</span>.<span class="built_in">format</span>(msg, end - start))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    po = Pool(<span class="number">3</span>)  <span class="comment"># 定义一个进程池，最大进程数为3</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">11</span>):</span><br><span class="line">        <span class="comment"># Pool.apply_async(要调用的目标, (传递给目标的参数元组,))</span></span><br><span class="line">        <span class="comment"># 每次循环将会用空闲出来的子进程去调用目标</span></span><br><span class="line">        po.apply_async(work, (i, ))</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;------start------&quot;</span>)</span><br><span class="line">    po.close()    <span class="comment"># 关闭进程池，关闭后po不在接收新的请求</span></span><br><span class="line">    po.join()     <span class="comment"># 等待po中所有子进程执行完后再关闭，必须放在close语句后</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;-------end-------&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">------start------</span><br><span class="line">Process-<span class="number">1</span> running, pid：<span class="number">20364</span></span><br><span class="line">Process-<span class="number">2</span> running, pid：<span class="number">15912</span></span><br><span class="line">Process-<span class="number">3</span> running, pid：<span class="number">16504</span></span><br><span class="line">Process-<span class="number">2</span> finish, time consuming：<span class="number">1.01</span></span><br><span class="line">Process-<span class="number">4</span> running, pid：<span class="number">15912</span></span><br><span class="line">Process-<span class="number">3</span> finish, time consuming：<span class="number">1.03</span></span><br><span class="line">Process-<span class="number">5</span> running, pid：<span class="number">16504</span></span><br><span class="line">Process-<span class="number">4</span> finish, time consuming：<span class="number">0.17</span></span><br><span class="line">Process-<span class="number">6</span> running, pid：<span class="number">15912</span></span><br><span class="line">Process-<span class="number">5</span> finish, time consuming：<span class="number">0.23</span></span><br><span class="line">Process-<span class="number">7</span> running, pid：<span class="number">16504</span></span><br><span class="line">Process-<span class="number">1</span> finish, time consuming：<span class="number">1.50</span></span><br><span class="line">Process-<span class="number">8</span> running, pid：<span class="number">20364</span></span><br><span class="line">Process-<span class="number">6</span> finish, time consuming：<span class="number">1.43</span></span><br><span class="line">Process-<span class="number">9</span> running, pid：<span class="number">15912</span></span><br><span class="line">Process-<span class="number">8</span> finish, time consuming：<span class="number">1.65</span></span><br><span class="line">Process-<span class="number">10</span> running, pid：<span class="number">20364</span></span><br><span class="line">Process-<span class="number">9</span> finish, time consuming：<span class="number">0.55</span></span><br><span class="line">Process-<span class="number">7</span> finish, time consuming：<span class="number">1.99</span></span><br><span class="line">Process-<span class="number">10</span> finish, time consuming：<span class="number">0.20</span></span><br><span class="line">-------end-------</span><br></pre></td></tr></table></figure><h3 id="创建进程池"><a href="#创建进程池" class="headerlink" title="创建进程池"></a>创建进程池</h3><p>创建进程池总共分步：</p><ol><li>导入 multiprocessing 模块</li><li>创建一个 Pool 对象并指定最大进程数</li><li>使用<code>apply()</code>或<code>apply_async()</code>方法</li><li>使用<code>close()</code>方法停止接收进程</li><li>使用<code>join()</code>方法声明等待子进程完毕再关闭进程池</li></ol>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
          <category> 进阶 </category>
          
          <category> 进程、线程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python【No-15】进程线程总叙</title>
      <link href="posts/46855"/>
      <url>posts/46855</url>
      
        <content type="html"><![CDATA[<p>进程是<strong>内存资源分配的单位</strong><br>线程是<strong>操作系统调度的单位</strong>，真正执行任务的是线程<br>协程是线程中<strong>任务细分下来的单位</strong></p><span id="more"></span><p>代码是由线程执行的<br>线程必须在进程中运行<br>线程可以拆分成多个协程</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/15-1.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/15-1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="进程"></p><p>从图中可以看出<br>一个进程中有1或多个线程，进程就像一个容器一样，是内存资源分配的单位<br>线程是由操作系统调度的，把CPU计算资源给哪个线程使用是操作系统管的<br>每个线程里或多或少有几个协程，这些是程序管理的</p><blockquote><p>程序 &gt; 进程 &gt; 线程 &gt; 协程</p></blockquote><blockquote><ul><li>代码写好了，躺在硬盘了，那叫<strong>程序</strong><ul><li>代码拿到内存里跑，那叫<strong>进程</strong></li><li>程序觉得一个主进程不够，可以再开N个<strong>子进程</strong><ul><li>进程只是一个容器，需要干活的，所以得有<strong>线程</strong></li><li>进程觉得一个主线程不够，可以再开N个<strong>子线程</strong><ul><li>线程觉得有很多耗时操作（如读写文件、网络请求），想把等待的时间利用起来做其他还没完成的任务，可以搞出很多个<strong>协程</strong></li></ul></li></ul></li></ul></li></ul></blockquote><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/15-2.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/15-2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="内存"></p><p>这么多个概念，其被发明的目的都是为了<strong>更高效的利用计算机</strong></p><p>在上古时代，单CPU-单核，在同一时间内只能做一件事情，不可能像现在这样又听歌又上网又写文档<br>人们发现CPU的计算速度奇高，所以利用了时间片(就是短到人类无法发现的时长)多次切换运行程序，雨露均沾<br>这样 单CPU-单核 也能实现多个任务同时进行。<br>不过这只是看起来像是在同时运行，如果你能暂停时间，你会发现CPU只是在执行某一个程序而已。<br>这种让CPU资源在程序之间反复横跳，从而实现多任务的技术，叫做<strong>并发</strong></p><p>那如果我就是想要按下时间暂停按钮的时候，真的有多个程序在一起执行怎么办？<br>再加个CPU咯。这叫<strong>并行</strong></p><h2 id="举个栗子"><a href="#举个栗子" class="headerlink" title="举个栗子"></a>举个栗子</h2><p>现在有一个玩具厂，厂里面有2个车间：一个生产玩具，一个生产家电<br>每个车间有N条流水线，每条流水线上有N个工人，每个工人都有各自的任务<br>车间需要地方搭建，还需要电力供应</p><p>我们捋一捋关系：</p><p>发电机  -&gt; CPU<br>厂         -&gt; 内存<br>车间      -&gt; 进程<br>流水线  -&gt; 线程<br>工人     -&gt; 任务</p><hr><p>车间没建起来，就像代码放在硬盘里，代码扔硬盘里不就叫<strong>程序</strong>么</p><p>把 车间 建到 厂房 里用起来，那些 车间 就成了 有用的车间<br>把 代码 放到 内存 里跑起来，那些 代码 就成了 <strong>进程</strong></p><p>车间 搭好了得有 流水线 来 组装产品啊<br>进程 建好了还得有 <strong>线程</strong> 来 执行任务啊</p><p>所以每个车间至少有一条主流水线<br>所以每个进程至少有一个主线程</p><p>车间 一开始只有一条主流水线做全部步骤，有天发现有个步骤特别麻烦<br>进程 一开始只有一个<strong>主线程</strong>做所有事情，有天发现有个操作特别耗时</p><p>于是主流水线就再拉了一条副流水线来负责这个麻烦的步骤，自己继续下一步，再有麻烦步骤就继续加副流水线<br>于是主线程开启一个<strong>子线程</strong>来负责这个耗时操作，主线程继续执行，再有耗时操作就继续加子线程</p><p>有一天单子太多，一条车间不够，那就加条副车间咯，再不够再加<br>有一天计算量太大，一个进程不够，那就加个<strong>子进程</strong>咯，再不够再加</p><p>而且副车间得更主车间一模一样<br>而且子进程得完全复制主进程，包括代码、状态等等</p><p>并且，一个车间挂了没事，不会影响其他车间<br>并且，一个进程挂了没事，不会影响其他进程</p><p>那现在车间之间 要传递零件怎么办，搭个管子，直接溜过去，先放的别人就先拿到<br>那现在<strong>进程之间</strong>要进行<strong>通信</strong>怎么办，用<strong>队列</strong>或者<strong>管道</strong>呗，先放的就先拿到</p><p>那流水线之间要传递东西怎么办？放车间的工具车上不就完了<br>那线程之间要<strong>通信</strong>怎么办？用<strong>全局变量</strong>不就完了</p><p>流水线跟车间可不一样，要是哪条副流水线挂了是会影响整个车间的<br>线程跟进程可不一样，要是哪个子线程挂了是会影响整个进程的</p><p>主流水线要是挂了，整个车间完犊子<br>主线程要是挂了，整个进程完犊子</p><p>有的流水线就一个工人，有的流水线有多个工人，这个工人动作慢了，就把螺丝刀给别的工人先用<br>有的线程就一个协程，有的线程有多个协程，这个协程阻塞了，就把运行权给别的协程</p><p>这种积极利用等待时间安排其他工人的模式，叫做高效利用时间<br>这种积极利用等待时间做其他任务的形式，叫做<strong>协程</strong></p><p>那现在发电机只有一个，生产玩具的车间要用，生产家电的车间要用，老板又想两个车间同时生产<br>那现在CPU只有一个，进程A要用，进程B要用，用户又想两个进程使用运行</p><p>那就让发电机快速在两个车间之间快速切换，哪个车间有电了立马干活，没电了立马暂停<br>那就让CPU资源在两个进程之间反复横跳，哪个进程被选中了立马运行，时间片到了立马暂停</p><p>因为速度非常快，所以老板看着以为两个车间都启动了<br>因为速度非常快，所以用户真的以为两个任务同时运行，这叫<strong>并发</strong></p><p>有一天老板发财，加了一台发电机，这下两个车间都有电了，真正的两个车间同时生产<br>有一天用户发财，加了一个CPU，这下两个进程都有资源了，真正实现两个进程同时运行，这叫<strong>并行</strong></p><hr><p>进程占的资源比较大，但是安全，一个进程挂掉不会导致另外一个进程挂掉<br>线程切换开销更小<br>协程利用等待的时间做别的事，但是需要程序承担调度责任</p><p>在不考虑 GIL（全局锁）的情况下，优先用协程、再用线程、最后用进程</p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
          <category> 进阶 </category>
          
          <category> 进程、线程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python【No-14】枚举类</title>
      <link href="posts/17751"/>
      <url>posts/17751</url>
      
        <content type="html"><![CDATA[<p>枚举类型在 Python3.4 新增到标准库</p><span id="more"></span><h2 id="创建枚举"><a href="#创建枚举" class="headerlink" title="创建枚举"></a>创建枚举</h2><p>有两种方法创建枚举</p><ol><li>基于 class 语法创建</li><li>基于 Function API 创建</li></ol><p>第一步，导入Enum类</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum</span><br></pre></td></tr></table></figure><h3 id="基于-class-语法创建"><a href="#基于-class-语法创建" class="headerlink" title="基于 class 语法创建"></a>基于 class 语法创建</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Weekend</span>(<span class="params">Enum</span>)；</span></span><br><span class="line"><span class="class">    <span class="title">Mon</span> = 1</span></span><br><span class="line"><span class="class">    <span class="title">Tue</span> = 2</span></span><br><span class="line"><span class="class">    <span class="title">Wed</span> = 3</span></span><br><span class="line"><span class="class">    <span class="title">Thr</span> = 4</span></span><br><span class="line"><span class="class">    <span class="title">Fri</span> = 5</span></span><br><span class="line"><span class="class">    <span class="title">Sat</span> = 6</span></span><br><span class="line"><span class="class">    <span class="title">Sun</span> = 7</span></span><br></pre></td></tr></table></figure><p>上面例子 </p><ol><li>定义了 Weekend 枚举类型</li><li>定义了 Weekend 的枚举成员 Weekend.Mon，Weekend.Tue…</li><li>为每一个枚举成员赋值。如Weekend.Mon 的值为1。值可以指定为其他类型，不是必须整型</li></ol><p>枚举成员包含两个属性：<code>name</code>和<code>value</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Weekend.Mon.name</span><br><span class="line">Mon</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Weekend.Mon.value</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure><p>定义string类型的值</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Weekend</span>(<span class="params">Enum</span>)；</span></span><br><span class="line"><span class="class">    <span class="title">Monday</span> = &#x27;<span class="title">Mon</span>&#x27;</span></span><br><span class="line"><span class="class">    <span class="title">Tuesday</span> = &#x27;<span class="title">Tue</span>&#x27;</span></span><br><span class="line"><span class="class">    <span class="title">Wednesday</span> = &#x27;<span class="title">Wed</span>&#x27;</span></span><br><span class="line"><span class="class">    <span class="title">Thursday</span> = &#x27;<span class="title">Thu</span>&#x27;</span></span><br><span class="line"><span class="class">    <span class="title">Friday</span> = &#x27;<span class="title">Fri</span>&#x27;</span></span><br><span class="line"><span class="class">    <span class="title">Saturday</span> = &#x27;<span class="title">Sat</span>&#x27;</span></span><br><span class="line"><span class="class">    <span class="title">Sunday</span> = &#x27;<span class="title">Sun</span>&#x27;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">Weekend</span>.<span class="title">Monday</span>.<span class="title">value</span></span></span><br><span class="line"><span class="class">&#x27;<span class="title">Mon</span>&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="基于-Function-API-创建"><a href="#基于-Function-API-创建" class="headerlink" title="基于 Function API 创建"></a>基于 Function API 创建</h3><blockquote><p><code>Enum(enum name, enumerators)</code><br>第一个参数 enum name 表示枚举名称，第二个参数enumerators 表示枚举成员列表<br>枚举成员列表有三种方式：</p><ol><li>使用字符串表示，各成员名使用空格隔开。成员的值从1开始自动递增<br><code>Enum(&#39;enum_name&#39;, &#39;member1 member2 member3 ... memberN&#39;)</code></li><li>使用元组表示，成员的值从1开始自动递增<br><code>Enum(&#39;enum_name&#39;, (&#39;member1&#39;, &#39;member2&#39;, &#39;member3&#39;, ... , &#39;memberN&#39;))</code></li><li>使用字典表示，字典可以指定枚举成员的值，其中字典的键为枚举成员名，值为枚举成员的值<br><code>Enum(&#39;enum_name&#39;, &#123;&#39;member1_key&#39;: memberl_value, &#39;member_key2&#39;: member2_value,...&#125;)</code></li></ol></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以下三句表达式互相等价</span></span><br><span class="line">weekend = Enum(<span class="string">&#x27;week&#x27;</span>,<span class="string">&#x27;Mon Tue Wed Thu Fri Sat Sun&#x27;</span>)</span><br><span class="line">weekend = Enum(<span class="string">&#x27;week&#x27;</span>,(<span class="string">&#x27;Mon&#x27;</span>, <span class="string">&#x27;Tue&#x27;</span>, <span class="string">&#x27;Wed&#x27;</span>, <span class="string">&#x27;Thu&#x27;</span>, <span class="string">&#x27;Fri&#x27;</span>, <span class="string">&#x27;Sat&#x27;</span>, <span class="string">&#x27;Sun&#x27;</span>)</span><br><span class="line">weekend = Enum(<span class="string">&#x27;week&#x27;</span>,&#123;<span class="string">&#x27;Mon&#x27;</span>:<span class="number">1</span>, <span class="string">&#x27;Tue&#x27;</span>:<span class="number">2</span>, <span class="string">&#x27;Wed&#x27;</span>:<span class="number">3</span>, <span class="string">&#x27;Thu&#x27;</span>:<span class="number">4</span>, <span class="string">&#x27;Fri&#x27;</span>:<span class="number">5</span>, <span class="string">&#x27;Sat&#x27;</span>:<span class="number">6</span>, <span class="string">&#x27;Sun&#x27;</span>:<span class="number">7</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>weekend.Mon.value</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure><h2 id="访问枚举成员"><a href="#访问枚举成员" class="headerlink" title="访问枚举成员"></a>访问枚举成员</h2><p>访问枚举成员有三种方式：</p><ol><li>使用点号(“.”)引用</li><li>使用value获取，值对应的枚举成员</li><li>使用枚举成员名</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Weekend</span>(<span class="params">Enum</span>):</span></span><br><span class="line">    Mon = <span class="number">1</span></span><br><span class="line">    Tue = <span class="number">2</span></span><br><span class="line">    Wed = <span class="number">3</span></span><br><span class="line">    Thr = <span class="number">4</span></span><br><span class="line">    Fri = <span class="number">5</span></span><br><span class="line">    Sat = <span class="number">6</span></span><br><span class="line">    Sun = <span class="number">7</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 按值访问</span></span><br><span class="line"><span class="built_in">print</span>(Weekend(<span class="number">5</span>))        <span class="comment"># Weekend.Fri</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 按枚举名访问</span></span><br><span class="line"><span class="built_in">print</span>(Weekend[<span class="string">&#x27;Sun&#x27;</span>])    <span class="comment"># Weekend.Sun</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问成员的名称</span></span><br><span class="line"><span class="built_in">print</span>(Weekend.Tue.name)  <span class="comment"># Tue</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问成员的值</span></span><br><span class="line"><span class="built_in">print</span>(Weekend.Thr.value) <span class="comment"># 4</span></span><br></pre></td></tr></table></figure><h2 id="枚举遍历"><a href="#枚举遍历" class="headerlink" title="枚举遍历"></a>枚举遍历</h2><p>如果把枚举当作 Dict 来看，<code>枚举类.枚举成员名</code>是key，<code>赋给枚举成员的值</code>是value</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;name:    member   | value&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">25</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> name, member <span class="keyword">in</span> Weekend.__members__.items():</span><br><span class="line">    <span class="built_in">print</span>(name + <span class="string">&quot; : &quot;</span> + <span class="built_in">str</span>(member) + <span class="string">&quot; | &quot;</span> + <span class="built_in">str</span>(member.value))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line"></span><br><span class="line">name:    member   | value</span><br><span class="line">-------------------------</span><br><span class="line">Mon : Weekend.Mon | <span class="number">0</span></span><br><span class="line">Tue : Weekend.Tue | <span class="number">1</span></span><br><span class="line">Wed : Weekend.Wed | <span class="number">2</span></span><br><span class="line">Thr : Weekend.Thr | <span class="number">3</span></span><br><span class="line">Fri : Weekend.Fri | <span class="number">4</span></span><br><span class="line">Sat : Weekend.Sat | <span class="number">5</span></span><br><span class="line">Sun : Weekend.Sun | <span class="number">6</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(Weekend.__members__)</span><br><span class="line">&#123;<span class="string">&#x27;Mon&#x27;</span>: &lt;Weekend.Mon: <span class="number">0</span>&gt;,</span><br><span class="line"> <span class="string">&#x27;Tue&#x27;</span>: &lt;Weekend.Tue: <span class="number">1</span>&gt;,</span><br><span class="line"> <span class="string">&#x27;Wed&#x27;</span>: &lt;Weekend.Wed: <span class="number">2</span>&gt;,</span><br><span class="line"> <span class="string">&#x27;Thr&#x27;</span>: &lt;Weekend.Thr: <span class="number">3</span>&gt;,</span><br><span class="line"> <span class="string">&#x27;Fri&#x27;</span>: &lt;Weekend.Fri: <span class="number">4</span>&gt;,</span><br><span class="line"> <span class="string">&#x27;Sat&#x27;</span>: &lt;Weekend.Sat: <span class="number">5</span>&gt;,</span><br><span class="line"> <span class="string">&#x27;Sun&#x27;</span>: &lt;Weekend.Sun: <span class="number">6</span>&gt;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">type</span>(Weekend.__members__)</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">mappingproxy</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure><h2 id="枚举比较"><a href="#枚举比较" class="headerlink" title="枚举比较"></a>枚举比较</h2><p>枚举成员并非整型，而是一种映射类型，是不能做大小比较的<br>当时可以做相等比较</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Weekend.Mon == Weekend.Mon</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Weekend.Mon == Weekend.Tue</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Weekend.Mon != Weekend.Tue</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Weekend.Mon == <span class="number">0</span></span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure><h2 id="限定枚举唯一性"><a href="#限定枚举唯一性" class="headerlink" title="限定枚举唯一性"></a>限定枚举唯一性</h2><p>限定枚举唯一性是指 限制枚举类中的枚举成员 的 名称和值都不重复</p><p>限定枚举唯一性非常简单<br>导入 unique类，然后在自定义的枚举类前加上装饰器 <code>@unique</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum, unique</span><br><span class="line"></span><br><span class="line"><span class="meta">@unique</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Weekend</span>:</span></span><br><span class="line">    Mon = <span class="number">0</span></span><br><span class="line">    Tue = <span class="number">1</span></span><br><span class="line">    Wed = <span class="number">2</span></span><br><span class="line">    Thr = <span class="number">3</span></span><br><span class="line">    Fri = <span class="number">4</span></span><br><span class="line">    Sat = <span class="number">5</span></span><br><span class="line">    Sun = <span class="number">6</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
          <category> OPP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python【No-13】魔术方法</title>
      <link href="posts/39743"/>
      <url>posts/39743</url>
      
        <content type="html"><![CDATA[<p>魔术方法即类的内置方法</p><span id="more"></span><h2 id="str"><a href="#str" class="headerlink" title="__str__()"></a><code>__str__()</code></h2><blockquote><p>触发时机:使用print(对象)或者str(对象)的时候触发<br>参数：一个self接收对象<br>返回值：必须是字符串类型<br>作用：print（对象时）进行操作，得到字符串，通常用于快捷操作<br>调用方式：<code>print(obj)</code></p><p>另外，还有一个与<code>__str__()</code>相同的子方法：<code>__repr__()</code>，效果一样，适用于调试时，区别在于<br><code>&gt;&gt;&gt; print(obj)</code> 时调用的是 <code>__str__()</code><br><code>&gt;&gt;&gt; obj</code> 时调用的是 <code>__repr__()</code></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    String name = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">int</span> age = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name, <span class="keyword">int</span> age)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;name: &quot;</span> + <span class="keyword">this</span>.name + <span class="string">&quot;, age: &quot;</span> + <span class="keyword">this</span>.age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Person p = <span class="keyword">new</span> Person(<span class="string">&quot;Boii&quot;</span>, <span class="number">18</span>);</span><br><span class="line">system.out.println(p);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line"><span class="comment">// name: Boii, age: 18</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, age</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;name: &quot;</span> + self.name + <span class="string">&quot;, age: &quot;</span> + self.age</span><br><span class="line"></span><br><span class="line">    __repr__ = __str__    <span class="comment"># 偷懒写法</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = Person(<span class="string">&quot;Boii&quot;</span>, <span class="number">18</span>)</span><br><span class="line"><span class="built_in">print</span>(p)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line"><span class="comment"># name: Boii, age: 18</span></span><br></pre></td></tr></table></figure><h2 id="call"><a href="#call" class="headerlink" title="__call__()"></a><code>__call__()</code></h2><blockquote><p>调用对象的魔术方法<br>触发时机:将对象当作函数调用时触发 对象()<br>参数:至少一个self接收对象，其余根据调用时参数决定<br>返回值：根据情况而定<br>作用：可以将复杂的步骤进行合并操作，减少调用的步骤，方便使用<br>调用方式：<code>obj()</code></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Athlete</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">prepare</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;The athlete is preparing...&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">warm_up</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;The athlete is warming up...&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">attend</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;The athlete attended.&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;The athlete ran.&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.prepare()</span><br><span class="line">        self.warm_up()</span><br><span class="line">        self.attend()</span><br><span class="line">        self.run()</span><br><span class="line"></span><br><span class="line">athlete = Athlete()</span><br><span class="line">athlete()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">The athlete <span class="keyword">is</span> preparing...</span><br><span class="line">The athlete <span class="keyword">is</span> warming up...</span><br><span class="line">The athlete attended.</span><br><span class="line">The athlete ran.</span><br></pre></td></tr></table></figure><p>示例中只是简单调用自身函数，实际过程中可能会有更多如开启线程，调用别的类等复杂操作</p><p>很多时候，需要判断一个对象能否被调用，能被调用的对象就是一个<code>Callable</code><br>函数，和带有 <code>__call__()</code>的类对象就是Callable<br>可以通过 <code>callable(obj)</code>来判断一个对象是否可以被调用</p><h2 id="iter"><a href="#iter" class="headerlink" title="__iter__()"></a><code>__iter__()</code></h2><blockquote><p>调用对象的魔术方法<br>触发时机：对象被用于 <code>for...in</code><br>参数：至少一个self接收对象<br>返回值：根据情况而定<br>作用：使类具有可迭代的能力<br>调用方式：<code>for...in obj</code></p></blockquote><p>如果一个类想被用于for … in循环，类似list或tuple那样，就必须实现一个__iter__()方法，<br>该方法返回一个迭代对象，<br>然后，Python的for循环就会不断调用该迭代对象的__next__()方法拿到循环的下一个值，<br>直到遇到StopIteration错误时退出循环。</p><p>以斐波那契数列为例，写一个Fib类，可以作用于for循环：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fib</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.a, self.b = <span class="number">0</span>, <span class="number">1</span>   <span class="comment"># 初始化两个计数器a，b</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self             <span class="comment"># 实例本身就是迭代对象，故返回自己</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__next__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.a, self.b = self.b, self.a + self.b <span class="comment"># 计算下一个值</span></span><br><span class="line">        <span class="keyword">if</span> self.a &gt; <span class="number">100000</span>:     <span class="comment"># 退出循环的条件</span></span><br><span class="line">            <span class="keyword">raise</span> StopIteration()</span><br><span class="line">        <span class="keyword">return</span> self.a           <span class="comment"># 返回下一个值</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> n <span class="keyword">in</span> Fib():</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(n)</span><br><span class="line">...</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line">...</span><br><span class="line"><span class="number">46368</span></span><br><span class="line"><span class="number">75025</span></span><br></pre></td></tr></table></figure><h2 id="getitem"><a href="#getitem" class="headerlink" title="__getitem__()"></a><code>__getitem__()</code></h2><h2 id="getattr"><a href="#getattr" class="headerlink" title="__getattr__()"></a><code>__getattr__()</code></h2><blockquote><p>触发时机：获取不存在的对象成员时触发<br>参数：1接收当前对象的self，一个是获取成员名称的字符串<br>返回值：必须有值<br>作用:为访问不存在的属性设置值<br>注意：getattribute无论何时都会在getattr之前触发，触发了getattribute就不会在触发getattr了</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
          <category> OPP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python【No-12】私有化</title>
      <link href="posts/45109"/>
      <url>posts/45109</url>
      
        <content type="html"><![CDATA[<p>类的私有化</p><span id="more"></span><p>Python 是动态语言，可以在程序运行过程中动态地给class加上属性或方法。<br>这种不加以节制的特性很容易造成烂代码一堆。对此 Python 提供了一些解决方案。</p><h2 id="slots-变量绑定白名单"><a href="#slots-变量绑定白名单" class="headerlink" title="slots 变量绑定白名单"></a><strong>slots</strong> 变量绑定白名单</h2><blockquote><p><code>__slots__ = (attributes_of_tuple)</code><br>写在类变量处<br>attributes_of_tuple是个元组，元组中每一个元素要用string型。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClsName</span>:</span></span><br><span class="line">    __slots__ = (<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>)</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><p>示例，在交互模式中：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 没有白名单，可以随意绑定属性</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">pass</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p = Person()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.name = <span class="string">&#x27;Boii&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.age = <span class="number">18</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.score = <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(p.name, p.age, p.score)</span><br><span class="line">Boii <span class="number">18</span> <span class="number">100</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用了白名单，只能绑定白名单上的属性</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line"><span class="meta">... </span>    __slots__ = (<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p = Person()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.name = <span class="string">&#x27;Boii&#x27;</span>    <span class="comment"># 白名单中的属性，可以绑定</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.age = <span class="number">18</span>         <span class="comment"># 白名单中的属性，可以绑定</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.score = <span class="number">100</span>      <span class="comment"># 白名单中没有的属性，绑定失败</span></span><br><span class="line"><span class="comment"># 白名单中没有 score，所以绑定失败</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">AttributeError: <span class="string">&#x27;Person&#x27;</span> <span class="built_in">object</span> has no attribute <span class="string">&#x27;score&#x27;</span></span><br></pre></td></tr></table></figure><p>示例，在模块文件中：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line"></span><br><span class="line">    __slots__ = (<span class="string">&#x27;score&#x27;</span>, <span class="string">&#x27;gender&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, age</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line"><span class="comment"># 白名单中没有 name 和 age，所以连创建对象都会失败</span></span><br><span class="line">person = Person(<span class="string">&#x27;Boii&#x27;</span>, <span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">AttributeError: <span class="string">&#x27;Person&#x27;</span> <span class="built_in">object</span> has no attribute <span class="string">&#x27;name&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line"></span><br><span class="line">    __slots__ = (<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>, <span class="string">&#x27;score&#x27;</span>, <span class="string">&#x27;gender&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, age</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = Person(<span class="string">&#x27;Boii&#x27;</span>, <span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(p.name, p.age)</span><br><span class="line"></span><br><span class="line">p.name = <span class="string">&#x27;Kali&#x27;</span>     <span class="comment"># 白名单中存在，可以修改</span></span><br><span class="line">p.age = <span class="number">30</span>          <span class="comment"># 白名单中存在，可以修改</span></span><br><span class="line">p.score = <span class="number">100</span>       <span class="comment"># 白名单中存在，可以绑定</span></span><br><span class="line">p.gender = <span class="string">&#x27;male&#x27;</span>   <span class="comment"># 白名单中存在，可以绑定</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(p.name, p.age, p.score, p.gender)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">Boii <span class="number">20</span></span><br><span class="line">Kali <span class="number">30</span> <span class="number">100</span> male</span><br></pre></td></tr></table></figure><blockquote><p>使用__slots__要注意，<code>__slots__</code>定义的属性仅对当前类实例起作用，对继承的子类是不起作用的<br>除非在子类中也定义<code>__slots__</code>，这样，子类实例允许定义的属性就是自身的<code>__slots__</code>加上父类的<code>__slots__</code>。</p></blockquote><h2 id="property"><a href="#property" class="headerlink" title="@property"></a>@property</h2><p>当一个类中有不想给外界随便访问或修改的属性时，可以将该变量变成 private 型的<br>例如 <code>__age = 18</code></p><p>这样的属性只能在类中访问和修改，外界要进行访问和修改只能通过类中的<code>getter、setter</code>方法。例如：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, age</span>):</span></span><br><span class="line">        self.__age = age</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_age</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.__age</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_age</span>(<span class="params">self, value</span>):</span></span><br><span class="line">        <span class="keyword">if</span> value &gt; <span class="number">0</span> <span class="keyword">and</span> value &lt; <span class="number">200</span>:</span><br><span class="line">            self.__age = value</span><br><span class="line"></span><br><span class="line">p = Person(<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(p.get_age())    <span class="comment"># 20</span></span><br><span class="line">p.set_age(<span class="number">18</span>)</span><br><span class="line"><span class="built_in">print</span>(p.get_age())    <span class="comment"># 18</span></span><br></pre></td></tr></table></figure><p>通过 <code>getter、setter</code> ，在访问和修改的时候比较麻烦，要通过调用方法。<br>使用 <code>装饰器@property</code> 则可以比较方便，像变量一样去访问和修改</p><h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClsName</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, attributeName</span>):</span></span><br><span class="line">        self.__attributeName = attributeName</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 要先写getter</span></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">attributeName</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.__attributeName</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 再写setter</span></span><br><span class="line"><span class="meta">    @attributeName.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">attributeName</span>(<span class="params">self, value</span>):</span></span><br><span class="line">        self.__attributeName = value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cls = ClsName()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(cls.attributeName)    <span class="comment"># 访问</span></span><br><span class="line">cls.attributeName = value   <span class="comment"># 修改</span></span><br></pre></td></tr></table></figure><p>现在改写上面 Person 类的例子：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, age</span>):</span></span><br><span class="line">        self.__age = age</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">age</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.__age</span><br><span class="line"></span><br><span class="line"><span class="meta">    @age.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">age</span>(<span class="params">self, value</span>):</span></span><br><span class="line">        <span class="keyword">if</span> value &gt; <span class="number">0</span> <span class="keyword">and</span> value &lt; <span class="number">200</span>:</span><br><span class="line">            self.__age = value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = Person(<span class="number">18</span>)</span><br><span class="line"><span class="built_in">print</span>(p.age)    <span class="comment"># 18</span></span><br><span class="line">p.age = <span class="number">20</span></span><br><span class="line"><span class="built_in">print</span>(p.age)    <span class="comment"># 20</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
          <category> OPP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python【No-11】类和对象</title>
      <link href="posts/7031"/>
      <url>posts/7031</url>
      
        <content type="html"><![CDATA[<p>模具和产品：类和对象</p><span id="more"></span><p>封装、继承、多态</p><h2 id="Class"><a href="#Class" class="headerlink" title="Class"></a>Class</h2><blockquote><p>类就像模具，用模具制作出来的产品叫做对象</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 不带继承的类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClsName</span>:</span>    <span class="comment"># 类名</span></span><br><span class="line">    <span class="comment"># 静态字段，通过类访问 print(ClsName.name), 在内存中只保存一份</span></span><br><span class="line">    name = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    age = <span class="number">0</span>        <span class="comment"># public类变量，任何区域都能访问</span></span><br><span class="line">    _weight = <span class="number">0</span>    <span class="comment"># protected类变量，当前类和子类和同一模块中才能访问</span></span><br><span class="line">    __height = <span class="number">0</span>   <span class="comment"># private类变量，只有当前类才能访问</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 构造方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,[para1[, para2[, paraN]</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot; 这里是类文档 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 普通字段，通过实例来访问 print(clsInstance.para1), 每个实例中都保存</span></span><br><span class="line">        self.para1 = para1</span><br><span class="line">        self.para2 = para2</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 类方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">method</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot; 这里是方法注释 &quot;&quot;&quot;</span></span><br><span class="line">        &lt;statement&gt;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 类的私有方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__private_method</span>(<span class="params">self</span>):</span></span><br><span class="line">        &lt;statement&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 继承了别的类的类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClsName</span>(<span class="params">BaseClsName1[, Base2[, Base3[, BaseN]</span>):</span>    <span class="comment"># 括号内是这个类所继承的父类</span></span><br><span class="line">    &lt;statement&gt;</span><br></pre></td></tr></table></figure><h3 id="self"><a href="#self" class="headerlink" title="self"></a>self</h3><p>这是<code>方法</code>和<code>函数</code>的区别之处：不管是什么方法都要有<code>self</code>这个参数，再写其他参数<br>这个<code>self</code>是唯一的不可缺少的，它等价于java 和 C++中的<code>this</code><br>但是调用方法的时候不需要给它赋值<br>当这样调用对象的方法时：<code>myobject.method(arg1,arg2)</code>，解释器会解释为<code>MyClass.method(myobject, arg1, arg2)</code>，<strong>这就是方法的自动传值</strong></p><h3 id="类变量-VS-对象变量"><a href="#类变量-VS-对象变量" class="headerlink" title="类变量 VS 对象变量"></a>类变量 VS 对象变量</h3><p>类变量或者说静态字段都是一个东西。（类变量 == 静态字段、类属性）<br>对象变量或者说普通字段也都是一个东西。（对象变量 == 普通字段、实例属性）</p><p>顾名思义，<br><code>类变量</code>就是属于<code>类</code>的变量<br><code>对象变量</code>就是属于<code>对象（实例）</code>的变量</p><h4 id="差别"><a href="#差别" class="headerlink" title="差别"></a>差别</h4><p><strong>定义</strong>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="comment"># 类变量、静态字段、类属性</span></span><br><span class="line">    eyes = <span class="number">2</span></span><br><span class="line">    nose = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, age</span>):</span></span><br><span class="line">        <span class="comment"># 对象变量、普通字段、实例属性</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br></pre></td></tr></table></figure><p><img src="IMG/20200902105833108_3400.png" class="lazyload" data-srcset="IMG/20200902105833108_3400.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p><strong>实例化</strong>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建两个对象（实例化）</span></span><br><span class="line">p1 = Person(<span class="string">&#x27;Boii&#x27;</span>, <span class="number">20</span>)</span><br><span class="line">p2 = Person(<span class="string">&#x27;Cai&#x27;</span>, <span class="number">18</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问静态变量</span></span><br><span class="line"><span class="built_in">print</span>(Person.eyes)    <span class="comment"># 2 通过类名访问</span></span><br><span class="line"><span class="built_in">print</span>(p1.eyes)        <span class="comment"># 2 通过对象访问</span></span><br><span class="line"><span class="built_in">print</span>(p2.nose)        <span class="comment"># 1 通过对象访问</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问对象变量</span></span><br><span class="line"><span class="built_in">print</span>(p1.name)   <span class="comment"># Boii</span></span><br><span class="line"><span class="built_in">print</span>(p2.name)   <span class="comment"># Cai</span></span><br></pre></td></tr></table></figure><p><img src="IMG/20200902105816461_6402.png" class="lazyload" data-srcset="IMG/20200902105816461_6402.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p><strong>修改类变量以后</strong>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改静态变量</span></span><br><span class="line">Person.eyes = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(p1.eyes)    <span class="comment"># 1</span></span><br><span class="line"><span class="built_in">print</span>(p2.eyes)    <span class="comment"># 1</span></span><br></pre></td></tr></table></figure><p><img src="IMG/20200902105922748_5672.png" class="lazyload" data-srcset="IMG/20200902105922748_5672.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改对象变量</span></span><br><span class="line">p1.age = <span class="number">50</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(p1.age)    <span class="comment"># 50</span></span><br><span class="line"><span class="built_in">print</span>(p2.age)    <span class="comment"># 18, 改了对象A的，对象B是不受影响的</span></span><br></pre></td></tr></table></figure><p><img src="IMG/20200902110710748_5406.png" class="lazyload" data-srcset="IMG/20200902110710748_5406.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>类变量，是属于类的，存在类那块内存中，类变量被该类创建出来的对象共享。<br>例如上图中，最上面的表格中就是类本身占的内存，其中就有类变量 eyes 和 nose<br>下面两个小表格就是对象 p1 和 p2 各自占的空间，其中就保存着对象变量 name，age</p><p>修改类变量 eyes 和 nose 后，对象 p1 和 p2 去访问 eyes 和 nose 就会访问到修改后的值<br>修改对象变量 name 或 age 后，对象之间互不影响。</p><p>假设一个类创建了两个对象A 和 B<br>这时内存中其实是有三块空间的，一块是类的，一块是对象A的，一块是对象B的。</p><p>当通过<code>类名.类变量</code>访问的时候，是访问<code>类那块内存</code>里的类变量的<br>当通过<code>类名.类变量</code>修改的时候，是修改<code>类那块内存</code>里的类变量的</p><p>当通过<code>对象.类变量</code>访问的时候，是系统跑去<code>类那块内存</code>里访问类变量的<br>当通过<code>对象.类变量</code>修改的时候，是系统跑去<code>类那块内存</code>里<strong>复制</strong>类变量到<code>对象那块内存</code>里的</p><p>此时通过<code>类名.类变量</code>修改，再通过<code>对象.类变量</code>访问，其实访问的是<code>对象自己内存</code>里的那个类变量</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="comment"># 类变量、静态字段</span></span><br><span class="line">    eyes = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, age</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建两个对象</span></span><br><span class="line">p1 = Person(<span class="string">&#x27;Boii&#x27;</span>, <span class="number">20</span>)</span><br><span class="line">p2 = Person(<span class="string">&#x27;Cai&#x27;</span>, <span class="number">18</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过类 访问静态变量</span></span><br><span class="line"><span class="built_in">print</span>(Person.eyes)        <span class="comment"># 2</span></span><br><span class="line"><span class="comment"># 通过对象 访问静态变量</span></span><br><span class="line"><span class="built_in">print</span>(p1.eyes)       <span class="comment"># 2</span></span><br><span class="line"><span class="built_in">print</span>(p2.eyes)       <span class="comment"># 2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 通过类 修改静态变量</span></span><br><span class="line">Person.eyes = <span class="number">1</span></span><br><span class="line"><span class="comment"># 再通过类 访问静态变量</span></span><br><span class="line"><span class="built_in">print</span>(Person.eyes)        <span class="comment"># 1</span></span><br><span class="line"><span class="comment"># 再通过对象 访问静态变量</span></span><br><span class="line"><span class="built_in">print</span>(p1.eyes)       <span class="comment"># 1</span></span><br><span class="line"><span class="built_in">print</span>(p2.eyes)       <span class="comment"># 1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 通过对象 修改对象变量</span></span><br><span class="line">p1.eyes = <span class="number">50</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 再通过类 访问静态变量</span></span><br><span class="line"><span class="built_in">print</span>(Person.eyes)        <span class="comment"># 1</span></span><br><span class="line"><span class="comment"># 再通过对象 访问静态变量</span></span><br><span class="line"><span class="built_in">print</span>(p1.eyes)       <span class="comment"># 50    此时personA的内存里已经有eyes这个变量了</span></span><br><span class="line"><span class="built_in">print</span>(p2.eyes)       <span class="comment"># 1</span></span><br></pre></td></tr></table></figure><p><img src="IMG/20200902111556373_11112.png" class="lazyload" data-srcset="IMG/20200902111556373_11112.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="><br>注意 p1 中 已经多了一个 eyes 的变量了</p><h4 id="另外"><a href="#另外" class="headerlink" title="另外"></a>另外</h4><p><strong>但是注意，如果静态变量是字典 dict，则不管怎么访问怎么修改，得到的都是一致的</strong></p><p>看下面的例子<br>类变量中有一个字典类型 d</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="comment"># 类变量、静态字段</span></span><br><span class="line">    eyes = <span class="number">2</span></span><br><span class="line">    d = &#123;<span class="number">1</span>: <span class="string">&#x27;A&#x27;</span>, <span class="number">2</span>: <span class="string">&#x27;B&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, age</span>):</span></span><br><span class="line">        <span class="comment"># 对象变量、普通字段</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br></pre></td></tr></table></figure><p><img src="IMG/20200902142346472_20282.png" class="lazyload" data-srcset="IMG/20200902142346472_20282.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>创建两个对象，然后通过对象修改类变量，和通过对象修改字典类型类变量</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建两个对象</span></span><br><span class="line">p1 = Person(<span class="string">&#x27;Boii&#x27;</span>, <span class="number">20</span>)</span><br><span class="line">p2 = Person(<span class="string">&#x27;Cai&#x27;</span>, <span class="number">18</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过类 修改静态变量, 改动的是类空间里的eyes</span></span><br><span class="line">Person.eyes = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过对象 修改静态变量, 是复制一份eyes到对象空间里并修改</span></span><br><span class="line">p1.eyes = <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过对象 修改静态字典变量, 并不会复制一份d到对象空间里</span></span><br><span class="line">p1.d[<span class="number">1</span>] = <span class="number">50</span></span><br></pre></td></tr></table></figure><p><img src="IMG/20200902142543383_3873.png" class="lazyload" data-srcset="IMG/20200902142543383_3873.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="><br>可以看到通过类名修改后，类空间里的eyes被修改了<br>通过对象修改类变量之后，对象空间里多了一个 eyes 变量并且已经修改了<br>通过对象修改字典类型类变量之后，没有复制一份，而是修改了类空间里字典的值</p><h4 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h4><ol><li>类变量，又称静态字段、类属性</li><li>对象变量，又称普通字段、实例属性</li><li>类变量是所有对象共有的，对象变量是对象自己独有的</li><li>类变量可以通过 <code>类名.类变量</code>、<code>对象.类变量</code>访问</li><li>类变量可以通过 <code>类名.类变量</code>、<code>对象.类变量</code>修改</li><li>通过 <code>对象.类变量</code> 修改时，除非该类变量是字典类型，否则都会把类变量复制一份到对象中去</li></ol><h3 id="实例方法、类方法、静态方法"><a href="#实例方法、类方法、静态方法" class="headerlink" title="实例方法、类方法、静态方法"></a>实例方法、类方法、静态方法</h3><h4 id="实例方法"><a href="#实例方法" class="headerlink" title="实例方法"></a>实例方法</h4><blockquote><p>最普通最常用的方法。类中定义的非私有的方法，每个对象在被创建以后都有自己的实例方法。</p></blockquote><ul><li>定义：第一个参数必须是实例对象，该参数名一般约定为“self”，通过它来传递实例的属性和方法（也可以传类的属性和方法）；<pre><code>  如`p1.instanceMethod()`，Python 解释器会把对象 p1 传给self参数</code></pre></li><li>调用：只能由实例对象调用。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    ...</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment"># 定义实例方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">walk</span>(<span class="params">self, step</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;I walked <span class="subst">&#123;step&#125;</span> steps.&quot;</span></span><br><span class="line"></span><br><span class="line">p1 = Person()</span><br><span class="line"><span class="built_in">print</span>(p1.walk(<span class="number">5</span>))        <span class="comment"># 调用实例方法</span></span><br><span class="line"></span><br><span class="line">-------------------------------</span><br><span class="line">Output:</span><br><span class="line"></span><br><span class="line">I walked <span class="number">5</span> steps.</span><br></pre></td></tr></table></figure><h4 id="类方法-classmethod"><a href="#类方法-classmethod" class="headerlink" title="类方法 @classmethod"></a>类方法 @classmethod</h4><blockquote><p>属于类的方法，和类变量一样，所有对象共享类方法</p></blockquote><ul><li>定义：使用装饰器<code>@classmethod</code>。第一个参数必须是当前类对象，该参数名一般约定为“cls”，通过它来传递类的属性和方法（不能传实例的属性和方法）；<br>  如<code>p1.clsMethod</code> 或 <code>Person.clsMethod</code>，Python解释器会把类 Person 传给 cls 参数</li><li>调用：类对象或实例对象都可以调用。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    __count = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        Person.__count += <span class="number">1</span></span><br><span class="line">    ...</span><br><span class="line">    ...</span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_count</span>(<span class="params">cls</span>):</span></span><br><span class="line">        <span class="keyword">return</span> cls.__count</span><br></pre></td></tr></table></figure><h4 id="静态方法-staticmethod"><a href="#静态方法-staticmethod" class="headerlink" title="静态方法 @staticmethod"></a>静态方法 @staticmethod</h4><p>用来存放逻辑性的代码，逻辑上属于类，但是和类本身没有关系，即，在静态方法中，不会涉及到类中的属性和方法的操作。<br>可以理解为静态方法是个<strong>独立的、单纯的</strong>函数，仅仅托关于某个类的名称空间中，便于使用和维护。</p><ul><li>定义：使用装饰器<code>@staticmethod</code>。参数随意，没有“self”和“cls”参数，但是方法体中不能使用类或实例的任何属性和方法；</li><li>调用：类对象或实例对象都可以调用。</li></ul><h3 id="构造方法"><a href="#构造方法" class="headerlink" title="构造方法"></a>构造方法</h3><blockquote><p><code>def __init__(self)</code>就是类的构造方法</p></blockquote><p>构造方法的形参可以有1~N个。而<code>参数self</code>是必选的首个的，这个<code>self</code>相当于<code>this</code>。<br><code>self</code>可以换成其他，但是为避免争议和歧义，最好用<code>self</code></p><p>对于一个对象，可以自由的增加属性或者说对象变量、普通字段，但是通过构造方法，可以强制要求<code>在实例化对象时传入必须的参数</code>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">animalA = Animal()    <span class="comment"># self 不需要传入</span></span><br><span class="line">animalA.weigth = <span class="number">180</span>  <span class="comment"># 可以自由的增加对象属性</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, age</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">personA = Person(<span class="string">&#x27;Boii&#x27;</span>, <span class="number">20</span>)    <span class="comment"># 创建对象时必须给 name 和 age</span></span><br><span class="line"></span><br><span class="line">personB = Person()    <span class="comment"># ！！错误</span></span><br></pre></td></tr></table></figure><h3 id="访问限制"><a href="#访问限制" class="headerlink" title="访问限制"></a>访问限制</h3><blockquote><p>不加下划线，仅变量名/方法名 = public，任何区域都可以访问<br>一条下划线+变量名/方法名 = protected，<code>当前类</code>和<code>子类</code>和<code>同一模块</code>才可以访问<br>两条下划线+变量名/方法名 = private， <code>当前类</code>才可以访问</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># public 示例</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name</span>):</span></span><br><span class="line">        self.name = name    <span class="comment"># public 属性</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(self.name)    <span class="comment"># 类内部可以访问</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">person = Person(<span class="string">&#x27;Boii&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(person.name)    <span class="comment"># Boii 类外部也可以访问</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># protected 示例</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Person.py begin</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name</span>):</span></span><br><span class="line">        self._name = name    <span class="comment"># protected 属性</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(self._name)     <span class="comment"># 当前类中可以访问</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">person = Person(<span class="string">&#x27;Boii&#x27;</span>)</span><br><span class="line"></span><br><span class="line">person.show()                 <span class="comment"># Boii</span></span><br><span class="line"><span class="comment">## Person.py end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## Student.py begin</span></span><br><span class="line"><span class="keyword">from</span> Person <span class="keyword">import</span> Person</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>(<span class="params">Person</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, age</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__(name)    <span class="comment"># 在子类中通过 super().__init__() 访问</span></span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;姓名：<span class="subst">&#123;self._name&#125;</span>, 年龄：<span class="subst">&#123;self.age&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">student = Student(<span class="string">&#x27;Boii&#x27;</span>, <span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">student.show()            <span class="comment"># 姓名：Boii, 年龄：20</span></span><br><span class="line"><span class="comment">## Student.py end</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># private 示例</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name</span>):</span></span><br><span class="line">        self.__name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(self.__name)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_name</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.__name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_name</span>(<span class="params">self, name</span>):</span></span><br><span class="line">        self.__name = name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">person = Person(<span class="string">&#x27;Boii&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(person.__name)        <span class="comment"># 错误！！只能在类中访问私有变量</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(person.get_name())    <span class="comment"># Boii, 通过get方法访问</span></span><br><span class="line"></span><br><span class="line">person.set_name(<span class="string">&#x27;Alice&#x27;</span>)    <span class="comment"># 通过set方法改变</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(person.get_name())    <span class="comment"># Alice</span></span><br></pre></td></tr></table></figure><p>private变量实际上是因为 python解释器对外把 <code>__name</code> 改成了 <code>_Person__name</code>，依然可以通过<code>person._Person__name</code>来访问，但是强烈建议不要这么做。</p><p>点击查看更多关于<a href="">访问限制、私有化</a>的问题</p><h2 id="封装、继承和多态"><a href="#封装、继承和多态" class="headerlink" title="封装、继承和多态"></a>封装、继承和多态</h2><blockquote><p>面向对象三大特性：封装、继承、多态<br><strong>封装</strong><br>把一类东西共通的属性、行为定义在一个类中，就是封装。</p><p><strong>继承</strong><br>一个类，继承了别的类以后，这个类叫做<code>子类</code><br>被继承的类，叫做<code>基类、父类、超类</code><br>继承以后，子类就拥有了父类的全部 <code>非private 功能</code><br>Python中，子类可以同时继承多个父类</p><p><strong>多态</strong><br>在子类中编写<code>与父类同名</code>的方法，叫做<code>方法重写</code>，<br>适用于父类功能不能满足子类要求时。这称之为<strong>多态</strong><br>当父类子类的方法相同时，总是会优先调用子类的方法</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Running---&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span>(<span class="params">Animal</span>):</span>    <span class="comment"># 继承父类 Animal</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span>(<span class="params">Animal</span>):</span>    <span class="comment"># 继承父类 Animal</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span>    <span class="comment"># 方法重写</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Cat is Running---&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dog = Dog()</span><br><span class="line">dog.run()    <span class="comment"># Running---</span></span><br><span class="line"></span><br><span class="line">cat = Cat()</span><br><span class="line">cat.run()    <span class="comment"># Cat is Running---</span></span><br></pre></td></tr></table></figure><h3 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h3><blockquote><p><code>class ClsName(BaseClass)</code><br>在继承中，父类和子类都有的方法（同名的方法），会优先调用子类的；子类没有的，才调用父类的<br>子类中不定义构造方法<code>__init__()</code>，会调用父类的构造方法<code>__init__()</code></p></blockquote><h4 id="单继承"><a href="#单继承" class="headerlink" title="单继承"></a>单继承</h4><p>在<strong>单继承</strong>中：<br>如果父类构造方法有参数，则子类必须有构造方法，并调用父类的构造方法且传参</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 子类没有__init__，默认调用父类的__init__</span></span><br><span class="line"><span class="comment"># 父类的__init__没有参数，所以子类可以不写__init__</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.name = <span class="string">&quot;Anonymity&quot;</span></span><br><span class="line">        self.age = <span class="number">18</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>(<span class="params">Person</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">s = Student()</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 父类的__init__有参数，子类必须有__init__，并调用父类的__init__且传参</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>(<span class="params">Person</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, age</span>):</span></span><br><span class="line">        self.age = age</span><br><span class="line">        <span class="built_in">super</span>().__init__(name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s = Student(<span class="string">&quot;Boii&quot;</span>, <span class="number">18</span>)</span><br></pre></td></tr></table></figure><h4 id="多继承"><a href="#多继承" class="headerlink" title="多继承"></a>多继承</h4><p>在<strong>多继承</strong>中：<br>如果子类没有<code>__init__()</code>，会调用第一个父类的<code>__init__()</code><br>如果第一个父类没有<code>__init__()</code>，会找第二个父类，以此类推…</p><p>其中，只要任何一个父类的<code>__init__()</code>有参数，子类就必须有<code>__init__()</code>来调用父类的<code>__init__()</code></p><p>如果有超过一个父类的<code>__init__()</code>有参数，<br>则应该写作 <code>BaseClsName.__init__(self, paras)</code> 或 <code>BaseClsName(type, obj).__init__(paras)</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseA</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, age</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseB</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, gender, nationality</span>):</span></span><br><span class="line">        self.gender = gender</span><br><span class="line">        self.nationality = nationality</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>(<span class="params">BaseA, BaseB</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, age, gender, nationality</span>):</span></span><br><span class="line"></span><br><span class="line">        BaseA(Student, self).__init__(name, age)</span><br><span class="line"></span><br><span class="line">        BaseB.__init__(self, gender, nationality)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s = Student(<span class="string">&quot;Boii&quot;</span>, <span class="number">18</span>, <span class="string">&quot;male&quot;</span>, <span class="string">&quot;China&quot;</span>)</span><br></pre></td></tr></table></figure><h4 id="钻石继承"><a href="#钻石继承" class="headerlink" title="钻石继承"></a>钻石继承</h4><blockquote><p>菱形继承是指：<br>子类 sub 继承了 父类 A，B，而父类 A，B又共同继承了祖父类 Base</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">   <span class="selector-attr">[Base]</span></span><br><span class="line">  ↗     ↖</span><br><span class="line"><span class="selector-attr">[A]</span>      <span class="selector-attr">[B]</span></span><br><span class="line">  ↖     ↗</span><br><span class="line">   <span class="selector-attr">[sub]</span></span><br></pre></td></tr></table></figure><p>由于Python的机制，解释器在创建 sub类对象时会找到 A 的 构造方法，接着找到 Base 的构造方法<br>然后再找 B 的构造方法，接着找到 Base 的构造方法，这样等于重复调用了 Base 的构造方法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Base.__init__&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>(<span class="params">Base</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        Base.__init__(self)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;A.__init__&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>(<span class="params">Base</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        Base.__init__(self)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;B.__init__&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">sub</span>(<span class="params">A, B</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        A.__init__(self)</span><br><span class="line">        B.__init__(self)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;sub.__init__&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sub()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">Base.__init__</span><br><span class="line">A.__init__</span><br><span class="line">Base.__init__</span><br><span class="line">B.__init__</span><br><span class="line">sub.__init__</span><br></pre></td></tr></table></figure><p>Base 的 <code>__init__()</code>被调用了两次</p><p>这时候可以改写 sub，A，B 的 <code>__init__()</code>为<code>super().__init__</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Base.__init__&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>(<span class="params">Base</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;A.__init__&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>(<span class="params">Base</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;B.__init__&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">sub</span>(<span class="params">A, B</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;sub.__init__&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sub()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">Base.__init__</span><br><span class="line">B.__init__</span><br><span class="line">A.__init__</span><br><span class="line">sub.__init__</span><br></pre></td></tr></table></figure><h3 id="多态的好处"><a href="#多态的好处" class="headerlink" title="多态的好处"></a>多态的好处</h3><p>如上示例，多态使得继承之后还可以进行扩展，但是多态还有另一个好处。</p><p>示例中，Animal 是父类，Dog 和 Cat 是子类。<br>Animal 是 Animal 类型；Dog 是 Dog 类型，也是 Animal 类型；Cat 同理</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>animal = Animal()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dog = Dog()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cat = Cat()</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>(animal, Animal)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>(dog, Dog)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>(dog, Animal)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>(cat, Cat)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>(cat, Animal)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>(animal, Dog)</span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure><blockquote><p><strong>一句话总结就是，对象的类型是<code>自身类+父类</code>，而所有类都自动继承自 <code>object类</code></strong></p></blockquote><p>因为这个特性，使得python更加灵活</p><p>假设现在有个函数，这个函数接受一个animal类型对象</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_twice</span>(<span class="params">animal</span>):</span></span><br><span class="line">    animal.run()</span><br><span class="line">    animal.run()</span><br></pre></td></tr></table></figure><p>在调用的时候：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>animal = Animal()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dog = Dog()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cat = Cat()</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>run_twice(animal)</span><br><span class="line">Running---</span><br><span class="line">Running---</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>run_twice(cat)</span><br><span class="line">Cat <span class="keyword">is</span> Running---</span><br><span class="line">Cat <span class="keyword">is</span> Running---</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>run_twice(dog)</span><br><span class="line">Running---</span><br><span class="line">Running---</span><br></pre></td></tr></table></figure><p>可以发现，这个接受Animal类型的函数，<strong>不仅可以接受Animal类及其子类的对象，还可以根据传入对象的不同实现不同的效果</strong><br>即使再定义一个类继承Animal，然后创建对象传入 <code>run_twice()</code>，依然可以实现相同的效果，而且不需要改动<code>run_twice()</code></p><p>同理，所有的类都继承自<code>object</code>，如果是<code>run_twice(object)</code>，则可以接受任何类型的对象<br>所以，对于一个变量，只需要知道其父类<code>Animal</code>，就可以放心的使用，在调用时<code>animal.run()</code>是作用在animal还是dog还是cat，由运行时该对象的确切类型决定。</p><p>调用方只管调用，不管细节。每当新增一种<code>Animal子类</code>时，只要确保<code>run()</code>方法编写正确，不用管<code>run_twice()</code>怎么实现。<br>这就是<code>&lt;开闭原则&gt;</code>:</p><ul><li>对扩展开放：允许新增<code>Animal</code>子类；</li><li>对修改封闭：不需要修改<code>依赖Animal类型</code>的<code>run_twice()</code>等函数</li></ul><h4 id="多态在静态语言和动态语言中的区别"><a href="#多态在静态语言和动态语言中的区别" class="headerlink" title="多态在静态语言和动态语言中的区别"></a>多态在静态语言和动态语言中的区别</h4><p>多态的这种特性在<code>动态语言</code>和<code>静态语言</code>中还有些区别.</p><p>像java这种静态语言，<code>run_twice(Animal)</code>传入的对象必须是<code>Animal类型或其子类</code>，否则无法调用<code>run()</code>方法。<br>而python这种动态语言，则不一定要传入Animal类型，只需要保证传入的对象有一个<code>run()</code>方法就可以。<br><strong>这就是动态语言的<code>“鸭子类型”</code>，它并不要求严格的继承体系，一个对象只要“看起来像鸭子，走起路来像鸭子”，那它就可以被看做是鸭子。</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Timer</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Start---&#x27;</span>)</span><br></pre></td></tr></table></figure><p>像这个类，没有继承Animal，但依然可以传给<code>run_twice(Animal)</code>。</p><p>示例：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span>(<span class="params"><span class="built_in">object</span></span>):</span>   <span class="comment"># 编写Animal类</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Animal is running...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span>(<span class="params">Animal</span>):</span>      <span class="comment"># Dog类继承Amimal类，没有run方法</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span>(<span class="params">Animal</span>):</span>      <span class="comment"># Cat类继承Animal类，有自己的run方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Cat is running...&#x27;</span>)</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span>(<span class="params"><span class="built_in">object</span></span>):</span>      <span class="comment"># Car类不继承，有自己的run方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Car is running...&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Stone</span>(<span class="params"><span class="built_in">object</span></span>):</span>    <span class="comment"># Stone类不继承，也没有run方法</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_twice</span>(<span class="params">animal</span>):</span></span><br><span class="line">    animal.run()</span><br><span class="line">    animal.run()</span><br><span class="line"></span><br><span class="line">run_twice(Animal())</span><br><span class="line">run_twice(Dog())</span><br><span class="line">run_twice(Cat())</span><br><span class="line">run_twice(Car())</span><br><span class="line">run_twice(Stone())</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">Animal</span></span> is running...</span><br><span class="line"><span class="function"><span class="title">Animal</span></span> is running...</span><br><span class="line"><span class="function"><span class="title">Animal</span></span> is running...</span><br><span class="line"><span class="function"><span class="title">Animal</span></span> is running...</span><br><span class="line"><span class="function"><span class="title">Cat</span></span> is running...</span><br><span class="line"><span class="function"><span class="title">Cat</span></span> is running...</span><br><span class="line"><span class="function"><span class="title">Car</span></span> is running...</span><br><span class="line"><span class="function"><span class="title">Car</span></span> is running...</span><br><span class="line"></span><br><span class="line">AttributeError: <span class="string">&#x27;Stone&#x27;</span> object has <span class="keyword">no</span> attribute <span class="string">&#x27;run&#x27;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
          <category> OPP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python【No-10】模块</title>
      <link href="posts/65033"/>
      <url>posts/65033</url>
      
        <content type="html"><![CDATA[<p>一个py文件就是一个模块</p><span id="more"></span><h2 id="模块-Module"><a href="#模块-Module" class="headerlink" title="模块 Module"></a>模块 Module</h2><blockquote><p>一个 <code>.py</code>文件就称之为一个<code>模块 module</code></p></blockquote><p>好处：</p><ol><li>提高了代码的可维护性；</li><li>可以被其他地方应用；</li><li>可以避免命名冲突。</li></ol><h3 id="import"><a href="#import" class="headerlink" title="import"></a>import</h3><p>import加载的模块分为四个通用类别：</p><ol><li>使用python编写的代码（<code>py文件</code>）；</li><li>已被编译为共享库或DLL的<code>C或C++扩展</code>；</li><li>包好一组模块的<code>包</code></li><li>使用C编写并链接到python解释器的<code>内置模块</code>.</li></ol><h2 id="包-Package"><a href="#包-Package" class="headerlink" title="包 Package"></a>包 Package</h2><blockquote><p>模块的上一级称为<code>包 package</code></p></blockquote><ul><li>包是一个文件夹，可以通过包来组织模块，避免冲突。</li><li>一个包里必须含有一个<code>__init__.py</code><ol><li><code>__init__.py</code>可以是空文件，也可以有Python代码</li><li><code>__init__.py</code>本身就算一个模块，它的模块名就是包名</li></ol></li><li>包里面还可以有包</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">MyPackage</span><br><span class="line"> ├─ web</span><br><span class="line"> │  ├─ __init__.py</span><br><span class="line"> │  ├─ utils.py</span><br><span class="line"> │  └─ test.py</span><br><span class="line"> ├─ dirc</span><br><span class="line"> │  ├─ utils.py</span><br><span class="line"> │  └─ test.py</span><br><span class="line"> │</span><br><span class="line"> ├─ __init__.py</span><br><span class="line"> ├─ main.py</span><br><span class="line"> └─ utils.py</span><br></pre></td></tr></table></figure><p>顶层包为 MyPackage<br>子包为 web<br>普通目录 dirc （因为它没有<code>__init__.py</code>文件）<br><code>test.py</code>的模块名为<code>MyPackage.web.test</code><br><code>utils.py</code>有两个，模块名分别为<code>MyPackage.web.utils</code>和<code>MyPackage.utils</code></p><blockquote><p>自己创建模块时注意命名不要与系统模块冲突<br>要检查系统中是否存在该模块，可以在交互环境下执行 <code>import abc</code>，若成功说明系统存在此模块。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> aabbccc</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">ModuleNotFoundError: No module named <span class="string">&#x27;aabbccc&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="使用模块"><a href="#使用模块" class="headerlink" title="使用模块"></a>使用模块</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;Here is the module documentation&quot;</span></span><br><span class="line"></span><br><span class="line">__author__ = <span class="string">&#x27;Boii&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>():</span></span><br><span class="line">    args = sys.argv</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(args) == <span class="number">1</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Hello, world!&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">len</span>(args) == <span class="number">2</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Hello, %s!&#x27;</span> % args[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Too many arguments!&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    test()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="标准模块文件模板"><a href="#标准模块文件模板" class="headerlink" title="标准模块文件模板"></a>标准模块文件模板</h3><ul><li><code>#!/usr/bin/env python3</code> 是向Unix / Linux / Mac 系统声明本文件是Python3文件</li><li><code># -*- coding: utf-8 -*-</code> 表示本文件使用标准utf-8编码，虽然Python3之后默认支持中文，但为保稳妥还是写上</li><li><code>&quot;Here is the module documentation&quot;</code>是模块文档注释，任何模块的第一个字符串都被视为模块的文档注释。可以通过<code>模块名.__doc__</code>获得。</li><li><code>__author__ = &#39;Boii&#39;</code>是作者。可以通过<code>模块名.__author__</code>获得。</li></ul><p>标准模块文件模板也可以不写，并不影响。</p><h3 id="导入、参数列表、name"><a href="#导入、参数列表、name" class="headerlink" title="导入、参数列表、name"></a>导入、参数列表、<strong>name</strong></h3><ul><li><code>import sys</code>引入了内置模块<code>sys</code></li><li><code>args = sys.argv</code>，这里<code>sys.argv</code>是参数列表，是一个 list，保存的是<code>通过命令执行本文件的时候所带的参数</code>。但该 list的第一个元素永远是文件名。<ul><li>例如上面的文件名为<code>Hello.py</code>，则运行命令<code>python Hello.py</code>后sys,argv为<code>[&#39;Hello.py&#39;]</code>.</li><li>如果执行的命令为<code>python Hello.py Boii</code>，则sys.argv为<code>[&#39;Hello.py&#39;, &#39;Boii&#39;]</code></li></ul></li><li><code>if __name__ == &#39;__main__&#39;: test()</code>如果这个文件是独立运行的，则 if 为 True，如果这个文件是被导入的，则 if 为 False。</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> python Hello.py</span></span><br><span class="line">Hello, world!</span><br><span class="line"><span class="meta">$</span><span class="bash"> python Hello.py Boii</span></span><br><span class="line">Hello, Boii!</span><br></pre></td></tr></table></figure><p>↑ 通过命令独立运行这个文件，所以 if 为 True，执行了 test() 函数</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> python</span></span><br><span class="line">Python 3.8.3</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; import Hello</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Hello.test()</span></span><br><span class="line">Hello, world!</span><br></pre></td></tr></table></figure><p>↑ 通过导入的方式运行这个文件，所以 if 为 False，没有执行 test() 函数，等到 Hello.test() 主动调用时才执行了 test() 函数</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>一个 .py 文件就是一个模块 module<br>一个带有 <code>__init__.py</code> 的文件夹就是一个包 package</p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
          <category> OPP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python【No-9】测试</title>
      <link href="posts/54509"/>
      <url>posts/54509</url>
      
        <content type="html"><![CDATA[<p>程序的必经之路：测试</p><span id="more"></span><p>测试分为 <code>单元测试</code>、<code>组件测试</code>、<code>系统测试</code>、<code>性能测试</code>，逐级上升。<br>所谓的<code>测试驱动开发(TDD：Test-Driven Development)</code>，就是说每写完一个小功能，就要做一个完整的单元测试，每次进行改动以后都要进行一次单元测试，以确保功能正常。</p><p>每个单元测试都通过以后就可以进行组件测试，所有组件测试都通过就可以进行系统测试，系统测试通过就可以进行性能测试，性能测试类似于“烤机”，测试系统的最大承受能力，承受峰值等等。</p><h2 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h2><p>单元测试就是对一个模块、一个函数或者一个类进行正确性检验的检测工作<br>举个栗子：</p><p>对一个求绝对值函数 <code>abs(num)</code>，可以编写一下几个测试用例：</p><ol><li>输入正数 如 <code>1</code>、<code>4.1</code>、<code>5.9</code>，期待返回正整数 <code>1</code>、<code>4.1</code>、<code>5.9</code></li><li>输入负数 如 <code>-1.5</code>、<code>-3.7</code>、<code>20</code>，期待返回正整数 <code>1.5</code>、<code>3.7</code>、<code>20</code></li><li>输入 <code>0</code>，期待返回 <code>0</code></li><li>输入非数值类型 如 <code>None</code>、<code>[]</code>、<code>&#123;&#125;</code>，期待抛出<code>TypeError</code>。</li></ol><p>将上面4个测试用例放到一个测试模块里，就是一个完整单元测试。<br>单元测试能通过了，说明这个函数功能正常，如果不通过，要么函数有问题，要么测试用例有问题。<br>所以要修复直到单元测试能够通过。</p><p>这样做的好处是，如果我们对<code>abs()</code>做了修改，只要再进行一次单元测试，可以通过，就说明修改没有影响函数的功能。如果不通过则要找出问题，修改到通过单元测试为止。极大程度上确保该模块行为仍然是正确的。</p><h2 id="文档测试"><a href="#文档测试" class="headerlink" title="文档测试"></a>文档测试</h2><p>一个函数、模块、类的第一个匿名字符串，就是文档。如</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span>():</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    这里是文档</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">cls</span>:</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    这里是文档</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p>文档的内容可以作为测试集来进行测试。<br>第一步：编写文档。文档中 <code>&gt;&gt;&gt;</code>的行会被执行，这与在交互模式下执行语句的相同的。<br>第二步：<code>if __name__ == &#39;__main__&#39;: import doctest; doctest.testmod()</code><br>第三步：运行文件</p><p>例如上面的绝对值函数<code>abs()</code>可以这样写</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">abs</span>(<span class="params">num</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    The function will return the absolute value of num.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; abs(11)</span></span><br><span class="line"><span class="string">    11</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; abs(-41)</span></span><br><span class="line"><span class="string">    41</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; abs(0)</span></span><br><span class="line"><span class="string">    0</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; abs(&#x27;a&#x27;)</span></span><br><span class="line"><span class="string">    Traceback (most recent call last):</span></span><br><span class="line"><span class="string">        ...</span></span><br><span class="line"><span class="string">    TypeError: &#x27;&gt;=&#x27; not supported between instances of &#x27;str&#x27; and &#x27;int&#x27;</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> n <span class="keyword">if</span> n &gt;= <span class="number">0</span> <span class="keyword">else</span> (-n)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">import</span> doctest</span><br><span class="line">    doctest.testmod()</span><br></pre></td></tr></table></figure><p>文档中以 <code>&gt;&gt;&gt;</code> 表示测试用例，并在下行写出结果。如果测试结果正确，则什么也不会输出。</p><h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>doctest非常有用，不但可以用来测试，还可以直接作为示例代码。通过某些文档生成工具，就可以自动把包含doctest的注释提取出来。用户看文档的时候，同时也看到了doctest。</p><h2 id="Unittest"><a href="#Unittest" class="headerlink" title="Unittest"></a>Unittest</h2><ol><li>环境搭建：Python已内置Unittest框架，直接<code>import unittest</code></li><li>四大组件：<ol><li>test fixture：<code>setUp</code>（前置条件）、<code>tearDown</code>（后置条件），用于初始化测试用例及清理和释放资源</li><li>test case：测试用例，通过继承<code>unittest.TestCase</code>实现用例的继承。在Unittest中，测试用例都是通过test前缀或后缀来识别的。<br> <code>def test_xxx(self)</code>、<code>def xxx_test(self)</code></li><li>test suite：测试套件，即测试用例的集合。</li><li>test runner：运行器，一般通过<code>runner</code>来调用<code>suite</code>去执行测试。</li></ol></li><li>运行机制：通过在main函数中，调用<code>unittest.main()</code>运行所有内容</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">forTest</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="comment"># 初始化</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;setUp&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 释放</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;tearDown&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 测试用例1</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_a</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 测试用例2</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_b</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;b&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>；</span><br><span class="line">    unittest.main()</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">setUp</span><br><span class="line">a</span><br><span class="line">tearDown</span><br><span class="line">setUp</span><br><span class="line">b</span><br><span class="line">tearDown</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
          <category> 进阶 </category>
          
          <category> 错误与调试 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python【No-8】调试</title>
      <link href="posts/24435"/>
      <url>posts/24435</url>
      
        <content type="html"><![CDATA[<p>开发的必经之路：调试</p><span id="more"></span><p>大型项目中，一般都是使用日志来调试程序。不过有时候有一小块代码想做调试的时候，可以用<code>print</code>和<code>assert</code>。</p><h2 id="print-amp-assert"><a href="#print-amp-assert" class="headerlink" title="print &amp; assert"></a>print &amp; assert</h2><p><code>print()</code> 就是常见的打印函数。</p><p>凡是用<code>print()</code>的地方都可以用 <code>断言assert语句</code>代替</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用print</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>(<span class="params">s</span>):</span></span><br><span class="line">    n = <span class="built_in">int</span>(s)</span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;n is zero!&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">10</span> / n</span><br><span class="line"></span><br><span class="line">foo(<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line"> ...</span><br><span class="line">ZeroDivisionError: division by zero</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用assert</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>(<span class="params">s</span>):</span></span><br><span class="line">    n = <span class="built_in">int</span>(s)</span><br><span class="line">    <span class="keyword">assert</span> n == <span class="number">0</span> , <span class="string">&quot;n is zero!&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">10</span> / n</span><br><span class="line"></span><br><span class="line">foo(<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line"> ...</span><br><span class="line">AssertionError: n <span class="keyword">is</span> zero!</span><br></pre></td></tr></table></figure><p>当assert后面的表达式为 False 时，则抛出 <code>AssertionError</code>错误</p><p><code>assert expression</code>等价于</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> expression:</span><br><span class="line">    <span class="keyword">raise</span> AssertionError</span><br></pre></td></tr></table></figure><p><code>assert expression [,arguments]</code>等价于</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> expression:</span><br><span class="line">    rasise AssertionError(arguments)</span><br></pre></td></tr></table></figure><p>例如：断言当前系统为 linux</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">assert</span> (linux <span class="keyword">in</span> sys.platform), <span class="string">&quot;该代码只能在 linux 系统下执行&quot;</span></span><br></pre></td></tr></table></figure><h2 id="日志模块-logging"><a href="#日志模块-logging" class="headerlink" title="日志模块 logging"></a>日志模块 logging</h2><p>Python 标准库中有一个日志模块 <code>logging</code>，相当于 java 中的 <code>log4j</code></p><p>在<strong>软件开发阶段</strong>或<strong>部署开发环境</strong>时，<br>为了尽可能详细的查看应用程序的运行状态来保证上线后的稳定性，<br>我们可能需要把该应用程序所有的运行日志全部记录下来进行分析，这是非常耗费机器性能的。</p><p>当<strong>应用程序正式发布</strong>或<strong>在生产环境部署应用程序</strong>时，<br>我们通常只需要记录应用程序的<code>异常信息</code>、<code>错误信息</code>等，<br>这样既可以减小服务器的I/O压力，也可以避免我们在排查故障时被淹没在日志的海洋里。</p><h3 id="logging-日志等级"><a href="#logging-日志等级" class="headerlink" title="logging 日志等级"></a>logging 日志等级</h3><p>把日志分为6个等级</p><table><thead><tr><th align="center">Level</th><th align="center">value</th><th align="left">Description</th></tr></thead><tbody><tr><td align="center">NOTEST</td><td align="center">0</td><td align="left"></td></tr><tr><td align="center">DEBUG</td><td align="center">10</td><td align="left">最详细的日志信息，典型应用场景是 问题诊断</td></tr><tr><td align="center">INFO</td><td align="center">20</td><td align="left">通常只记录关键节点信息，用于确认一切都是按照我们预期的那样进行工作</td></tr><tr><td align="center">WARNING</td><td align="center">30</td><td align="left">当某些不期望的事情发生时记录的信息，但是此时应用程序还是正常运行的</td></tr><tr><td align="center">ERROR</td><td align="center">40</td><td align="left">由于一个更严重的问题导致某些功能不能正常运行时记录的信息</td></tr><tr><td align="center">CRITICAL</td><td align="center">50</td><td align="left">当发生严重错误，导致应用程序不能继续运行时记录的信息</td></tr></tbody></table><p>日志等级是从下到上依次升高的（值越大等级越高）<br>即：NOTEST &lt; DEBUG &lt; INFO &lt; WARNING &lt; ERROR &lt; CRITICAL，<br>而日志的信息量是依次减少的；</p><p>开发应用程序或部署开发环境时，可以使用<code>DEBUG</code>或<code>INFO</code>级别的日志获取尽可能详细的日志信息来进行开发或部署调试；<br>应用上线或部署生产环境时，应该使用<code>WARNING</code>或<code>ERROR</code>或<code>CRITICAL</code>级别的日志来降低机器的I/O压力和提高获取错误日志信息的效率。</p><p>日志级别的指定通常都是在<code>应用程序的配置文件</code>中进行指定的。</p><h3 id="logging-配置"><a href="#logging-配置" class="headerlink" title="logging 配置"></a>logging 配置</h3><blockquote><p><code>loggong.basicConfig(**kwargs)</code></p></blockquote><p>**kwargs 可以接收关键字参数如下：</p><table><thead><tr><th align="left">参数名称</th><th align="left">描述</th><th align="left">取值范围</th></tr></thead><tbody><tr><td align="left">filename</td><td align="left">指定日志输出目标文件的文件名，指定该设置项后日志信息就不会被输出到控制台了</td><td align="left">string</td></tr><tr><td align="left">filemode</td><td align="left">指定日志文件的打开模式，默认为’a’。该选项要在filename指定时才有效</td><td align="left">a、w</td></tr><tr><td align="left">format</td><td align="left">指定日志格式字符串，即指定日志输出时所包含的字段信息以及它们的顺序</td><td align="left">详见下表</td></tr><tr><td align="left">datefmt</td><td align="left">指定日期/时间格式，该选项要在format中包含时间字段%(asctime)s时才有效</td><td align="left"><a href="https://docs.python.org/3/library/time.html#time.strftime">datefmt</a></td></tr><tr><td align="left">level</td><td align="left">指定日志器的日志级别</td><td align="left">logging.DEBUG、logging.INFO…</td></tr><tr><td align="left">stream</td><td align="left">指定日志输出目标stream。</td><td align="left">sys.stdout、sys.stderr以及网络stream</td></tr><tr><td align="left">style</td><td align="left">指定format格式字符串的风格，可取值为，默认为’%’</td><td align="left">%、{、$</td></tr><tr><td align="left">handlers</td><td align="left">该选项如果被指定，它应该是一个创建了多个Handler的可迭代对象，这些handler将会被添加到root logger。</td><td align="left">一个创建了多个Handler的可迭代对象</td></tr></tbody></table><p><code>filename</code>、<code>stream</code>和<code>handlers</code>这三个配置项只能有一个存在，不能同时出现2个或3个，否则会引发ValueError异常。</p><p>format 参数的取值表</p><table><thead><tr><th align="left">名称</th><th align="left">使用格式</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">asctime</td><td align="left">%(asctime)s</td><td align="left">日志事件发生的时间–<strong>人类可读时间</strong>，如：2003-07-08 16:49:45,896</td></tr><tr><td align="left">created</td><td align="left">%(created)f</td><td align="left">日志事件发生的时间–<strong>时间戳</strong>，就是当时调用time.time()函数返回的值</td></tr><tr><td align="left">relativeCreated</td><td align="left">%(relativeCreated)d</td><td align="left">日志事件发生的时间相对于logging模块加载时间的<strong>相对毫秒数</strong>（目前还不知道干嘛用的）</td></tr><tr><td align="left">msecs</td><td align="left">%(msecs)d</td><td align="left">日志事件发生的时间的<strong>毫秒部分</strong></td></tr><tr><td align="left">—————</td><td align="left">——————-</td><td align="left">—————————————————————————-</td></tr><tr><td align="left">levelname</td><td align="left">%(levelname)s</td><td align="left">该日志记录的文字形式的<strong>日志级别</strong>（’DEBUG’, ‘INFO’, ‘WARNING’, ‘ERROR’, ‘CRITICAL’）</td></tr><tr><td align="left">levelno</td><td align="left">%(levelno)s</td><td align="left">该日志记录的数字形式的<strong>日志级别</strong>（10,20,30,40,50）</td></tr><tr><td align="left">lineno</td><td align="left">%(lineno)d</td><td align="left">调用日志记录函数的<strong>源代码所在的行号</strong></td></tr><tr><td align="left">funcName</td><td align="left">%(funcName)s</td><td align="left">调用日志记录函数的<strong>函数名</strong></td></tr><tr><td align="left">name</td><td align="left">%(name)s</td><td align="left">所使用的<strong>日志器名称</strong>，默认是’root’，</td></tr><tr><td align="left">message</td><td align="left">%(message)s</td><td align="left">日志记录的<strong>文本内容</strong>，通过 msg % args计算得到的</td></tr><tr><td align="left">—————</td><td align="left">——————-</td><td align="left">—————————————————————————-</td></tr><tr><td align="left">pathname</td><td align="left">%(pathname)s</td><td align="left">调用日志记录函数的源码文件的<strong>全路径</strong></td></tr><tr><td align="left">filename</td><td align="left">%(filename)s</td><td align="left">pathname的文件名部分，包含文件后缀</td></tr><tr><td align="left">module</td><td align="left">%(module)s</td><td align="left">filename的名称部分，不包含后缀</td></tr><tr><td align="left">—————</td><td align="left">——————-</td><td align="left">—————————————————————————-</td></tr><tr><td align="left">process</td><td align="left">%(process)d</td><td align="left">进程ID</td></tr><tr><td align="left">processName</td><td align="left">%(processName)s</td><td align="left">进程名称，Python 3.1新增</td></tr><tr><td align="left">thread</td><td align="left">%(thread)d</td><td align="left">线程ID</td></tr><tr><td align="left">threadname</td><td align="left">%(thread)s</td><td align="left">线程名称</td></tr></tbody></table><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">LOG_FORMAT = <span class="string">&quot;%(asctime)s - %(levelname)s - %(message)s&quot;</span>    <span class="comment"># 日志打印格式</span></span><br><span class="line">DATE_FORMAT = <span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>    <span class="comment"># 时间打印格式</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置日志</span></span><br><span class="line">logging.basicConfig(filename=<span class="string">&#x27;my.log&#x27;</span>, level=logging.DEBUG, <span class="built_in">format</span>=LOG_FORMAT, datefmt=DATE_FORMAT)</span><br><span class="line"></span><br><span class="line">logging.debug(<span class="string">&quot;This is a debug log.&quot;</span>)</span><br><span class="line">logging.info(<span class="string">&quot;This is a info log.&quot;</span>)</span><br><span class="line">logging.warning(<span class="string">&quot;This is a warning log.&quot;</span>)</span><br><span class="line">logging.error(<span class="string">&quot;This is a error log.&quot;</span>)</span><br><span class="line">logging.critical(<span class="string">&quot;This is a critical log.&quot;</span>)</span><br></pre></td></tr></table></figure><p>以上代码 配置了日志文件，级别设置为 DEBUG，输出格式为 <code>日志发生时间 - 日志等级 - 日志信息</code></p><p>执行后结果如下：</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/8-1.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/8-1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="1"></p><p>执行第二次后结果如下：</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/8-2.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/8-2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2"></p><p>如果要让日志格式好看点，还可以指定宽度。<br>比如执行 日志等级 的打印宽度为 8，在 s 前面加上宽度即可：<code>%(levelname)8s</code><br>如果要左对齐，则写上减号 -：<code>%(levelname)-8s</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入模块</span></span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">LOG_FORMAT = <span class="string">&quot;%(asctime)s - %(levelname)-8s - %(message)s&quot;</span>    <span class="comment"># 日志打印格式</span></span><br><span class="line">DATE_FORMAT = <span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>    <span class="comment"># 时间打印格式</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置日志</span></span><br><span class="line">logging.basicConfig(filename=<span class="string">&#x27;my.log&#x27;</span>, level=logging.DEBUG, <span class="built_in">format</span>=LOG_FORMAT, datefmt=DATE_FORMAT)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打日志</span></span><br><span class="line">logging.debug(<span class="string">&quot;This is a debug log.&quot;</span>)</span><br><span class="line">logging.info(<span class="string">&quot;This is a info log.&quot;</span>)</span><br><span class="line">logging.warning(<span class="string">&quot;This is a warning log.&quot;</span>)</span><br><span class="line">logging.error(<span class="string">&quot;This is a error log.&quot;</span>)</span><br><span class="line">logging.critical(<span class="string">&quot;This is a critical log.&quot;</span>)</span><br></pre></td></tr></table></figure><p>左对齐：%(levelname)-8s</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/8-3.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/8-3.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="3"></p><p>右对齐：%(levelname)8s</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/8-4.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/8-4.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="4"></p><h3 id="logging-模块使用"><a href="#logging-模块使用" class="headerlink" title="logging 模块使用"></a>logging 模块使用</h3><blockquote><p>用法：</p><ol><li>导入 logging</li><li>配置(可选)</li><li>打日志</li></ol></blockquote><p>logging 模块提供了两种记录日志的方式：</p><ul><li>使用 logging 提供的<code>模块级别</code>的函数</li><li>使用 logging 日志系统的<code>四大组件</code></li></ul><p>logging所提供的<code>模块级别</code>的日志记录函数也是对logging<code>日志系统相关类</code>的封装而已。</p><h4 id="函数用法"><a href="#函数用法" class="headerlink" title="函数用法"></a>函数用法</h4><p>常用模块级别函数</p><table><thead><tr><th align="left">Function</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left">logging.debug(msg, *args, **kwargs)</td><td align="left">创建一条严重级别为 DEBUG 的日志记录</td></tr><tr><td align="left">logging.info(msg, *args, **kwargs)</td><td align="left">创建一条严重级别为 INFO 的日志记录</td></tr><tr><td align="left">logging.warning(msg, *args, **kwargs)</td><td align="left">创建一条严重级别为 WARNNING 的日志记录</td></tr><tr><td align="left">logging.error(msg, *args, **kwargs)</td><td align="left">创建一条严重级别为 ERROR 的日志记录</td></tr><tr><td align="left">logging.critical(msg, *args, **kwargs)</td><td align="left">创建一条严重级别为 CRITICAL 的日志记录</td></tr><tr><td align="left">logging.log(msg, *args, **kwargs)</td><td align="left">创建一条严重级别为 LOG 的日志记录</td></tr><tr><td align="left">logging.basicConfig(**kwargs)</td><td align="left">对root logger进行一次性配置</td></tr></tbody></table><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging    <span class="comment"># 导入模块</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打日志</span></span><br><span class="line">logging.debug(<span class="string">&quot;This is a debug log.&quot;</span>)</span><br><span class="line">logging.info(<span class="string">&quot;This is a info log.&quot;</span>)</span><br><span class="line">logging.warning(<span class="string">&quot;This is a warning log.&quot;</span>)</span><br><span class="line">logging.error(<span class="string">&quot;This is a error log.&quot;</span>)</span><br><span class="line">logging.critical(<span class="string">&quot;This is a critical log.&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">或</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> logging    <span class="comment">#导入模块</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打日志</span></span><br><span class="line">logging.log(logging.DEBUG, <span class="string">&quot;This is a debug log.&quot;</span>)</span><br><span class="line">logging.log(logging.INFO, <span class="string">&quot;This is a info log.&quot;</span>)</span><br><span class="line">logging.log(logging.WARNING, <span class="string">&quot;This is a warning log.&quot;</span>)</span><br><span class="line">logging.log(logging.ERROR, <span class="string">&quot;This is a error log.&quot;</span>)</span><br><span class="line">logging.log(logging.CRITICAL, <span class="string">&quot;This is a critical log.&quot;</span>)</span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">WARNING:root:This <span class="keyword">is</span> a warning log.</span><br><span class="line">ERROR:root:This <span class="keyword">is</span> a error log.</span><br><span class="line">CRITICAL:root:This <span class="keyword">is</span> a critical log.</span><br></pre></td></tr></table></figure><p>这里只输出 warning 级别以上的信息。这是因为默认的日志等级是 warning ，所以 debug 和 info 级别的信息就被忽略了。<br>logging 只输出 大于等于 所设置级别以上的日志信息。<br>这点可以在 <code>logging.basicConfig()</code>中设置</p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
          <category> 进阶 </category>
          
          <category> 错误与调试 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python【No-7】错误处理</title>
      <link href="posts/63024"/>
      <url>posts/63024</url>
      
        <content type="html"><![CDATA[<p>语言必修课：错误处理</p><span id="more"></span><h2 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h2><blockquote><p><code>try...except1...[exceptN...[finally...]</code></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    可能会出现异常的代码</span><br><span class="line"><span class="keyword">except</span> 异常类型 [<span class="keyword">as</span> 别名]：</span><br><span class="line">    出现异常后的处理</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    不管是否出现异常最后都会执行的代码</span><br></pre></td></tr></table></figure><p>示例：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 出现 除零的异常 示例</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Try---------&quot;</span>)</span><br><span class="line">    r = <span class="number">10</span>/<span class="number">0</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;result: &quot;</span>, r)</span><br><span class="line"><span class="keyword">except</span> ZeroDivisionError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Except------&quot;</span>, e)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Finally-----&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;END&quot;</span>)</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">Try---------</span><br><span class="line">Except------ division by zero</span><br><span class="line">Finally-----</span><br><span class="line">END</span><br></pre></td></tr></table></figure><p>try 语句块中的代码遇到异常后会跳转到 except 语句块执行<br>而 finally 语句块不管有没有异常最后都会执行。当然，也可以没有 finally 语句</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 没有异常的示例</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Try---------&quot;</span>)</span><br><span class="line">    r = <span class="number">10</span>/<span class="number">2</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;result: &quot;</span>, r)</span><br><span class="line"><span class="keyword">except</span> ZeroDivisionError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Except------&quot;</span>, e)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Finally-----&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;END&quot;</span>)</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">Try---------</span><br><span class="line">result: <span class="number">5</span></span><br><span class="line">Finally-----</span><br><span class="line">END</span><br></pre></td></tr></table></figure><h3 id="捕获多个异常"><a href="#捕获多个异常" class="headerlink" title="捕获多个异常"></a>捕获多个异常</h3><p>捕获异常不止可以捕获一个，还可以<code>捕获多个</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Try---------&quot;</span>)</span><br><span class="line">    r = <span class="number">10</span> / <span class="built_in">int</span>(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;result: &quot;</span>, r)</span><br><span class="line"><span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;ValueError: &#x27;</span>, e)</span><br><span class="line"><span class="keyword">except</span> ZeroDivisionError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ZeroDivisionError: &quot;</span>, e)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Finally-----&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;END&quot;</span>)</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line"></span><br><span class="line">Try---------</span><br><span class="line">ValueError:  invalid literal <span class="keyword">for</span> <span class="built_in">int</span>() <span class="keyword">with</span> base <span class="number">10</span>: <span class="string">&#x27;a&#x27;</span></span><br><span class="line">Finally-----</span><br><span class="line">END</span><br></pre></td></tr></table></figure><h3 id="else-语句"><a href="#else-语句" class="headerlink" title="else 语句"></a>else 语句</h3><p>在 except 后面还可以加一个 <code>else 语句块</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># else 语句在没有异常的情况下 示例</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Try---------&quot;</span>)</span><br><span class="line">    r = <span class="number">10</span> / <span class="built_in">int</span>(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;result: &quot;</span>, r)</span><br><span class="line"><span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;ValueError: &#x27;</span>, e)</span><br><span class="line"><span class="keyword">except</span> ZeroDivisionError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ZeroDivisionError: &quot;</span>, e)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Else--------No Error!&quot;</span>)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Finally-----&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;END&quot;</span>)</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line"></span><br><span class="line">Try---------</span><br><span class="line">result: <span class="number">5.0</span></span><br><span class="line">Else--------No Error!</span><br><span class="line">Finally-----</span><br><span class="line">END</span><br></pre></td></tr></table></figure><p>else 语句不同于finally 语句。finally 语句是有无异常都会执行，else 语句会在没有异常的情况下执行</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># else 语句在有异常的情况下 示例</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Try---------&quot;</span>)</span><br><span class="line">    r = <span class="number">10</span> / <span class="built_in">int</span>(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;result: &quot;</span>, r)</span><br><span class="line"><span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;ValueError: &#x27;</span>, e)</span><br><span class="line"><span class="keyword">except</span> ZeroDivisionError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ZeroDivisionError: &quot;</span>, e)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Else--------No Error!&quot;</span>)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Finally-----&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;END&quot;</span>)</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line">Try---------</span><br><span class="line">ValueError:  invalid literal <span class="keyword">for</span> <span class="built_in">int</span>() <span class="keyword">with</span> base <span class="number">10</span>: <span class="string">&#x27;a&#x27;</span></span><br><span class="line">Finally-----</span><br><span class="line">END</span><br></pre></td></tr></table></figure><h3 id="优点：跨越多层调用"><a href="#优点：跨越多层调用" class="headerlink" title="优点：跨越多层调用"></a>优点：跨越多层调用</h3><p>例如现在 <code>A()</code> 调用 <code>B()</code>，<code>B()</code> 调用 <code>C()</code>，在 <code>C()</code> 出错了，只要 <code>A()</code> 捕获到了，就可以处理。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">C</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">10</span> / <span class="built_in">int</span>(s)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">B</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">return</span> C(s) * <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">A</span>():</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        B(<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Error:&quot;</span>, e)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Finally------&quot;</span>)</span><br><span class="line"></span><br><span class="line">A()</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line"></span><br><span class="line">Error: division by zero</span><br><span class="line">Finally------</span><br></pre></td></tr></table></figure><p>虽然错误是在 <code>C()</code> 出现，但是在 <code>A()</code> 也能捕获。<br>如果错误没有被捕获，它就会一直往上抛，最后被Python解释器捕获，打印一个错误信息，然后程序退出。</p><h3 id="错误是个class"><a href="#错误是个class" class="headerlink" title="错误是个class"></a>错误是个class</h3><p>所有的错误类型都继承自 <code>BaseException</code>，如果捕获到了一个父类错误，其子类错误不会被捕获。<br>例如：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    foo()</span><br><span class="line"><span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;ValueError&#x27;</span>)</span><br><span class="line"><span class="keyword">except</span> UnicodeError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;UnicodeError&#x27;</span>)</span><br></pre></td></tr></table></figure><p>第二个except永远捕获不到 <code>UnicodeError</code>，因为<code>UnicodeError</code>是<code>ValueError</code>的子类。<br>即使有<code>UnicodeError</code>，也被第一个except捕获了。</p><h4 id="错误类继承关系"><a href="#错误类继承关系" class="headerlink" title="错误类继承关系"></a>错误类继承关系</h4><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">BaseException</span><br><span class="line"> +<span class="comment">-- SystemExit</span></span><br><span class="line"> +<span class="comment">-- KeyboardInterrupt</span></span><br><span class="line"> +<span class="comment">-- GeneratorExit</span></span><br><span class="line"> +<span class="comment">-- Exception</span></span><br><span class="line">      +<span class="comment">-- StopIteration</span></span><br><span class="line">      +<span class="comment">-- StopAsyncIteration </span></span><br><span class="line">      +<span class="comment">-- AttributeError     属性错误</span></span><br><span class="line">      +<span class="comment">-- AssertionError     断言错误</span></span><br><span class="line">      +<span class="comment">-- BufferError        缓冲错误</span></span><br><span class="line">      +<span class="comment">-- EOFError           文件结束符错误</span></span><br><span class="line">      +<span class="comment">-- MemoryError        内存错误</span></span><br><span class="line">      +<span class="comment">-- ReferenceError</span></span><br><span class="line">      +<span class="comment">-- SystemError        系统错误</span></span><br><span class="line">      +<span class="comment">-- TypeError          类型错误</span></span><br><span class="line">      +<span class="comment">-- ArithmeticError    算术错误</span></span><br><span class="line">      |    +<span class="comment">-- FloatingPointError</span></span><br><span class="line">      |    +<span class="comment">-- OverflowError</span></span><br><span class="line">      |    +<span class="comment">-- ZeroDivisionError</span></span><br><span class="line">      +<span class="comment">-- ImportError        导入错误</span></span><br><span class="line">      |    +<span class="comment">-- ModuleNotFoundError</span></span><br><span class="line">      +<span class="comment">-- LookupError</span></span><br><span class="line">      |    +<span class="comment">-- IndexError</span></span><br><span class="line">      |    +<span class="comment">-- KeyError</span></span><br><span class="line">      +<span class="comment">-- NameError          命名错误</span></span><br><span class="line">      |    +<span class="comment">-- UnboundLocalError</span></span><br><span class="line">      +<span class="comment">-- OSError            操作系统错误</span></span><br><span class="line">      |    +<span class="comment">-- BlockingIOError      IO阻塞错误</span></span><br><span class="line">      |    +<span class="comment">-- ChildProcessError    子进程错误</span></span><br><span class="line">      |    +<span class="comment">-- ConnectionError</span></span><br><span class="line">      |    |    +<span class="comment">-- BrokenPipeError</span></span><br><span class="line">      |    |    +<span class="comment">-- ConnectionAbortedError</span></span><br><span class="line">      |    |    +<span class="comment">-- ConnectionRefusedError</span></span><br><span class="line">      |    |    +<span class="comment">-- ConnectionResetError</span></span><br><span class="line">      |    +<span class="comment">-- FileExistsError</span></span><br><span class="line">      |    +<span class="comment">-- FileNotFoundError</span></span><br><span class="line">      |    +<span class="comment">-- InterruptedError</span></span><br><span class="line">      |    +<span class="comment">-- IsADirectoryError</span></span><br><span class="line">      |    +<span class="comment">-- NotADirectoryError</span></span><br><span class="line">      |    +<span class="comment">-- PermissionError</span></span><br><span class="line">      |    +<span class="comment">-- ProcessLookupError</span></span><br><span class="line">      |    +<span class="comment">-- TimeoutError</span></span><br><span class="line">      +<span class="comment">-- RuntimeError       运行时错误</span></span><br><span class="line">      |    +<span class="comment">-- NotImplementedError</span></span><br><span class="line">      |    +<span class="comment">-- RecursionError</span></span><br><span class="line">      +<span class="comment">-- SyntaxError        同步错误</span></span><br><span class="line">      |    +<span class="comment">-- IndentationError</span></span><br><span class="line">      |         +<span class="comment">-- TabError</span></span><br><span class="line">      +<span class="comment">-- ValueError         值错误</span></span><br><span class="line">      |    +<span class="comment">-- UnicodeError</span></span><br><span class="line">      |         +<span class="comment">-- UnicodeDecodeError</span></span><br><span class="line">      |         +<span class="comment">-- UnicodeEncodeError</span></span><br><span class="line">      |         +<span class="comment">-- UnicodeTranslateError</span></span><br><span class="line">      +<span class="comment">-- Warning            警告</span></span><br><span class="line">           +<span class="comment">-- DeprecationWarning</span></span><br><span class="line">           +<span class="comment">-- PendingDeprecationWarning</span></span><br><span class="line">           +<span class="comment">-- RuntimeWarning</span></span><br><span class="line">           +<span class="comment">-- SyntaxWarning</span></span><br><span class="line">           +<span class="comment">-- UserWarning</span></span><br><span class="line">           +<span class="comment">-- FutureWarning</span></span><br><span class="line">           +<span class="comment">-- ImportWarning</span></span><br><span class="line">           +<span class="comment">-- UnicodeWarning</span></span><br><span class="line">           +<span class="comment">-- BytesWarning</span></span><br><span class="line">           +<span class="comment">-- ResourceWarning</span></span><br></pre></td></tr></table></figure><h3 id="抛出错误"><a href="#抛出错误" class="headerlink" title="抛出错误"></a>抛出错误</h3><p>错误是 class， 捕获错误实质上就是捕获到该 class 的一个实例。因此，错误是可以有意创建并抛出的。</p><p><code>try...except...</code>是承接错误，而<code>raise</code>是抛出错误</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span>():</span></span><br><span class="line">    username = <span class="built_in">input</span>(<span class="string">&quot;请输入用户名：&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(username) &lt; <span class="number">6</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&quot;用户名长度必须6位以上&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;输入的用户名是:&quot;</span>, username)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">register()</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output1:</span></span><br><span class="line">请输入用户名：admin</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;d:/---Programming---/Python/Project/mo2.py&quot;</span>, line <span class="number">9</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    register()</span><br><span class="line">  File <span class="string">&quot;d:/---Programming---/Python/Project/mo2.py&quot;</span>, line <span class="number">4</span>, <span class="keyword">in</span> register</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">&quot;用户名长度必须6位以上&quot;</span>)</span><br><span class="line">Exception: 用户名长度必须<span class="number">6</span>位以上</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output2:</span></span><br><span class="line">请输入用户名：administor</span><br><span class="line">输入的用户名是: administor</span><br></pre></td></tr></table></figure><p>在 if 中主动<code>raise</code>抛出错误，但是调用<code>register()</code>的地方没有<code>try...except</code>来捕获错误，所以最后由解释器处理，打印出了错误信息</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span>():</span></span><br><span class="line">    username = <span class="built_in">input</span>(<span class="string">&quot;请输入用户名：&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(username) &lt; <span class="number">6</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&quot;用户名长度必须6位以上&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;输入的用户名是：&quot;</span>, username)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    register()</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(e)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;注册失败&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;注册成功&quot;</span>)</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output1:</span></span><br><span class="line">请输入用户名：admin</span><br><span class="line">用户名长度必须<span class="number">6</span>位以上</span><br><span class="line">注册失败</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output2:</span></span><br><span class="line">请输入用户名：administor</span><br><span class="line">输入的用户名是: administor</span><br><span class="line">注册成功</span><br></pre></td></tr></table></figure><p>在 if 处 <code>raise</code>抛出错误，在<code>register()</code>使用了<code>try...except</code>捕获错误，然后进行了处理。</p><h3 id="自定义错误"><a href="#自定义错误" class="headerlink" title="自定义错误"></a>自定义错误</h3><p>主动抛出错误，这个错误可以是自己定义的 class，因为错误也是 class。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NameUndercutting</span>(<span class="params">Exception</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span>():</span></span><br><span class="line">    username = <span class="built_in">input</span>(<span class="string">&quot;请输入用户名：&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(username) &lt; <span class="number">6</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&quot;用户名长度必须6位以上&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;输入的用户名是：&quot;</span>, username)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    register()</span><br><span class="line"><span class="keyword">except</span> NameUndercutting <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(e)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;注册失败&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;注册成功&quot;</span>)</span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output1:</span></span><br><span class="line">请输入用户名：admin</span><br><span class="line">用户名长度必须<span class="number">6</span>位以上</span><br><span class="line">注册失败</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output2:</span></span><br><span class="line">请输入用户名：administor</span><br><span class="line">输入的用户名是: administor</span><br><span class="line">注册成功</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
          <category> 进阶 </category>
          
          <category> 错误与调试 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python【No-6】函数</title>
      <link href="posts/9049"/>
      <url>posts/9049</url>
      
        <content type="html"><![CDATA[<p>一等公民：函数</p><span id="more"></span><h2 id="定义函数"><a href="#定义函数" class="headerlink" title="定义函数"></a>定义函数</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">functionName</span>(<span class="params">paramters</span>):</span></span><br><span class="line">    function body</span><br><span class="line">    [<span class="keyword">return</span>]</span><br></pre></td></tr></table></figure><h2 id="调用函数"><a href="#调用函数" class="headerlink" title="调用函数"></a>调用函数</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">funcName([paras])</span><br></pre></td></tr></table></figure><h2 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h2><blockquote><p>不管有没有 return 函数都会返回<br>有 return 时函数返回相应的值<br>没有 return 时函数返回 None</p></blockquote><blockquote><p><code>return None</code> 可以简写为 <code>return</code></p></blockquote><h3 id="返回多个值"><a href="#返回多个值" class="headerlink" title="返回多个值"></a>返回多个值</h3><p>python 函数可以返回多个值<br>但其本质其实是返回一个多元素的Tuple，因为语法上tuple可以省略括号，所以看起来像返回多个值<br>如果显式的返回一个list，dict，tuple，set，则是返回值本身</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">move</span>(<span class="params">x, y, step, angle=<span class="number">0</span></span>):</span></span><br><span class="line">    nx = x + step * math.cos(angle)</span><br><span class="line">    ny = y - step * math.sin(angle)</span><br><span class="line">    <span class="keyword">return</span> nx, ny</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x, y = move(<span class="number">100</span>, <span class="number">100</span>, <span class="number">60</span>, math.pi / <span class="number">6</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(x, y)</span><br><span class="line"><span class="number">151.96152422706632</span> <span class="number">70.0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r = move(<span class="number">100</span>, <span class="number">100</span>, <span class="number">60</span>, math.pi / <span class="number">6</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(r)</span><br><span class="line">(<span class="number">151.96152422706632</span>, <span class="number">70.0</span>)</span><br></pre></td></tr></table></figure><h2 id="空函数"><a href="#空函数" class="headerlink" title="空函数"></a>空函数</h2><blockquote><p>空函数可以作为占位符，比如现在还没想好怎么写函数的代码，就可以先放一个pass，让代码能运行起来。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span>():</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><h2 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h2><h3 id="参数检查"><a href="#参数检查" class="headerlink" title="参数检查"></a>参数检查</h3><blockquote><p>python解释器会检查参数 <code>个数</code> ，但不会检查参数 <code>类型</code><br>类型检查需要自己做<br>可以使用内置函数 <code>isinstance(obj,class_of_tuple)</code> 并抛出错误</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_abs</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> x <span class="keyword">if</span> x &gt;= <span class="number">0</span> <span class="keyword">else</span> -x</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加检查类型</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_abs</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(x, (<span class="built_in">int</span>, <span class="built_in">float</span>)):        <span class="comment"># 检查类型</span></span><br><span class="line">        <span class="keyword">raise</span> TypeError(<span class="string">&#x27;bad operand type&#x27;</span>)    <span class="comment"># 抛出错误</span></span><br><span class="line">    <span class="keyword">return</span> x <span class="keyword">if</span> x &gt;= <span class="number">0</span> <span class="keyword">else</span> -x</span><br></pre></td></tr></table></figure><h4 id="isinstance"><a href="#isinstance" class="headerlink" title="isinstance()"></a>isinstance()</h4><blockquote><p>isinstance(被检查对象,检查类型元组)<br>isinstance() 接受两个参数，第一个是被检查对象，第二个是要求的类型元组<br>类型元组中只要有一个被满足，则返回True，反之返回False</p></blockquote><h3 id="默认参数、可变参数和关键字参数"><a href="#默认参数、可变参数和关键字参数" class="headerlink" title="默认参数、可变参数和关键字参数"></a>默认参数、可变参数和关键字参数</h3><h4 id="默认参数"><a href="#默认参数" class="headerlink" title="默认参数 ="></a>默认参数 =</h4><blockquote><p><code>def funcName( [para1 ... ,] paraN = defaultValue)</code><br>当参数的值不确定的时候，就可以使用默认参数</p><p>默认参数 <code>para1 = defaultValue </code> 必须放在最后面<br>当有多个默认参数的情况下，想指定某个默认参数不使用默认，可以将默认参数的形参名带上<br>默认参数必须指向<strong>不变对象！</strong></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">power</span>(<span class="params">x,n=<span class="number">2</span></span>):</span></span><br><span class="line">    s = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">        s *= x</span><br><span class="line">        n -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>power(<span class="number">5</span>)</span><br><span class="line"><span class="number">25</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>power(<span class="number">5</span>, <span class="number">2</span>)</span><br><span class="line"><span class="number">25</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>power(<span class="number">5</span>, <span class="number">3</span>)</span><br><span class="line"><span class="number">125</span></span><br></pre></td></tr></table></figure><p>当有多个默认参数的情况下，想指定某个默认参数不使用默认，可以将默认参数的形参名带上</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enroll</span>(<span class="params">name, gender, age=<span class="number">6</span>, city=<span class="string">&#x27;SWA&#x27;</span></span>):</span></span><br><span class="line">    <span class="built_in">print</span>(name)</span><br><span class="line">    <span class="built_in">print</span>(gender)</span><br><span class="line">    <span class="built_in">print</span>(age)</span><br><span class="line">    <span class="built_in">print</span>(city)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>enroll(<span class="string">&#x27;Boii&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="number">23</span>, <span class="string">&#x27;BJ&#x27;</span>)</span><br><span class="line">Boii</span><br><span class="line">M</span><br><span class="line"><span class="number">23</span></span><br><span class="line">BJ</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>enroll(<span class="string">&#x27;Boii&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="number">23</span>)</span><br><span class="line">Boii</span><br><span class="line">M</span><br><span class="line"><span class="number">23</span></span><br><span class="line">SWA</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>enroll(<span class="string">&#x27;Boii&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, city=<span class="string">&#x27;NJ&#x27;</span>)</span><br><span class="line">Boii</span><br><span class="line">M</span><br><span class="line"><span class="number">6</span></span><br><span class="line">NJ</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>enroll(<span class="string">&#x27;Boii&#x27;</span>, <span class="string">&#x27;M&#x27;</span>)</span><br><span class="line">Boii</span><br><span class="line">M</span><br><span class="line"><span class="number">6</span></span><br><span class="line">SWA</span><br></pre></td></tr></table></figure><p>默认参数必须指向<strong>不变对象！</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_end</span>(<span class="params">L=[]</span>):</span></span><br><span class="line">    L.append(<span class="string">&#x27;END&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> L</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>add_end([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="string">&#x27;END&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>add_end([<span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;z&#x27;</span>])</span><br><span class="line">[<span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;z&#x27;</span>, <span class="string">&#x27;END&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 坑来了</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>add_end()</span><br><span class="line">[<span class="string">&#x27;END&#x27;</span>]            <span class="comment"># 这里还是正常的</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>add_end()</span><br><span class="line">[<span class="string">&#x27;END&#x27;</span>, <span class="string">&#x27;END&#x27;</span>]     <span class="comment"># 这里就不正常了</span></span><br></pre></td></tr></table></figure><p>猜测可能是python内部在使用默认参数的时候会创建对象，比如这个list，但是这个对象不会被销毁导致的</p><p>改进：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_end</span>(<span class="params">L=<span class="literal">None</span></span>)</span></span><br><span class="line"><span class="function">    <span class="title">if</span> <span class="title">L</span> <span class="title">is</span> <span class="title">None</span>:</span></span><br><span class="line">        L = []</span><br><span class="line">    L.append(<span class="string">&#x27;END&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> L</span><br><span class="line">    </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>add_end()</span><br><span class="line">[<span class="string">&#x27;END&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>add_end()</span><br><span class="line">[<span class="string">&#x27;END&#x27;</span>]</span><br></pre></td></tr></table></figure><h4 id="可变参数"><a href="#可变参数" class="headerlink" title="可变参数 *"></a>可变参数 *</h4><blockquote><p>可变参数可以接收 0~N个参数</p><p><code>def funcName( [para1 ... ,] *paraN)</code><br>当参数的个数不确定的时候，就可以使用可变参数 <code>*paraN</code><br>形参和实参都可以使用可变参数。<br><code>形参</code> 使用可变参数，则是告诉调用者我可以接受0~N个参数，<br><code>实参</code> 使用可变参数，则是告诉函数我已经打包好了。</p></blockquote><p>可变参数的 <code>实际原理</code>：<br>其实可变参数在函数被调用时，将所有参数自动打包成一个tuple，然后传递给函数<br>函数接收到之后再解构这个tuple，或者通过 <code>for 迭代</code> 遍历这个tuple来使用里面的元素</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calc</span>(<span class="params">*numbers</span>):</span>        <span class="comment"># 形参 使用可变参数，则是告诉调用者我可以接受0~N个参数</span></span><br><span class="line">    <span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> numbers:</span><br><span class="line">        <span class="built_in">sum</span> += n*n</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sum</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>calc(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>calc()</span><br><span class="line"><span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>nums = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>calc(nums[<span class="number">0</span>], nums[<span class="number">1</span>], nums[<span class="number">2</span>]) <span class="comment"># 这种分散一个个的参数在传递之前也是被自动打包成一个tuple的</span></span><br><span class="line"><span class="number">14</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>calc(*nums)            <span class="comment"># 实参 使用可变参数，则是告诉函数我已经打包好了</span></span><br><span class="line"><span class="number">14</span></span><br></pre></td></tr></table></figure><h4 id="关键字参数"><a href="#关键字参数" class="headerlink" title="关键字参数 **"></a>关键字参数 **</h4><blockquote><p>这种方式，调用者可以传入 0~N 个关键字参数，关键字 key 随意</p><p><code>def funcName( [para1 ... ,] **key_paraN)</code><br>即通过<code>关键字</code>来指定参数，或者说通过<code>键-值对</code>的方式来传实参<br>而在函数里，形参 关键字参数 <code>**paraN</code> 将传过来的这些键-值对打包成一个dict</p><p>其原理跟可变参数类似</p><ul><li>可变参数 <code>*paraN</code> 是把 <code>除了必选参数外的所有参数</code> 打包成一个tuple传给函数</li><li>关键字参数 <code>**paraN</code> 是把 <code>除了必选参数外的所有参数</code> 打包成一个dict传给函数</li></ul><p>之后函数内部可以通过 <code>for 迭代</code> 遍历这个dict来使用里面的键-值对<br>因为是使用键-值对的方式，所以传参时的 <code>传给关键字参数的</code>参数顺序是无所谓的</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">person</span>(<span class="params">name, age, **kv</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;name:&#x27;</span>, name, <span class="string">&#x27;--&#x27;</span> , <span class="string">&#x27;age:&#x27;</span>, age, <span class="string">&#x27;--&#x27;</span> , <span class="string">&#x27;other:&#x27;</span> kv)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 只填必选参数的调用方法</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>person(<span class="string">&#x27;Boii&#x27;</span>, <span class="number">23</span>)</span><br><span class="line">name: Boii -- age: <span class="number">23</span> -- other: &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 填了必选参数和自定义参数的调用方法</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>person(<span class="string">&#x27;Boii&#x27;</span>, <span class="number">23</span>, city=<span class="string">&#x27;SWA&#x27;</span>)</span><br><span class="line">name: Boii -- age: <span class="number">23</span> -- other: &#123;<span class="string">&#x27;city&#x27;</span>:<span class="string">&#x27;SWA&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>person(<span class="string">&#x27;Adam&#x27;</span>, <span class="number">45</span>, gender=<span class="string">&#x27;M&#x27;</span>, job=<span class="string">&#x27;Engineer&#x27;</span>)</span><br><span class="line">name: Adam -- age: <span class="number">45</span> -- other: &#123;<span class="string">&#x27;gender&#x27;</span>: <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;job&#x27;</span>: <span class="string">&#x27;Engineer&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关键字实参的顺序无所谓</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>person(<span class="string">&#x27;Adam&#x27;</span>, <span class="number">45</span>, job=<span class="string">&#x27;Engineer&#x27;</span>, gender=<span class="string">&#x27;M&#x27;</span>)</span><br><span class="line">name: Adam -- age: <span class="number">45</span> -- other: &#123;<span class="string">&#x27;job&#x27;</span>: <span class="string">&#x27;Engineer&#x27;</span>, <span class="string">&#x27;gender&#x27;</span>: <span class="string">&#x27;M&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 还可以自己把参数打包成dict，然后传给函数, 原理和可变参数类似</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d = &#123;<span class="string">&#x27;job&#x27;</span>: <span class="string">&#x27;Engineer&#x27;</span>, <span class="string">&#x27;gender&#x27;</span>: <span class="string">&#x27;M&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>person(<span class="string">&#x27;Adam&#x27;</span>, <span class="number">45</span>, **d)</span><br><span class="line">name: Adam -- age: <span class="number">45</span> -- other: &#123;<span class="string">&#x27;job&#x27;</span>: <span class="string">&#x27;Engineer&#x27;</span>, <span class="string">&#x27;gender&#x27;</span>: <span class="string">&#x27;M&#x27;</span>&#125;</span><br></pre></td></tr></table></figure><h4 id="命名关键字参数-，"><a href="#命名关键字参数-，" class="headerlink" title="命名关键字参数 *，"></a>命名关键字参数 *，</h4><blockquote><p><code>def funcName( [para1 ... ,] *, key_paraN)</code><br>对比关键字参数 ↓<br><code>def funcName( [para1 ... ,] **key_paraN)</code></p><p>区别于关键字参数：</p><ul><li>如果想要求调用者在调用的时候必须用你给的 key，则可以用 命名关键字参数 <code>*, key_paraN</code></li><li>这种方式，调用者必须 遵循个数 和 关键字</li></ul></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">person</span>(<span class="params">*, city, nationality</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;city:&#x27;</span>, city)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;nationality:&#x27;</span>, nationality)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>person(city=<span class="string">&#x27;SWA&#x27;</span>, nationality=<span class="string">&#x27;China&#x27;</span>)</span><br><span class="line">city: SWA</span><br><span class="line">nationality: China</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>person(nationality=<span class="string">&#x27;China&#x27;</span>, city=<span class="string">&#x27;SWA&#x27;</span>)</span><br><span class="line">city: SWA</span><br><span class="line">nationality: China</span><br><span class="line"></span><br><span class="line"><span class="comment"># 错误示例</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span> person()</span><br><span class="line">TypeError: person() missing <span class="number">2</span> required keyword-only arguments: <span class="string">&#x27;city&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;nationality&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span> person(<span class="string">&#x27;SWA&#x27;</span>, <span class="string">&#x27;China&#x27;</span>)</span><br><span class="line">TypeError: person() takes <span class="number">0</span> positional arguments but <span class="number">2</span> were given</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">person</span>(<span class="params">name, age, *, city, nationality</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;name:&#x27;</span>, name)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;age:&#x27;</span>, age)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;city:&#x27;</span>, city)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;nationality:&#x27;</span>, nationality)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>person(<span class="string">&#x27;Boii&#x27;</span>, <span class="number">23</span>, city=<span class="string">&#x27;SWA&#x27;</span>, nationality=<span class="string">&#x27;China&#x27;</span>)</span><br><span class="line">name: Boii</span><br><span class="line">age: <span class="number">23</span></span><br><span class="line">city: SWA</span><br><span class="line">nationality: China</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>person(<span class="string">&#x27;Boii&#x27;</span>, <span class="number">23</span>, nationality=<span class="string">&#x27;China&#x27;</span>, city=<span class="string">&#x27;SWA&#x27;</span>)</span><br><span class="line">name: Boii</span><br><span class="line">age: <span class="number">23</span></span><br><span class="line">city: SWA</span><br><span class="line">nationality: China</span><br><span class="line"></span><br><span class="line"><span class="comment"># 错误示例</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>person(city=<span class="string">&#x27;SWA&#x27;</span>, nationality=<span class="string">&#x27;China&#x27;</span>)</span><br><span class="line">TypeError: person() missing <span class="number">2</span> required positional arguments: <span class="string">&#x27;name&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;age&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="参数组合"><a href="#参数组合" class="headerlink" title="参数组合"></a>参数组合</h4><blockquote><p>在Python中定义函数，可以用必选参数、默认参数、可变参数、关键字参数和命名关键字参数<br>这5种参数都可以组合使用。<br>但是请注意，参数定义的顺序必须是：<br><code>必选参数</code>、<code>默认参数</code>、<code>可变参数</code>、<code>命名关键字参数</code>和<code>关键字参数</code>。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span>(<span class="params">a, b, c=<span class="number">0</span>, *args, **kw</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;a =&#x27;</span>, a, <span class="string">&#x27;b =&#x27;</span>, b, <span class="string">&#x27;c =&#x27;</span>, c, <span class="string">&#x27;args =&#x27;</span>, args, <span class="string">&#x27;kw =&#x27;</span>, kw)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f2</span>(<span class="params">a, b, c=<span class="number">0</span>, *, d, **kw</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;a =&#x27;</span>, a, <span class="string">&#x27;b =&#x27;</span>, b, <span class="string">&#x27;c =&#x27;</span>, c, <span class="string">&#x27;d =&#x27;</span>, d, <span class="string">&#x27;kw =&#x27;</span>, kw)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f1(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">a = <span class="number">1</span> b = <span class="number">2</span> c = <span class="number">0</span> args = () kw = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f1(<span class="number">1</span>, <span class="number">2</span>, c=<span class="number">3</span>)</span><br><span class="line">a = <span class="number">1</span> b = <span class="number">2</span> c = <span class="number">3</span> args = () kw = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f1(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">a = <span class="number">1</span> b = <span class="number">2</span> c = <span class="number">3</span> args = (<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>) kw = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f1(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, x=<span class="number">99</span>)</span><br><span class="line">a = <span class="number">1</span> b = <span class="number">2</span> c = <span class="number">3</span> args = (<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>) kw = &#123;<span class="string">&#x27;x&#x27;</span>: <span class="number">99</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f2(<span class="number">1</span>, <span class="number">2</span>, d=<span class="number">99</span>, ext=<span class="literal">None</span>)</span><br><span class="line">a = <span class="number">1</span> b = <span class="number">2</span> c = <span class="number">0</span> d = <span class="number">99</span> kw = &#123;<span class="string">&#x27;ext&#x27;</span>: <span class="literal">None</span>&#125;</span><br></pre></td></tr></table></figure><p>最神奇的是通过一个tuple和dict，你也可以调用上述函数：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span>(<span class="params">a, b, c=<span class="number">0</span>, *args, **kw</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;a =&#x27;</span>, a, <span class="string">&#x27;b =&#x27;</span>, b, <span class="string">&#x27;c =&#x27;</span>, c, <span class="string">&#x27;args =&#x27;</span>, args, <span class="string">&#x27;kw =&#x27;</span>, kw)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f2</span>(<span class="params">a, b, c=<span class="number">0</span>, *, d, **kw</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;a =&#x27;</span>, a, <span class="string">&#x27;b =&#x27;</span>, b, <span class="string">&#x27;c =&#x27;</span>, c, <span class="string">&#x27;d =&#x27;</span>, d, <span class="string">&#x27;kw =&#x27;</span>, kw)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>args = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>kw = &#123;<span class="string">&#x27;d&#x27;</span>: <span class="number">99</span>, <span class="string">&#x27;x&#x27;</span>: <span class="string">&#x27;#&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f1(*args, **kw)</span><br><span class="line">a = <span class="number">1</span> b = <span class="number">2</span> c = <span class="number">3</span> args = (<span class="number">4</span>,) kw = &#123;<span class="string">&#x27;d&#x27;</span>: <span class="number">99</span>, <span class="string">&#x27;x&#x27;</span>: <span class="string">&#x27;#&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>args = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>kw = &#123;<span class="string">&#x27;d&#x27;</span>: <span class="number">88</span>, <span class="string">&#x27;x&#x27;</span>: <span class="string">&#x27;#&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f2(*args, **kw)</span><br><span class="line">a = <span class="number">1</span> b = <span class="number">2</span> c = <span class="number">3</span> d = <span class="number">88</span> kw = &#123;<span class="string">&#x27;x&#x27;</span>: <span class="string">&#x27;#&#x27;</span>&#125;</span><br></pre></td></tr></table></figure><blockquote><p>所以，对于任意函数，都可以通过类似<code>func(*args, **kw)</code>的形式调用它，无论它的参数是如何定义的。<br><strong>！！虽然可以组合多达5种参数，但不要同时使用太多的组合，否则函数接口的可理解性很差。</strong></p></blockquote><h2 id="递归函数"><a href="#递归函数" class="headerlink" title="递归函数"></a>递归函数</h2><blockquote><p>自己调用自己<br>递归要素：</p><ol><li>自己调用自己</li><li>有判断条件        （没判断就死循环了，会导致溢出）</li><li>有变量迭代        （没变量迭代就死循环了）</li></ol></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fact</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">if</span> n == <span class="number">1</span> <span class="keyword">else</span> n * fact(n-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fact(<span class="number">5</span>)</span><br><span class="line"><span class="number">120</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fact(<span class="number">10</span>)</span><br><span class="line"><span class="number">3628800</span></span><br></pre></td></tr></table></figure><p>计算 fact(5) 的时候</p><blockquote><p>===&gt; fact(5)<br>===&gt; 5 * fact(4)<br>===&gt; 5 * (4 * fact(3))<br>===&gt; 5 * (4 * (3 * fact(2)))<br>===&gt; 5 * (4 * (3 * (2 * fact(1))))<br>===&gt; 5 * (4 * (3 * (2 * 1)))<br>===&gt; 5 * (4 * (3 * 2))<br>===&gt; 5 * (4 * 6)<br>===&gt; 5 * 24<br>===&gt; 120</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
          <category> 基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python【No-5】运算符</title>
      <link href="posts/11720"/>
      <url>posts/11720</url>
      
        <content type="html"><![CDATA[<p>基础难点：运算符</p><span id="more"></span><h2 id="算术运算符"><a href="#算术运算符" class="headerlink" title="算术运算符"></a>算术运算符</h2><p>以下假设变量a为10，变量b为21：</p><table><thead><tr><th align="left">运算符</th><th align="left"></th><th align="left">描述</th><th align="left">实例</th></tr></thead><tbody><tr><td align="left">+</td><td align="left">加</td><td align="left">两个对象相加</td><td align="left">a + b 输出结果 31</td></tr><tr><td align="left">-</td><td align="left">减</td><td align="left">得到负数或是一个数减去另一个数</td><td align="left">a - b 输出结果 -11</td></tr><tr><td align="left">*</td><td align="left">乘</td><td align="left">两个数相乘或是返回一个被重复若干次的字符串</td><td align="left">a * b 输出结果 210</td></tr><tr><td align="left">/</td><td align="left">除</td><td align="left">x 除以 y</td><td align="left">b / a 输出结果 2.1</td></tr><tr><td align="left">%</td><td align="left">取模</td><td align="left">返回除法的余数</td><td align="left">b % a 输出结果 1</td></tr><tr><td align="left">**</td><td align="left">幂</td><td align="left">返回x的y次幂</td><td align="left">a**b 为10的21次方</td></tr><tr><td align="left">//</td><td align="left">取整除</td><td align="left">向下取接近商的整数</td><td align="left">-9//2输出结果为-5</td></tr></tbody></table><h2 id="比较运算符"><a href="#比较运算符" class="headerlink" title="比较运算符"></a>比较运算符</h2><p>以下假设变量a为10，变量b为20：</p><table><thead><tr><th align="left">运算符</th><th align="left"></th><th align="left">描述</th><th align="left">实例</th></tr></thead><tbody><tr><td align="left">==</td><td align="left">等于</td><td align="left">比较对象是否相等</td><td align="left">(a == b) 返回 False。</td></tr><tr><td align="left">!=</td><td align="left">不等于</td><td align="left">比较两个对象是否不相等</td><td align="left">(a != b) 返回 True。</td></tr><tr><td align="left">&gt;</td><td align="left">大于</td><td align="left">返回x是否大于y</td><td align="left">(a &gt; b) 返回 False。</td></tr><tr><td align="left">&lt;</td><td align="left">小于</td><td align="left">返回x是否小于y</td><td align="left">(a &lt; b) 返回 True。</td></tr><tr><td align="left">&gt;=</td><td align="left">大于等于</td><td align="left">返回x是否大于等于y。</td><td align="left">(a &gt;= b) 返回 False。</td></tr><tr><td align="left">&lt;=</td><td align="left">小于等于</td><td align="left">返回x是否小于等于y。</td><td align="left">(a &lt;= b) 返回 True。</td></tr></tbody></table><blockquote><p>所有比较运算符返回1表示真，返回0表示假。<br>这分别与特殊的变量True和False等价。注意，这些变量名的大写。</p></blockquote><h2 id="赋值运算符"><a href="#赋值运算符" class="headerlink" title="赋值运算符"></a>赋值运算符</h2><p>以下假设变量a为10，变量b为20：</p><table><thead><tr><th align="left">运算符</th><th align="left">描述</th><th align="left">实例</th></tr></thead><tbody><tr><td align="left">=</td><td align="left">简单的赋值运算符</td><td align="left">c = a + b 将 a + b 的运算结果赋值为 c</td></tr><tr><td align="left">+=</td><td align="left">加法赋值运算符</td><td align="left">c += a 等效于 c = c + a</td></tr><tr><td align="left">-=</td><td align="left">减法赋值运算符</td><td align="left">c -= a 等效于 c = c - a</td></tr><tr><td align="left">*=</td><td align="left">乘法赋值运算符</td><td align="left">c *= a 等效于 c = c * a</td></tr><tr><td align="left">/=</td><td align="left">除法赋值运算符</td><td align="left">c /= a 等效于 c = c / a</td></tr><tr><td align="left">%=</td><td align="left">取模赋值运算符</td><td align="left">c %= a 等效于 c = c % a</td></tr><tr><td align="left">**=</td><td align="left">幂赋值运算符</td><td align="left">c **= a 等效于 c = c ** a</td></tr><tr><td align="left">//=</td><td align="left">取整除赋值运算符</td><td align="left">c //= a 等效于 c = c // a</td></tr><tr><td align="left">:=</td><td align="left">海象运算符，可在表达式内部为变量赋值。</td><td align="left"></td></tr></tbody></table><h2 id="海象运算符-成为运算符-命名表达式运算符"><a href="#海象运算符-成为运算符-命名表达式运算符" class="headerlink" title="海象运算符/成为运算符/命名表达式运算符"></a>海象运算符/成为运算符/命名表达式运算符</h2><p>例1</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">age = 20</span><br><span class="line">if age&gt; 18:</span><br><span class="line">    print(&#x27;Adult&#x27;)</span><br><span class="line"></span><br><span class="line"># 使用海象</span><br><span class="line">if (age := 20) &gt; 18:</span><br><span class="line">    print(&#x27;Adult&#x27;)</span><br></pre></td></tr></table></figure><p>例2</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">L = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">n = <span class="built_in">len</span>(L)</span><br><span class="line"><span class="keyword">if</span> n &gt; <span class="number">2</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Length of L is&#x27;</span>, <span class="built_in">len</span>(L))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用海象</span></span><br><span class="line">L = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">if</span> (n := <span class="built_in">len</span>(L)) &gt; <span class="number">2</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Length of L is&#x27;</span>, n)</span><br></pre></td></tr></table></figure><p>可以理解为 <code>len(L)</code> 的返回值赋值给<code>n</code>，然后判断 <code>n&gt;2</code><br>这样做的好处可以提升运行效率</p><p>因为在需要多次调用函数这种会降低运行效率的时候<br>我们通常会减少相同的函数调用，将函数调用后的返回值保存在一个变量里<br>然后 频繁调用函数 换成 频繁使用这个变量</p><p>但是这样就需要多一行保存返回值的表达式<br>而 <code>海象运算符</code> 或者说 <code>成为运算符</code> 则兼顾了两者，即使用了变量保存返回值，又不用多一行代码。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">n = 0</span><br><span class="line">while n &lt; 3:</span><br><span class="line">   print(n) # 0,1,2</span><br><span class="line">   n += 1</span><br><span class="line">   </span><br><span class="line"># 当转换为海象运算符时</span><br><span class="line"></span><br><span class="line">w = 0</span><br><span class="line">while (w := w + 1) &lt; 3:</span><br><span class="line">   print(w) # 1,2</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">while True:</span><br><span class="line">   p = input(&quot;Enter the password: &quot;)</span><br><span class="line">   if p == &quot;the password&quot;:</span><br><span class="line">      break </span><br><span class="line"></span><br><span class="line"># 当转换为海象运算符时</span><br><span class="line">while (p := input(&quot;Enter the password: &quot;)) != &quot;the password&quot;:</span><br><span class="line">   continue</span><br></pre></td></tr></table></figure><h2 id="位运算符"><a href="#位运算符" class="headerlink" title="位运算符"></a>位运算符</h2><p>按位运算符是把数字看作二进制来进行计算的。Python中的按位运算法则如下：<br>下表中变量 a 为 60，b 为 13二进制格式如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">a = 0011 <span class="number">1100</span>    <span class="comment"># 60</span></span><br><span class="line"></span><br><span class="line">b = <span class="number">0000</span> <span class="number">1101</span>    <span class="comment"># 13</span></span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">a&amp;b = <span class="number">0000</span> <span class="number">1100</span>    <span class="comment"># 12</span></span><br><span class="line"></span><br><span class="line">a|b = 0011 <span class="number">1101</span>    <span class="comment"># 61</span></span><br><span class="line"></span><br><span class="line">a^b = 0011 0001    <span class="comment"># 49</span></span><br><span class="line"></span><br><span class="line">~a  = <span class="number">1100</span> 0011    <span class="comment"># 195</span></span><br></pre></td></tr></table></figure><table><thead><tr><th align="left">运算符</th><th align="left">描述</th><th align="left">实例</th></tr></thead><tbody><tr><td align="left">&amp;</td><td align="left">按位与运算符：参与运算的两个值,如果两个相应位都为1,则该位的结果为1,否则为0</td><td align="left">(a &amp; b) 输出结果 12 ，二进制解释： 0000 1100</td></tr><tr><td align="left">|</td><td align="left">按位或运算符：只要对应的二个二进位有一个为1时，结果位就为1。</td><td align="left">(a| b) 输出结果 61 ，二进制解释： 0011 1101</td></tr><tr><td align="left">^</td><td align="left">按位异或运算符：当两对应的二进位相异时，结果为1</td><td align="left">(a ^ b) 输出结果 49 ，二进制解释： 0011 0001</td></tr><tr><td align="left">~</td><td align="left">按位取反运算符：对数据的每个二进制位取反,即把1变为0,把0变为1</td><td align="left">(~a ) 输出结果 -61 ，二进制解释： 1100 0011， 在一个有符号二进制数的补码形式。</td></tr><tr><td align="left">&lt;&lt;</td><td align="left">左移动运算符：运算数的各二进位全部左移N位.高位丢弃，低位补0。</td><td align="left">a &lt;&lt; 2 输出结果 240 ，二进制解释： 1111 0000</td></tr><tr><td align="left">&gt;&gt;</td><td align="left">右移动运算符：运算数的各二进位全部右移N位，</td><td align="left">a &gt;&gt; 2 输出结果 15 ，二进制解释： 0000 1111</td></tr></tbody></table><p>a &lt;&lt; 1 等价于 a * 2<br>a &lt;&lt; 2 等价于 a * 2 * 2<br>a &gt;&gt; 1 等价于 a / 2<br>a &gt;&gt; 2 等价于 a / 2 / 2<br>a ^= a 等价于 a = a ^ a 等价于置零 a = 0<br>a = a ^ (~a) + 1 等价于置零 a = 0<br>~a + 1 为a的补码</p><h2 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h2><p>Python语言支持逻辑运算符，以下假设变量 a 为 10, b为 20:</p><table><thead><tr><th align="left">运算符</th><th align="left">表达式</th><th align="left">描述</th><th align="left">实例</th></tr></thead><tbody><tr><td align="left">and</td><td align="left">x and y</td><td align="left">布尔”与” - 如果 x 为 False，x and y 返回 False，否则它返回 y 的计算值。</td><td align="left">(a and b) 返回 20。</td></tr><tr><td align="left">or</td><td align="left">x or y</td><td align="left">布尔”或” - 如果 x 是 True，它返回 x 的值，否则它返回 y 的计算值。</td><td align="left">(a or b) 返回 10。</td></tr><tr><td align="left">not</td><td align="left">not x</td><td align="left">布尔”非” - 如果 x 为 True，返回 False 。如果 x 为 False，它返回 True。</td><td align="left">not(a and b) 返回 False</td></tr></tbody></table><h2 id="成员运算符"><a href="#成员运算符" class="headerlink" title="成员运算符"></a>成员运算符</h2><p>除了以上的一些运算符之外，Python还支持成员运算符，测试实例中包含了一系列的成员，包括字符串，列表或元组。</p><table><thead><tr><th align="left">运算符</th><th align="left">描述</th><th align="left">实例</th></tr></thead><tbody><tr><td align="left">in</td><td align="left">如果在指定的序列中找到值返回 True，否则返回 False。</td><td align="left">x 在 y 序列中 , 如果 x 在 y 序列中返回 True。</td></tr><tr><td align="left">not in</td><td align="left">如果在指定的序列中没有找到值返回 True，否则返回 False。</td><td align="left">x 不在 y 序列中 , 如果 x 不在 y 序列中返回 True。</td></tr></tbody></table><h2 id="身份运算符"><a href="#身份运算符" class="headerlink" title="身份运算符"></a>身份运算符</h2><p>身份运算符用于比较两个对象的存储单元</p><table><thead><tr><th align="left">运算符</th><th align="left">描述</th><th align="left">实例</th></tr></thead><tbody><tr><td align="left">is</td><td align="left">is 是判断两个标识符是不是引用自一个对象</td><td align="left">x is y, 类似 id(x) == id(y) , 如果引用的<strong>是同一个对象</strong>则返回 True，否则返回 False</td></tr><tr><td align="left">is not</td><td align="left">is not 是判断两个标识符是不是引用自不同对象</td><td align="left">x is not y ， 类似 id(a) != id(b)。如果引用的<strong>不是同一个对象</strong>则返回结果 True，否则返回 False。</td></tr><tr><td align="left">id()</td><td align="left">id() 函数用于获取对象内存地址</td><td align="left"></td></tr></tbody></table><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#id()</span></span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;a = <span class="string">&#x27;runoob&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(a)</span><br><span class="line"><span class="number">4531887632</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = <span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(b)</span><br><span class="line"><span class="number">140588731085608</span></span><br></pre></td></tr></table></figure><h2 id="三目运算符"><a href="#三目运算符" class="headerlink" title="三目运算符"></a>三目运算符</h2><blockquote><p>true if expression else flase<br>满足表达式时 if 表达式 else 不满足表达式时</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = <span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>h = a + b <span class="keyword">if</span> a &lt; b <span class="keyword">else</span> a - b</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>h</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>q = (a + b) <span class="keyword">if</span> (a &lt; b) <span class="keyword">else</span> (a - b)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>q</span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure><h2 id="运算符优先级"><a href="#运算符优先级" class="headerlink" title="运算符优先级"></a>运算符优先级</h2><p>以下表格列出了从最高到最低优先级的所有运算符：</p><table><thead><tr><th align="left">运算符</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">**</td><td align="left">指数 (最高优先级)</td></tr><tr><td align="left">~、+、-</td><td align="left">按位取反、正、负</td></tr><tr><td align="left">*、/、%、//</td><td align="left">乘，除，求余数和取整除</td></tr><tr><td align="left">+、-</td><td align="left">加、减</td></tr><tr><td align="left">&lt;&lt;、&gt;&gt;</td><td align="left">左移、右移</td></tr><tr><td align="left">&amp;</td><td align="left">按位与</td></tr><tr><td align="left">^、|</td><td align="left">按位异或、按位或</td></tr><tr><td align="left">&lt;=、&lt;、&gt;、&gt;=</td><td align="left">比较运算符</td></tr><tr><td align="left">==、!=</td><td align="left">等于运算符</td></tr><tr><td align="left">=、%=、/=、//=、-=、+=、*=、**=</td><td align="left">赋值运算符</td></tr><tr><td align="left">is、is not</td><td align="left">身份运算符</td></tr><tr><td align="left">in、not in</td><td align="left">成员运算符</td></tr><tr><td align="left">and、or、not</td><td align="left">逻辑运算符</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
          <category> 基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python【No-4】数据类型</title>
      <link href="posts/39690"/>
      <url>posts/39690</url>
      
        <content type="html"><![CDATA[<p>基础知识：数据类型</p><span id="more"></span><h2 id="常见内置类型"><a href="#常见内置类型" class="headerlink" title="常见内置类型"></a>常见内置类型</h2><blockquote><p>内置类型：<br>None（全局只有一个）<br>数值类型：int、float、complax（复数）、bool<br>迭代类型<br>序列类型：list、bytes、range、tuple、string、array<br>映射类型：dict<br>集合类型：set、frozenset<br>上下文管理类型：with</p></blockquote><blockquote><p>可变类型：list、set、dict<br>不可变类型：int、float、string、tuple</p></blockquote><h2 id="基本数据类型"><a href="#基本数据类型" class="headerlink" title="基本数据类型"></a>基本数据类型</h2><h3 id="整型"><a href="#整型" class="headerlink" title="整型"></a>整型</h3><p>可以是任意大小的整数<br>与数学上的表示方法一样 如：1，100，-800，0<br>可以用十六进制表示法 如：0xFF00, 0xab54f</p><h4 id="常用基本运算"><a href="#常用基本运算" class="headerlink" title="常用基本运算"></a>常用基本运算</h4><blockquote><p>加（+）    减（-）    乘（*）    除（/）    模（%）</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">3</span> + <span class="number">2</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">3</span> - <span class="number">2</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">3</span> * <span class="number">2</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">3</span> / <span class="number">2</span></span><br><span class="line"><span class="number">1.5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">2</span> + <span class="number">3</span> * <span class="number">4</span></span><br><span class="line"><span class="number">14</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>(<span class="number">2</span> + <span class="number">3</span>) * <span class="number">4</span></span><br><span class="line"><span class="number">20</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">17</span> % <span class="number">3</span></span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure><blockquote><p>除法运算 （/）永远返回浮点型</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">9</span> / <span class="number">3</span></span><br><span class="line"><span class="number">3.0</span></span><br></pre></td></tr></table></figure><blockquote><p>乘方（**）    截断除法、整数除（//）</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">3</span> ** <span class="number">2</span></span><br><span class="line"><span class="number">9</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">3</span> ** <span class="number">3</span></span><br><span class="line"><span class="number">27</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">17</span> // <span class="number">3</span></span><br><span class="line"><span class="number">5</span></span><br></pre></td></tr></table></figure><blockquote><p>包含多种混合类型运算数的运算会把整数转换为浮点数</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">4</span> * <span class="number">3.75</span> - <span class="number">1</span></span><br><span class="line"><span class="number">14.0</span></span><br></pre></td></tr></table></figure><h3 id="浮点数"><a href="#浮点数" class="headerlink" title="浮点数"></a>浮点数</h3><p>即小数 如：1.2，524.33，-9.11<br>如果是很大或很小的浮点数，必须用科学计数法表示，用<code>e+指数</code>代替底数 <code>10^指数</code>，如：</p><blockquote><p>1.23×10^9 就是 1.23e9 或 12.3e8，  0.000012 就是 1.2e-5<br>浮点数运算可能会有四舍五入的误差</p></blockquote><h3 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">str1 = <span class="string">&#x27;OK&#x27;</span>        <span class="comment"># OK</span></span><br><span class="line">str2 = <span class="string">&quot;OK&quot;</span>        <span class="comment"># OK</span></span><br><span class="line">str3 = <span class="string">&quot;I&#x27;m ok.&quot;</span>   <span class="comment"># I&#x27;m ok.</span></span><br><span class="line">str4 = <span class="string">&#x27;I\&#x27;m ok.&#x27;</span>  <span class="comment"># I&#x27;m ok.</span></span><br><span class="line">str5 = <span class="string">&quot;I\&quot;m ok.&quot;</span>  <span class="comment"># I&quot;m ok.</span></span><br><span class="line">str6 = <span class="string">&#x27;I&quot;m ok.&#x27;</span>   <span class="comment"># I&quot;m ok.</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">str7 = <span class="string">&#x27;&#x27;&#x27;这是一个段落，所以可以直接换行，不需反斜杠来声明语句未结束</span></span><br><span class="line"><span class="string">    直到遇到下一个三单引号，才认为结束</span></span><br><span class="line"><span class="string">但是换行会跟着换行，空格会跟着空格&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">str7输出为：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">这是一个段落，所以可以直接换行，不需反斜杠来声明语句未结束</span></span><br><span class="line"><span class="string">    直到遇到下一个三单引号，才认为结束</span></span><br><span class="line"><span class="string">但是换行会跟着换行，空格会跟着空格</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">\n 换行    \t 缩进</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用转义字符</span></span><br><span class="line">str8 = <span class="string">&#x27;ab\ncd&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">str8输出为：</span></span><br><span class="line"><span class="string">ab</span></span><br><span class="line"><span class="string">cd</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">r&#x27;字符串&#x27;</span> 表示不转义</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不转义</span></span><br><span class="line">str9 = <span class="string">r&#x27;ab\ncd&#x27;</span>    <span class="comment"># ab\ncd</span></span><br></pre></td></tr></table></figure><p>转义字符</p><table><thead><tr><th align="center">转义字符</th><th align="center">描述</th></tr></thead><tbody><tr><td align="center">\</td><td align="center">续行符</td></tr><tr><td align="center">\</td><td align="center">反斜杠</td></tr><tr><td align="center">&#39;</td><td align="center">单引号</td></tr><tr><td align="center">&quot;</td><td align="center">双引号</td></tr><tr><td align="center">\a</td><td align="center">响铃</td></tr><tr><td align="center">\b</td><td align="center">退格</td></tr><tr><td align="center">\e</td><td align="center">转义</td></tr><tr><td align="center">\000</td><td align="center">空</td></tr><tr><td align="center">\n</td><td align="center">换行</td></tr><tr><td align="center">\v</td><td align="center">纵向制表符</td></tr><tr><td align="center">\t</td><td align="center">横向制表符</td></tr><tr><td align="center">\r</td><td align="center">回车</td></tr><tr><td align="center">\f</td><td align="center">换页</td></tr><tr><td align="center">\o</td><td align="center">八进制</td></tr><tr><td align="center">\x</td><td align="center">十六进制</td></tr></tbody></table><h3 id="布尔值"><a href="#布尔值" class="headerlink" title="布尔值"></a>布尔值</h3><blockquote><p><code>True</code>   <code>False</code></p></blockquote><p>可以用 <code>and</code> , <code>or</code> , <code>not</code> 运算</p><h3 id="空值"><a href="#空值" class="headerlink" title="空值"></a>空值</h3><blockquote><p>空值是一个特殊的值，用 <code>None</code> 表示。<code>None</code> 不等于 <code>0</code>，<code>0</code> 是有意义的.<br>全局只有一个None</p></blockquote><h2 id="复合数据类型"><a href="#复合数据类型" class="headerlink" title="复合数据类型"></a>复合数据类型</h2><h3 id="列表-List"><a href="#列表-List" class="headerlink" title="列表 List"></a>列表 List</h3><blockquote><p>一种<code>有序的、可变的</code> 元素集合<br>用 <code>[ ]</code> 标识</p><p>可随机添加和删除其中的元素<br><strong>可理解为可变的数组</strong><br>是一种复合数据类型<br>List 中的元素可以不同类型<br>区别于元组Tuple：List 中的元素可变</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>name = [<span class="string">&#x27;Alice&#x27;</span>, <span class="string">&#x27;Boii&#x27;</span>, <span class="string">&#x27;Chen&#x27;</span>, <span class="string">&#x27;Dannie&#x27;</span>, <span class="string">&#x27;Eva&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(name)</span><br><span class="line">[<span class="string">&#x27;Alice&#x27;</span>, <span class="string">&#x27;Boii&#x27;</span>, <span class="string">&#x27;Chen&#x27;</span>, <span class="string">&#x27;Dannie&#x27;</span>, <span class="string">&#x27;Eva&#x27;</span>]</span><br></pre></td></tr></table></figure><h4 id="List索引"><a href="#List索引" class="headerlink" title="List索引"></a>List索引</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">|  P  |  y  |  t  |  h  |  o  |  n  |</span><br><span class="line">   <span class="number">0</span>     <span class="number">1</span>     <span class="number">2</span>     <span class="number">3</span>     <span class="number">4</span>     <span class="number">5</span>            <span class="comment"># 从左往右，下标从0开始</span></span><br><span class="line">  -<span class="number">6</span>    -<span class="number">5</span>    -<span class="number">4</span>    -<span class="number">3</span>    -<span class="number">2</span>    -<span class="number">1</span>            <span class="comment"># 从右往左，下标从-1开始</span></span><br></pre></td></tr></table></figure><h4 id="List的增删改查"><a href="#List的增删改查" class="headerlink" title="List的增删改查"></a>List的增删改查</h4><h5 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h5><blockquote><p>listName = [element1, element2, element3, …]</p></blockquote><h5 id="增"><a href="#增" class="headerlink" title="增"></a>增</h5><h6 id="追加到末尾-append"><a href="#追加到末尾-append" class="headerlink" title="追加到末尾 append"></a>追加到末尾 append</h6><blockquote><p>listName.append(value)</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>name = [<span class="string">&#x27;Alice&#x27;</span>, <span class="string">&#x27;Boii&#x27;</span>, <span class="string">&#x27;Chen&#x27;</span>, <span class="string">&#x27;Dannie&#x27;</span>, <span class="string">&#x27;Eva&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>name.append(<span class="string">&#x27;Fit&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>name</span><br><span class="line">[<span class="string">&#x27;Alice&#x27;</span>, <span class="string">&#x27;Boii&#x27;</span>, <span class="string">&#x27;Chen&#x27;</span>, <span class="string">&#x27;Dannie&#x27;</span>, <span class="string">&#x27;Eva&#x27;</span>, <span class="string">&#x27;Fit&#x27;</span>]</span><br></pre></td></tr></table></figure><h6 id="插入到指定位置-insert"><a href="#插入到指定位置-insert" class="headerlink" title="插入到指定位置 insert"></a>插入到指定位置 insert</h6><blockquote><p>listName.insert(index, value)</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>name = [<span class="string">&#x27;Alice&#x27;</span>, <span class="string">&#x27;Boii&#x27;</span>, <span class="string">&#x27;Chen&#x27;</span>, <span class="string">&#x27;Dannie&#x27;</span>, <span class="string">&#x27;Eva&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>name.insert(<span class="number">3</span>, <span class="string">&#x27;Fit&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>name</span><br><span class="line">[<span class="string">&#x27;Alice&#x27;</span>, <span class="string">&#x27;Boii&#x27;</span>, <span class="string">&#x27;Chen&#x27;</span>, <span class="string">&#x27;Fit&#x27;</span>, <span class="string">&#x27;Dannie&#x27;</span>, <span class="string">&#x27;Eva&#x27;</span>]</span><br></pre></td></tr></table></figure><h5 id="删"><a href="#删" class="headerlink" title="删"></a>删</h5><h6 id="删除末尾元素-pop"><a href="#删除末尾元素-pop" class="headerlink" title="删除末尾元素 pop"></a>删除末尾元素 pop</h6><blockquote><p>listName.pop()</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>name = [<span class="string">&#x27;Alice&#x27;</span>, <span class="string">&#x27;Boii&#x27;</span>, <span class="string">&#x27;Chen&#x27;</span>, <span class="string">&#x27;Dannie&#x27;</span>, <span class="string">&#x27;Eva&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>name.pop()</span><br><span class="line"><span class="string">&#x27;Eva&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>name</span><br><span class="line">[<span class="string">&#x27;Alice&#x27;</span>, <span class="string">&#x27;Boii&#x27;</span>, <span class="string">&#x27;Chen&#x27;</span>, <span class="string">&#x27;Dannie&#x27;</span>]</span><br></pre></td></tr></table></figure><h6 id="删除指定位置元素-pop"><a href="#删除指定位置元素-pop" class="headerlink" title="删除指定位置元素 pop"></a>删除指定位置元素 pop</h6><blockquote><p>listName.pop(index)<br>或<br>del listName[index]</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>name = [<span class="string">&#x27;Alice&#x27;</span>, <span class="string">&#x27;Boii&#x27;</span>, <span class="string">&#x27;Chen&#x27;</span>, <span class="string">&#x27;Dannie&#x27;</span>, <span class="string">&#x27;Eva&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>name.pop(<span class="number">3</span>)</span><br><span class="line"><span class="string">&#x27;Dannie&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>name</span><br><span class="line">[<span class="string">&#x27;Alice&#x27;</span>, <span class="string">&#x27;Boii&#x27;</span>, <span class="string">&#x27;Chen&#x27;</span>, <span class="string">&#x27;Eva&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> name[<span class="number">2</span>]</span><br><span class="line">[<span class="string">&#x27;Alice&#x27;</span>, <span class="string">&#x27;Boii&#x27;</span>, <span class="string">&#x27;Eva&#x27;</span>]</span><br></pre></td></tr></table></figure><h5 id="改"><a href="#改" class="headerlink" title="改"></a>改</h5><blockquote><p>修改某个元素，直接给该元素赋新值即可<br>listName[index] = value</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>name = [<span class="string">&#x27;Alice&#x27;</span>, <span class="string">&#x27;Boii&#x27;</span>, <span class="string">&#x27;Chen&#x27;</span>, <span class="string">&#x27;Dannie&#x27;</span>, <span class="string">&#x27;Eva&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>name[<span class="number">2</span>] = <span class="string">&#x27;Cai&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>name</span><br><span class="line">[<span class="string">&#x27;Alice&#x27;</span>, <span class="string">&#x27;Boii&#x27;</span>, <span class="string">&#x27;Cai&#x27;</span>, <span class="string">&#x27;Dannie&#x27;</span>, <span class="string">&#x27;Eva&#x27;</span>]</span><br></pre></td></tr></table></figure><h5 id="查"><a href="#查" class="headerlink" title="查"></a>查</h5><blockquote><p>使用下标来访问List中的元素<br>listName[index]</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">name = [<span class="string">&#x27;Alice&#x27;</span>, <span class="string">&#x27;Boii&#x27;</span>, <span class="string">&#x27;Chen&#x27;</span>, <span class="string">&#x27;Dannie&#x27;</span>, <span class="string">&#x27;Eva&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(name[<span class="number">0</span>])    <span class="comment"># &#x27;Alice&#x27; 访问List第一个元素</span></span><br><span class="line"><span class="built_in">print</span>(name[<span class="number">1</span>])    <span class="comment"># &#x27;Boii&#x27;  访问List第二个元素</span></span><br><span class="line"><span class="built_in">print</span>(name[-<span class="number">1</span>])   <span class="comment"># &#x27;Eva&#x27;   访问List最后一个元素</span></span><br></pre></td></tr></table></figure><h4 id="获得长度-len"><a href="#获得长度-len" class="headerlink" title="获得长度 len()"></a>获得长度 len()</h4><blockquote><p>len(List名)</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>name = [<span class="string">&#x27;Alice&#x27;</span>, <span class="string">&#x27;Boii&#x27;</span>, <span class="string">&#x27;Chen&#x27;</span>, <span class="string">&#x27;Dannie&#x27;</span>, <span class="string">&#x27;Eva&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(name)</span><br><span class="line"><span class="number">5</span></span><br></pre></td></tr></table></figure><h4 id="List中元素可以不同类型"><a href="#List中元素可以不同类型" class="headerlink" title="List中元素可以不同类型"></a>List中元素可以不同类型</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>L = [<span class="string">&#x27;Boii&#x27;</span>, <span class="number">23</span>, <span class="literal">True</span>, <span class="string">&#x27;https://tcp404.com&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>L</span><br><span class="line">[<span class="string">&#x27;Boii&#x27;</span>, <span class="number">23</span>, <span class="literal">True</span>, <span class="string">&#x27;https://tcp404.com&#x27;</span>]</span><br></pre></td></tr></table></figure><h4 id="List嵌套List"><a href="#List嵌套List" class="headerlink" title="List嵌套List"></a>List嵌套List</h4><blockquote><p>类似于多维数组的概念</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>l_main = [<span class="string">&#x27;Boii&#x27;</span>, <span class="number">23</span>, [<span class="string">&#x27;https://&#x27;</span>, <span class="string">&#x27;tcp404&#x27;</span>, <span class="string">&#x27;.com&#x27;</span>], <span class="number">443</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(l_main)</span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(l_main[<span class="number">2</span>])</span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure><p>等价于</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>l_sub =  [<span class="string">&#x27;https://&#x27;</span>, <span class="string">&#x27;tcp404&#x27;</span>, <span class="string">&#x27;.com&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l_main = [<span class="string">&#x27;Boii&#x27;</span>, <span class="number">23</span>, l_sub, <span class="number">443</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#获取 tcp404可以用一下方式</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l_main[<span class="number">2</span>][<span class="number">1</span>]</span><br><span class="line"><span class="string">&#x27;tcp404&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="空List"><a href="#空List" class="headerlink" title="空List"></a>空List</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>L = []</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(L)</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>li = <span class="built_in">list</span>()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(li)</span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure><h3 id="元组-Tuple"><a href="#元组-Tuple" class="headerlink" title="元组 Tuple"></a>元组 Tuple</h3><blockquote><p>一种 <code>有序的、不可变的</code> 元素集合<br>用 <code>( )</code> 标识</p><p>Tuple中的元素一旦初始化就不可变<br><strong>可理解为不可变的数组</strong><br>是一种复合数据类型<br>Tuple中的元素可以不同类型<br>区别于List：Tuple 中的元素 <code>不可变</code></p></blockquote><h4 id="初始化-1"><a href="#初始化-1" class="headerlink" title="初始化"></a>初始化</h4><blockquote><p>tupleName = (elem1, elem2, elem3, …)</p></blockquote><h4 id="Tuple索引"><a href="#Tuple索引" class="headerlink" title="Tuple索引"></a>Tuple索引</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">|  P  |  y  |  t  |  h  |  o  |  n  |</span><br><span class="line">   <span class="number">0</span>     <span class="number">1</span>     <span class="number">2</span>     <span class="number">3</span>     <span class="number">4</span>     <span class="number">5</span>            <span class="comment"># 从左往右，下标从0开始</span></span><br><span class="line">  -<span class="number">6</span>    -<span class="number">5</span>    -<span class="number">4</span>    -<span class="number">3</span>    -<span class="number">2</span>    -<span class="number">1</span>            <span class="comment"># 从右往左，下标从-1开始</span></span><br></pre></td></tr></table></figure><h4 id="Tuple的增删改查"><a href="#Tuple的增删改查" class="headerlink" title="Tuple的增删改查"></a>Tuple的增删改查</h4><blockquote><p>Tuple不可变，所以不可以 增加、删除、修改，只能查询<br>查询与List相同</p></blockquote><h5 id="查-1"><a href="#查-1" class="headerlink" title="查"></a>查</h5><blockquote><p>tupleName[index]</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>T = (<span class="number">1</span>, <span class="number">2</span>, <span class="string">&#x27;Boii&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>T[<span class="number">2</span>]</span><br><span class="line"><span class="string">&#x27;Boii&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>T[<span class="number">0</span>]</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>T</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>, <span class="string">&#x27;Boii&#x27;</span>)</span><br></pre></td></tr></table></figure><h4 id="空Tuple"><a href="#空Tuple" class="headerlink" title="空Tuple ()"></a>空Tuple ()</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>tr = ()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tr</span><br><span class="line">()</span><br></pre></td></tr></table></figure><h4 id="定义单元素的Tuple-element，"><a href="#定义单元素的Tuple-element，" class="headerlink" title="定义单元素的Tuple (element，)"></a>定义单元素的Tuple (element，)</h4><blockquote><p>为避免与数学的括号混淆，定义一个元素的Tuple时，要在元素后加上逗号</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>tr = (<span class="string">&#x27;Boii&#x27;</span>,)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tr</span><br><span class="line">(<span class="string">&#x27;Boii&#x27;</span>,)</span><br></pre></td></tr></table></figure><blockquote><p>且在python解释中：<br>    tr = (1) 会被认为是 tr = 1, tr 就变成一个普通的整型变量<br>    tr = (‘Boii’) 会被认为是 tr = ‘Boii’, tr 就变成一个普通的字符串变量</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>tr = (<span class="number">1</span>)        <span class="comment"># 等价于 tr = 1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tr</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tr = (<span class="string">&#x27;Boii&#x27;</span>)   <span class="comment"># 等价于 tr = &#x27;Boii&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tr</span><br><span class="line"><span class="string">&#x27;Boii&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tr = (<span class="string">&#x27;Boii&#x27;</span>,)  <span class="comment"># √ 正确定义单元素Tuple</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tr</span><br><span class="line">(<span class="string">&#x27;Boii&#x27;</span>,)</span><br></pre></td></tr></table></figure><h4 id="Tuple不可变的意义"><a href="#Tuple不可变的意义" class="headerlink" title="Tuple不可变的意义"></a>Tuple不可变的意义</h4><blockquote><p>因为tuple不可变，所以代码更安全。如果可能，能用tuple代替list就尽量用tuple。</p></blockquote><h4 id="！！！不可变Tuple中的可变元素"><a href="#！！！不可变Tuple中的可变元素" class="headerlink" title="！！！不可变Tuple中的可变元素"></a>！！！不可变Tuple中的可变元素</h4><blockquote><p>Tuple的不可变指的是Tuple指向的元素不可变<br>如果元素中有 <code>可变的Listlist</code> ，那么Tuple依然可以修改</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>t = (<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t[<span class="number">2</span>][<span class="number">0</span>] = <span class="string">&#x27;X&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t[<span class="number">2</span>][<span class="number">1</span>] = <span class="string">&#x27;Y&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t</span><br><span class="line">(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, [<span class="string">&#x27;X&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>])</span><br></pre></td></tr></table></figure><p>定义Tuplet时</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/4-1.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/4-1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="1"></p><p>修改Tuplet的元素后</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/4-2.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/4-2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2"></p><h3 id="字典-Dict"><a href="#字典-Dict" class="headerlink" title="字典 Dict"></a>字典 Dict</h3><blockquote><p>一种 <code>无序的、可变的</code> 键-值对集合<br>用 <code>&#123; &#125;</code> 标识</p><p>键key 必须是不可变对象 （如字符串、整数。而list，tuple这些不可以作为key）<br>键key 不可以重复<br>键key 可以不同类型，但不建议<br>键key 可以是变量，但是这个变量必须指向字符串、整数这类不可变对象</p><p>Dictionary VS List</p><ol><li>Dict 查找和插入的速度极快，不会随着key的增加而变慢；</li><li>Dict 需要占用大量的内存，内存浪费多。</li><li>List 查找和插入的时间随着元素的增加而增加；</li><li>List 占用空间小，浪费内存很少。</li></ol></blockquote><h4 id="初始化-2"><a href="#初始化-2" class="headerlink" title="初始化"></a>初始化</h4><blockquote><p>dictName = { key1 : value1, key2 : value2, key3 : value3, … }</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">d = &#123;<span class="string">&#x27;a&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;b&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;c&#x27;</span>: <span class="number">3</span>, <span class="string">&#x27;d&#x27;</span>: <span class="number">4</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 键可以不同类型</span></span><br><span class="line">dd = &#123;<span class="string">&#x27;a&#x27;</span>:<span class="string">&#x27;Alice&#x27;</span>, <span class="string">&#x27;b&#x27;</span>:<span class="string">&#x27;Boii&#x27;</span>, <span class="number">18</span>:<span class="string">&#x27;Kk&#x27;</span>&#125;</span><br></pre></td></tr></table></figure><h4 id="Dict索引"><a href="#Dict索引" class="headerlink" title="Dict索引"></a>Dict索引</h4><blockquote><p>Dict的索引就是 键key。</p></blockquote><h4 id="Dict的增删改查和判断"><a href="#Dict的增删改查和判断" class="headerlink" title="Dict的增删改查和判断"></a>Dict的增删改查和判断</h4><h5 id="增-1"><a href="#增-1" class="headerlink" title="增"></a>增</h5><blockquote><p>dictName[key] = value</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>d = &#123;<span class="string">&#x27;a&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;b&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;c&#x27;</span>: <span class="number">3</span>, <span class="string">&#x27;d&#x27;</span>: <span class="number">4</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d[<span class="string">&#x27;AC&#x27;</span>] = <span class="string">&#x27;diu&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d</span><br><span class="line">&#123;<span class="string">&#x27;a&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;b&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;c&#x27;</span>: <span class="number">3</span>, <span class="string">&#x27;d&#x27;</span>: <span class="number">4</span>, <span class="string">&#x27;AC&#x27;</span>:<span class="string">&#x27;diu&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用变量作为key</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d = &#123;<span class="string">&#x27;a&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;b&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;c&#x27;</span>: <span class="number">3</span>, <span class="string">&#x27;d&#x27;</span>: <span class="number">4</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="string">&#x27;x&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d[a] = <span class="string">&#x27;what&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d</span><br><span class="line">&#123;<span class="string">&#x27;a&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;b&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;c&#x27;</span>: <span class="number">3</span>, <span class="string">&#x27;d&#x27;</span>: <span class="number">4</span>, <span class="string">&#x27;x&#x27;</span>:<span class="string">&#x27;what&#x27;</span>&#125;</span><br></pre></td></tr></table></figure><h5 id="删-pop、del"><a href="#删-pop、del" class="headerlink" title="删 pop、del"></a>删 pop、del</h5><blockquote><p>dictName.pop(key)<br>del dictName[key]</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>d = &#123;<span class="string">&#x27;a&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;b&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;c&#x27;</span>: <span class="number">3</span>, <span class="string">&#x27;d&#x27;</span>: <span class="number">4</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d.pop(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">&#123;<span class="string">&#x27;b&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;c&#x27;</span>: <span class="number">3</span>, <span class="string">&#x27;d&#x27;</span>: <span class="number">4</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> d[<span class="string">&#x27;c&#x27;</span>]</span><br><span class="line">&#123;<span class="string">&#x27;b&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;d&#x27;</span>: <span class="number">4</span>&#125;</span><br></pre></td></tr></table></figure><h5 id="改-1"><a href="#改-1" class="headerlink" title="改"></a>改</h5><blockquote><p>dictName[key] = newValue<br>因为key不能重复，所以如果key不存在，会变成添加，如果key存在，newValue会覆盖oldValue</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>d = &#123;<span class="string">&#x27;a&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;b&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;c&#x27;</span>: <span class="number">3</span>, <span class="string">&#x27;d&#x27;</span>: <span class="number">4</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d[<span class="string">&#x27;a&#x27;</span>] = <span class="number">25</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d</span><br><span class="line">&#123;<span class="string">&#x27;a&#x27;</span>: <span class="number">25</span>, <span class="string">&#x27;b&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;c&#x27;</span>: <span class="number">3</span>, <span class="string">&#x27;d&#x27;</span>: <span class="number">4</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d[<span class="string">&#x27;e&#x27;</span>] = <span class="number">15</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d</span><br><span class="line">&#123;<span class="string">&#x27;a&#x27;</span>: <span class="number">25</span>, <span class="string">&#x27;b&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;c&#x27;</span>: <span class="number">3</span>, <span class="string">&#x27;d&#x27;</span>: <span class="number">4</span>, <span class="string">&#x27;e&#x27;</span>: <span class="number">15</span>&#125;</span><br></pre></td></tr></table></figure><h5 id="查-get"><a href="#查-get" class="headerlink" title="查 get"></a>查 get</h5><blockquote><p>dictName.get(key)<br>如果key存在，返回对应的value<br>如果key不存在，返回None</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">d = &#123;<span class="string">&#x27;a&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;b&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;c&#x27;</span>: <span class="number">3</span>, <span class="string">&#x27;d&#x27;</span>: <span class="number">4</span>&#125;</span><br><span class="line">d.get(<span class="string">&#x27;a&#x27;</span>)       <span class="comment"># 1</span></span><br><span class="line">d.get(<span class="string">&#x27;z&#x27;</span>)       <span class="comment"># None</span></span><br></pre></td></tr></table></figure><blockquote><p>dictName.get(key, return)<br>如果key存在，返回对应的value<br>如果key不存在，返回指定的返回值return，return可以是整型、字符串，甚至是List等</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>d = &#123;<span class="string">&#x27;a&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;b&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;c&#x27;</span>: <span class="number">3</span>, <span class="string">&#x27;d&#x27;</span>: <span class="number">4</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d.get(<span class="string">&#x27;z&#x27;</span>, <span class="number">0</span>)</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d.get(<span class="string">&#x27;z&#x27;</span>, <span class="string">&#x27;No This Key&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;No This Key&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d.get(<span class="string">&#x27;z&#x27;</span>, [<span class="number">0</span>, <span class="number">0</span>])</span><br><span class="line">[<span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d.get(<span class="string">&#x27;z&#x27;</span>, &#123;<span class="number">1</span>:<span class="string">&#x27;a&#x27;</span>, <span class="number">2</span>:<span class="string">&#x27;b&#x27;</span>&#125;)</span><br><span class="line">&#123;<span class="number">1</span>:<span class="string">&#x27;a&#x27;</span>, <span class="number">2</span>:<span class="string">&#x27;b&#x27;</span>&#125;</span><br></pre></td></tr></table></figure><h5 id="判断-in、not-in"><a href="#判断-in、not-in" class="headerlink" title="判断 in、not in"></a>判断 in、not in</h5><blockquote><p>key in dictName</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>d = &#123;<span class="string">&#x27;a&#x27;</span>: <span class="number">25</span>, <span class="string">&#x27;b&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;c&#x27;</span>: <span class="number">3</span>, <span class="string">&#x27;d&#x27;</span>: <span class="number">4</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;b&#x27;</span> <span class="keyword">in</span> d</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;z&#x27;</span> <span class="keyword">in</span> d</span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure><h3 id="集合-Set"><a href="#集合-Set" class="headerlink" title="集合 Set"></a>集合 Set</h3><blockquote><p>一种 <code>无序的、不重复的、可变的</code> 的元素的集合<br>用 <code>set([ ])</code> 或 <code>&#123;key, key, ...&#125;</code> 标识</p><p>类似数学概念中的集合<br>可以通过 Dict 来理解：Set 是一种不存储 value 的 Dict（因为key不能重复）<br>是一种复合数据类型<br>Set 中的元素可以不同类型</p></blockquote><h4 id="Set索引"><a href="#Set索引" class="headerlink" title="Set索引"></a>Set索引</h4><blockquote><p>Set 是无序的，所以没有索引，只有元素，或者说只有key</p></blockquote><h4 id="初始化-3"><a href="#初始化-3" class="headerlink" title="初始化"></a>初始化</h4><blockquote><p>setName = set(key_list)<br>setName = {key1, key2, key3, …}</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s1 = <span class="built_in">set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="string">&#x27;a&#x27;</span>, (<span class="number">32</span>, <span class="string">&#x27;a&#x27;</span>, <span class="literal">False</span>), <span class="number">55</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s1</span><br><span class="line">&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">55</span>, (<span class="number">32</span>, <span class="string">&#x27;a&#x27;</span>, <span class="literal">False</span>), <span class="string">&#x27;a&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s2 = <span class="built_in">set</span>(<span class="string">&#x27;abadfgaae&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s2</span><br><span class="line">&#123;<span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;a&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s3 = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">5</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s3</span><br><span class="line">&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;</span><br></pre></td></tr></table></figure><h4 id="Set的增删改查"><a href="#Set的增删改查" class="headerlink" title="Set的增删改查"></a>Set的增删改查</h4><h5 id="增-add、update"><a href="#增-add、update" class="headerlink" title="增 add、update"></a>增 add、update</h5><blockquote><p>setName.add(key)          只能添加基本数据类型<br>setName.update(key)     可以添加基本数据类型和复合数据类型</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s3 = <span class="built_in">set</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">5</span>])</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s3.add(<span class="number">7</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s3</span><br><span class="line">&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">7</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s3.update([<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s3</span><br><span class="line">&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>&#125;</span><br></pre></td></tr></table></figure><h5 id="删除-remove、discard、pop"><a href="#删除-remove、discard、pop" class="headerlink" title="删除 remove、discard、pop"></a>删除 remove、discard、pop</h5><blockquote><p>setName.remove(key)    删除指定元素，如果元素不存在会存在错误<br>setName.discard(key)    删除指定元素，如果元素不存在不会存在错误<br>setName.pop()              随机删除一个元素</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="built_in">set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">15</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line">&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">15</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.remove(<span class="number">5</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line">&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">15</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.remove(<span class="number">20</span>)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">KeyError: <span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.discard(<span class="number">15</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line">&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">7</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.discard(<span class="number">20</span>)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.pop()</span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line">&#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">7</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.pop()</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line">&#123;<span class="number">2</span>, <span class="number">1</span>, <span class="number">7</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.pop()</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line">&#123;<span class="number">1</span>, <span class="number">7</span>&#125;</span><br></pre></td></tr></table></figure><h5 id="改-remove-add"><a href="#改-remove-add" class="headerlink" title="改 remove + add"></a>改 remove + add</h5><blockquote><p>Set 中没有改的办法，因为集合是无序的，改一个元素没有意义<br>只能删除要改的key，然后添加新的key</p><p>setName.remove(key)<br>setName.add(key)</p></blockquote><h5 id="查-2"><a href="#查-2" class="headerlink" title="查"></a>查</h5><h2 id="强制类型转换"><a href="#强制类型转换" class="headerlink" title="强制类型转换"></a>强制类型转换</h2><table><thead><tr><th align="left">函数</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">int(x [,base])</td><td align="left">将x转换为一个整数</td></tr><tr><td align="left">long(x [,base] )</td><td align="left">将x转换为一个长整数</td></tr><tr><td align="left">float(x)</td><td align="left">将x转换到一个浮点数</td></tr><tr><td align="left">complex(real [,imag])</td><td align="left">创建一个复数</td></tr><tr><td align="left">str(x)</td><td align="left">将对象 x 转换为字符串</td></tr><tr><td align="left">repr(x)</td><td align="left">将对象 x 转换为表达式字符串</td></tr><tr><td align="left">eval(str)</td><td align="left">用来计算在字符串中的有效Python表达式,并返回一个对象</td></tr><tr><td align="left">tuple(s)</td><td align="left">将序列 s 转换为一个Tuple</td></tr><tr><td align="left">list(s)</td><td align="left">将序列 s 转换为一个List</td></tr><tr><td align="left">set(s)</td><td align="left">转换为可变集合</td></tr><tr><td align="left">dict(d)</td><td align="left">创建一个Dict。d 必须是一个序列 (key,value)Tuple。</td></tr><tr><td align="left">frozenset(s)</td><td align="left">转换为不可变集合</td></tr><tr><td align="left">chr(x)</td><td align="left">将一个整数转换为一个字符</td></tr><tr><td align="left">unichr(x)</td><td align="left">将一个整数转换为Unicode字符</td></tr><tr><td align="left">ord(x)</td><td align="left">将一个字符转换为它的ASCII十进制整数值</td></tr><tr><td align="left">hex(x)</td><td align="left">将一个整数转换为一个十六进制字符串</td></tr><tr><td align="left">oct(x)</td><td align="left">将一个整数转换为一个八进制字符串</td></tr></tbody></table><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line">数字</span><br><span class="line">    整数 -<span class="number">1</span> <span class="number">0</span> <span class="number">1</span></span><br><span class="line">    浮点 -<span class="number">0.1</span> <span class="number">0.0</span> <span class="number">1.0</span></span><br><span class="line">    二进制 <span class="number">0b11</span>        结果 <span class="number">3</span></span><br><span class="line">    八进制 <span class="number">0o77</span>        结果 <span class="number">63</span></span><br><span class="line">    <span class="number">16</span>进制 <span class="number">0xFF</span>        结果 <span class="number">255</span></span><br><span class="line"> </span><br><span class="line">字符串 &lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">str</span>&#x27;&gt;</span></span><br><span class="line"><span class="class">    纯字符串 &#x27;<span class="title">str</span>&#x27; &quot;<span class="title">str</span>&quot; &#x27;&#x27;&#x27;<span class="title">str</span>&#x27;&#x27;&#x27; &quot;&quot;&quot;<span class="title">str</span>&quot;&quot;&quot;</span></span><br><span class="line"><span class="class">    字符串数字(<span class="params">二进制 0b</span>) &#x27;0<span class="title">b0</span>&#x27;     转成字符 <span class="title">str</span>(<span class="params"><span class="number">0b10</span></span>) 结果 &#x27;2&#x27;     ## 可以前置补零<span class="title">str</span>(<span class="params"><span class="number">0b00000010</span></span>)</span></span><br><span class="line"><span class="class">    字符串数字(<span class="params">八进制 0o</span>) &#x27;0<span class="title">o0</span>&#x27;     转换字符 <span class="title">str</span>(<span class="params"><span class="number">0o77</span></span>) 结果 &#x27;63&#x27;    ## 可以前置补零<span class="title">str</span>(<span class="params"><span class="number">0o0077</span></span>)</span></span><br><span class="line"><span class="class">    字符串数字(<span class="params">十进制</span>)    &#x27;0&#x27;       转换字符 <span class="title">str</span>(<span class="params"><span class="number">100</span></span>)  结果 &#x27;100&#x27;   ## 不能前置补零</span></span><br><span class="line"><span class="class">    字符串数字(<span class="params"><span class="number">16</span>进制 0x</span>) &#x27;0<span class="title">x0</span>&#x27;     转换字符 <span class="title">str</span>(<span class="params"><span class="number">0xFF</span></span>) 结果 &#x27;255&#x27;   ## 可以前置补零<span class="title">str</span>(<span class="params"><span class="number">0x00FF</span></span>)</span></span><br><span class="line"><span class="class">二进制 &lt;<span class="title">class</span> &#x27;<span class="title">bytes</span>&#x27;&gt;</span></span><br><span class="line"><span class="class">    二进制字节表示 <span class="title">b</span>&#x27;&#x27;    # <span class="title">ASCII</span> 字符 0-9 <span class="title">a</span>-<span class="title">z</span> <span class="title">A</span>-<span class="title">Z</span> 等</span></span><br></pre></td></tr></table></figure><h3 id="数字-转-字符串"><a href="#数字-转-字符串" class="headerlink" title="数字 转 字符串"></a>数字 转 字符串</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##  255(10进制)  0b11(2进制)  0xFF(16进制)</span></span><br><span class="line"><span class="comment">## (10进制数)</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">bin</span>(<span class="number">255</span>)            <span class="string">&#x27;0b11111111&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">oct</span>(<span class="number">255</span>)            <span class="string">&#x27;0o377&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>(<span class="number">255</span>)            <span class="string">&#x27;0xff&#x27;</span></span><br><span class="line"><span class="comment">## (2进制数)</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">bin</span>(<span class="number">0b11</span>)           <span class="string">&#x27;0b11&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>(<span class="number">0xFF</span>)           <span class="string">&#x27;0xff&#x27;</span></span><br><span class="line"><span class="comment">## (16进制数)</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">bin</span>(<span class="number">0xFF</span>)           <span class="string">&#x27;0b11111111&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>(<span class="number">0xFF</span>)           <span class="string">&#x27;0xff&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="字符串-转-数字（十进制数）"><a href="#字符串-转-数字（十进制数）" class="headerlink" title="字符串 转 数字（十进制数）"></a>字符串 转 数字（十进制数）</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##  &#x27;123&#x27;(以10进制解析)  &#x27;10&#x27;(以2进制解析)  &#x27;a&#x27;(以16进制解析)</span></span><br><span class="line"><span class="comment">## (10进制表示的字符串)</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">int</span>(<span class="string">&#x27;123&#x27;</span>)          <span class="number">123</span>         <span class="comment">## 十进制字符转十进制数字</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">int</span>(<span class="string">&#x27;123&#x27;</span>,<span class="number">10</span>)       <span class="number">123</span>         <span class="comment">## 默认是十进制</span></span><br><span class="line"><span class="comment">## (二进制表示的字符串)</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">int</span>(<span class="string">&#x27;100&#x27;</span>,<span class="number">2</span>)        <span class="number">4</span>           <span class="comment">## 二进制的 100 等于 十进制的 4（可以不加前置 0b）</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">int</span>(<span class="string">&#x27;0b100&#x27;</span>,<span class="number">2</span>)      <span class="number">4</span>           <span class="comment">## 二进制的 100 等于 十进制的 4</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">int</span>(<span class="string">&#x27;0b0100&#x27;</span>,<span class="number">2</span>)     <span class="number">4</span>           <span class="comment">## 可以前置补零</span></span><br><span class="line"><span class="comment">## (16进制表示的字符串)</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">int</span>(<span class="string">&#x27;a&#x27;</span>,<span class="number">16</span>)         <span class="number">10</span>          <span class="comment">## 16进制的 a 等于 十进制的 10（可以不加前置 0x）</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">int</span>(<span class="string">&#x27;0xa&#x27;</span>,<span class="number">16</span>)       <span class="number">10</span>          <span class="comment">## 16进制的 a 等于 十进制的 10</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">int</span>(<span class="string">&#x27;0x0a&#x27;</span>,<span class="number">16</span>)      <span class="number">10</span>          <span class="comment">## 16进制的 a 等于 十进制的 10（可以前置补零）</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">int</span>(<span class="string">&#x27;10&#x27;</span>,<span class="number">16</span>)        <span class="number">16</span>          <span class="comment">## 16进制的10 等于 十进制的 16（可以不加前置 0x）</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">int</span>(<span class="string">&#x27;0x10&#x27;</span>,<span class="number">16</span>)      <span class="number">16</span>          <span class="comment">## 16进制的10 等于 十进制的 16</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">int</span>(<span class="string">&#x27;0x0010&#x27;</span>,<span class="number">16</span>)    <span class="number">16</span>          <span class="comment">## 16进制的10 等于 十进制的 16（可以前置补零）</span></span><br></pre></td></tr></table></figure><h3 id="数字-转-数字"><a href="#数字-转-数字" class="headerlink" title="数字 转 数字"></a>数字 转 数字</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##  0b11  0xFF</span></span><br><span class="line"><span class="comment">## 十进制 转 十进制</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">int</span>(<span class="number">255</span>)            <span class="number">255</span>         <span class="comment"># 无意义操作</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">255</span>                 <span class="number">255</span>         <span class="comment"># 无意义操作</span></span><br><span class="line"><span class="comment">## 二进制 转 十进制</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">int</span>(<span class="number">0b11</span>)           <span class="number">3</span>           <span class="comment"># 可加前置零 int(0b0011)</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">0b11111111</span>          <span class="number">255</span>         <span class="comment"># 等价</span></span><br><span class="line"><span class="comment">## 16进制 转 十进制</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">int</span>(<span class="number">0xFF</span>)           <span class="number">255</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">0xff</span>                <span class="number">255</span>         <span class="comment"># 等价 且 忽略大小写</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">0xFF</span>                <span class="number">255</span>         <span class="comment"># 等价 且 忽略大小写</span></span><br><span class="line"><span class="comment">## 十进制 转 二进制（使用 数字 转 字节码/字符）</span></span><br><span class="line"><span class="number">255</span> 等价 <span class="number">0b11111111</span></span><br><span class="line"><span class="comment">## 十进制 转 16进制（使用 数字 转 字节码/字符）</span></span><br><span class="line"><span class="number">255</span> 等价 <span class="number">0xff</span></span><br></pre></td></tr></table></figure><h3 id="字符串-转-字节码"><a href="#字符串-转-字节码" class="headerlink" title="字符串 转 字节码"></a>字符串 转 字节码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">bytes</span>(<span class="string">&#x27;abc&#x27;</span>,<span class="string">&#x27;utf-8&#x27;</span>)              <span class="string">b&#x27;abc&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">bytes</span>(<span class="string">&#x27;编程&#x27;</span>,<span class="string">&#x27;utf-8&#x27;</span>)             <span class="string">b&#x27;\xe7\xbc\x96\xe7\xa8\x8b&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">bytes</span>(<span class="string">&#x27;Python3编程&#x27;</span>,<span class="string">&#x27;utf-8&#x27;</span>)      <span class="string">b&#x27;Python3\xe7\xbc\x96\xe7\xa8\x8b&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;Python3编程&#x27;</span>.encode(<span class="string">&#x27;UTF-8&#x27;</span>)     <span class="string">b&#x27;Python3\xe7\xbc\x96\xe7\xa8\x8b&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>S = <span class="string">&#x27;Python3编程&#x27;</span>                 <span class="string">&#x27;Python3编程&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>B = <span class="built_in">bytes</span>(S,<span class="string">&#x27;utf-8&#x27;</span>)              <span class="string">b&#x27;Python3\xe7\xbc\x96\xe7\xa8\x8b&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>FMT = <span class="built_in">str</span>(<span class="built_in">len</span>(B)) + <span class="string">&#x27;s&#x27;</span>           <span class="string">&#x27;13s&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>struct.pack(FMT,B)                <span class="string">b&#x27;Python3\xe7\xbc\x96\xe7\xa8\x8b&#x27;</span></span><br><span class="line"><span class="comment">## 以16进制数字写的字符串，直接转成一样的字节码（2个16进制字符才是一个字节）</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;01&#x27;</span>)               <span class="string">b&#x27;\x01&#x27;</span>                       <span class="comment"># 单字节</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;0001&#x27;</span>)             <span class="string">b&#x27;\x00\x01&#x27;</span>                   <span class="comment"># 双字节</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;aabbccddeeff&#x27;</span>)     <span class="string">b&#x27;\xaa\xbb\xcc\xdd\xee\xff&#x27;</span>   <span class="comment"># 多字节</span></span><br></pre></td></tr></table></figure><h3 id="字节码-转-字符串"><a href="#字节码-转-字符串" class="headerlink" title="字节码 转 字符串"></a>字节码 转 字符串</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##  取出16进制表示的内容</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">b&#x27;abc&#x27;</span>.decode(<span class="string">&#x27;UTF-8&#x27;</span>)                                  <span class="string">&#x27;abc&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">b&#x27;Python3\xe7\xbc\x96\xe7\xa8\x8b&#x27;</span>.decode(<span class="string">&#x27;UTF-8&#x27;</span>)      <span class="string">&#x27;Python3编程&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">b&#x27;\xaa\xbb\xcc\xdd\xee\xff&#x27;</span>.<span class="built_in">hex</span>()                       <span class="string">&#x27;aabbccddeeff&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">b&#x27;0&#x27;</span>.<span class="built_in">hex</span>()                                              <span class="string">&#x27;30&#x27;</span>    <span class="comment">## 字符0在ASCII码上的数字（数字是16进制表示）== 48（十进制）</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">b&#x27;1&#x27;</span>.<span class="built_in">hex</span>()                                              <span class="string">&#x27;31&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">b&#x27;z&#x27;</span>.<span class="built_in">hex</span>()                                              <span class="string">&#x27;7a&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="数字-转-字节码（是二进制，用16进制显示）"><a href="#数字-转-字节码（是二进制，用16进制显示）" class="headerlink" title="数字 转 字节码（是二进制，用16进制显示）"></a>数字 转 字节码（是二进制，用16进制显示）</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 10进制数 转 字节码</span></span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>struct.pack(<span class="string">&#x27;B&#x27;</span>,<span class="number">0</span>)          <span class="string">b&#x27;\x00&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>struct.pack(<span class="string">&#x27;B&#x27;</span>,<span class="number">1</span>)          <span class="string">b&#x27;\x01&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>struct.pack(<span class="string">&#x27;B&#x27;</span>,<span class="number">101</span>)        <span class="string">b&#x27;e&#x27;</span>                    <span class="comment">## 101 对应 16进制的 0x65（此处返回值是显示为当前整数 101 对应的 ASCII字符 e）</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>struct.pack(<span class="string">&#x27;B&#x27;</span>,<span class="number">255</span>)        <span class="string">b&#x27;\xff&#x27;</span>                 <span class="comment"># 无符号最大单字符可以表示的数字</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>struct.pack(<span class="string">&#x27;&gt;i&#x27;</span>,<span class="number">255</span>)       <span class="string">b&#x27;\x00\x00\x00\xff&#x27;</span>     <span class="comment"># 4字节大端表示的数字</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>struct.pack(<span class="string">&#x27;&lt;i&#x27;</span>,<span class="number">255</span>)       <span class="string">b&#x27;\xff\x00\x00\x00&#x27;</span>     <span class="comment"># 4字节小端表示的数字</span></span><br><span class="line"><span class="comment"># 2进制数 转 字节码</span></span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>struct.pack(<span class="string">&#x27;B&#x27;</span>,<span class="number">0b11111111</span>)     <span class="string">b&#x27;\xff&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>struct.pack(<span class="string">&#x27;&gt;i&#x27;</span>,<span class="number">0b111</span>)         <span class="string">b&#x27;\x00\x00\x00\x07&#x27;</span>     <span class="comment"># 0b111 等于 7（10进制）</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>struct.pack(<span class="string">&#x27;&gt;i&#x27;</span>,<span class="number">0b1111</span>)        <span class="string">b&#x27;\x00\x00\x00\x0f&#x27;</span>     <span class="comment"># 0b1111 等于 15（10进制）</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>struct.pack(<span class="string">&#x27;&gt;i&#x27;</span>,<span class="number">0b11111</span>)       <span class="string">b&#x27;\x00\x00\x00\x1f&#x27;</span>     <span class="comment"># 0b11111 等于 31（10进制）</span></span><br><span class="line"><span class="comment"># 16进制数 转 字节码</span></span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>struct.pack(<span class="string">&#x27;B&#x27;</span>,<span class="number">0xff</span>)           <span class="string">b&#x27;\xff&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>struct.pack(<span class="string">&#x27;&gt;i&#x27;</span>,<span class="number">0xfff</span>)         <span class="string">b&#x27;\x00\x00\x0f\xff&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="字节码-转-数字"><a href="#字节码-转-数字" class="headerlink" title="字节码 转 数字"></a>字节码 转 数字</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> struct          <span class="number">16</span>进制表现                <span class="number">10</span>进制等值</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>struct.unpack(<span class="string">&#x27;B&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>)                      (<span class="number">255</span>,)          <span class="comment"># 单字节</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>struct.unpack(<span class="string">&#x27;&gt;i&#x27;</span>, <span class="string">b&#x27;\x00\x00\x00\xff&#x27;</span>)         (<span class="number">255</span>,)          <span class="comment"># 4字节，大端模式</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>struct.unpack(<span class="string">&#x27;&lt;i&#x27;</span>, <span class="string">b&#x27;\x00\x00\x00\xff&#x27;</span>)         (-<span class="number">16777216</span>,)    <span class="comment"># 4字节，小端模式</span></span><br><span class="line"><span class="comment">## 手动 转换</span></span><br><span class="line">字节码 -&gt; 字符串</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>B = <span class="string">b&#x27;\xe9&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>S = B.<span class="built_in">hex</span>()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>S                                               <span class="comment"># 值 &#x27;e9&#x27;</span></span><br><span class="line">字符串（<span class="number">16</span>进制格式）-&gt; 数字（<span class="number">10</span>进制）</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">int</span>(S,<span class="number">16</span>)                                       <span class="comment"># 值 233</span></span><br></pre></td></tr></table></figure><h3 id="ASCII-字符-和-数字"><a href="#ASCII-字符-和-数字" class="headerlink" title="ASCII 字符 和 数字"></a>ASCII 字符 和 数字</h3><p>字节    b’\x05’<br>字符串   ‘\x05’<br>将一个整数 (0-1114111) 转换为 一个字符（整数对应的 ASCII 字符）<br>ValueError: chr() arg not in range(0x110000)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">chr</span>(<span class="number">0</span>)                  <span class="string">&#x27;\x00&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">chr</span>(<span class="number">1</span>)                  <span class="string">&#x27;\x01&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">chr</span>(<span class="number">97</span>)                 <span class="string">&#x27;a&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">chr</span>(<span class="number">1114111</span>)            <span class="string">&#x27;\U0010ffff&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(<span class="built_in">chr</span>(<span class="number">101</span>))           <span class="number">1</span>  <span class="comment"># 长度为 1个字符</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(<span class="built_in">chr</span>(<span class="number">1114111</span>))       <span class="number">1</span>  <span class="comment"># 长度为 1个字符</span></span><br></pre></td></tr></table></figure><h3 id="将一个-ASCII字符-转换为-一个整数"><a href="#将一个-ASCII字符-转换为-一个整数" class="headerlink" title="将一个 ASCII字符 转换为 一个整数"></a>将一个 ASCII字符 转换为 一个整数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">ord</span>(<span class="string">&#x27;\x00&#x27;</span>)             <span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">ord</span>(<span class="string">&#x27;\x01&#x27;</span>)             <span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>)                <span class="number">97</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">ord</span>(<span class="string">&#x27;0&#x27;</span>)                <span class="number">48</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">ord</span>(<span class="string">&#x27;1&#x27;</span>)                <span class="number">49</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>)                <span class="number">65</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">ord</span>(<span class="string">&#x27;Z&#x27;</span>)                <span class="number">90</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">ord</span>(<span class="string">&#x27;\U0010ffff&#x27;</span>)       <span class="number">1114111</span></span><br></pre></td></tr></table></figure><h3 id="ASCII-字符-和-bin-字节"><a href="#ASCII-字符-和-bin-字节" class="headerlink" title="ASCII 字符 和 bin(字节)"></a>ASCII 字符 和 bin(字节)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> b2a_hex, a2b_hex</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a2b_hex(<span class="string">&#x27;ab&#x27;</span>)</span><br><span class="line"><span class="string">b&#x27;\xab&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b2a_hex(<span class="string">b&#x27;ab&#x27;</span>)</span><br><span class="line"><span class="string">b&#x27;6162&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a2b_hex(<span class="string">b&#x27;6162&#x27;</span>)</span><br><span class="line"><span class="string">b&#x27;ab&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="总结-摘自-羋虹光"><a href="#总结-摘自-羋虹光" class="headerlink" title="总结 (摘自 羋虹光)"></a>总结 (摘自 <a href="https://www.jianshu.com/p/b3157c9751d0">羋虹光</a>)</h2><h3 id="int-类型解析"><a href="#int-类型解析" class="headerlink" title="int 类型解析"></a>int 类型解析</h3><p>较小的整数会很频繁的被使用，所以python将这些对象放置到了一个池子中，每次需要这些对象的时候就到池子中获取这个值，避免多次的重复创建对象引起的许多不必要的开销。这个池子内的数字范围是[-5, 257), 所以都是从池子里面取值，自然id不变。</p><h3 id="float类型解析"><a href="#float类型解析" class="headerlink" title="float类型解析"></a>float类型解析</h3><p>对于float类型的使用自然没有int那么频繁，并且float类型也不好定义哪些常用，也就没有池子给到这个类型，所以每次重新创建即可。</p><h3 id="tuple类型解析"><a href="#tuple类型解析" class="headerlink" title="tuple类型解析"></a>tuple类型解析</h3><p>对于tuple类型，与float类型的思维相似，所以也是每次重新创建。</p><h3 id="string类型解析"><a href="#string类型解析" class="headerlink" title="string类型解析"></a>string类型解析</h3><p>单词类型的str由于被重复使用的概率比较大，所以在python中为单词类型的str做了一个缓存，也就是说如果是单词类型的str， 会被存储到一个字典(dict)中，字典的内容是字符串为key， 地址为value。当有一个字符串需要创建，就先去访问这个字典，如果存在则返回字典中字符串的地址，如果不存在，则返回新创建的地址，并将这个字符串添加进入字典。这是字符串的intern机制。</p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
          <category> 基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python【No-3】判断和循环</title>
      <link href="posts/6930"/>
      <url>posts/6930</url>
      
        <content type="html"><![CDATA[<p>程序结构：判断与循环</p><span id="more"></span><h1 id="Judgment-amp-circulation"><a href="#Judgment-amp-circulation" class="headerlink" title="Judgment&amp;circulation"></a>Judgment&amp;circulation</h1><blockquote><p><strong>！！不要用浮点数比较相等！！</strong></p></blockquote><h2 id="判断"><a href="#判断" class="headerlink" title="判断"></a>判断</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> condition:</span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line"><span class="keyword">elif</span> condition:</span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>()</span><br></pre></td></tr></table></figure><p>例如</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">age = <span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> age &gt; = <span class="number">6</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;teenager&#x27;</span>)</span><br><span class="line"><span class="keyword">elif</span> age &gt;= <span class="number">18</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;adult&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;kid&#x27;</span>)</span><br></pre></td></tr></table></figure><p>还可以简写</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> x:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;True&#x27;</span>)</span><br><span class="line"></span><br><span class="line">或</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> x: <span class="built_in">print</span>(<span class="string">&#x27;True&#x27;</span>)</span><br></pre></td></tr></table></figure><p><strong>只要 x 是非零数值、非空字符串、非空list、非空tuple，也不是None，就判断为True，否则为False</strong></p><h2 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h2><h3 id="for"><a href="#for" class="headerlink" title="for"></a>for</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> Iterable:</span><br><span class="line">   do sth</span><br></pre></td></tr></table></figure><p>例如</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Li = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line"><span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> Li:</span><br><span class="line">    <span class="built_in">sum</span> += x</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">sum</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 21</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>]:</span><br><span class="line">    <span class="built_in">sum</span> = <span class="built_in">sum</span> + x</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">sum</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#55</span></span><br></pre></td></tr></table></figure><h3 id="range"><a href="#range" class="headerlink" title="range()"></a>range()</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">range</span>(<span class="number">5</span>)</span><br><span class="line"><span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">5</span>))</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从1加到100</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">101</span>):</span><br><span class="line">    <span class="built_in">sum</span> = <span class="built_in">sum</span> + x</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">sum</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5050</span></span><br></pre></td></tr></table></figure><h3 id="while"><a href="#while" class="headerlink" title="while"></a>while</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> condition:</span><br><span class="line">    do sth</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line">n = <span class="number">99</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">    <span class="built_in">sum</span> = <span class="built_in">sum</span> + n</span><br><span class="line">    n = n - <span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">sum</span>)</span><br></pre></td></tr></table></figure><h3 id="break"><a href="#break" class="headerlink" title="break"></a>break</h3><blockquote><p>跳出整个循环，且不执行else子句</p></blockquote><h3 id="continue"><a href="#continue" class="headerlink" title="continue"></a>continue</h3><blockquote><p>跳出本次循环</p></blockquote><h3 id="else"><a href="#else" class="headerlink" title="else"></a>else</h3><blockquote><p>else 子句会在循环不满足条件退出时执行<br>但如果 break 跳出循环时，不会执行else子句</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line">n = <span class="number">99</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">    <span class="built_in">sum</span> = <span class="built_in">sum</span> + n</span><br><span class="line">    n = n - <span class="number">2</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;else&#x27;</span>)    <span class="comment"># 循环结束后会执行这句话</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">sum</span>)</span><br><span class="line"></span><br><span class="line">---------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="number">2500</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line">n = <span class="number">99</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">    <span class="built_in">sum</span> = <span class="built_in">sum</span> + n</span><br><span class="line">    n = n - <span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">10</span>:</span><br><span class="line">        <span class="keyword">break</span>   <span class="comment"># n 小于 10的时候会跳出循环，并且不会执行 else 子句</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;else&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">sum</span>)</span><br><span class="line"></span><br><span class="line">---------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line"><span class="number">2475</span></span><br></pre></td></tr></table></figure><h3 id="pass"><a href="#pass" class="headerlink" title="pass"></a>pass</h3><blockquote><p>pass 语句什么也不做。当语法上需要一个语句，但程序需要什么动作也不做时，可以使用它。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">pass</span>  <span class="comment"># Busy-wait for keyboard interrupt (Ctrl+C)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">MyEmptyClass</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">initlog</span>(<span class="params">*args</span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">pass</span>   <span class="comment"># Remember to implement this!</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
          <category> 基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python【No-2】基础</title>
      <link href="posts/38014"/>
      <url>posts/38014</url>
      
        <content type="html"><![CDATA[<p>Python 基础知识</p><span id="more"></span><h2 id="输入-amp-输出"><a href="#输入-amp-输出" class="headerlink" title="输入 &amp; 输出"></a>输入 &amp; 输出</h2><h3 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h3><blockquote><p>print(‘输出内容’)</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="number">300</span>)                         <span class="comment"># 300</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="number">100</span> + <span class="number">200</span>)                   <span class="comment"># 300</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="string">&#x27;100 + 200 =&#x27;</span>, <span class="number">100</span> + <span class="number">200</span>)    <span class="comment"># 100 + 200 = 300</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="string">&#x27;Hello World!&#x27;</span>)              <span class="comment"># Hello World!</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="string">&#x27;The quick&#x27;</span>, <span class="string">&#x27;brown for&#x27;</span>, <span class="string">&#x27;jumps over.&#x27;</span>)    <span class="comment"># The quick brown for jumps over.</span></span><br></pre></td></tr></table></figure><h3 id="输入"><a href="#输入" class="headerlink" title="输入"></a>输入</h3><blockquote><p>承接变量 = input(‘提示信息’)</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>name = <span class="built_in">input</span>()</span><br><span class="line">Boii</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>name</span><br><span class="line"><span class="string">&#x27;Boii&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(name)</span><br><span class="line">Boii</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># name.py</span><br><span class="line"></span><br><span class="line">name = input(&#x27;Please enter your name:&#x27;)</span><br><span class="line">print(&#x27;Hello&#x27;, name)</span><br></pre></td></tr></table></figure><p><code>&gt;_:  python name.py</code></p><blockquote><p>Please enter your name: Boii<br>Hello Boii</p></blockquote><h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><blockquote><ol><li>大小写英文、数字、下划线_</li><li>不能数字开头</li><li>大小写敏感</li><li>不能用关键字</li><li>不需要声明类型</li></ol></blockquote><blockquote><ol start="6"><li>简洁明了，信达雅原则。变量名用名词，函数名方法名用动词</li><li>由于python是动态语言，不需要声明类型，所以命名尽量体现类型或用前缀体现。如 i_age, fPrice, b_flag</li><li>慎用字母O和I</li></ol></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">1</span>        <span class="comment"># a是一个整型</span></span><br><span class="line">b = <span class="number">1.0</span>      <span class="comment"># b是一个浮点型</span></span><br><span class="line">c = <span class="string">&#x27;abc&#x27;</span>    <span class="comment"># c是一个字符串</span></span><br><span class="line">d = <span class="literal">True</span>     <span class="comment"># d是一个布尔值</span></span><br><span class="line">e = <span class="literal">None</span>     <span class="comment"># e是一个空值</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 多个变量同时赋值</span></span><br><span class="line"></span><br><span class="line">a = b = c = <span class="number">1</span></span><br><span class="line"><span class="comment"># 以上语句, 内存中会创建一个空间,值为1; 再创建三个空间a, b, c, 存放1的地址，即指向1那块内存</span></span><br><span class="line"></span><br><span class="line">x, y, z = <span class="number">1</span>, <span class="number">2</span>, <span class="string">&quot;Boii&quot;</span></span><br><span class="line"><span class="comment"># 以上语句, x为1, y为2, z为Boii</span></span><br></pre></td></tr></table></figure><h3 id="变量实际上是指向"><a href="#变量实际上是指向" class="headerlink" title="变量实际上是指向"></a>变量实际上是指向</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="string">&#x27;ABC&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = a</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="string">&#x27;XYZ&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(b)</span><br><span class="line">ABC</span><br></pre></td></tr></table></figure><p><code>a = &#39;ABC&#39;</code></p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/2-1.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/2-1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="1"></p><p><code>b = a</code></p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/2-2.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/2-2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2"></p><p><code>a = &#39;XYZ&#39;</code></p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/2-3.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/2-3.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2"></p><h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><p><a href="https://tcp404.com/2020/07/09/Python%E3%80%90No-4%E3%80%91%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/">数据类型.md</a></p><h2 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h2><p><a href="https://tcp404.com/2020/07/10/Python%E3%80%90No-5%E3%80%91%E8%BF%90%E7%AE%97%E7%AC%A6/">运算符</a></p><h2 id="缩进"><a href="#缩进" class="headerlink" title="缩进"></a>缩进</h2><p>Python以缩进来区分代码块。连续的相同缩进视为同一代码块，同一作用域，如同C中的花括号。</p><blockquote><p>按照约定俗成，4个空格为一个缩进。在IDE中最好设置好tab自动转换为4个空格</p></blockquote><h3 id="多行语句"><a href="#多行语句" class="headerlink" title="多行语句"></a>多行语句</h3><p>如果一个语句太长，可以使用 <code>\</code> 声明此语句未结束</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">total = item_one + \</span><br><span class="line">        item_two + \</span><br><span class="line">        item_three</span><br></pre></td></tr></table></figure><h2 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 这是单行注释</span><br><span class="line"></span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">这是多行注释，使用单引号</span><br><span class="line">这是多行注释，使用单引号</span><br><span class="line">这是多行注释，使用单引号</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">这是多行注释，使用双引号</span><br><span class="line">这是多行注释，使用双引号</span><br><span class="line">这是多行注释，使用双引号</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
          <category> 基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python【No-1】总叙</title>
      <link href="posts/15463"/>
      <url>posts/15463</url>
      
        <content type="html"><![CDATA[<p>关于Python</p><span id="more"></span><ul><li><p>语言哲学： 简洁</p></li><li><p>类型：解释型语言、动态语言、面向对象（一切皆对象）</p></li><li><p>缺点：</p><ol><li>速度慢</li><li>代码不能加密</li></ol></li><li><p>语言思想：</p><ol><li>一切皆对象</li><li>函数是一等公民</li></ol></li></ul><h2 id="解释器"><a href="#解释器" class="headerlink" title="解释器"></a>解释器</h2><h3 id="CPython"><a href="#CPython" class="headerlink" title="CPython"></a>CPython</h3><blockquote><p>默认解释器。</p></blockquote><h3 id="PyPy"><a href="#PyPy" class="headerlink" title="PyPy"></a>PyPy</h3><blockquote><p>目标是执行速度，采用JIT技术，对python代码进行动编译。<br>但是与CPython不同。 <a href="http://pypy.readthedocs.org/en/latest/cpython_differences.html">PyPy VS CPython</a></p></blockquote><h3 id="Jython"><a href="#Jython" class="headerlink" title="Jython"></a>Jython</h3><blockquote><p>Jython是运行在Java平台上的Python解释器，可以直接把Python代码编译成Java字节码执行。</p></blockquote><h3 id="IronPython"><a href="#IronPython" class="headerlink" title="IronPython"></a>IronPython</h3><blockquote><p>IronPython和Jython类似，只不过IronPython是运行在微软.Net平台上的Python解释器，可以直接把Python代码编译成.Net的字节码。</p></blockquote><h2 id="命令行模式-amp-交互模式"><a href="#命令行模式-amp-交互模式" class="headerlink" title="命令行模式 &amp; 交互模式"></a>命令行模式 &amp; 交互模式</h2><h3 id="命令行模式"><a href="#命令行模式" class="headerlink" title="命令行模式"></a>命令行模式</h3><p>┌──────────────────────────────────────┐<br>│Command Prompt                                               - □ x │<br>├──────────────────────────────────────┤<br>│Microsoft Windows [Version 10.0.0]                              │<br>│(c) 2015 Microsoft Corporation. All rights reserved.       │<br>│                                                                                    │<br>│C:&gt; _                                                                           │<br>│                                                                                    │<br>└──────────────────────────────────────┘</p><blockquote><p>可以切换到文件所在目录下，然后输入 <code>python 文件名.py</code> 来执行python文件</p></blockquote><h3 id="Python交互模式"><a href="#Python交互模式" class="headerlink" title="Python交互模式"></a>Python交互模式</h3><p>┌────────────────────────────────────────┐<br>│Command Prompt - python                                     - □ x │<br>├────────────────────────────────────────┤<br>│Microsoft Windows [Version 10.0.0]                                  │<br>│(c) 2015 Microsoft Corporation. All rights reserved.           │<br>│                                                                                        │<br>│C:&gt; python                                                                     │<br>│Python 3.7 … on win32                                                     │<br>│Type “help”, … for more information.                                │<br>│&gt;&gt;&gt; 100 + 200                                                                │<br>│300                                                                                  │<br>│&gt;&gt;&gt; _                                                                              │<br>│                                                                                        │<br>└────────────────────────────────────────┘</p><blockquote><p>输入 <code>python</code> 进入交互模式， 输入 <code>exit()</code> 或 <code>quit()</code> 退出交互模式</p></blockquote><h3 id="文件名"><a href="#文件名" class="headerlink" title="文件名"></a>文件名</h3><ul><li>扩展名：.py</li><li>文件名：英文字母、数字、下划线</li></ul><h2 id="直接运行-py文件"><a href="#直接运行-py文件" class="headerlink" title="直接运行.py文件"></a>直接运行.py文件</h2><ul><li><input disabled="" type="checkbox"> Win</li><li><input checked="" disabled="" type="checkbox"> Linux</li><li><input checked="" disabled="" type="checkbox"> Mac</li></ul><p>前提：</p><blockquote><ol><li> 在hello.py文件的第一行加上一个特殊的注释 <code>#!/usr/bin/env python3</code> ， 如<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Hello World!&quot;</span>)</span><br></pre></td></tr></table></figure></li><li> 通过命令给hello.py文件执行权限<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> chmod a+x hello.py</span></span><br></pre></td></tr></table></figure></li></ol></blockquote><h2 id="中文编码"><a href="#中文编码" class="headerlink" title="中文编码"></a>中文编码</h2><blockquote><p>Python2 默认编码格式是：ASCII，使用中文会出错<br>解决方法：在文件开头加入 <code># -*- coding: UTF-8 -*-</code> 或 <code># coding=utf-8</code></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;放码过来&quot;</span>)</span><br></pre></td></tr></table></figure><blockquote><p>Python3 默认编码格式是：UTF-8，所以无需指定编码格式<br>注意：py文件需要存储格式为 UTF-8</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;放码过来&quot;</span>)</span><br></pre></td></tr></table></figure><p>但最好还是加上</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;放码过来&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="python的一切皆对象"><a href="#python的一切皆对象" class="headerlink" title="python的一切皆对象"></a>python的一切皆对象</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 示例如下</span></span><br><span class="line">a=<span class="number">2019</span></span><br><span class="line">b=<span class="string">&quot;一切皆对象&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(<span class="number">2019</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(<span class="built_in">int</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(b))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(<span class="built_in">str</span>))</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">stu = Student()</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(stu))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(Student))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">int</span>.__bases__)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">str</span>.__bases__)</span><br><span class="line"><span class="built_in">print</span>(Student.__bases__)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>.__bases__)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">object</span>.__bases__)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(<span class="built_in">object</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(<span class="built_in">type</span>))</span><br></pre></td></tr></table></figure><p>运行结果：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">int</span>&#x27;&gt; # 2019是由<span class="title">int</span>这个类创建的实例</span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> &#x27;<span class="title">type</span>&#x27;&gt; # <span class="title">int</span>这个类是由<span class="title">type</span>这个类创建的实例</span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> &#x27;<span class="title">str</span>&#x27;&gt; # 同上</span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> &#x27;<span class="title">type</span>&#x27;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> &#x27;<span class="title">__main__</span>.<span class="title">Student</span>&#x27;&gt;   # <span class="title">stu</span>是类<span class="title">Student</span>创建的实例</span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> &#x27;<span class="title">type</span>&#x27;&gt; # 类<span class="title">Student</span>是由<span class="title">type</span>这个类创建的实例</span></span><br><span class="line"><span class="class">(<span class="params">&lt;<span class="keyword">class</span> <span class="string">&#x27;object&#x27;</span>&gt;,</span>) # 类<span class="title">int</span>的基类是<span class="title">object</span>这个类</span></span><br><span class="line"><span class="class">(<span class="params">&lt;<span class="keyword">class</span> <span class="string">&#x27;object&#x27;</span>&gt;,</span>) # 同上</span></span><br><span class="line"><span class="class">(<span class="params">&lt;<span class="keyword">class</span> <span class="string">&#x27;object&#x27;</span>&gt;,</span>) # 同上</span></span><br><span class="line"><span class="class">(<span class="params">&lt;<span class="keyword">class</span> <span class="string">&#x27;object&#x27;</span>&gt;,</span>) # 重点：类<span class="title">type</span>的基类也是<span class="title">object</span>这个基类</span></span><br><span class="line"><span class="class">() # 重点：类<span class="title">object</span>没有基类</span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> &#x27;<span class="title">type</span>&#x27;&gt; # 难点：类<span class="title">object</span>是由类<span class="title">type</span>创建的实例</span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> &#x27;<span class="title">type</span>&#x27;&gt; # 难点：类<span class="title">type</span>是由<span class="title">type</span>类自身创建的实例</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/1-1-%E4%B8%80%E5%88%87%E7%9A%86%E5%AF%B9%E8%B1%A1.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Py/1-1-%E4%B8%80%E5%88%87%E7%9A%86%E5%AF%B9%E8%B1%A1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="一切皆对象"></p><p>对于上面图片的解读如下：</p><ol><li>object是一切对象：list、str、dict、tuple的基类，同时object是type的实例</li><li>类type是自身的实例，同时type也继承自object类</li><li>由结论1和结论2，得出一切皆对象，同时一切皆继承自object类</li></ol><p><code>类object</code>是一切对象的基类<br><code>类object</code>是<code>类type</code>的实例</p><p><code>类type</code>继承自<code>类object</code><br><code>类type</code>是<code>类type</code>的实例</p><p>一切皆对象，一切皆继承自object类</p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
          <category> 基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VUE-note-day2</title>
      <link href="posts/37390"/>
      <url>posts/37390</url>
      
        <content type="html"><![CDATA[<p>Vue 的细节是真的多.</p><span id="more"></span><h2 id="v-text"><a href="#v-text" class="headerlink" title="v-text"></a>v-text</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;msg&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span> 等价于 <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-text</span>=<span class="string">&quot;msg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="javascript">            <span class="attr">msg</span>: <span class="string">&#x27;Hello World !&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    &#125;);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p> // 显示结果 ==&gt;&gt;</p><p>Hello World 等价于 Hello World.</p><h2 id="v-once"><a href="#v-once" class="headerlink" title="v-once"></a>v-once</h2><blockquote><p>形式: v-once</p><p>值: 无</p><p>作用: 限定所在元素只被渲染一次, 完成后即使值更新了也不再渲染</p></blockquote><p>不管是用 v-text = “msg” 还是用  都会实时的更新,也就是当msg 的值改变的时候, 显示的结果也会改变.</p><p>如果只想渲染一次, 可以加上v-once</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;msg&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span> 不等价于 <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-text</span>=<span class="string">&quot;msg&quot;</span> <span class="attr">v-once</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="javascript">            <span class="attr">msg</span>: <span class="string">&#x27;Hello World !&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    &#125;);</span></span><br><span class="line"><span class="javascript">    </span></span><br><span class="line"><span class="javascript">    app.msg = <span class="string">&quot;Hello&quot;</span></span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>显示结果 ==&gt;&gt;</p><p>Hello World 不等价于 Hello</p><h2 id="v-html"><a href="#v-html" class="headerlink" title="v-html"></a>v-html</h2><blockquote><p>形式: v-html = “variable”</p><p>值: variable -&gt; string, 取自于data{} 里的属性</p><p>! WARN:  容易导致<a href="https://en.wikipedia.org/wiki/Cross-site_scripting">XSS攻击</a>. 所以, 只在可信内容上使用. <strong>永不</strong>用在用户提交的内容上。</p><p>作用: 更新元素的innerHTML. 内容按普通的HTML插入, 不会被编译</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-html</span>=<span class="string">&quot;dodo&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="javascript">            <span class="attr">dodo</span>: <span class="string">&#x27;&lt;h2&gt;Hello&lt;/h2&gt;&#x27;</span></span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    &#125;);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 渲染结果 =&gt;&gt; --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-html</span>=<span class="string">&quot;dodo&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--显示结果 ==&gt;&gt; --&gt;</span></span><br><span class="line">Hello</span><br></pre></td></tr></table></figure><h2 id="v-on"><a href="#v-on" class="headerlink" title="v-on"></a>v-on</h2><blockquote><p>形式： v-on:event[.qualifier] = “Function | Inline statements | Object”</p><p>缩写： @event[.qualifier] = “Function | Inline statements | Object”</p><p>值： </p><ul><li>event -&gt; 要监听的事件， 如click， keyup等</li><li>qualifier -&gt; 修饰符，监听事件做一些限定</li><li>methods -&gt; 当所监听的事件触发时的响应方法</li><li>Inline statements -&gt; 内联语句</li><li>Object -&gt; [2.4.0]新增，使用键值对对象作为响应事件，但是不支持任何修饰器</li></ul><p>作用： 绑定监听事件。事件类型由event参数指定，</p><p>修饰符：</p><ul><li><code>.stop</code> - 调用 <code>event.stopPropagation()</code>。</li><li><code>.prevent</code> - 调用 <code>event.preventDefault()</code>。</li><li><code>.capture</code> - 添加事件侦听器时使用 capture 模式。</li><li><code>.self</code> - 只当事件是从侦听器绑定的元素本身触发时才触发回调。</li><li><code>.&#123;keyCode | keyAlias&#125;</code> - 只当事件是从特定键触发时才触发回调。</li><li><code>.native</code> - 监听组件根元素的原生事件。</li><li><code>.once</code> - 只触发一次回调。</li><li><code>.left</code> - (2.2.0) 只当点击鼠标左键时触发。</li><li><code>.right</code> - (2.2.0) 只当点击鼠标右键时触发。</li><li><code>.middle</code> - (2.2.0) 只当点击鼠标中键时触发。</li><li><code>.passive</code> - (2.3.0) 以 <code>&#123; passive: true &#125;</code> 模式添加侦听器</li></ul></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--方法处理器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:click</span>=<span class="string">&quot;Function1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 动态事件（2.6.0+） --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:</span>[<span class="attr">event</span>]=<span class="string">&quot;dosth&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 内联语句 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:click</span>=<span class="string">&quot;dosth(&#x27;hello&#x27;, $event)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 缩写 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;dosth&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 停止冒泡 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click.stop</span>=<span class="string">&quot;dosth&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 阻止默认行为 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click.prevent</span>=<span class="string">&quot;dosth&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 没有表达式的阻止默认行为 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> @<span class="attr">click.prevent</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 串联修饰符 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click.stop.prevent</span>=<span class="string">&quot;dosth&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 键修饰符.键名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">keyup.enter</span>=<span class="string">&quot;onEnter&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 键修饰符.键码 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">keyup.13</span>=<span class="string">&quot;onEnter&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 点击回调只触发一次 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click.once</span>=<span class="string">&quot;dosth&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 对象语法（2.4.0+） --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on</span>=<span class="string">&quot;&#123;keyup: dosthA, keydown: dosthB&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="v-bind"><a href="#v-bind" class="headerlink" title="v-bind"></a>v-bind</h2><blockquote><p>形式： v-bind:AttributeOrProperty[.qualifier] = “value”</p><p>缩写： :AttributeOrProperty=”value”</p><p>值：</p><ul><li>AttributeOrProperty -&gt; 标签的原生属性或特性</li><li>value -&gt; 标签原生属性所对应的值</li></ul><p>作用：将属性或特性与变量绑定在一起，实现动态修改</p><p>修饰符：</p><ul><li><code>.prop</code> - 作为一个 DOM property 绑定而不是作为 attribute 绑定。(<a href="https://stackoverflow.com/questions/6003819/properties-and-attributes-in-html#answer-6004028">差别在哪里？</a>)</li><li><code>.camel</code> - (2.1.0+) 将 kebab-case attribute 名转换为 camelCase。(从 2.1.0 开始支持)</li><li><code>.sync</code> (2.3.0+) 语法糖，会扩展成一个更新父组件绑定值的 <code>v-on</code> 侦听器。</li></ul></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 绑定一个属性 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">v-bind:src</span>=<span class="string">&quot;imageSrc&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 动态 attribute 名 (2.6.0+) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">v-bind:</span>[<span class="attr">key</span>]=<span class="string">&quot;value&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 缩写 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">&quot;imageSrc&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 动态 attribute 名缩写 (2.6.0+) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">:</span>[<span class="attr">key</span>]=<span class="string">&quot;value&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 内联字符串拼接 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">&quot;&#x27;/path/to/images/&#x27; + fileName&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- class 绑定 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">:class</span>=<span class="string">&quot;&#123; red: isRed &#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">:class</span>=<span class="string">&quot;[classA, classB]&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">:class</span>=<span class="string">&quot;[classA, &#123; classB: isB, classC: isC &#125;]&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- style 绑定 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">:style</span>=<span class="string">&quot;&#123; fontSize: size + &#x27;px&#x27; &#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">:style</span>=<span class="string">&quot;[styleObjectA, styleObjectB]&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 绑定一个有属性的对象 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-bind</span>=<span class="string">&quot;&#123; id: someProp, &#x27;other-attr&#x27;: otherProp &#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 通过 prop 修饰符绑定 DOM 属性 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-bind:text-content.prop</span>=<span class="string">&quot;text&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- prop 绑定。“prop”必须在 my-component 中声明。--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">my-component</span> <span class="attr">:prop</span>=<span class="string">&quot;someThing&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">my-component</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 通过 $props 将父组件的 props 一起传给子组件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">child-component</span> <span class="attr">v-bind</span>=<span class="string">&quot;$props&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">child-component</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- XLink --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">:xlink:special</span>=<span class="string">&quot;foo&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="v-model"><a href="#v-model" class="headerlink" title="v-model"></a>v-model</h2><blockquote><p>形式： v-model[.qualifier] = “variable”</p><p>值：variable -&gt; 双向数据绑定的变量，通过这个变量实现数据与视图之间的绑定</p><p>! WARN: 只能在 <code>&lt;input&gt;</code>、<code>&lt;select&gt;</code>、<code>&lt;textarea&gt;</code> 和组件上使用</p><p>作用： 实现双向数据绑定</p><p>修饰符：</p><ul><li><a href="https://cn.vuejs.org/v2/guide/forms.html#lazy"><code>.lazy</code></a> - 取代 <code>input</code> 监听 <code>change</code> 事件,  懒加载，会等到失焦才更新</li><li><a href="https://cn.vuejs.org/v2/guide/forms.html#number"><code>.number</code></a> - 输入字符串转为有效的数字，限制只有数字有效， 但是如果先输入字符串则该修饰符无效</li><li><a href="https://cn.vuejs.org/v2/guide/forms.html#trim"><code>.trim</code></a> - 输入首尾空格过滤</li></ul></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;msg&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>v-model.lazy<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model.lazy</span>=<span class="string">&quot;msg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="javascript">            <span class="attr">msg</span>: <span class="string">&#x27;Hello World !&#x27;</span></span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    &#125;);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>加了lazy修饰符， 所以会等到input输入框失去焦点才渲染更新</p>]]></content>
      
      
      <categories>
          
          <category> Note </category>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VUE-note-day1</title>
      <link href="posts/37710"/>
      <url>posts/37710</url>
      
        <content type="html"><![CDATA[<p>疫情在家真的无聊 T_T，学点Vue吧</p><span id="more"></span><h2 id="v-if-amp-v-else-if-amp-v-else"><a href="#v-if-amp-v-else-if-amp-v-else" class="headerlink" title="v-if &amp; v-else-if &amp; v-else"></a>v-if &amp; v-else-if &amp; v-else</h2><h3 id="v-if"><a href="#v-if" class="headerlink" title="v-if"></a>v-if</h3><blockquote><p>形式: v-if = “express | variable”</p><p>值:  true -&gt; 渲染[^1] | false -&gt; 不渲染</p><p>作用: vue的一个内部指令, 用在html标签中, 作为标签的一个属性. 用来判断是否渲染所在的标签.</p></blockquote><p>其作用相当于C语言中的 <code>if判断语句</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;app&quot;&gt;</span><br><span class="line">    &lt;div v-if=&quot;isLogin&quot;&gt;欢迎来到XXX.&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">        <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>: &#123;</span><br><span class="line">            <span class="attr">isLogin</span>: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="v-else-if-2-1-0新增"><a href="#v-else-if-2-1-0新增" class="headerlink" title="v-else-if [2.1.0新增]"></a>v-else-if [2.1.0新增]</h3><blockquote><p>形式: v-else-if = “express | variable”</p><p>值: true -&gt; 渲染 | false -&gt; 不渲染</p><p>! WARN:  必须紧跟在 v-if 或 v-else-if后面, 否则将不被识别.</p><p>作用: 其作用相当于C语言中的 <code>else if 判断语句</code>.</p></blockquote><h3 id="v-else"><a href="#v-else" class="headerlink" title="v-else"></a>v-else</h3><blockquote><p>形式: v-else</p><p>值: 无</p><p>作用: 同 v-if 一样, vue的一个内部指令, 用在html标签中.</p><p>! WARN: 必须紧跟在 v-if 或 v-else-if后面, 否则将不被识别.</p></blockquote><h3 id="综合示例"><a href="#综合示例" class="headerlink" title="综合示例"></a>综合示例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;div v-<span class="keyword">if</span>=<span class="string">&quot;type === &#x27;A&#x27;&quot;</span>&gt;  A  &lt;/div&gt;</span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-else-if</span>=<span class="string">&quot;type === &#x27;B&#x27;&quot;</span>&gt;</span>  B  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-else-if</span>=<span class="string">&quot;type === &#x27;C&#x27;&quot;</span>&gt;</span>  C  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-else</span>&gt;</span>  Not A/B/C  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="key-管理可复用元素"><a href="#key-管理可复用元素" class="headerlink" title="key 管理可复用元素"></a>key 管理可复用元素</h3><blockquote><p>形式: key = “unique-value”</p><p>值: 不固定, 只要是全局唯一即可</p><p>作用: vue为了高效渲染使得加载速度变快, 会复用已有元素,  有时候有的元素虽然相同但是我们不想被复用, 可以在元素中添加key属性来避免被vue复用. 使用了key属性的元素会被重新渲染而不是复用</p></blockquote><h4 id="官网示例"><a href="#官网示例" class="headerlink" title="官网示例"></a><a href="%5Bhttps://cn.vuejs.org/v2/guide/conditional.html#%E7%94%A8-key-%E7%AE%A1%E7%90%86%E5%8F%AF%E5%A4%8D%E7%94%A8%E7%9A%84%E5%85%83%E7%B4%A0%5D(https://cn.vuejs.org/v2/guide/conditional.html#%E7%94%A8-key-%E7%AE%A1%E7%90%86%E5%8F%AF%E5%A4%8D%E7%94%A8%E7%9A%84%E5%85%83%E7%B4%A0)">官网示例</a></h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">v-if</span>=<span class="string">&quot;loginType === &#x27;username&#x27;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span>&gt;</span>Username<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">placeholder</span>=<span class="string">&quot;Enter your username&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">v-else</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span>&gt;</span>Email<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">placeholder</span>=<span class="string">&quot;Enter your email address&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这个例子, 如果input 输入框内有内容, 在切换的时候不会被清空, 因为被vue复用了.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">v-if</span>=<span class="string">&quot;loginType === &#x27;username&#x27;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span>&gt;</span>Username<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">placeholder</span>=<span class="string">&quot;Enter your username&quot;</span> <span class="attr">key</span>=<span class="string">&quot;username-input&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">v-else</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span>&gt;</span>Email<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">placeholder</span>=<span class="string">&quot;Enter your email address&quot;</span> <span class="attr">key</span>=<span class="string">&quot;email-input&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><p>而这个例子, 如果<code>&lt;input&gt;</code>输入框内有内容, 在切换时会被清空, 因为不会被复用而是重新渲染. 但是 <code>&lt;label&gt;</code>依然会被高效复用, 因为没有key属性.</p><blockquote><p>key属性作用: 避免被复用, 使之重新渲染</p></blockquote><h3 id="v-show"><a href="#v-show" class="headerlink" title="v-show"></a>v-show</h3><blockquote><p>形式: v-show = “express | variable”</p><p>值: true -&gt; 显示[^4] | false -&gt; 不显示</p><p>作用: vue的一个内部指令, 用在html标签中,  用于判断所在标签是否显示, 而不是是否渲染</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">v-show</span>=<span class="string">&quot;right&quot;</span>&gt;</span>Hello!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>  <span class="comment">&lt;!--当right为true时, 该标签会被显示, 为false时不显示--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span> <span class="attr">v-show</span>=<span class="string">&quot;status === 1&quot;</span>&gt;</span> 当status为1时显示 <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="attr">data</span>:&#123;</span></span><br><span class="line"><span class="javascript">            <span class="attr">right</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">            <span class="attr">status</span>: <span class="number">2</span></span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    &#125;);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">渲染后的结果:</span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">style</span>=<span class="string">&quot;display:block;&quot;</span>&gt;</span>Hello!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">style</span>=<span class="string">&quot;display:none;&quot;</span>&gt;</span> 当status为1时显示 <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="v-if-VS-v-show"><a href="#v-if-VS-v-show" class="headerlink" title="v-if   VS   v-show"></a>v-if   VS   v-show</h3><p>渲染:</p><ul><li><p><code>v-if</code> 是<strong>“真正”的条件渲染</strong>，因为它会确保在切换过程中条件块内的事件监听器和子组件适当地被销毁和重建。</p></li><li><p><code>v-show</code>只是简单地基于 <strong>CSS 进行切换</strong>。</p></li></ul><p>渲染时机:</p><ul><li><p><code>v-if</code> 也是<strong>惰性的</strong>：如果在初始渲染时条件为假，则什么也不做——直到条件第一次变为真时，才会开始渲染条件块。</p></li><li><p><code>v-show</code> 就简单得多——不管初始条件是什么，元素总是会被渲染，</p></li></ul><p>开销:</p><ul><li><code>v-if</code> 有更高的切换开销，而 <code>v-show</code> 有更高的初始渲染开销。</li></ul><p>因此:</p><ul><li><p>如果需要非常<strong>频繁地切换</strong>，则使用 <code>v-show</code> 较好；</p></li><li><p>如果在运行时条件<strong>很少改变</strong>，则使用 <code>v-if</code> 较好。</p></li></ul><h2 id="v-for"><a href="#v-for" class="headerlink" title="v-for"></a>v-for</h2><h3 id="数组作为数据源"><a href="#数组作为数据源" class="headerlink" title="数组作为数据源"></a>数组作为数据源</h3><blockquote><p>形式: 渲染一个数组</p><ol><li>v-for = “alias in source” 或 v-for = “alias of source”</li><li>v-for = “(alias, index) in source”</li></ol><p>值: </p><ul><li>source -&gt; 数据源, 是一个数组</li><li>alias -&gt; 别名, 遍历时的临时变量</li><li>index -&gt; 索引(下标), 默认的, 可以取别的名, 但是约定俗成是 index</li></ul><p>! WARN: </p><ul><li>别名和索引的位置不能换. 即使换了解释器也默认按照 <code>第一个参数是临时变量, 第二个参数是索引, in 后面的参数是数据源</code> 的规则来解释</li><li>哪个元素要被循环渲染就写在哪个元素里作为它的属性.</li></ul><p>作用: 将数组里的每一个值渲染到标签的插值[^7]中. </p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;age in DemoArray&quot;</span>&gt;</span>&#123;&#123;age&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="javascript">            <span class="attr">DemoArray</span>: [<span class="number">20</span>, <span class="number">30</span>, <span class="number">44</span>, <span class="number">10</span>, <span class="number">33</span>]</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    &#125;);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// 渲染结果=&gt;&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>20<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>30<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>44<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>10<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>33<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>// 显示结果 ==&gt;&gt;</p><ul><li>20</li><li>30</li><li>44</li><li>10</li><li>33</li></ul></blockquote><h4 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h4><blockquote><p>计算的工作都在computed里完成</p></blockquote><p>排序实现在vue对象中的computed, 但是computed里的键名不能和data里的键名相同. 而我们要按排序后的数组渲染, 所以 html 里要改成 v-for = “age in sortArray”</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;age in DemoArray&quot;</span>&gt;</span>&#123;&#123;age&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line">4...</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">    <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="javascript">    <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="javascript">        <span class="attr">DemoArray</span>: [<span class="number">20</span>, <span class="number">30</span>, <span class="number">44</span>, <span class="number">10</span>, <span class="number">33</span>]</span></span><br><span class="line"><span class="javascript">    &#125;,</span></span><br><span class="line"><span class="javascript">    <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">/** 错误写法. 键名重复</span></span></span><br><span class="line"><span class="comment"><span class="javascript">            DemoArray: function()&#123;</span></span></span><br><span class="line"><span class="comment"><span class="javascript">            return this.DemoArray.sort((a, b) =&gt; a - b);</span></span></span><br><span class="line"><span class="comment"><span class="javascript">        &#125;</span></span></span><br><span class="line"><span class="comment"><span class="javascript">        */</span></span></span><br><span class="line"><span class="javascript">        <span class="attr">sortItems</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> <span class="built_in">this</span>.DemoArray.sort(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a - b);</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">&#125;);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>因为 <code>javascript</code> 自带的 bug, 对数组排序 DemoArray.sort()是把每个数组元素的最前面的一位[^5], 所以排序出来是有问题的.</p><p>导致这个 bug 的原因我猜想是因为 js 是弱类型语言, 解释器也不知道你这个数组里到底是字符串还是数字还是什么, 又得给你排序, 所以干脆统统按 <code>给字符串排序</code> 的方法处理.</p><blockquote><p>修复方法就是自己实现一个函数. 上述代码中用了<a href="https://www.liaoxuefeng.com/wiki/1022910821149312/1031549578462080">箭头函数</a>使得更加简洁. 关键代码即 <code>(a, b) =&gt; a - b</code></p></blockquote><h4 id="数组更新"><a href="#数组更新" class="headerlink" title="数组更新"></a>数组更新</h4><h5 id="会修改原数组的方法-变异方法"><a href="#会修改原数组的方法-变异方法" class="headerlink" title="会修改原数组的方法: 变异方法"></a>会修改原数组的方法: 变异方法</h5><ul><li>push()</li><li>pop()</li><li>shift()</li><li>unshift()</li><li>splice()</li><li>sort()</li><li>reverse()</li></ul><p>通过这些方法修改数组, <strong>会触发视图的更新</strong>. </p><h5 id="不会修改原数组的方法-非变异方法"><a href="#不会修改原数组的方法-非变异方法" class="headerlink" title="不会修改原数组的方法: 非变异方法"></a>不会修改原数组的方法: 非变异方法</h5><ul><li>filter()</li><li>concat()</li><li>slice()</li></ul><p>它们不会改变原始数组，而<strong>返回一个新数组</strong>。</p><p>当使用非变异方法时，可以用新数组替换旧数组：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = <span class="keyword">new</span> Vue (&#123;</span><br><span class="line">    <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>:&#123;</span><br><span class="line">        <span class="attr">items</span>: [</span><br><span class="line">            &#123;<span class="attr">msg</span>: <span class="string">&quot;m1&quot;</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">msg</span>: <span class="string">&quot;m2&quot;</span>&#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 替换              </span></span><br><span class="line">app.items = app.items.filter( <span class="function"><span class="params">item</span> =&gt;</span> item.items.match(<span class="regexp">/mmm/</span>) ) ;</span><br></pre></td></tr></table></figure><blockquote><p>? 这里不清楚怎么实现的, 但是<a href="%5Bhttps://cn.vuejs.org/v2/guide/list.html#%E6%9B%BF%E6%8D%A2%E6%95%B0%E7%BB%84%5D(https://cn.vuejs.org/v2/guide/list.html#%E6%9B%BF%E6%8D%A2%E6%95%B0%E7%BB%84)">官网</a>的说法是: 并非丢弃现有DOM而重新渲染整个列表, 因为Vue里有些智能的方法, 所以, 数组在改动不大的情况下去替换原有数组的非常高效的, 不必担心.</p><p>至于怎么个智能法没说, 有待深挖. </p></blockquote><h4 id="数组更新的注意事项"><a href="#数组更新的注意事项" class="headerlink" title="数组更新的注意事项"></a>数组更新的注意事项</h4><h5 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h5><p>由于不靠谱的JavaScript的限制, 以下两种方法的更新Vue是无法检测到的</p><ol><li>利用索引直接设置一个数组项时，例如：<code>vm.items[indexOfItem] = newValue</code></li><li>修改数组的长度时，例如：<code>vm.items.length = newLength</code></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">array</span>: [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">app.array[<span class="number">3</span>] = <span class="number">10</span><span class="comment">//Vue 检测不到更新, 也不会触发视图更新</span></span><br><span class="line">app.array.length = <span class="number">8</span><span class="comment">//Vue 检测不到更新</span></span><br></pre></td></tr></table></figure><h5 id="解决-问题1"><a href="#解决-问题1" class="headerlink" title="解决: 问题1"></a>解决: 问题1</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Vue.set(vm.items, indexOfItem, newValue), </span><br><span class="line"><span class="comment">// 例如: Vue.set(app.array, 2, 10)</span></span><br><span class="line"><span class="comment">// ==&gt;&gt; [0,1,10,3,4,5,6,7,8]</span></span><br><span class="line">或</span><br><span class="line">vm.items.splice(indexOfItem, <span class="number">1</span>, newValue), </span><br><span class="line"><span class="comment">// 例如: app.array.splice(3, 1, 50)</span></span><br><span class="line"><span class="comment">// ==&gt;&gt; [0,1,2,50,4,5,6,7,8]</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">// 关于这个1,可以是任何数, </span></span><br><span class="line"><span class="comment">// 0则不吃掉任何元素, </span></span><br><span class="line"><span class="comment">// 1则吃掉array[indexOfItem]那个元素,</span></span><br><span class="line"><span class="comment">// 2则吃掉array[indexOfItem] 和 array[indexOfItem + 1]两个元素</span></span><br><span class="line"><span class="comment">// 以此类推</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 例如: app.array.splice(2,2,30)</span></span><br><span class="line"><span class="comment">// ==&gt;&gt; [0,1,30,5,6,7,8]</span></span><br><span class="line">    </span><br><span class="line">或</span><br><span class="line">vm.$set(vm.items, indexOfItem, newValue)</span><br><span class="line"><span class="comment">// 例如: app.$set(app.array, 2, 10)</span></span><br><span class="line"><span class="comment">// ==&gt;&gt; [0,1,10,3,4,5,6,7,8]</span></span><br></pre></td></tr></table></figure><h5 id="解决-问题2"><a href="#解决-问题2" class="headerlink" title="解决: 问题2"></a>解决: 问题2</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.array.splice(新长度值)</span><br></pre></td></tr></table></figure><h3 id="对象作为数据源"><a href="#对象作为数据源" class="headerlink" title="对象作为数据源"></a>对象作为数据源</h3><blockquote><p>形式: 渲染一个对象</p><ol><li>v-for = “value in object”</li><li>v-for = “(value, key) in object”</li><li>v-for = “(value, key, index) in object”</li></ol><p>值:</p><ul><li>object -&gt; 数据源, 是一个对象, 要遍历的是它的所有属性</li><li>value -&gt; 别名, 遍历时的临时变量, 输出的是每一个属性的值</li><li>key -&gt; 索引(键名), 默认的, 可以取别的名, 但是约定俗成是 key, 输出的是每一个属性(键值对)的键名</li><li>index -&gt; 索引(下标), 默认的, 可以取别的名, 约定俗成是index, 输出的是每一个属性的下标[^6].</li></ul><p>! WARN:</p><ul><li>和遍历数组一样, 键名索引和下标索引的位置不要换. 即使换了解释器也是按照 <code>第一个参数是临时变量,第二个参数是键名索引, 第三个参数是下标索引, in 后面是数据源</code>的规则解释.</li><li>哪个元素要被循环渲染就写在哪个元素里作为它的属性.</li></ul><p>作用: 将对象里的每一个属性(键值对)的值渲染到标签的插值[^7]中.</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(val, key, idx) in obj&quot;</span>&gt;</span>&#123;&#123;idx&#125;&#125;-&#123;&#123;key&#125;&#125;-&#123;&#123;val&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">      <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="javascript">      <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="javascript">        <span class="attr">obj</span>:&#123;</span></span><br><span class="line"><span class="javascript">        <span class="attr">prop1</span>: <span class="string">&#x27;key1&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="attr">prop2</span>: <span class="number">20</span>,</span></span><br><span class="line"><span class="javascript">        <span class="attr">prop3</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="javascript">         &#125;</span></span><br><span class="line"><span class="javascript">      &#125;</span></span><br><span class="line"><span class="javascript">    &#125;);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// 渲染结果 =&gt;&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>0-prop1-key1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>1-prop2-20<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>2-prop3-true<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>// 显示结果 ==&gt;&gt;</p><ul><li>0-prop1-key1</li><li>1-prop2-20</li><li>2-prop3-true</li></ul></blockquote><h4 id="对象更新的注意事项"><a href="#对象更新的注意事项" class="headerlink" title="对象更新的注意事项"></a>对象更新的注意事项</h4><h5 id="问题-1"><a href="#问题-1" class="headerlink" title="问题:"></a>问题:</h5><p>由于不靠谱的JavaScript的限制, 对象属性的添加或删除 Vue是检测不到的</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">a</span>: <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.b = <span class="number">2</span> <span class="comment">// Vue检测不到, 不会更新视图</span></span><br></pre></td></tr></table></figure><h5 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h5><p>app.a   app.b    这里a和b叫做根级别响应式属性, 是不允许动态添加的, 但是根级别属性的属性是可以动态添加的.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">root</span>:&#123; <span class="attr">child</span>: <span class="number">1</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// app.root 不允许动态添加, app.root.child允许动态添加</span></span><br></pre></td></tr></table></figure><p>添加单个属性的方法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Vue.set(rootAttribute, childKey, childValue)</span><br><span class="line"><span class="comment">// 例如: Vue.set(app.root, &#x27;age&#x27;, 10)</span></span><br><span class="line"><span class="comment">// ==&gt;&gt; data: &#123;</span></span><br><span class="line"><span class="comment">//root: &#123; child: 1, age: 10&#125;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line">或</span><br><span class="line">vm.$set(rootAttribute, childKey, childValue)</span><br><span class="line"><span class="comment">// 例如: app.$set(app.root, &#x27;age&#x27;, 10)</span></span><br></pre></td></tr></table></figure><p>添加多个属性的方法: 使用 <code>Object.assign()</code> 或 <code>_.extend()</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.root = <span class="built_in">Object</span>.assign(&#123;&#125;, app.root, &#123; <span class="attr">age</span>: <span class="number">27</span>, <span class="attr">favoriteColor</span>: <span class="string">&#x27;Vue Green&#x27;</span> &#125;)</span><br></pre></td></tr></table></figure><h3 id="数组对象作为数据源的排序"><a href="#数组对象作为数据源的排序" class="headerlink" title="数组对象作为数据源的排序"></a>数组对象作为数据源的排序</h3><blockquote><p>计算处理同样是在computed中.</p><p>重新定义一个函数, 并作出处理</p><p>在v-for调用时 把数据源换成刚刚定义的函数名</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">4...</span><br><span class="line">4<span class="comment">//数组对象方法排序:</span></span><br><span class="line">4<span class="attr">sortStudents</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">4    <span class="keyword">var</span> key = <span class="string">&quot;age&quot;</span>;</span><br><span class="line">4    <span class="keyword">return</span> <span class="built_in">this</span>.students.sort(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a[key] &lt; b[key] ? -<span class="number">1</span> : (a[key] &gt; b[key] ? <span class="number">1</span> : <span class="number">0</span>))</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="范围作为数据源"><a href="#范围作为数据源" class="headerlink" title="范围作为数据源"></a>范围作为数据源</h3><p>形式: 渲染一个对象</p><ol><li>v-for = “value in object”</li><li>v-for = “(value, key) in object”</li><li>v-for = “(value, key, index) in object”</li></ol><p>值:</p><ul><li>object -&gt; 数据源, 是一个对象, 要遍历的是它的所有属性</li><li>value -&gt; 别名, 遍历时的临时变量, 输出的是每一个属性的值</li><li>key -&gt; 索引(键名), 默认的, 可以取别的名, 但是约定俗成是 key, 输出的是每一个属性(键值对)的键名</li><li>index -&gt; 索引(下标), 默认的, 可以取别的名, 约定俗成是index, 输出的是每一个属性的下标[^6].</li></ul><p>! WARN:</p><ul><li>和遍历数组一样, 键名索引和下标索引的位置不要换. 即使换了解释器也是按照 <code>第一个参数是临时变量,第二个参数是键名索引, 第三个参数是下标索引, in 后面是数据源</code>的规则解释.</li><li>哪个元素要被循环渲染就写在哪个元素里作为它的属性.</li></ul><p>作用: 将对象里的每一个属性(键值对)的值渲染到标签的插值[^7]中.</p><blockquote><p>形式:  v-for=” n in range”</p><p>值: </p><ul><li>n -&gt; 别名, 遍历时的临时变量</li><li>range -&gt; 数据源, 遍历的范围</li></ul></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-for</span>=<span class="string">&quot;n in 10&quot;</span>&gt;</span>&#123;&#123; n &#125;&#125; <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>显示结果 ==&gt;&gt;</p><p>1 2 3 4 5 6 7 8 9 10</p><h3 id="v-for-和-v-if-一起用时"><a href="#v-for-和-v-if-一起用时" class="headerlink" title="v-for 和 v-if 一起用时"></a>v-for 和 v-if 一起用时</h3><p>尽量不要把v-for 和 v-if 放在同一个标签里</p><blockquote><p>但他们处在同一个标签内时, v-for 的优先级比 v-if 高</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--尽量不要--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;todo in todos&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;!todo.isComplete&quot;</span>&gt;</span></span><br><span class="line">  &#123;&#123; todo &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--上面是特殊情况下的写法,  下面是正常情况下的规范写法--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">v-if</span>=<span class="string">&quot;todos.length&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;todo in todos&quot;</span>&gt;</span></span><br><span class="line">    &#123;&#123; todo &#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">v-else</span>&gt;</span>No todos left!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>[^1]:渲染, 加载完DOM树之后就开始在页面上加载, 这个过程叫做渲染<br>[^2]:加载, 当浏览器接收到服务器返回的html文件时, 会读取所有html标签形成一颗DOM树[^3]<br>[^3]:DOM树, 全部html标签的树状结构<br>[^4]:display: block<br>[^5]:如果是字符串就,第一位就是第一个字符; 如果是数字,第一位就是最大位的那个数字, 比如39的第一位是3<br>[^6]:对象中的属性都是键值对, 属性的下标从0开始, 先定义的属性(键值对)下标就靠前<br>[^7]:插值, HTML标签中间用 <code>&#123;&#123; 插值 &#125;&#125;</code> 包起来的地方</p>]]></content>
      
      
      <categories>
          
          <category> Note </category>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>全站变灰的实现</title>
      <link href="posts/43293"/>
      <url>posts/43293</url>
      
        <content type="html"><![CDATA[<h1 id="哀悼日-全站变灰的实现"><a href="#哀悼日-全站变灰的实现" class="headerlink" title="哀悼日-全站变灰的实现"></a>哀悼日-全站变灰的实现</h1><span id="more"></span><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>作为一个关心家国大事的青年，在国家有难时因争相出手付出举手之劳，虽然现在时和平年代，但是也会经历 918公祭日、哀悼日等。</p><p>每到这些日子，警报响彻神州, 江水呜咽，山川悲鸣; 大江南北，长城内外，国家以最高的祭奠向英雄哀悼，人民以最深的怀念为英雄送行。</p><p>除了现场祭奠，线上我们也想表达自己对那些烈士、英雄和逝世同胞的深切哀悼，那么可以通过全站变灰的方式，遮去往日绚烂的色彩，跳脱的动效为他们沉寂。</p><p>下面将介绍如何让全站变灰。</p><h2 id="青铜操作"><a href="#青铜操作" class="headerlink" title="青铜操作"></a>青铜操作</h2><p>作为 <code>铂金CV工程师</code> </p><div class="note green"><p>先来一顿 青铜段 操作:</p></div><ol><li>用最广告的引擎搜索: <code>全站变灰</code></li><li>点进广告最多的论坛, 将关键代码进行数据读取: <code>Ctrl + C</code></li><li>来到自己的站点启动全站检测: <code>F12</code></li><li>找到html标签, 在style面板中进行数据写入: <code>Ctrl + V</code></li></ol><p>完美~</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Mourn/grey.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Mourn/grey.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="全站变灰"></p><h2 id="白银操作"><a href="#白银操作" class="headerlink" title="白银操作"></a>白银操作</h2><div class="note gray"><p>接下来就要进行 白银段 操作了:</p></div><p>这里我用的是<a href="https://volantis.js.org/">Volantis</a>这个主题, 你要找到你自己主题里生成 <code>&lt;head&gt;&lt;/head&gt;</code>标签的那个文件.</p><ol><li><p>进入网站根目录, 找到 themes\volantis\layout_partial\head.ejs</p></li><li><p>在 <code>&lt;head&gt;&lt;/head&gt;</code> 标签内添加</p><figure class="highlight css"><figcaption><span>themes\volantis\layout\_partial\head.ejs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;style&gt;</span><br><span class="line">  <span class="selector-tag">html</span> &#123;</span><br><span class="line">    -webkit-<span class="attribute">filter</span>: <span class="built_in">grayscale</span>(<span class="number">100%</span>);</span><br><span class="line">    -moz-<span class="attribute">filter</span>: <span class="built_in">grayscale</span>(<span class="number">100%</span>);</span><br><span class="line">    -ms-<span class="attribute">filter</span>: <span class="built_in">grayscale</span>(<span class="number">100%</span>);</span><br><span class="line">    -o-<span class="attribute">filter</span>: <span class="built_in">grayscale</span>(<span class="number">100%</span>);</span><br><span class="line">    <span class="attribute">filter</span>: progid:DXImageTransform.Microsoft.<span class="built_in">BasicImage</span>(grayscale=<span class="number">1</span>);</span><br><span class="line">    _filter: none;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure></li><li><p>保存,推送: <code>hexo g -d</code></p></li></ol><p>做到这里其实就够了. 但是你也可以进阶一下</p><h2 id="黄金操作"><a href="#黄金操作" class="headerlink" title="黄金操作"></a>黄金操作</h2><div class="note yellow"><p>再来顿 黄金段 操作:</p></div><ol><li><p>在刚刚添加 <code>&lt;style&gt;...&lt;/style&gt;</code> 标签外面再套上一句ejs的判断语句</p><figure class="highlight css"><figcaption><span>themes\volantis\layout\_partial\head.ejs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line marked">&lt;% if (theme<span class="selector-class">.style</span><span class="selector-class">.mourn</span>) &#123; %&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">  <span class="selector-tag">html</span> &#123;</span><br><span class="line">    -webkit-<span class="attribute">filter</span>: <span class="built_in">grayscale</span>(<span class="number">100%</span>);</span><br><span class="line">    -moz-<span class="attribute">filter</span>: <span class="built_in">grayscale</span>(<span class="number">100%</span>);</span><br><span class="line">    -ms-<span class="attribute">filter</span>: <span class="built_in">grayscale</span>(<span class="number">100%</span>);</span><br><span class="line">    -o-<span class="attribute">filter</span>: <span class="built_in">grayscale</span>(<span class="number">100%</span>);</span><br><span class="line">    <span class="attribute">filter</span>: progid:DXImageTransform.Microsoft.<span class="built_in">BasicImage</span>(grayscale=<span class="number">1</span>);</span><br><span class="line">    _filter: none;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line marked">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure></li><li><p>在你的主题目录的配置文件 <code>themes\volantis\_config.yml</code> 中, </p></li><li><p>添加 <code>mourn: true</code></p><figure class="highlight yaml"><figcaption><span>themes\volantis\_config.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">style:</span></span><br><span class="line">    <span class="string">...</span></span><br><span class="line marked">    <span class="attr">mourn:</span> <span class="literal">true</span>    <span class="comment"># 哀悼: 全站变灰</span></span><br></pre></td></tr></table></figure></li><li><p>保存,推送: <code>hexo g -d</code></p></li></ol><p>这样当你要关掉的时候就不用再跑去head.ejs中删除了, 直接在主题配置文件中把<code>mourn: false</code> 就行了. </p><span class='p green'>开启 -> mourn: true</span> <span class='p red'>关闭 -> mourn: false</span> <p>也可以把mourn放到最外层, 只要让 <code>mourn字段</code> 前面没有空格就行, 相应的 <code>&lt;% if (theme.style.mourn) &#123; %&gt;</code> 要改成 <code>&lt;% if (theme.mourn) &#123; %&gt;</code></p><p>这是yaml的语法, 不懂的<a href="http://www.ruanyifeng.com/blog/2016/07/yaml.html">出门左转</a></p><h2 id="铂金操作"><a href="#铂金操作" class="headerlink" title="铂金操作"></a>铂金操作</h2><div class="note cyan"><p>最后是 铂金段 操作</p></div><p>推送毕竟需要时间, 如果我们想要实现准时准点时间一到自动全站变灰,那就要升级下操作了.<br>只需要把刚刚的代码修改一下.</p><figure class="highlight css"><figcaption><span>themes\volantis\layout\_partial\head.ejs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line marked">&lt;% if (theme<span class="selector-class">.style</span><span class="selector-class">.mourn</span><span class="selector-class">.switch</span>)&#123; %&gt;</span><br><span class="line marked">&lt;%  <span class="selector-tag">var</span> startTime = Date<span class="selector-class">.parse</span>(theme<span class="selector-class">.style</span><span class="selector-class">.mourn</span><span class="selector-class">.startTime</span><span class="selector-class">.replace</span>(/-/g, &quot;/&quot;));  %&gt;</span><br><span class="line marked">&lt;%  <span class="selector-tag">var</span> endTime = Date<span class="selector-class">.parse</span>(theme<span class="selector-class">.style</span><span class="selector-class">.mourn</span><span class="selector-class">.endTime</span><span class="selector-class">.replace</span>(/-/g, &quot;/&quot;));     %&gt;</span><br><span class="line marked">&lt;%  <span class="selector-tag">var</span> currentTime = Date<span class="selector-class">.now</span>(); %&gt;</span><br><span class="line marked">&lt;% &#125; %&gt;</span><br><span class="line marked">&lt;% if (currentTime &gt; startTime &amp;&amp; currentTime &lt; endTime) &#123; %&gt;</span><br><span class="line marked">    &lt;style&gt;</span><br><span class="line">      <span class="selector-tag">html</span> &#123;</span><br><span class="line">        -webkit-<span class="attribute">filter</span>: <span class="built_in">grayscale</span>(<span class="number">100%</span>);</span><br><span class="line">        -moz-<span class="attribute">filter</span>: <span class="built_in">grayscale</span>(<span class="number">100%</span>);</span><br><span class="line">        -ms-<span class="attribute">filter</span>: <span class="built_in">grayscale</span>(<span class="number">100%</span>);</span><br><span class="line">        -o-<span class="attribute">filter</span>: <span class="built_in">grayscale</span>(<span class="number">100%</span>);</span><br><span class="line">        <span class="attribute">filter</span>: progid:DXImageTransform.Microsoft.<span class="built_in">BasicImage</span>(grayscale=<span class="number">1</span>);</span><br><span class="line">        _filter: none;</span><br><span class="line">      &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure><p>然后配置中改成:</p><figure class="highlight yaml"><figcaption><span>themes\volantis\_config.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">style:</span></span><br><span class="line">  <span class="string">...</span></span><br><span class="line">  <span class="attr">mourn:</span>  <span class="comment"># 哀悼: 全站变灰</span></span><br><span class="line marked">    <span class="attr">switch:</span> <span class="literal">true</span></span><br><span class="line marked">    <span class="attr">startTime:</span> <span class="string">&#x27;2020-4-4 0:0:0&#x27;</span></span><br><span class="line marked">    <span class="attr">endTime:</span> <span class="string">&#x27;2020/4/5 0:0:0&#x27;</span></span><br></pre></td></tr></table></figure><p>这样只需要填写好开启关闭的时间, 然后打开开关<span class='p green'>switch: true</span>即可</p><div class="note guide red"><ol><li>日期用-或者/分隔都可以, 因为ejs中有做格式化</li><li>时间一定要用(英文)冒号:分隔</li><li>日期和时间之间要有空格隔开</li><li>个位数不要添加前缀, 比如凌晨三点要写 3:0:0, 不要写成 <del>03:00:00</del></li></ol></div><h2 id="心得"><a href="#心得" class="headerlink" title="心得"></a>心得</h2><p>之前配置主题的时候小心翼翼, 生怕一不小心弄错了就头大.<br>折腾了一段时间积攒了一些经验</p><div class="note guide blue"><p class='p subtitle'>一. 边预览边修改</p>1. 可以使用命令<span class='p blue'>hexo s</span> 开启本地预览, 在浏览器输入<span class='p cyan'>localhost:4000</span>开启本地预览2. 开启后cmd窗口放在一旁, 在编辑器中做修改, hexo server 一直监听着变化, 每次保存都会自动编译3. 只需要在浏览器里刷新一下就可以看到结果. 有什么编译错误cmd窗口里也会实时的显示出来.<p class='p subtitle'>二. 学会看报错信息</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Mourn/debug1.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Mourn/debug1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Debug"><br><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Mourn/debug2.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Mourn/debug2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Debug"></p><p>常见的报错信息就那么几个单词, 不懂的翻译一下, 知道错在哪里, 然后思考为什么会错误, 一步步修改, 慢慢的一点点积累就会成长.</p><p class='p subtitle'>三. YAML是个好东西</p>掌握了yaml语法以后, 就可以自由的添加自己想要的配置.就上面的修改全站变灰为例, 说白了就是找到自己想要的效果的代码, 然后在ejs里做判断, ejs和yaml配合, 就可以作出自己想要的效果了.</div>]]></content>
      
      
      <categories>
          
          <category> HEXO </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HEXO </tag>
            
            <tag> YAML </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Electron Note</title>
      <link href="posts/34681"/>
      <url>posts/34681</url>
      
        <content type="html"><![CDATA[<p>Note</p><span id="more"></span><h1 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h1><p>在项目文件夹下新建两个文件:  <code>main.html</code> &amp; <code>main.js</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--main.html--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Hello World<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">id</span>=<span class="string">&quot;title&quot;</span>&gt;</span></span><br><span class="line">        Hello World !</span><br><span class="line">    <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> electron = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>);  <span class="comment">// 引入electron模块</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = electron.app;  <span class="comment">// 创建electron引用</span></span><br><span class="line"><span class="keyword">const</span> BrowserWindow = electron.BrowserWindow; <span class="comment">// 创建窗口引用</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> mainWindow = <span class="literal">null</span>; <span class="comment">// 声明要打开的主窗口</span></span><br><span class="line"></span><br><span class="line">app.on(<span class="string">&#x27;ready&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    mainWindow = <span class="keyword">new</span> BrowserWindow(&#123; <span class="comment">// 设置打开的窗口大小</span></span><br><span class="line">        <span class="attr">width</span>: <span class="number">800</span>,</span><br><span class="line">        <span class="attr">heigth</span>: <span class="number">500</span></span><br><span class="line">    &#125;);</span><br><span class="line">    mainWindow.loadFile(<span class="string">&#x27;main.html&#x27;</span>); <span class="comment">// 加载html页面</span></span><br><span class="line">    mainWindow.on(<span class="string">&#x27;closed&#x27;</span>, <span class="function">() =&gt;</span> &#123;<span class="comment">// 监听窗口关闭事件</span></span><br><span class="line">        mainWindow = <span class="literal">null</span><span class="comment">// 一定要把窗口设置为null,否则会一直占内存</span></span><br><span class="line">    &#125;);<span class="comment">// 如同C语言申请内存后一定要free释放内存</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>然后打开cmd命令行, cd到项目的根目录, 执行命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init</span><br></pre></td></tr></table></figure><p>项目根目录就会生成一个 <code>package.json</code> 文件</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Hello-World&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;main&quot;</span>: <span class="string">&quot;main.js&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;test&quot;</span>: <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;start&quot;</span>: <span class="string">&quot;electron .&quot;</span><span class="comment">// 这句要自己添加</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;keywords&quot;</span>: [],</span><br><span class="line">  <span class="attr">&quot;author&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;license&quot;</span>: <span class="string">&quot;ISC&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后就可以在 <code>cmd命令行</code> 中执行命令来启动项目</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm start 或者 electron .</span><br></pre></td></tr></table></figure><p>效果如下:</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Electron-Note/1.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Electron-Note/1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Hello world"></p><p>也可以自己添加 <code>main.css</code> 编写样式, 让界面更好看.</p><p>所有命名不固定.</p><h1 id="主进程与渲染进程"><a href="#主进程与渲染进程" class="headerlink" title="主进程与渲染进程"></a>主进程与渲染进程</h1><h3 id="主进程"><a href="#主进程" class="headerlink" title="主进程"></a>主进程</h3><ol><li><p>Electron 运行 <code>package.json</code> 的 <code>main属性</code> 的进程被称为主进程</p></li><li><p>每个应用只有一个主进程</p></li><li><p><strong>作用</strong>:</p><ol><li>管理原生GUI , 典型的窗口(BrowserWindow , Tray, Dock, Menu)</li><li>创建渲染进程</li><li>控制应用生命周期 (app)</li></ol></li><li><p><strong>模块</strong>:</p><ol><li>**(常用): **app , BrowserWindow , ipcMain , Menu , Tray , MenuItem , dialog , Notification , webContents , autoUpdater , globalShortcut , <strong>clipboard , crashReporter</strong></li><li>SystemPreferences , TouchBar , netLog , powerMonitor , inAppPurchase , net , powerSaveBlocker , contentTracing , BrowserView ,  session , protocol , Screen , <strong>shell , nativelmage</strong></li></ol></li></ol><h3 id="渲染进程"><a href="#渲染进程" class="headerlink" title="渲染进程"></a>渲染进程</h3><ol><li>展示web页面的进程称为渲染进程</li><li>一个应用可以有多个渲染进程</li><li><strong>作用</strong>: 通过Node.js,  Electron提供的API可以跟系统底层打交道</li><li><strong>常用模块</strong>: <ol><li>**(常用): **ipcRenderer , remote , desktopCapture , <strong>clipboard , crashReporter</strong> </li><li>webFrame , <strong>shell , nativelmage</strong></li></ol></li></ol><h2 id="进程间通信"><a href="#进程间通信" class="headerlink" title="进程间通信"></a>进程间通信</h2><p>通信工具: <strong>IPC通信模块</strong></p><ul><li>Electron 提供了IPC通信模块, 主进程的 <code>ipcMain</code> 和渲染进程的 <code>ipcRenderer</code> </li><li><code>ipcMain</code> 和 <code>ipcRenderer</code> 都是<code>EventEmitter</code> 对象</li></ul><h3 id="从渲染进程到主进程-render-to-main"><a href="#从渲染进程到主进程-render-to-main" class="headerlink" title="从渲染进程到主进程 (render to main)"></a>从渲染进程到主进程 (render to main)</h3><ul><li>Callbake写法:<ul><li>ipcRenderer.send( channer, …args)      // 渲染进程中发送</li><li>ipcMain.on(channel, handler)                // 主进程中响应</li></ul></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Render-process.js</span></span><br><span class="line"><span class="keyword">const</span> &#123;ipcRenderer&#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>);</span><br><span class="line">ipcRenderer.send(<span class="string">&#x27;通信频段名&#x27;</span>, <span class="number">0</span>或N个参数);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Main-process.js</span></span><br><span class="line">...</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleIPC</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    ipcMain.on(<span class="string">&#x27;通信频段名&#x27;</span>, <span class="function">(<span class="params">err, <span class="number">0</span>或N个参数</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// do something to reply</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(handleIPC, <span class="number">500</span>);</span><br><span class="line">...</span><br></pre></td></tr></table></figure><ul><li>Promise写法 (Electron 7.0之后, 处理请求 + 响应模式):<ul><li>ipcRenderer.invoke(channel, …args)    // 渲染进程中发送</li><li>ipcMain.handle(channel, handler)        // 主进程中响应</li></ul></li></ul><h3 id="从主进程到渲染进程-main-to-render"><a href="#从主进程到渲染进程-main-to-render" class="headerlink" title="从主进程到渲染进程 (main to render)"></a>从主进程到渲染进程 (main to render)</h3><ul><li>ipcRenderer.on(channel, handler)    // 渲染进程中响应</li><li>webContents.send(channel)              // 主进程中发送</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Main-process.js</span></span><br><span class="line">...</span><br><span class="line">mainWindow = <span class="keyword">new</span> BrowserWindow(&#123;......&#125;);</span><br><span class="line">mainWindow.webContents.send(<span class="string">&#x27;通信频段名&#x27;</span>);</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Render-process.js</span></span><br><span class="line"><span class="keyword">const</span> &#123;ipcRenderer&#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>);</span><br><span class="line">ipcRenderer.on(<span class="string">&#x27;通信频段名&#x27;</span>, <span class="function">(<span class="params">err, <span class="number">0</span>或N个参数</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// do something to reply</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="从渲染进程到渲染进程-render-to-render-页面间通信"><a href="#从渲染进程到渲染进程-render-to-render-页面间通信" class="headerlink" title="从渲染进程到渲染进程 (render to render)   页面间通信"></a>从渲染进程到渲染进程 (render to render)   页面间通信</h3><p>页面之间的通信主要做两件事情: 1. 通知事件;  2. 数据共享</p><h4 id="通知事件"><a href="#通知事件" class="headerlink" title="通知事件"></a>通知事件</h4><ul><li>ipcRenderer.sendTo( webContentsId, channel, …args )</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Main-process.js</span></span><br><span class="line"><span class="keyword">const</span> &#123;app, BrowserWindow, Notification, ipcMain&#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> win1 = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">let</span> win2 = <span class="literal">null</span>;</span><br><span class="line">app.on(<span class="string">&#x27;ready&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    win1 = <span class="keyword">new</span> BrowserWindow(&#123; </span><br><span class="line">        <span class="attr">width</span>:<span class="number">500</span>, </span><br><span class="line">        <span class="attr">heigth</span>:<span class="number">500</span>, </span><br><span class="line">        <span class="attr">webPreferences</span>:&#123;<span class="attr">nodeIntegration</span>:<span class="literal">true</span>&#125; </span><br><span class="line">    &#125;);</span><br><span class="line">    win1.loadFile(<span class="string">&#x27;./win1.html&#x27;</span>);</span><br><span class="line">    win2 = <span class="keyword">new</span> BrowserWindow(&#123; </span><br><span class="line">        <span class="attr">width</span>:<span class="number">500</span>, </span><br><span class="line">        <span class="attr">heigth</span>:<span class="number">500</span>, </span><br><span class="line">        <span class="attr">webPreferences</span>:&#123;<span class="attr">nodeIntegration</span>:<span class="literal">true</span>&#125; </span><br><span class="line">    &#125;);</span><br><span class="line">    win2.loadFile(<span class="string">&#x27;./win2.html&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">global</span>.sharedObject = &#123; <span class="attr">win2WebContentsId</span>: win2.webContents.id &#125;<span class="comment">//把win2的id放在全局对象中</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// render1-process.js</span></span><br><span class="line"><span class="comment">// sender</span></span><br><span class="line"><span class="keyword">const</span> &#123;ipcRenderer, remote&#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> win2Id = remote.getGlobal(<span class="string">&#x27;sharedObject&#x27;</span>).win2WenContentsId<span class="comment">//获取win2的id</span></span><br><span class="line">ipcRenderer.sendTo(win2Id, <span class="string">&#x27;通信频段名&#x27;</span>, <span class="number">0</span>或N个参数)<span class="comment">// 与win2进行通信</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// render2-process.js</span></span><br><span class="line"><span class="comment">// responser</span></span><br><span class="line"><span class="keyword">const</span> &#123;ipcRenderer&#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>)</span><br><span class="line">ipcRenderer.on(<span class="string">&#x27;通信频段名&#x27;</span>, <span class="function">(<span class="params">err, <span class="number">0</span>或N个参数</span>) =&gt;</span> &#123;<span class="comment">// 响应</span></span><br><span class="line">    <span class="comment">// do something to reply</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="数据共享"><a href="#数据共享" class="headerlink" title="数据共享"></a>数据共享</h4><ul><li>使用web技术( localStorage , sessionStorage , indexedDB )</li></ul><h3 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h3><h4 id="渲染进程的调试"><a href="#渲染进程的调试" class="headerlink" title="渲染进程的调试"></a>渲染进程的调试</h4><ol><li>用代码打开 Chromiun的开发者工具</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> win = <span class="keyword">new</span> BrowserWindow();</span><br><span class="line">win.webContents.openDevTools();</span><br></pre></td></tr></table></figure><ol start="2"><li>输入命令行 <code>electron .</code> 之后, 在窗口按下快捷键 <code>Ctrl + Shift + i</code></li></ol><h4 id="主进程的调试"><a href="#主进程的调试" class="headerlink" title="主进程的调试"></a>主进程的调试</h4><p>Electron 主进程是一个 Node.js 进程。Node.js 在 8 之后引入了 <code>--inspect</code> 参数用于调试，同样也适用于 Electron 主进程：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">electron . --inspect</span><br></pre></td></tr></table></figure><p>默认会监听 9229 端口，应用启动后，在 Chrome 浏览器（或其他基于 Chromium 开发的浏览器）中打开 <code>chrome://inspect</code> 即可看到对应的调试会话，点击会话链接即可打开 devtools 进行调试。</p><p>另外，可以在命令行参数中指定端口号，实现同时调试多个应用中的多个进程而不产生冲突：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">electron . --inspect=1234</span><br></pre></td></tr></table></figure><h5 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h5><p>1.开启命令行开关</p><p>启动electron的时候需要带上inspect开关，并配置调试端口.</p><p>有两个开关，分别是 <code>--inspect=[port]</code> 和 <code>--inspect-brk=[port]</code>，区别在于后者会暂停在第一行js代码</p><p>这里建议在 <code>package.json</code> 的 <code>script</code> 字段添加如下内容</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">       <span class="attr">&quot;test&quot;</span>: <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>,</span><br><span class="line">       <span class="attr">&quot;start&quot;</span>: <span class="string">&quot;electron .&quot;</span>,</span><br><span class="line">       <span class="attr">&quot;debug&quot;</span>: <span class="string">&quot;electron . --inspect=5858&quot;</span>    <span class="comment">// 添加这行</span></span><br><span class="line">     &#125;,</span><br></pre></td></tr></table></figure><p>2.设置chrome调试器</p><p>打开chrome，然后新开一个标签进入<a href="chrome://inspect">chrome://inspect</a> ，这里我们要先配置监听的端口，不然的话，Remote Target列表里是不会出现要调试的electron程序的</p><p>&gt;_</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Electron-Note/chrome-inspect.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Electron-Note/chrome-inspect.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="chrome://inspect"></p><p>&gt;_</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Electron-Note/chrome-port.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Electron-Note/chrome-port.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="chrome-port"></p><p>然后在项目目录下就可以直接使用命令 </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run debug</span><br></pre></td></tr></table></figure><p>就可以看到如下画面:</p><p>&gt;_</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Electron-Note/chrome-run.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Electron-Note/chrome-run.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="chrome-run"></p><p>3.调试</p><p>点击 inspect 就可以进行调试了.</p><h5 id="在-VSCode-中调试"><a href="#在-VSCode-中调试" class="headerlink" title="在 VSCode 中调试"></a>在 VSCode 中调试</h5><p>上述方法均会打开 devtools 界面，所有的调试操作均在 devtools 中进行。对于某些操作比如代码断点调试，可以进一步与编辑器或 IDE 相结合，提升开发体验。以下将简要介绍如何在 VSCode 进行调试。</p><p>以 Electron 官方的模板 <a href="https://github.com/electron/electron-quick-start">electron-quick-start</a> 为例，首先需要为 VSCode 安装一个扩展：<a href="https://marketplace.visualstudio.com/items?itemName=msjsdiag.debugger-for-chrome">Debugger for Chrome</a>（用于调试渲染进程）。克隆代码仓库到本地并安装依赖：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/electron/electron-quick-start.git</span><br><span class="line"><span class="built_in">cd</span> electron-quick-start</span><br><span class="line">npm install</span><br></pre></td></tr></table></figure><p>然后在仓库中添加文件 <code>.vscode/launch.json</code>，内容如下：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;0.2.0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;configurations&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Main&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;node&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;request&quot;</span>: <span class="string">&quot;launch&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;runtimeExecutable&quot;</span>: <span class="string">&quot;C:\\Users\\用户名\\AppData\\Roaming\\npm\\electron&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;runtimeArgs&quot;</span>: [<span class="string">&quot;--remote-debugging-port=9222&quot;</span>, <span class="string">&quot;.&quot;</span>],</span><br><span class="line">      <span class="attr">&quot;windows&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;runtimeExecutable&quot;</span>: <span class="string">&quot;C:\\Users\\用户名\\AppData\\Roaming\\npm\\electron.cmd&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Renderer&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;chrome&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;request&quot;</span>: <span class="string">&quot;attach&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;port&quot;</span>: <span class="number">9222</span>,</span><br><span class="line">      <span class="attr">&quot;webRoot&quot;</span>: <span class="string">&quot;$&#123;workspaceFolder&#125;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;compounds&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;All&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;configurations&quot;</span>: [<span class="string">&quot;Main&quot;</span>, <span class="string">&quot;Renderer&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注意: Windows系统的路径分隔符要写作 “\\“ </p><p>if  普通安装electron </p><p>​    then 把”用户名”改成”你系统的用户名”;</p><p>else 自定义安装electron </p><p>​    then 找到你的 electron.cmd; </p><p>​             复制路径; </p><p>​             到 json中修改;</p><p>if  Linux用户</p><p>​    then 系统.路径分隔符 = “/“</p><p>if  (项目根目录/node_modules/.bin/electron).isExist</p><p>​    then </p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;runtimeExecutable&quot;</span>: <span class="string">&quot;$&#123;workspaceFolder&#125;/node_modules/.bin/electron&quot;</span>,</span><br><span class="line"><span class="string">&quot;windows&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;runtimeExecutable&quot;</span>: <span class="string">&quot;$&#123;workspaceFolder&#125;/node_modules/.bin/electron.cmd&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p>然后在 VSCode 左侧选择 debug 面板，启动 <code>All</code> 这一项开始调试，此时就可以在 <code>main.js</code> 或 <code>renderer.js</code> 文件中添加断点了：</p><p>配置文件中的一些要点解释如下：</p><ol><li><code>configurations</code> 中的两项分别对应主进程和渲染进程。<code>compounds</code> 中指定了一个组合会话 <code>All</code>，选择 <code>All</code> 将会同时启动这两个会话。</li><li>Renderer 配置中的 <code>webRoot</code> 参数直接使用了 <code>$&#123;workspaceFolder&#125;</code>，是因为在这个工程中，HTML 引用的静态资源位于根目录下。实际使用的时候需要更新到对应的路径才会生效。</li><li>实际开发中可能会有编译的流程，比如使用 TypeScript 配合打包工具 Webpack，最终生成的代码与源代码并不在一个路径下。这种情况下需要产出 source map 来建立映射关系。</li></ol><p>&gt;_</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Electron-Note/debug.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Electron-Note/debug.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="debug"></p><h3 id="经验技巧"><a href="#经验技巧" class="headerlink" title="经验技巧"></a>经验技巧</h3><ul><li><p>少用remote模块</p><p>  因为每次remote会触发底层的同步IPC事件, 特别影响性能, 处理的不好容易进程卡死</p></li><li><p>不要用sync模式</p><p>  一旦写的不好就会整个应用卡死</p></li><li><p>在请求+响应的通信模式下,需要自定义超时限制</p><p>  在响应的时候需要设置一个时长限制, 当应用响应超时, 需要response一个异常的超时事件让业务处理, 然后去做对应的交互</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Electron </category>
          
          <category> Note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Electron </tag>
            
            <tag> note </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git-基本操作说明</title>
      <link href="posts/42006"/>
      <url>posts/42006</url>
      
        <content type="html"><![CDATA[<p>Git Yes!</p><span id="more"></span><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Git-basic-operation/git%E8%AF%B4%E6%98%8E.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Git-basic-operation/git%E8%AF%B4%E6%98%8E.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="git"></p><p>经典git关系图</p><ul><li>Workspace：工作区</li><li>Index / Stage：暂存区</li><li>Repository：仓库区（或本地仓库）</li><li>Remote：远程仓库</li></ul><h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><p>刚新建一个项目的时候需要来几条初始化命令</p><h5 id="生成本地仓库"><a href="#生成本地仓库" class="headerlink" title="生成本地仓库"></a>生成本地仓库</h5><p>git init </p><h5 id="把工作区的文件提交到暂存区"><a href="#把工作区的文件提交到暂存区" class="headerlink" title="把工作区的文件提交到暂存区"></a>把工作区的文件提交到暂存区</h5><p>git add .<br>或者<br>git add 文件名</p><h5 id="把暂存区的文件提交到本地仓库"><a href="#把暂存区的文件提交到本地仓库" class="headerlink" title="把暂存区的文件提交到本地仓库"></a>把暂存区的文件提交到本地仓库</h5><p>git commit -m “描述”<br>这里的描述就是到时候看到的下面的这些</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Git-basic-operation/1.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Git-basic-operation/1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="1"></p><h5 id="先给你要提交的远程仓库起个别名"><a href="#先给你要提交的远程仓库起个别名" class="headerlink" title="先给你要提交的远程仓库起个别名"></a>先给你要提交的远程仓库起个别名</h5><p>git remote add 仓库别名 Git地址<br>Git地址如下图所示</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Git-basic-operation/2.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Git-basic-operation/2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2"></p><h5 id="把本地仓库的文件提交到远程仓库（就是github上能看到的那种）"><a href="#把本地仓库的文件提交到远程仓库（就是github上能看到的那种）" class="headerlink" title="把本地仓库的文件提交到远程仓库（就是github上能看到的那种）"></a>把本地仓库的文件提交到远程仓库（就是github上能看到的那种）</h5><p>git push -u 仓库别名 分支名<br>分支就是….算了这里是傻瓜备忘不想解释</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Git-basic-operation/3.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Git-basic-operation/3.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="3"></p><p>到这就可以上去github看看了。文件内容都在里面</p><h2 id="第二次提交"><a href="#第二次提交" class="headerlink" title="第二次提交"></a>第二次提交</h2><p>第二次提交的时候一般不是整个项目都有变动对吧？<br>没事git会自动识别修改过的和没修改过的文件</p><h5 id="可以看看git识别到哪些"><a href="#可以看看git识别到哪些" class="headerlink" title="可以看看git识别到哪些"></a>可以看看git识别到哪些</h5><p>git status</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Git-basic-operation/gitstatus.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Git-basic-operation/gitstatus.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="gitstatus"></p><p>红色的，Umerged，表示工作区有改动的文件，还没提交到暂存区<br>git文件的四种状态</p><ul><li>untracked   未被追踪的。就是还没添加过的</li><li>unmodified 工作区里已经被追踪了，还没修改</li><li>modified     工作区的文件修改了但还没提交到暂存区</li><li>staged        添加到了暂存区倒是还没提交到远程仓库</li></ul><h5 id="把它提交到暂存区去"><a href="#把它提交到暂存区去" class="headerlink" title="把它提交到暂存区去"></a>把它提交到暂存区去</h5><p>git add .</p><h5 id="把它提交到本地仓库去"><a href="#把它提交到本地仓库去" class="headerlink" title="把它提交到本地仓库去"></a>把它提交到本地仓库去</h5><p>git commit -m “描述”</p><h5 id="把它提交到远程仓库去"><a href="#把它提交到远程仓库去" class="headerlink" title="把它提交到远程仓库去"></a>把它提交到远程仓库去</h5><p>git push -u 远程仓库别名 分支名</p><p>搞定！</p><h5 id="拉取远程仓库的文件到本地"><a href="#拉取远程仓库的文件到本地" class="headerlink" title="拉取远程仓库的文件到本地"></a>拉取远程仓库的文件到本地</h5><p>git pull 远程仓库别名 分支名</p><p>多用户共同开发的时候，新用户可能会在本地新建一个文件夹，然后git init, 接着pull<br>可能会出现拉取失败，因为git认为这是两个不同的项目，所以拒绝拉取合并，可以加上<code>--allow-unrelated-histories</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull 仓库别名 分支名 --allow-unrelated-histories</span><br></pre></td></tr></table></figure><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>要把代码写完放在github上就等于 你要从山旮旯里寄东西到北京</p><p>工作区 =&gt; 就是你项目的文件夹，你经营的这家客栈<br>暂存区 =&gt; 就是你这个项目的git索引，你这个村里的驿站<br>本地仓库 =&gt; 就是你电脑里的一个存储库，你市里的驿站<br>远程仓库 =&gt; 就是github服务器上面，北京</p><p>你东西收拾好了的时候  得找村里的快递站帮你保管和寄送到市里的快递站<br><code>git add .</code><br>等你说commit的时候    市里的快递站 就给你 送到省里的快递站<br><code>git commit -m &quot;描述&quot;</code><br>等你说push的时候        省里的快递站 就给你 送到北京<br><code>git push -u 远程仓库别名 分支名</code></p><p>&gt;_</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Git-basic-operation/git%E5%B8%B8%E7%94%A8.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Git-basic-operation/git%E5%B8%B8%E7%94%A8.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="GIT常用命令"></p>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
            <tag> 命令 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SSM-配置文件</title>
      <link href="posts/25425"/>
      <url>posts/25425</url>
      
        <content type="html"><![CDATA[<p>先把配置文件捋清楚</p><span id="more"></span><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>SSM框架中有几个比较重要的配置文件，一开始学起来会很模糊，这里做一下整理</p><blockquote><p> 当一个web程序启动时，Tomcat服务器最先会读取 <strong><code>web.xml</code></strong> 文件，这个文件中会启动一些配置，还会启动Spring配置文件**<code>applicationContext.xml</code>** 和SpringMVC配置文件 <strong><code>springMVC-servlet.xml</code></strong> 这两个文件，在运行 <strong><code>applicationContext.xml</code></strong> 的时候会启动MyBatis的配置文件 **<code>myBatis.xml</code>**，并且会调用到 <strong><code>jdbc.properties</code></strong> 和 <strong><code>log4J.properties</code></strong> 两个资源属性文件里的属性。</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/SSM-config/2.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/SSM-config/2.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="SSM机制"></p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/SSM-config/J2EE.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/SSM-config/J2EE.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="J2EE"></p><h3 id="web-xml"><a href="#web-xml" class="headerlink" title="web.xml"></a>web.xml</h3><p>接下来先看看最先启动的 <strong><code>web.xml</code></strong> 是都怎么配置。</p><p>在Spring配置中和在Servlet配置中，就启动了applicationContext 和 SpringMVC-servlet 两个配置文件</p><ul><li>启动applicationContext</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>启动SpringMVC-servlet</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--部署Servlet分发器 DispatcherServlet--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springer<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--注册DispatcherServlet的配置文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springer-servlet.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br></pre></td></tr></table></figure><p>运行到这的时候就会调用到上述两个文件。</p><p>整个文件如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">id</span>=<span class="string">&quot;WebApp_ID&quot;</span> <span class="attr">version</span>=<span class="string">&quot;3.1&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--以下配置的加载顺序:先 ServletContext &gt;&gt; context-param &gt;&gt; listener &gt;&gt; filter &gt;&gt; servlet &gt;&gt;  spring--&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- ==================== 欢迎页配置 ==================== --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置欢迎页--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- ==================== Spring配置 ==================== --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--启动Spinrg 配置文件 applicationContext.xml--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置监听器，加载Spring 配置文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- ==================== Serlvet配置 ==================== --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--部署Servlet分发器 DispatcherServlet--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springer<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--注册DispatcherServlet的配置文件--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springer-servlet.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置DispatcherServlet的作用范围，这里作用于整个web目录--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springer<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- ==================== 过滤器配置 ==================== --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置过编码滤器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>characterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--编码格式：UTF-8--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--是否全部过滤，包括符合格式的文件/请求--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置过滤器的作用范围，这里作用于整个WEB目录--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>characterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- ==================== 错误页面配置 ==================== --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--404错误页面注册--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">error-page</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">error-code</span>&gt;</span>404<span class="tag">&lt;/<span class="name">error-code</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">location</span>&gt;</span>/WEB-INF/jsp/404.jsp<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="applicationContext-xml"><a href="#applicationContext-xml" class="headerlink" title="applicationContext.xml"></a>applicationContext.xml</h3><p>这个文件是第二个启动的配置文件</p><p>在这个文件里主要做了几件事情：</p><ol><li>加载jdbc.properties资源属性文件</li><li>配置数据源</li><li>配置Mybatis工厂<ol><li>指定数据源</li><li>指定Mybatis配置文件</li></ol></li><li>批量配置Mapper接口<ol><li>设置需要扫描的dao包</li><li>配置sqlSessionFactory对象</li></ol></li><li>添加事务支持<ol><li>配置事务管理器</li><li>配置通知</li><li>配置切面</li></ol></li><li>扫描service包</li></ol><p>下面一个一个解释：</p><h4 id="1-加载jdbc-properties"><a href="#1-加载jdbc-properties" class="headerlink" title="1.加载jdbc.properties"></a>1.加载jdbc.properties</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:jdbc.properties&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>把连接数据库的一些数据分离出来写在jdbc.properties这个文件中，加载了这个文件就可以使用这些属性</p><p>而在 jdbc.properties 文件中的内容如下（这里演示的是MySQL8.0）:</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">jdbc.driver</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="meta">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/transactional?useSSL=false?serverTimezone=Hongkong?characterEncoding=utf-8?autoReconnect=true</span></span><br><span class="line"><span class="meta">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">jdbc.password</span>=<span class="string">123456</span></span><br><span class="line"><span class="meta">jdbc.maxTotal</span>=<span class="string">30</span></span><br><span class="line"><span class="meta">jdbc.maxIdle</span>=<span class="string">10</span></span><br><span class="line"><span class="meta">jdbc.initialSize</span>=<span class="string">5</span></span><br></pre></td></tr></table></figure><p>至于如何调用，则在下面的配置数据源中演示</p><h4 id="2-配置数据源"><a href="#2-配置数据源" class="headerlink" title="2.配置数据源"></a>2.配置数据源</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.commons.dbcp2.BasicDataSource&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- 最大连接数 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxTotal&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.maxTotal&#125;&quot;</span>/&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- 最大空闲连接数 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxIdle&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.maxIdle&#125;&quot;</span>/&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- 初始化连接数 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;initialSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.initialSize&#125;&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在上面已经加载了jdbc.properties，所以在配置数据源的时候直接用 <strong><code>$&#123;属性名&#125;</code></strong> 就可以使用该属性。这样做的好处是，在多处调用 <code>jdbc.properties</code> 里的那些属性的时候，如果要该一个属性比如数据库密码，只需要修改jdbc.properties 中的 jdbc.password 的值就行了。</p><h4 id="3-配置Mybatis工厂"><a href="#3-配置Mybatis工厂" class="headerlink" title="3.配置Mybatis工厂"></a>3.配置Mybatis工厂</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">4<span class="comment">&lt;!-- 配置MyBatis工厂，同时指定数据源，并与MyBatis完美整合 --&gt;</span></span><br><span class="line">   </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--指定数据源--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dSource&quot;</span>/&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- configLocation的属性值为MyBatis的核心配置文件 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;configLocation&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:mybatis-config.xml&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>注意指定数据源的 <code>&lt;property&gt;</code> 标签中的 <code>ref</code> 属性，要和数据源的 id 对应</p><p>在第二个 <code>&lt;property&gt;</code>  中指定和启动了Mybatis的配置文件</p><h4 id="4-配置数据映射接口"><a href="#4-配置数据映射接口" class="headerlink" title="4.配置数据映射接口"></a>4.配置数据映射接口</h4><p>数据映射接口，也就是dao，通过Mybatis配置文件映射到数据库操作文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span>    </span><br><span class="line">    <span class="comment">&lt;!-- mybatis-spring组件的扫描器 ，必须写全dao的包名，且只能扫描一个dao包 --&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basePackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;dao&quot;</span>/&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sqlSessionFactoryBeanName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;sqlSessionFactory&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>配置以后，Spring会自动扫描MyBatis的接口并装配（Spring将指定包中所有被@Mapper注解标注的接口自动装配为MyBatis的映射接口）</p><p>在Eclipse中的进行项目的话要写全dao 的包名，比如 com.github.java.dao 这样，而在IDEA中一般会配置好项目的source root 根目录 和 resource root 资源目录，所以写dao包名就好。</p><p>例如我的目录结构，我设置了java为source root 根目录，所以不用写全包名</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/SSM-config/3.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/SSM-config/3.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="3"></p><h4 id="5-添加事务支持"><a href="#5-添加事务支持" class="headerlink" title="5.添加事务支持"></a>5.添加事务支持</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;txManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">4<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dSource&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 开启事务注解 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;txManager&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>事务支持有很多种方法，这种是基于@Transactional注解的事务管理。</p><p>还有一种是声明式事务管理</p><h4 id="6-扫描service包"><a href="#6-扫描service包" class="headerlink" title="6.扫描service包"></a>6.扫描service包</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;service&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><h4 id="完整文件"><a href="#完整文件" class="headerlink" title="完整文件"></a>完整文件</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/tx/spring-tx.xsd&quot;</span>&gt;</span></span><br><span class="line">4</span><br><span class="line">    <span class="comment">&lt;!--=================== 加载jdbc.properties ===================--&gt;</span></span><br><span class="line">4<span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:jdbc.properties&quot;</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--======================== 配置数据源 ========================--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.commons.dbcp2.BasicDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 最大连接数 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxTotal&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.maxTotal&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 最大空闲连接数 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxIdle&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.maxIdle&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 初始化连接数 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;initialSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.initialSize&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--======================== 配置MyBatis工厂 ========================--&gt;</span></span><br><span class="line">4<span class="comment">&lt;!-- 配置MyBatis工厂，同时指定数据源，并与MyBatis完美整合 --&gt;</span></span><br><span class="line">4<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">44<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span> /&gt;</span></span><br><span class="line">44<span class="comment">&lt;!-- configLocation的属性值为MyBatis的核心配置文件 --&gt;</span></span><br><span class="line">44<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;configLocation&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:com/mybatis/mybatis-config.xml&quot;</span> /&gt;</span></span><br><span class="line">4<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--======================== Mapper代理 ========================--&gt;</span></span><br><span class="line">    </span><br><span class="line">4<span class="comment">&lt;!--Mapper代理开发，使用Spring自动扫描MyBatis的接口并装配（Spring将指定包中所有被@Mapper注解标注的接口自动装配为MyBatis的映射接口） --&gt;</span></span><br><span class="line">4<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span></span><br><span class="line">44<span class="comment">&lt;!-- mybatis-spring组件的扫描器 ，必须写全dao的包名，且只能扫描一个dao包 --&gt;</span></span><br><span class="line">44<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basePackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.dao&quot;</span> /&gt;</span></span><br><span class="line">44<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sqlSessionFactoryBeanName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> /&gt;</span></span><br><span class="line">4<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">4<span class="comment">&lt;!--======================== 扫描Service包 ========================--&gt;</span></span><br><span class="line">    </span><br><span class="line">4<span class="comment">&lt;!-- dao包在mybatis-spring组件中已经扫描，这里不再需要扫描 --&gt;</span></span><br><span class="line">4<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.service&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--======================== 配置事务支持 ========================--&gt;</span></span><br><span class="line">    </span><br><span class="line">4<span class="comment">&lt;!-- 添加事务支持 --&gt;</span></span><br><span class="line">4<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;txManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">44<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span> /&gt;</span></span><br><span class="line">4<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">4<span class="comment">&lt;!-- 开启事务注解 --&gt;</span></span><br><span class="line">4<span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;txManager&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="SpringMVC-servlet-xml"><a href="#SpringMVC-servlet-xml" class="headerlink" title="SpringMVC-servlet.xml"></a>SpringMVC-servlet.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;controller&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;converter&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;formatter&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;utils&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;po&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">location</span>=<span class="string">&quot;/css/&quot;</span> <span class="attr">mapping</span>=<span class="string">&quot;/css/**&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">location</span>=<span class="string">&quot;/html/&quot;</span> <span class="attr">mapping</span>=<span class="string">&quot;/html/**&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">location</span>=<span class="string">&quot;/images/&quot;</span> <span class="attr">mapping</span>=<span class="string">&quot;/images/**&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--==================== 配置视图解析器 ====================--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span> <span class="attr">id</span>=<span class="string">&quot;internalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/jsp/&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--==================== 注册类型转换器 ====================--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;conversionService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.context.support.ConversionServiceFactoryBean&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;converters&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;converter.GoodsConverter&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--启动类型转换器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span> <span class="attr">conversion-service</span>=<span class="string">&quot;conversionService&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--==================== 注册格式化转换器 ====================--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;formattingConversionService&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">&quot;org.springframework.format.support.FormattingConversionServiceFactoryBean&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;formatters&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;formatter.GoodsFormatter&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--启动格式化转换器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span> <span class="attr">conversion-service</span>=<span class="string">&quot;formattingConversionService&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--==================== 配置校验器 ====================--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置错误消息资源--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;msgSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.context.support.ReloadableResourceBundleMessageSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basenames&quot;</span> <span class="attr">value</span>=<span class="string">&quot;errorMessages&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--资源文件编码格式--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;fileEncodings&quot;</span> <span class="attr">value</span>=<span class="string">&quot;utf-8&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--对资源文件内容缓存时间，单位秒--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;cacheSeconds&quot;</span> <span class="attr">value</span>=<span class="string">&quot;120&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--注册校验器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;validator&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.validation.beanvalidation.LocalValidatorFactoryBean&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--hibernate校验器--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;providerClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;org.hibernate.validator.HibernateValidator&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--指定校验使用的资源为将，在文件中配置校验错误信息--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;validationMessageSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;msgSource&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--启动spring的valid校验功能--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span> <span class="attr">conversion-service</span>=<span class="string">&quot;conversionService&quot;</span> <span class="attr">validator</span>=<span class="string">&quot;validator&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--==================== 配置拦截器 ====================--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;bean class=&quot;interceptor.AllInterceptor&quot;/&gt;--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/**&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mvc:exclude-mapping</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;interceptor.Interceptor1&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/five&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;interceptor.Interceptor2&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--==================== 配置文件上传和下载 ====================--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;multipartResolver&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">p:defaultEncoding</span>=<span class="string">&quot;UTF-8&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">p:maxUploadSize</span>=<span class="string">&quot;5400000&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">p:uploadTempDir</span>=<span class="string">&quot;fileUpload/temp&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--==================== 配置异常处理 ====================--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使用@ExceptionHandler注解时注释掉，因为@ExceptionHandler注解方法不能有任何配置--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--统一异常处理，托管MyExceptionHandler--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;bean class=&quot;exception.MyExceptionHandler&quot;/&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--统一异常处理，使用SimpleMappingExceptionResolver异常处理器处理异常--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;bean class=&quot;org.springframework.web.servlet.handler.SimpleMappingExceptionResolver&quot;&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&amp;lt;!&amp;ndash;定义默认的异常处理页面，当该异常类型注册时使用&amp;ndash;&amp;gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;property name=&quot;defaultErrorView&quot; value=&quot;error&quot;/&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&amp;lt;!&amp;ndash;定义异常处理页面用来获取异常信息的变量名，默认名为exception&amp;ndash;&amp;gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;property name=&quot;exceptionAttribute&quot; value=&quot;ex&quot;/&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&amp;lt;!&amp;ndash;定义需要特殊处理的异常，用类名活完全路径名为key，异常页名为值&amp;ndash;&amp;gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;property name=&quot;exceptionMappings&quot;&gt;--&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--&lt;props&gt;--&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--&lt;prop key=&quot;exception.MyException&quot;&gt;my-error&lt;/prop&gt;--&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--&lt;prop key=&quot;java.sql.SQLException&quot;&gt;sql-error&lt;/prop&gt;--&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--&amp;lt;!&amp;ndash;这里还可以继续扩展对不同异常类型的处理&amp;ndash;&amp;gt;--&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--&lt;/props&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;/property&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;/bean&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> SSM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> SSM </tag>
            
            <tag> SSM配置 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SSM-8-Spring事务管理</title>
      <link href="posts/3844"/>
      <url>posts/3844</url>
      
        <content type="html"><![CDATA[<p>有了事务好管理</p><span id="more"></span><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>事务：也就是一个用户操作中，需要包含哪些具体操作。这些操作集合在一起，就是事务。这些操作必须是具体的，必要的，不可分割的。要么全部完成，要么全部失败。</p><p>比如你给你朋友转账1000块的操作，分成几个步骤就是：</p><ol><li>自己的账户扣1000块钱</li><li>对方的账户加1000块钱</li><li>把这笔转账行为记录在服务器中</li></ol><p>这三个步骤就具备了<strong>原子性，一致性，隔离性，持久性</strong>。</p><p>原子性：<strong>要么全部完成，有一个完成不了就全部回滚。</strong>比如自己的账户扣钱成功，但是对方的账户加钱失败，那么就回滚，自己的账户的钱恢复到转账钱的余额。</p><p>一致性： <strong>一致性代表了底层数据存储的完整性。</strong>例如你转账给朋友1000块，那你的账户要扣1000块，你朋友的账户得增加1000块，如果只增加了500块，那就是不一致。</p><p>隔离性：<strong>隔离性意味着事务必须在不干扰其他进程或事务的前提下独立执行。</strong>也就是，在事务或工作单元执行完毕之前，其所访问的数据不能受系统其他部分的影响。比如你在给朋友转账的时候，别人给你转账是转不了的。因为要确保你的账户的隔离。</p><p>持久性：<strong>持久性表示在某个事务的执行过程中，对数据所作的所有改动都必须在事务成功结束前保存至某种物理存储设备。</strong>转账后要把这次转账记录在服务器里，不管过了多久都可以查。</p><p>事务的三个主要方法：<code>开启事务 BeginTranscation()</code>，<code>提交 commit()</code> ，<code>回滚 rollback()</code></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> SSM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> SSM </tag>
            
            <tag> 事务管理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SSM-7-统一异常处理</title>
      <link href="posts/59097"/>
      <url>posts/59097</url>
      
        <content type="html"><![CDATA[<p>遇到异常不要慌～</p><span id="more"></span><h2 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h2><p>程序运行过程中总会遇到一些可预知的，不可预知的异常。如果不对这些异常进行捕捉和处理，就会导致程序崩溃、停止运行、闪退等诸多令人体验极差的现象。如果对这些异常一个一个单独处理，则代码显得很臃肿，耦合度高（独立性差），所以要用统一异常处理对所有的代码进行异常处理</p><p>SpringMVC处理异常有三种方式：</p><ol><li>简单异常处理SimpleMappingExceptionResolver</li><li>实现HandlerExceptionResolver接口自定义异常</li><li>使用@ExceptionHandler注解实现异常处理</li></ol><p>在程序中可能出现异常的地方进行捕捉，程序发生异常被捕捉到后，就会调用我们编写的统一异常处理类进行处理</p><h2 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h2><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/SSM-7/1.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/SSM-7/1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="1"></p><h2 id="使用步骤"><a href="#使用步骤" class="headerlink" title="使用步骤"></a>使用步骤</h2><p>由于我们太完美了程序暂时没有什么异常，所以我们得自己制造点异常。</p><p>我们先做一个列表，把控制层，业务层，模型层的各种异常集中链接在这里。</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page isELIgnored=<span class="string">&quot;false&quot;</span> %&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    String path = request.getContextPath();</span><br><span class="line">    String basePath = request.getScheme() + <span class="string">&quot;://&quot;</span> + request.getServerName() + <span class="string">&quot;:&quot;</span> + request.getServerPort() + path + <span class="string">&quot;/&quot;</span>;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;base href=<span class="string">&quot;&lt;%=basePath%&gt;&quot;</span>/&gt;</span><br><span class="line">    &lt;title&gt;Exception&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=<span class="string">&quot;body&quot;</span>&gt;</span><br><span class="line">    &lt;h3&gt;&lt;a href=<span class="string">&quot;db&quot;</span>&gt;控制器中数据库异常&lt;/a&gt;&lt;/h3&gt;</span><br><span class="line">    &lt;h3&gt;&lt;a href=<span class="string">&quot;my&quot;</span>&gt;控制器中自定义异常&lt;/a&gt;&lt;/h3&gt;</span><br><span class="line">    &lt;h3&gt;&lt;a href=<span class="string">&quot;no&quot;</span>&gt;控制器中未知异常&lt;/a&gt;&lt;/h3&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>如下图：</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/SSM-7/2.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/SSM-7/2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2"></p><p>这些链接点击后跳转到控制层里进行处理。而程序不会无端端的就异常，所以我们得先在控制器里弄点异常：自己<strong>主动</strong>抛出一个<em>异常</em> 。</p><h3 id="先主动搞个异常"><a href="#先主动搞个异常" class="headerlink" title="先主动搞个异常"></a>先主动搞个异常</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> SQLException(<span class="string">&quot;控制器中数据库异常&quot;</span>);</span><br></pre></td></tr></table></figure><p>这句话就是主动抛出一个异常。</p><p>整体的代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExceptionController</span></span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/db&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">db</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> SQLException(<span class="string">&quot;控制器中数据库异常&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/my&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">my</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> MyException(<span class="string">&quot;控制器中自定义异常&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/no&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">no</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;控制器中未知异常&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>好了制造好了异常，现在开始来处理。一共有三种方法</p><h3 id="实现HandlerExceptionResolver接口"><a href="#实现HandlerExceptionResolver接口" class="headerlink" title="实现HandlerExceptionResolver接口"></a>实现HandlerExceptionResolver接口</h3><h4 id="1-编写一个类实现HandlerExceptionResolver接口"><a href="#1-编写一个类实现HandlerExceptionResolver接口" class="headerlink" title="1.编写一个类实现HandlerExceptionResolver接口"></a>1.编写一个类实现HandlerExceptionResolver接口</h4><p>异常抛出后，就会被捕捉，捕捉后就要进行处理啦。我们编写一个类，这个类要实现 <code>HandlerExceptionResolver接口</code>里的 <code>resolveException()</code> 方法。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyExceptionHandler</span> <span class="keyword">implements</span> <span class="title">HandlerExceptionResolver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 重写接口方法</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> arg0 servlet请求</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> arg1 servlet响应</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> obj  目标对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ex   异常</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回相应的视图</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">resolveException</span><span class="params">(HttpServletRequest arg0, HttpServletResponse arg1, Object obj, Exception ex)</span> </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; model = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        model.put(<span class="string">&quot;ex&quot;</span>, ex);</span><br><span class="line">        <span class="comment">// 根据不同错误转向不同页面（统一处理），即异常与view的对应关系</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 如果异常属于自定义异常类型</span></span><br><span class="line">        <span class="keyword">if</span> (ex <span class="keyword">instanceof</span> MyException) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string">&quot;exception/my-error&quot;</span>, model);</span><br><span class="line">            <span class="comment">// 如果异常属于数据库异常类型</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ex <span class="keyword">instanceof</span> SQLException) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string">&quot;exception/sql-error&quot;</span>, model);</span><br><span class="line">            <span class="comment">// 如果异常属于未知类型</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string">&quot;exception/error&quot;</span>, model);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>控制层里制造了三种不同的异常 ，这些异常被捕捉后会被送到这里进行处理。这里主要就是根据异常的不同类型返回不同的视图页面。</p><h3 id="3-在SpringMVC配置文件中配置"><a href="#3-在SpringMVC配置文件中配置" class="headerlink" title="3. 在SpringMVC配置文件中配置"></a>3. 在SpringMVC配置文件中配置</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;exception.MyExceptionHandler&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><h3 id="使用-ExceptionHandler注解实现异常处理"><a href="#使用-ExceptionHandler注解实现异常处理" class="headerlink" title="使用@ExceptionHandler注解实现异常处理"></a>使用@ExceptionHandler注解实现异常处理</h3><p>这种是最容易的一种方式，集成简单，扩展性好。</p><h4 id="1-创建一个BaseController类"><a href="#1-创建一个BaseController类" class="headerlink" title="1.创建一个BaseController类"></a>1.创建一个BaseController类</h4><p>创建一个抽象类，并在类中使用@ExceptionHandler注解声明异常处理方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseController</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 异常处理方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request Servlet请求</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ex 异常实例</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回一个视图页面的名称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">exception</span><span class="params">(HttpServletRequest request, Exception ex)</span></span>&#123;</span><br><span class="line">        request.setAttribute(<span class="string">&quot;ex&quot;</span>, ex);</span><br><span class="line">        <span class="keyword">if</span> (ex <span class="keyword">instanceof</span> SQLException) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;404&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( ex <span class="keyword">instanceof</span> MyException) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;exception/my-error&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;exception/error&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-让其他控制器继承这个类"><a href="#2-让其他控制器继承这个类" class="headerlink" title="2.让其他控制器继承这个类"></a>2.让其他控制器继承这个类</h4><p>让其他需要处理异常的类继承这个BaseController类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExceptionController</span> <span class="keyword">extends</span> <span class="title">BaseController</span></span>&#123;</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-注意使用这种方法是配置文件中不要配置任何其他异常处理方法。"><a href="#3-注意使用这种方法是配置文件中不要配置任何其他异常处理方法。" class="headerlink" title="3. 注意使用这种方法是配置文件中不要配置任何其他异常处理方法。"></a>3. 注意使用这种方法是配置文件中不要配置任何其他异常处理方法。</h4><p><strong>注意使用这种方法是配置文件中不要配置任何其他异常处理方法！！！</strong></p><p><strong>注意使用这种方法是配置文件中不要配置任何其他异常处理方法！！！</strong></p><p><strong>注意使用这种方法是配置文件中不要配置任何其他异常处理方法！！！</strong></p><h3 id="简单异常处理SimpleMappingExceptionResolver"><a href="#简单异常处理SimpleMappingExceptionResolver" class="headerlink" title="简单异常处理SimpleMappingExceptionResolver"></a>简单异常处理SimpleMappingExceptionResolver</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.handler.SimpleMappingExceptionResolver&quot;</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--定义默认的异常处理页面，当该异常类型注册时使用--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;defaultErrorView&quot;</span> <span class="attr">value</span>=<span class="string">&quot;error&quot;</span>/&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--定义异常处理页面用来获取异常信息的变量名，默认名为exception--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;exceptionAttribute&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ex&quot;</span>/&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--定义需要特殊处理的异常，用类名活完全路径名为key，异常页名为值--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;exceptionMappings&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;exception.MyException&quot;</span>&gt;</span>my-error<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;java.sql.SQLException&quot;</span>&gt;</span>sql-error<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">               <span class="comment">&lt;!--这里还可以继续扩展对不同异常类型的处理--&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在<strong>SpringMVC配置文件</strong>中配置 <code>SimpleMappingExceptionResolver异常处理器</code> ，即可实现对异常的统一处理。</p><p>主要分默认异常处理页面，获取异常信息的变量名，还有一些需要特殊处理的异常。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>最简单的使用@ExceptionHandler注解的方法，虽然有集成简单，可扩展性好等优点，但是该方法对已有代码存在入侵性，需要修改已有代码，是相关类继承于BaseController。</p><p>而第一种写一个HandlerExceptionResolver的实现类的方法则比较温和，不会对代码进行入侵。记得要在SpringMVC配置文件中托管这个实现类：<code>&lt;bean class=&quot;exception.MyExceptionHandler&quot;/&gt;</code></p><p>最后一种其实最方便啦，配置好就OK，不用增加什么文件。</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> SSM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> SSM </tag>
            
            <tag> 统一异常处理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SSM-6-上传和下载</title>
      <link href="posts/4950"/>
      <url>posts/4950</url>
      
        <content type="html"><![CDATA[<p>来了，上下都来了～</p><span id="more"></span><h2 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h2><p>文件上传和下载是web经常要面对的问题。</p><p>上传的方式有多种，包括：</p><ol><li>使用文件流手工编程上传</li><li>基于commons-fileupload组件的文件上传</li><li>基于Servlet3及以上版本文件上传</li></ol><p>下载经常有两种方式：</p><ol><li>通过超链接实现下载，但是会暴露下载文件的真实位置，并且只能下载存放在web应用所在的目录下的文件。</li><li>利用程序编码实现下载，可以增加安全访问控制，还可以从任意位置提供下载的数据，比如数据库。</li></ol><h2 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h2><h3 id="上传"><a href="#上传" class="headerlink" title="上传"></a>上传</h3><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/SSM-6/1.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/SSM-6/1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="1"></p><p>选择文件前</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/SSM-6/2.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/SSM-6/2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2"></p><p>选择文件后</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/SSM-6/3.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/SSM-6/3.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="3"></p><p>上传文件后</p><h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/SSM-6/4.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/SSM-6/4.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="4"></p><p>可以被下载的文件列表</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/SSM-6/5.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/SSM-6/5.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="5"></p><p>选择文件存储位置</p><h2 id="使用步骤"><a href="#使用步骤" class="headerlink" title="使用步骤"></a>使用步骤</h2><h4 id="导入jar包"><a href="#导入jar包" class="headerlink" title="导入jar包"></a>导入jar包</h4><p>SpringMVC框架的文件上传是基于commons-fileupload组件，所以需要commons-fileupload和commons-io的jar包。</p><p>maven项目：配置pom.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--上传下载--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>非maven项目：将下载好的 <code>commons-fileupload</code> 和 <code>commons-io</code> 的jar放到 <code>webapps\WEB-INF\lib</code> 目录下</p><h3 id="单文件上传"><a href="#单文件上传" class="headerlink" title="单文件上传"></a>单文件上传</h3><h4 id="1-编写领域模型"><a href="#1-编写领域模型" class="headerlink" title="1. 编写领域模型"></a>1. 编写领域模型</h4><p>文件上传后保存在服务器里是一个对象，这个对象我们得定义它的属性。文件上传的时候的文件描述（备注），文件的创建时间等等，最重要的文件本身的类型是 <code>MultipartFile</code> </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileDomain</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    <span class="keyword">private</span> MultipartFile myFile;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDescription</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> description;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDescription</span><span class="params">(String description)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.description = description;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MultipartFile <span class="title">getMyFile</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> myFile;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMyFile</span><span class="params">(MultipartFile myFile)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.myFile = myFile;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-编写一个提交页面"><a href="#2-编写一个提交页面" class="headerlink" title="2. 编写一个提交页面"></a>2. 编写一个提交页面</h4><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page isELIgnored=<span class="string">&quot;false&quot;</span> %&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    String path = request.getContextPath();</span><br><span class="line">    String basePath = request.getScheme() + <span class="string">&quot;://&quot;</span> + request.getServerName() + <span class="string">&quot;:&quot;</span> + request.getServerPort() + path + <span class="string">&quot;/&quot;</span>;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;base href=<span class="string">&quot;&lt;%=basePath%&gt;&quot;</span>/&gt;</span><br><span class="line">    &lt;title&gt;onFile&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form action=<span class="string">&quot;six/oneFileUpLoad&quot;</span> method=<span class="string">&quot;post&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line">    选择文件：&lt;input type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;myFile&quot;</span>/&gt;&lt;br&gt;</span><br><span class="line">    文件描述：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;description&quot;</span>/&gt;&lt;br&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;提交&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>input标签的type属性为file时，就变成选择文件了。</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/SSM-6/6.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/SSM-6/6.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="6"></p><p>**要注意的是：表单form的enctype属性应设置为 <code>multipart/form-data</code>**。然后就可以把表单提交到控制器了： <code>action=&quot;six/oneFileUpload&quot;</code></p><h4 id="3-编写控制器"><a href="#3-编写控制器" class="headerlink" title="3. 编写控制器"></a>3. 编写控制器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/six&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SixController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Log logger = LogFactory.getLog(SixController.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/oneFileUpLoad&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">oneFileUpload</span><span class="params">(<span class="meta">@ModelAttribute</span> FileDomain fileDomain, HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获取存储路径</span></span><br><span class="line">        String realpath = request.getServletContext().getRealPath(<span class="string">&quot;fileUpload&quot;</span>);</span><br><span class="line">        <span class="comment">// 获取文件名</span></span><br><span class="line">        String fileName = fileDomain.getMyFile().getOriginalFilename();</span><br><span class="line">        <span class="comment">// 如果文件名不为null &amp;&amp; 目标文件夹不存在，则新建文件夹</span></span><br><span class="line">        <span class="keyword">assert</span> fileName != <span class="keyword">null</span>;</span><br><span class="line">        File targetFile = <span class="keyword">new</span> File(realpath, fileName);</span><br><span class="line">        <span class="keyword">if</span> (!targetFile.exists()) &#123;</span><br><span class="line">            targetFile.mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 开始上传文件</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            fileDomain.getMyFile().transferTo(targetFile);</span><br><span class="line">            logger.info(<span class="string">&quot;成功&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;6/showOne&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>表单提交到控制器后就由控制器进行处理。</p><ul><li>先获取realPath：文件保存到服务器的哪个地方，也叫存储路径。文件上传后都是存在服务器的，所以这里说的路径是指在服务器上的存储路径。</li><li>然后获取文件的文件名</li><li>如果realPath这个目录不存在，就创建目录</li><li>然后就开始上传文件。上传的关键方法就是 <code>transferTo()</code> </li></ul><p>这里上传成功就会跳转到 <code>/WEB-INF/jsp/6/showOne</code> 页面</p><p>&gt;_</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/SSM-6/3.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/SSM-6/3.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="3"></p><h4 id="4-编写结果页面"><a href="#4-编写结果页面" class="headerlink" title="4. 编写结果页面"></a>4. 编写结果页面</h4><p>也就是上面要跳转的 <code>/WEB-INF/jsp/6/showOne</code> 页面</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page isELIgnored=<span class="string">&quot;false&quot;</span> %&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    String path = request.getContextPath();</span><br><span class="line">    String basePath = request.getScheme() + <span class="string">&quot;://&quot;</span> + request.getServerName() + <span class="string">&quot;:&quot;</span> + request.getServerPort() + path + <span class="string">&quot;/&quot;</span>;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;base href=<span class="string">&quot;&lt;%=basePath%&gt;&quot;</span>/&gt;</span><br><span class="line">    &lt;title&gt;ShowOne&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">$&#123;fileDomain.description&#125;&lt;br&gt;</span><br><span class="line">$&#123;fileDomain.myFile.originalFilename&#125;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><h3 id="多文件上传"><a href="#多文件上传" class="headerlink" title="多文件上传"></a>多文件上传</h3><p>多文件上传和单文件的上传过程是相同的，但是他们的模型是不同的。多文件上传的模型是列表list</p><h4 id="1-领域模型"><a href="#1-领域模型" class="headerlink" title="1.领域模型"></a>1.领域模型</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MultiFileDomain</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> List&lt;String&gt; description;</span><br><span class="line">   <span class="keyword">private</span> List&lt;MultipartFile&gt; myFile;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">getDescription</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> description;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDescription</span><span class="params">(List&lt;String&gt; description)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.description = description;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;MultipartFile&gt; <span class="title">getMyFile</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> myFile;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMyFile</span><span class="params">(List&lt;MultipartFile&gt; myFile)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.myFile = myFile;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>跟单文件上传的类型差不多，不同在于用list去装载。</p><h4 id="2-编写提交页面"><a href="#2-编写提交页面" class="headerlink" title="2.编写提交页面"></a>2.编写提交页面</h4><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page isELIgnored=<span class="string">&quot;false&quot;</span> %&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    String path = request.getContextPath();</span><br><span class="line">    String basePath = request.getScheme() + <span class="string">&quot;://&quot;</span> + request.getServerName() + <span class="string">&quot;:&quot;</span> + request.getServerPort() + path + <span class="string">&quot;/&quot;</span>;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;base href=<span class="string">&quot;&lt;%=basePath%&gt;&quot;</span>/&gt;</span><br><span class="line">    &lt;title&gt;MultiFile&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form action=<span class="string">&quot;six/mutliFile&quot;</span> method=<span class="string">&quot;post&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line">    选择文件<span class="number">1</span>：&lt;input type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;myFile&quot;</span>/&gt; &lt;br&gt;</span><br><span class="line">    文件描述<span class="number">1</span>：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;description&quot;</span>/&gt;&lt;br&gt;</span><br><span class="line">    选择文件<span class="number">2</span>：&lt;input type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;myFile&quot;</span>/&gt; &lt;br&gt;</span><br><span class="line">    文件描述<span class="number">2</span>：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;description&quot;</span>/&gt;&lt;br&gt;</span><br><span class="line">    选择文件<span class="number">3</span>：&lt;input type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;myFile&quot;</span>/&gt; &lt;br&gt;</span><br><span class="line">    文件描述<span class="number">3</span>：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;description&quot;</span>/&gt;&lt;br&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;提交&quot;</span>/&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>同样是enctype属性要设置成 <code>multipart/form-data</code> ，通过action属性提交到控制器</p><h4 id="3-控制器"><a href="#3-控制器" class="headerlink" title="3.控制器"></a>3.控制器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/six&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SixController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Log logger = LogFactory.getLog(SixController.class);</span><br><span class="line">    </span><br><span class="line">4<span class="meta">@RequestMapping(&quot;/mutliFile&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">multiFile</span><span class="params">(<span class="meta">@ModelAttribute</span> MultiFileDomain multiFileDomain, HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获取真实路径</span></span><br><span class="line">        String realpath = request.getServletContext().getRealPath(<span class="string">&quot;fileUpload&quot;</span>);</span><br><span class="line">        <span class="comment">// 如果目标文件夹不存在则新建文件夹</span></span><br><span class="line">        File targetDir = <span class="keyword">new</span> File(realpath);</span><br><span class="line">        <span class="keyword">if</span> (!targetDir.exists()) &#123;</span><br><span class="line">            targetDir.mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 将文件放置到list中</span></span><br><span class="line">        List&lt;MultipartFile&gt; files = multiFileDomain.getMyFile();</span><br><span class="line">        <span class="comment">// 将list中的文件逐个上传</span></span><br><span class="line">        <span class="keyword">for</span> (MultipartFile file : files) &#123;</span><br><span class="line">            String fileName = file.getOriginalFilename();</span><br><span class="line">            <span class="keyword">assert</span> fileName != <span class="keyword">null</span>;</span><br><span class="line">            File targetFile = <span class="keyword">new</span> File(realpath, fileName);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                file.transferTo(targetFile);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        logger.info(<span class="string">&quot;成功&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;6/showMulti&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>控制器里前部分也是相同的，获取存储路径，获取文件名，检查目标目录是否存在。</p><p>区别在于：将传过来的文件放在一个新的List中</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;MultipartFile&gt; files = multiFileDomain.getMyFile();</span><br></pre></td></tr></table></figure><p>然后循环遍历整个List，将文件一个一个上传，然后返回 <code>/WEB-INF/jsp/6/showMulti</code> 页面</p><h3 id="下载-1"><a href="#下载-1" class="headerlink" title="下载"></a>下载</h3><p>利用程序实现下载需要设置两个报头：</p><ol><li><strong>设置Content-Type的值为：application/x-msdownload</strong>，因为web服务器需要告诉浏览器所输出内容的类型不是普通文件文件或是HTML，而是一个要保存到本地的下载文件。</li><li><strong>设置Content-Disposition的值为：attachment</strong>，后面还可以指定filename参数。filename参数就是那个默认保存文件名。如下图红框所示：</li></ol><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/SSM-6/6.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/SSM-6/6.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="6"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">response.setHeader(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/x-msdownload&quot;</span>);</span><br><span class="line">response.setHeader(<span class="string">&quot;Content-Disposition&quot;</span>, <span class="string">&quot;attachment;filename=&quot;</span> + toUTF8(filename));</span><br></pre></td></tr></table></figure><h4 id="1-编写跳转页面"><a href="#1-编写跳转页面" class="headerlink" title="1. 编写跳转页面"></a>1. 编写跳转页面</h4><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page isELIgnored=<span class="string">&quot;false&quot;</span> %&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    String path = request.getContextPath();</span><br><span class="line">    String basePath = request.getScheme() + <span class="string">&quot;://&quot;</span> + request.getServerName() + <span class="string">&quot;:&quot;</span> + request.getServerPort() + path + <span class="string">&quot;/&quot;</span>;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;base href=<span class="string">&quot;&lt;%=basePath%&gt;&quot;</span>/&gt;</span><br><span class="line">    &lt;title&gt;MultiFile&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    &lt;a href=<span class="string">&quot;six/showDownFiles&quot;</span>&gt;文件下载&lt;/a&gt;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>整个页面只有一个a标签的链接。点击之后会跳转到 <code>showDownFiles</code> 控制器</p><h4 id="2-编写列表控制器"><a href="#2-编写列表控制器" class="headerlink" title="2.编写列表控制器"></a>2.编写列表控制器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/six&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SixController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Log logger = LogFactory.getLog(SixController.class);</span><br><span class="line">    </span><br><span class="line">4<span class="meta">@RequestMapping(&quot;/showDownFiles&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">showDown</span><span class="params">(HttpServletRequest request, Model model)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获取存储目录</span></span><br><span class="line">        String realpath = request.getServletContext().getRealPath(<span class="string">&quot;fileUpload&quot;</span>);</span><br><span class="line">        <span class="comment">// 实例化为一个File对象</span></span><br><span class="line">        File dir = <span class="keyword">new</span> File(realpath);</span><br><span class="line">        <span class="comment">// 将目录下的文件放到File数组中</span></span><br><span class="line">        File[] files = dir.listFiles();</span><br><span class="line">        <span class="comment">// 创建一个数组列表，用于返回到前台页面</span></span><br><span class="line">        ArrayList&lt;String&gt; fileName = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">assert</span> files != <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">// 逐一将目录下的文件添加到数组列表中</span></span><br><span class="line">        <span class="keyword">for</span> (File file : files) &#123;</span><br><span class="line">            fileName.add(file.getName());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 将数组列表返回给前台页面</span></span><br><span class="line">        model.addAttribute(<span class="string">&quot;files&quot;</span>, fileName);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;6/showDownFiles&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>列出控制器还是比较简单的：</p><ol><li>获取存储位置</li><li>将路径实例化成一个File对象</li><li>将存储位置里的文件放到File数组中</li><li>创建一个数组列表，然后将文件逐个添加到数组列表中</li><li>将数组列表返回给前台页面</li></ol><h4 id="3-编写下载列表展示页面"><a href="#3-编写下载列表展示页面" class="headerlink" title="3. 编写下载列表展示页面"></a>3. 编写下载列表展示页面</h4><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page isELIgnored=<span class="string">&quot;false&quot;</span> %&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    String path = request.getContextPath();</span><br><span class="line">    String basePath = request.getScheme() + <span class="string">&quot;://&quot;</span> + request.getServerName() + <span class="string">&quot;:&quot;</span> + request.getServerPort() + path + <span class="string">&quot;/&quot;</span>;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;base href=<span class="string">&quot;&lt;%=basePath%&gt;&quot;</span>/&gt;</span><br><span class="line">    &lt;title&gt;ShowDownFiles&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;table&gt;</span><br><span class="line">    &lt;tr&gt;&lt;td&gt;被下载文件名&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">    &lt;c:forEach items=<span class="string">&quot;$&#123;files&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;filename&quot;</span>&gt;&lt;%--<span class="meta">@elvariable</span> id=<span class="string">&quot;filesname&quot;</span> type=<span class="string">&quot;po.six.FileDomain&quot;</span>--%&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;&lt;a href=<span class="string">&quot;six/down?filename=$&#123;filename&#125;&quot;</span>&gt;$&#123;filename&#125;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/c:forEach&gt;</span><br><span class="line">&lt;/table&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>这里用了表单标签库中的 <code>&lt;c:forEach&gt;</code> 标签，将存储目录中的文件列出来，列出来的每一项都是一个超链接，链接指向 <code>six/down</code> 这个下载控制器。效果如下：</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/SSM-6/4.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/SSM-6/4.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="4"></p><h4 id="4-编写下载控制器"><a href="#4-编写下载控制器" class="headerlink" title="4.编写下载控制器"></a>4.编写下载控制器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/six&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SixController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Log logger = LogFactory.getLog(SixController.class);</span><br><span class="line">    </span><br><span class="line">4<span class="meta">@RequestMapping(&quot;/down&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">down</span><span class="params">(<span class="meta">@RequestParam</span> String filename, HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 获取存储位置</span></span><br><span class="line">            String savePath = request.getServletContext().getRealPath(<span class="string">&quot;fileUpload&quot;</span>);</span><br><span class="line">            <span class="comment">// 设置报头</span></span><br><span class="line">            response.setHeader(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/x-msdownload&quot;</span>);</span><br><span class="line">            response.setHeader(<span class="string">&quot;Content-Disposition&quot;</span>, <span class="string">&quot;attachment;filename=&quot;</span> + toUTF8(filename));</span><br><span class="line">            <span class="comment">// 读取服务器上的文件并写入到输出对象中，也就是下载</span></span><br><span class="line">            FileInputStream in = <span class="keyword">new</span> FileInputStream(savePath + <span class="string">&quot;\\&quot;</span> + filename);</span><br><span class="line">            ServletOutputStream out = response.getOutputStream();</span><br><span class="line">            out.flush();</span><br><span class="line">            <span class="keyword">int</span> aRead;</span><br><span class="line">            <span class="keyword">byte</span>[] b = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="keyword">while</span> ((aRead = in.read(b)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                out.write(b, <span class="number">0</span>, aRead);</span><br><span class="line">            &#125;</span><br><span class="line">            out.flush();</span><br><span class="line">            out.close();</span><br><span class="line">            in.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        logger.info(<span class="string">&quot;下载成功&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>下载控制器则做了几件事情：</p><ol><li>获取存储目录</li><li>设置报头</li><li>将目标文件从输入流读取出来，转移到Servlet输出流写入进去，完成下载这个动作</li></ol><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/SSM-6/5.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/SSM-6/5.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="5"></p><p>因为报头的 Content-Disposition 设置为 attachment，所以下载之前浏览器会询问保存位置。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>上传和下载是web中很重要的一项功能，需要彻底掌握。上传的方式有多种，基于commons-fileupload的文件上传还是比较容易的，关键代码就是transferTo()方法。而下载选择用编码实现是为了不暴露文件的真实位置，还有就是可以下载任意位置的文件，所以可以将文件放在数据库中，然后让下载控制器去数据库中读取下载。虽然步骤比较麻烦，但是安全，规范。</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> SSM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> SSM </tag>
            
            <tag> 上传下载 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SSM-5-拦截器</title>
      <link href="posts/46719"/>
      <url>posts/46719</url>
      
        <content type="html"><![CDATA[<p>拦截器其实就是一种中间件</p><span id="more"></span><h2 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h2><p>拦截器 Interceptor 主要用于在 <code>请求到达控制器之前进行验证</code> ，有点类似过滤器。主要用于拦截用户请求并做出相应的处理。通常应用在<strong>权限验证，记录请求信息的日志，判断用户是否登录等</strong>功能上。</p><p>主要的实现方法有两种：</p><ol><li>通过实现 <code>HandlerInterceptor接口</code> 或继承 <code>HandlerInterceptor接口</code> 的实现类来定义。</li><li>通过实现 <code>WebRequestInterceptor接口</code> 或继承<code>WebRequestInterceptor接口</code> 的实现类来定义。</li></ol><h2 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h2><p>拦截器的拦截时间点在这里面分三种：</p><ol><li>请求到达控制器之前调用，比如点击我的购物车的时候，判断用户有没有登录先</li><li>控制器调用之后，返回视图之前。</li><li>解析试图之后。比如访问了XXX的QQ空间，就在视图解析完后记录到访问记录中</li></ol><p>&gt;_</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/SSM-4/1.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/SSM-4/1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="1"></p><p>这里的案例只是在这些方法里打印了一些话来表示出拦截器在什么时间点做了什么</p><h2 id="使用步骤"><a href="#使用步骤" class="headerlink" title="使用步骤"></a>使用步骤</h2><h3 id="1-配置"><a href="#1-配置" class="headerlink" title="1. 配置"></a>1. 配置</h3><p>先在springmvc-servlet.xml中配置拦截器。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;interceptor.AllInterceptor&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这样的配置方式默认对所有请求拦截，也就是任何请求要到达控制器之前都会经过拦截器。</p><p>这种方式的话就是拦截所有的请求，但是请求如果是到<code>/abc</code>这个控制器的话就例外，不拦截。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/**&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">mvc:exclude-mapping</span> <span class="attr">path</span>=<span class="string">&quot;/abc&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;interceptor.Interceptor1&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这种呢就是对发送到<code>/6</code>这个控制器的请求，进行指定的拦截器拦截。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/6&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;interceptor.Interceptor2&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-实现接口"><a href="#2-实现接口" class="headerlink" title="2. 实现接口"></a>2. 实现接口</h3><p>HandlerInterceptor接口中已经有默认的实现方法了，所以implements之后并不会提醒重写方法。</p><p>preHandle：在<strong>请求到达控制器之前</strong>进行拦截</p><p>postHandle：<strong>控制器调用之后，解析试图之前</strong>进行拦截</p><p>afterCompletion：在<strong>解析试图之后</strong>进行拦截</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AllInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;preHandle，请求到达控制器之前&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;postHandle,控制器调用之后，解析试图之前&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;afterCompletion,解析视图之后&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>拦截器是一个比较重要的东西。使用也简单，主要是两点</p><ol><li>编写拦截器的工作，preHandle要干嘛，postHandle要干嘛，afterCompletion要干嘛。</li><li>在springmvc配置文件里编写拦截规则，是全部都拦截用一个全局拦截器？还是某个控制器用某个拦截器？</li></ol>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> SSM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> SSM </tag>
            
            <tag> 拦截器 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SSM-4-数据绑定</title>
      <link href="posts/41307"/>
      <url>posts/41307</url>
      
        <content type="html"><![CDATA[<p>先把数据绑定起来</p><span id="more"></span><h2 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h2><p>数据绑定是将用户参数输入值绑定到领域模型（POJO）的一种特性，在SpringMVC的Controller和View参数传递数据的过程中，所有HTTP请求参数的类型均为字符串，如果模型需要绑定的类型为double或int，则需要手动进行类型转换，而有了数据绑定后：</p><ol><li>不需要手动转型数据了。</li><li>当表单输入验证失败时，会重新生成一个HTML表单，无需重新填写已输入字段。</li></ol><h2 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h2><p>第一次加载的样子</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/SSM-4/1.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/SSM-4/1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="1"></p><p>验证失败后重新加载的样子，前面填过的数据依然保留着</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/SSM-4/2.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/SSM-4/2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2"></p><p>验证成功后进入这个页面</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/SSM-4/3.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/SSM-4/3.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="3"></p><h2 id="使用步骤"><a href="#使用步骤" class="headerlink" title="使用步骤"></a>使用步骤</h2><h3 id="1-导入jar包"><a href="#1-导入jar包" class="headerlink" title="1. 导入jar包"></a>1. 导入jar包</h3><p>maven项目：配置pom.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>taglibs<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>standard<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>非maven项目：将下载好的 <code>taglibs</code> 和 <code>jstl</code> 的jar放到 <code>webapps\WEB-INF\lib</code> 目录下</p><h3 id="2-web-xml中配置编码过滤器"><a href="#2-web-xml中配置编码过滤器" class="headerlink" title="2. web.xml中配置编码过滤器"></a>2. web.xml中配置编码过滤器</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>characterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>characterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3-编写领域模型"><a href="#3-编写领域模型" class="headerlink" title="3. 编写领域模型"></a>3. 编写领域模型</h3><p>定义各种属性和getter&amp;setter方法，太简单，不赘述</p><h3 id="4-编写控制层Controller"><a href="#4-编写控制层Controller" class="headerlink" title="4. 编写控制层Controller"></a>4. 编写控制层Controller</h3><p>因为视图层用的都是表单标签库，所以数据要在controller层定义</p><p>然后通过model.addAttribute()方法将数据传送出去</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/four&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FourController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Log logger = LogFactory.getLog(FourController.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> FourUserService fourUserService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FourController</span><span class="params">(FourUserService fourUserService)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fourUserService = fourUserService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 第一次加载表单会触发这个方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/input&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">inputUser</span><span class="params">(Model model)</span> </span>&#123;</span><br><span class="line">        HashMap&lt;String, String&gt; hobbys = getMap();</span><br><span class="line">44<span class="comment">// 虽然是第一次加载，但是也要在model添加一个领域模型的对象，否则表单标签无法找到modelAttribute属性指定的form backing object</span></span><br><span class="line">        model.addAttribute(<span class="string">&quot;user&quot;</span>, <span class="keyword">new</span> User());</span><br><span class="line">        </span><br><span class="line">        model.addAttribute(<span class="string">&quot;hobbys&quot;</span>, hobbys);</span><br><span class="line">        model.addAttribute(<span class="string">&quot;carrers&quot;</span>, <span class="keyword">new</span> String[]&#123;<span class="string">&quot;教师&quot;</span>, <span class="string">&quot;学生&quot;</span>, <span class="string">&quot;码农&quot;</span>, <span class="string">&quot;民工&quot;</span>&#125;);</span><br><span class="line">        model.addAttribute(<span class="string">&quot;houseRegister&quot;</span>, <span class="keyword">new</span> String[]&#123;<span class="string">&quot;北京&quot;</span>, <span class="string">&quot;上海&quot;</span>, <span class="string">&quot;广州&quot;</span>, <span class="string">&quot;深圳&quot;</span>&#125;);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;userAdd&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 表单提交的时候会触发这个方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">addUser</span><span class="params">(<span class="meta">@ModelAttribute</span> User user, Model model)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 进入业务层验证业务逻辑</span></span><br><span class="line">        <span class="keyword">if</span> (fourUserService.addUser(user)) &#123;</span><br><span class="line">            logger.info(<span class="string">&quot;成功&quot;</span>);</span><br><span class="line">            <span class="comment">// 重定向到本控制器里的list控制方法</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;redirect:list&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        logger.info(<span class="string">&quot;失败&quot;</span>);</span><br><span class="line">        <span class="comment">// 验证失败的时候就到了这里，相当于重新加载，但是会带着已经填过的数据，用户就不用再次填写已经填写过的输入，注意这里没有在model.addAttribute()中new bean()。看不懂请对比上面的input方法</span></span><br><span class="line">        HashMap&lt;String, String&gt; hobbys = getMap();</span><br><span class="line">        model.addAttribute(<span class="string">&quot;hobbys&quot;</span>, hobbys);</span><br><span class="line">        model.addAttribute(<span class="string">&quot;carrers&quot;</span>, <span class="keyword">new</span> String[]&#123;<span class="string">&quot;教师&quot;</span>, <span class="string">&quot;学生&quot;</span>, <span class="string">&quot;码农&quot;</span>, <span class="string">&quot;民工&quot;</span>&#125;);</span><br><span class="line">        model.addAttribute(<span class="string">&quot;houseRegister&quot;</span>, <span class="keyword">new</span> String[]&#123;<span class="string">&quot;北京&quot;</span>, <span class="string">&quot;上海&quot;</span>, <span class="string">&quot;广州&quot;</span>, <span class="string">&quot;深圳&quot;</span>&#125;);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;userAdd&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/list&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">listUsers</span><span class="params">(Model model)</span> </span>&#123;</span><br><span class="line">        List&lt;User&gt; users = fourUserService.getUsers();</span><br><span class="line">        model.addAttribute(<span class="string">&quot;users&quot;</span>, users);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;userList&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> HashMap&lt;String, String&gt; <span class="title">getMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        HashMap&lt;String, String&gt; hobbys = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">5</span>);</span><br><span class="line">        hobbys.put(<span class="string">&quot;篮球&quot;</span>, <span class="string">&quot;篮球&quot;</span>);</span><br><span class="line">        hobbys.put(<span class="string">&quot;乒乓球&quot;</span>, <span class="string">&quot;乒乓球&quot;</span>);</span><br><span class="line">        hobbys.put(<span class="string">&quot;电玩&quot;</span>, <span class="string">&quot;电玩&quot;</span>);</span><br><span class="line">        hobbys.put(<span class="string">&quot;游泳&quot;</span>, <span class="string">&quot;游泳&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> hobbys;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-编写业务逻辑层Service"><a href="#5-编写业务逻辑层Service" class="headerlink" title="5. 编写业务逻辑层Service"></a>5. 编写业务逻辑层Service</h3><p>业务层，业务逻辑都在这里判断</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> service.four;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> po.four.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> pr919</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FourUserServiceImpl</span> <span class="keyword">implements</span> <span class="title">FourUserService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ArrayList&lt;User&gt; users = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addUser</span><span class="params">(User u)</span> </span>&#123;</span><br><span class="line">        String magicValue = <span class="string">&quot;民工&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (!magicValue.equals(u.getCarrer()) &amp;&amp; !<span class="string">&quot;&quot;</span>.equals(u.getUsername()))&#123;</span><br><span class="line">            users.add(u);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ArrayList&lt;User&gt; <span class="title">getUsers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> users;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="6-编写视图层View"><a href="#6-编写视图层View" class="headerlink" title="6. 编写视图层View"></a>6. 编写视图层View</h3><p>视图层的<strong>表单标签</strong>通过<strong>控制层</strong>和<strong>领域模型</strong>绑定在一起，实现了数据绑定。</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">&lt;%-- userAdd.jsp --%&gt;</span><br><span class="line"></span><br><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;form&quot;</span> uri=<span class="string">&quot;http://www.springframework.org/tags/form&quot;</span> %&gt;</span><br><span class="line">&lt;%--</span><br><span class="line">  Created by IntelliJ IDEA.</span><br><span class="line">  User: pr919</span><br><span class="line">  Date: <span class="number">2019.6</span><span class="number">.24</span></span><br><span class="line">  Time: <span class="number">14</span>:<span class="number">41</span></span><br><span class="line">  To change <span class="keyword">this</span> template use File | Settings | File Templates.</span><br><span class="line">--%&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page isELIgnored=<span class="string">&quot;false&quot;</span> %&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    String path = request.getContextPath();</span><br><span class="line">    String basePath = request.getScheme() + <span class="string">&quot;://&quot;</span> + request.getServerName() + <span class="string">&quot;:&quot;</span> + request.getServerPort() + path + <span class="string">&quot;/&quot;</span>;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;base href=<span class="string">&quot;&lt;%=basePath%&gt;&quot;</span>/&gt;</span><br><span class="line">    &lt;title&gt;dataBind&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;%--<span class="meta">@elvariable</span> id=<span class="string">&quot;user&quot;</span> type=<span class="string">&quot;po.four.User&quot;</span>--%&gt;</span><br><span class="line">&lt;form:form modelAttribute=<span class="string">&quot;user&quot;</span> mothod=<span class="string">&quot;post&quot;</span> action=<span class="string">&quot;four/save&quot;</span>&gt;</span><br><span class="line">    &lt;fieldset&gt;</span><br><span class="line">        &lt;legend&gt;添加一个用户&lt;/legend&gt;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            &lt;label&gt;用户名：&lt;/label&gt;</span><br><span class="line">            &lt;form:input path=<span class="string">&quot;username&quot;</span>/&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            &lt;label&gt;爱好：&lt;/label&gt;</span><br><span class="line">            &lt;%--<span class="meta">@elvariable</span> id=<span class="string">&quot;hobbys&quot;</span> type=<span class="string">&quot;java.util.List&quot;</span>--%&gt;</span><br><span class="line">            &lt;form:checkboxes items=<span class="string">&quot;$&#123;hobbys&#125;&quot;</span> path=<span class="string">&quot;hobby&quot;</span>/&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            &lt;label&gt;朋友：&lt;/label&gt;</span><br><span class="line">            &lt;form:checkbox path=<span class="string">&quot;friends&quot;</span> value=<span class="string">&quot;张三&quot;</span>/&gt;<span class="number">1</span></span><br><span class="line">            &lt;form:checkbox path=<span class="string">&quot;friends&quot;</span> value=<span class="string">&quot;李四&quot;</span>/&gt;<span class="number">2</span></span><br><span class="line">            &lt;form:checkbox path=<span class="string">&quot;friends&quot;</span> value=<span class="string">&quot;王五&quot;</span>/&gt;<span class="number">3</span></span><br><span class="line">            &lt;form:checkbox path=<span class="string">&quot;friends&quot;</span> value=<span class="string">&quot;赵六&quot;</span>/&gt;<span class="number">4</span></span><br><span class="line">        &lt;/p&gt;</span><br><span class="line"></span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            &lt;label&gt;职业：&lt;/label&gt;</span><br><span class="line">            &lt;form:select path=<span class="string">&quot;carrer&quot;</span>&gt;</span><br><span class="line">                &lt;option&gt;&lt;/option&gt;</span><br><span class="line">                请选择职业</span><br><span class="line">                &lt;%--<span class="meta">@elvariable</span> id=<span class="string">&quot;carrers&quot;</span> type=<span class="string">&quot;java.util.List&quot;</span>--%&gt;</span><br><span class="line">                &lt;form:options items=<span class="string">&quot;$&#123;carrers&#125;&quot;</span>/&gt;</span><br><span class="line">            &lt;/form:select&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            &lt;label&gt;户籍：&lt;/label&gt;</span><br><span class="line">            &lt;form:select path=<span class="string">&quot;houseRegister&quot;</span>&gt;</span><br><span class="line">                &lt;option&gt;&lt;/option&gt;</span><br><span class="line">                请选择户籍</span><br><span class="line">                &lt;%--<span class="meta">@elvariable</span> id=<span class="string">&quot;houseRegister&quot;</span> type=<span class="string">&quot;java.util.List&quot;</span>--%&gt;</span><br><span class="line">                &lt;form:options items=<span class="string">&quot;$&#123;houseRegister&#125;&quot;</span>/&gt;</span><br><span class="line">            &lt;/form:select&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            &lt;label&gt;个人描述：&lt;/label&gt;</span><br><span class="line">            &lt;form:textarea path=<span class="string">&quot;remark&quot;</span> rows=<span class="string">&quot;5&quot;</span>/&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;p id=<span class="string">&quot;buttons&quot;</span>&gt;</span><br><span class="line">            &lt;input id=<span class="string">&quot;reset&quot;</span> type=<span class="string">&quot;reset&quot;</span> /&gt;</span><br><span class="line">            &lt;input id=<span class="string">&quot;submit&quot;</span> type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;添加&quot;</span>&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">    &lt;/fieldset&gt;</span><br><span class="line">&lt;/form:form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&lt;%-- userAdd.jsp --%&gt;</span><br><span class="line"></span><br><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> %&gt;</span><br><span class="line">&lt;%--</span><br><span class="line">  Created by IntelliJ IDEA.</span><br><span class="line">  User: pr919</span><br><span class="line">  Date: <span class="number">2019.6</span><span class="number">.24</span></span><br><span class="line">  Time: <span class="number">15</span>:<span class="number">18</span></span><br><span class="line">  To change <span class="keyword">this</span> template use File | Settings | File Templates.</span><br><span class="line">--%&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page isELIgnored=<span class="string">&quot;false&quot;</span> %&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    String path = request.getContextPath();</span><br><span class="line">    String basePath = request.getScheme() + <span class="string">&quot;://&quot;</span> + request.getServerName() + <span class="string">&quot;:&quot;</span> + request.getServerPort() + path + <span class="string">&quot;/&quot;</span>;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;base href=<span class="string">&quot;&lt;%=basePath%&gt;&quot;</span>/&gt;</span><br><span class="line">    &lt;title&gt;dataList&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;用户列表&lt;/h1&gt;</span><br><span class="line">&lt;a href=<span class="string">&quot;&lt;c:url value=&quot;</span>four/input<span class="string">&quot;/&gt;&quot;</span>&gt;继续添加&lt;/a&gt;</span><br><span class="line">&lt;table&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;th&gt;用户名&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;兴趣爱好&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;朋友&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;职业&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;户籍&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;个人描述&lt;/th&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line"></span><br><span class="line">    &lt;c:forEach items=<span class="string">&quot;$&#123;users&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;user&quot;</span>&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;$&#123;user.username&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;</span><br><span class="line">                &lt;c:forEach items=<span class="string">&quot;$&#123;user.hobby&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;hobby&quot;</span>&gt;</span><br><span class="line">                    $&#123;hobby&#125;&amp;nbsp;</span><br><span class="line">                &lt;/c:forEach&gt;</span><br><span class="line">            &lt;/td&gt;</span><br><span class="line">            &lt;td&gt;</span><br><span class="line">                &lt;c:forEach items=<span class="string">&quot;$&#123;user.friends&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;friend&quot;</span>&gt;</span><br><span class="line">                    $&#123;friend&#125;&amp;nbsp;</span><br><span class="line">                &lt;/c:forEach&gt;</span><br><span class="line">            &lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;user.carrer&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;user.houseRegister&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;user.remark&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/c:forEach&gt;</span><br><span class="line">&lt;/table&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>目前来说，除了不用手动转型之外，我还没想到这个数据绑定有什么用。如果是为了验证输入的话，用javaScript或ajax就够了。</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> SSM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> SSM </tag>
            
            <tag> 数据绑定 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C-Note</title>
      <link href="posts/60258"/>
      <url>posts/60258</url>
      
        <content type="html"><![CDATA[<p>C语言笔记</p><span id="more"></span><h3 id="指针"><a href="#指针" class="headerlink" title="指针"></a>指针</h3><p>定义指针：<code>dataType * pointerName = NULL</code>;</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> * ptr_a = <span class="literal">NULL</span>;</span><br></pre></td></tr></table></figure><p>指针赋值：<code>pointerName = &amp;varName</code>;</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a = <span class="number">10</span>;</span><br><span class="line">ptr_a = &amp;a;</span><br></pre></td></tr></table></figure><p>对于指针，其实就是存放地址的变量</p><p><code>int a = 10;</code> 这句话等于申请了一块内存，放了个值10进去，起个别命叫<code>a</code> 。那这个空间的地址假设是 0028FF，那<code>ptr_a = &amp;a</code> 这句话就是再申请一块内存，把0028FF放进去，起个别名叫<code>ptr_a</code> 。</p><p><code>&amp;</code> 这个符号是取地址的意思</p><p><code>*</code> 这个符号则是取这个指针变量中，那个地址的内存中的 值，也就是直接操作内存，修改内存里的内容</p><h3 id="值传递-引用传递"><a href="#值传递-引用传递" class="headerlink" title="值传递  引用传递"></a>值传递  引用传递</h3><p>值传递：传递一份副本，传递后操作的只是副本，也就是对变量的副本进行操作，变量本身不会变化</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">change</span><span class="params">(<span class="keyword">int</span> num)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    num ++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">4<span class="keyword">int</span> num = <span class="number">9</span>;</span><br><span class="line">4change(num);</span><br><span class="line">4<span class="built_in">printf</span>(<span class="string">&quot;num = %d&quot;</span>, num);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 结果：9</span></span><br></pre></td></tr></table></figure><p>引用传递：<code>&amp;var</code>， 传递的是地址，传递后操作的是该地址中的值，也就是对变量本身进行操作</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">change</span><span class="params">(<span class="keyword">int</span> * num)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">4*num ++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">4<span class="keyword">int</span> num = <span class="number">9</span>;</span><br><span class="line">    change(&amp;num);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;num = %d&quot;</span>, num);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 结果：10</span></span><br></pre></td></tr></table></figure><p>值传递就是普通操作，引用传递就是操作指针（骚操作）</p><h3 id="变量的生存周期"><a href="#变量的生存周期" class="headerlink" title="变量的生存周期"></a>变量的生存周期</h3><table><thead><tr><th>存储类型说明符</th><th>存储类型</th><th>说明</th></tr></thead><tbody><tr><td>auto</td><td>自动存储</td><td>只能用于块作用域中的变量，局部变量默认情况下归为自动存储类型</td></tr><tr><td>register</td><td>寄存器存储</td><td>只能用于块作用域中的变量，请求速度快，适用在循环次数多的循环变量/反复使用的变量。</td></tr><tr><td>static</td><td>静态存储</td><td>载入程序时创建对象，程序结束时对象消失。</td></tr><tr><td>extern</td><td>外部变量</td><td>说明符表示生命的变量定义在别处。作用域是整个程序，生存周期贯穿应用程序的开始和结束。跟static一样。</td></tr></tbody></table><h3 id="头文件"><a href="#头文件" class="headerlink" title="头文件"></a>头文件</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> HEADFILENAME_H_INCLUDE</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HEADFILENAME_H_INCLUDE</span></span><br><span class="line">4</span><br><span class="line">4<span class="comment">// TODO</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Note </category>
          
          <category> C Language </category>
          
      </categories>
      
      
        <tags>
            
            <tag> note </tag>
            
            <tag> C Language </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java-About-Hash</title>
      <link href="posts/33205"/>
      <url>posts/33205</url>
      
        <content type="html"><![CDATA[<p>Hash 是一种很神奇的数据结构</p><span id="more"></span><h2 id="HashTable"><a href="#HashTable" class="headerlink" title="HashTable"></a>HashTable</h2><p><strong>HashTable 散列表 哈希表：</strong> 是一种数据结构，它提供快速的插入和查找操作，不管表中有多少数据，插入删除和查找的时间都接近O(1)</p><p><strong>优点：</strong>HashTable其实是基于数组的，所以在查询方面非常的快，同时它不像普通数组那样紧密排列，在数值未满的时候所有的值其实是散部在数组中的某个位置上的，所以在插入和删除的时候不用像普通数组一样让余下的值一个个的挪。</p><p><strong>缺点：</strong>同时也因为它的基于数组的，所以创建以后难以扩展，当HashTable被基本填满的时候，性能严重下降，而且不能顺序遍历。</p><p>一个输入传进来的时候会经过<strong>散列函数</strong>，计算出一个值，这个值就是这个输入在HashTable中的位置，称为<strong>HashCode 哈希值 散列值</strong>。</p><p>当HashTable中的值还不多的时候各种操作的效率是非常高的，但是HashTable快满的时候各种操作的效率就开始变低了</p><h2 id="开放寻址法"><a href="#开放寻址法" class="headerlink" title="开放寻址法"></a>开放寻址法</h2><h3 id="线性探测方法"><a href="#线性探测方法" class="headerlink" title="线性探测方法"></a>线性探测方法</h3><blockquote><p>比如一个HashTable的长度是8，现在只剩下 <del>6</del> 这个位置是空的</p><p>而一个输入经过散列函数计算之后得到的结果是 <del>7</del> ，一看 <del>7</del> 上面有人占了，怎么办呢？</p><p>往下找空位咯，<del>7</del> 下面是 <del>0</del> ，有人了，下一个 <del>1</del> ，有人了，下一个 <del>2</del> ，有人了…下一个 <del>6</del> ，耶没人，上去！ </p><p>这样几乎遍历了一整个数组，效率是非常低的，HashTable小的时候还能忍受，如果HashTable长度是2000呢?20000呢？</p></blockquote><p>上述的方法其实就是当散列函数计算出来的值上面已经有值的时候的解决方法之一，<strong>开放寻址法</strong>中的<strong>线性探测</strong>，往下找空位，找到进填进去。最坏的情况下就是几乎遍历整个数组。</p><h3 id="二次探测方法"><a href="#二次探测方法" class="headerlink" title="二次探测方法"></a>二次探测方法</h3><p>另一种的思路有那么点像二分查找法，叫做<strong>二次探测方法</strong></p><blockquote><p>比如表中只有 <del>3</del> 是有空位的，其余都是满的</p><p>而一个输入经过散列函数计算之后得到的结果是 <del>7</del>，一看 <del>7</del> 上面有人了，怎么办呢？</p><p>CurrentCode + 0，CurrentCode + 1^2^ ，CurrentCode - 1 ^2^，CurrentCode + 2^2^，CurrentCode - 2^2^，……</p><p>7不行就 + 1^2^ = 8，8还是不行，那就7 - 1^2^ = 6，6还是不行，那就7 - 2^2^ = 3，3可以，上去！</p></blockquote><p>因为进行试探的步长都是二次方，所以叫 <strong>二次探测方法</strong></p><h3 id="双重散列方法"><a href="#双重散列方法" class="headerlink" title="双重散列方法"></a>双重散列方法</h3><p>还有一种方法叫做 <strong>双重散列方法</strong></p><blockquote><p>就是使用第一个哈希函数计算的值如果被占用了，就找第二个哈希函数，直到找到空闲的存储位置</p></blockquote><p>不管用那种方法，只要HashTable空位不多的时候散列冲突的概率就会大大提高，尽可能保证HashTable中有一定比例的空位。</p><p>一般用<strong>加载因子</strong>来表示空位的多少。加载因子越大表示约满，反之亦然。</p><h2 id="链表法"><a href="#链表法" class="headerlink" title="链表法"></a>链表法</h2><p>HashTable中每个元素对应一条链表，所有散列值相同的元素放到相同的链表中。如下图</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Java-about-hash/HashMap.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Java-about-hash/HashMap.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="链表法"></p><p>查找的时候先通过HashCode找到位置，然后将值与链表中的值逐个使用 equals() 对比。</p><h2 id="But"><a href="#But" class="headerlink" title="But"></a>But</h2><p>但其实HashTable是元素数量不能超过总容量的一半，当HashTable太满的时候，一个选择是扩容数组，创建一个新的容量为 <code>CurrentCapacity * 1.34 + n = 2^m </code>  的数组，把值放到新数组，但是元素的索引没法复制，会被重新哈希化。<br>$$<br>CurrentCapacity * 1.34 + n = 2^m = NewCapacity<br>$$</p><h2 id="举个栗子"><a href="#举个栗子" class="headerlink" title="举个栗子"></a>举个栗子</h2><p>一本字典有1000页，当你要查找Link这个词的时候，肯定想去翻目录，目录显示在第666页，那么你是不是可以直接翻到666页找这个单词？也就是所Link这个单词在<code>散列表[666]</code>，但是第666页可能不止这一个单词哦，那你是不是要一个一个进行equals才能知道是哪个呢？因为知道在哪一条链表上，所以尽管遍历看起来很慢，但总比遍历所有链表快吧？</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Hash </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java-反射</title>
      <link href="posts/13406"/>
      <url>posts/13406</url>
      
        <content type="html"><![CDATA[<p>Java 神器：反射</p><span id="more"></span><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Person p = <span class="keyword">new</span> Person();</span><br><span class="line"></span><br><span class="line"><span class="comment">/**获取*/</span></span><br><span class="line">Class&lt;?&gt; clazz = p.getClass(); <span class="comment">// 得知道类对象</span></span><br><span class="line">Class&lt;?&gt; clazz =  Person.class;<span class="comment">//得知道类名</span></span><br><span class="line">Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;com.tcp404.Person&quot;</span>);<span class="comment">//得知道类的全路径名</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/** 获取方法 */</span></span><br><span class="line">Method method = clazz.getDeclaredMethod(<span class="string">&quot;方法名&quot;</span>, <span class="keyword">new</span> Class()&#123;[参数类型.class, 参数类型.class, ...]&#125;);</span><br><span class="line">Methods[] methods = clazz.getDeclaredMethods();</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 获取属性 */</span></span><br><span class="line">Field field = clazz.getDeclaredField(<span class="string">&quot;属性名字&quot;</span>);</span><br><span class="line">Field[] fields = clazz.getDeclaredFields();</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 获取构造器 */</span></span><br><span class="line">Constructor&lt;?&gt; con = clazz.getDeclaredConstructor(<span class="keyword">new</span> Class()&#123;[参数类型.class, 参数类型.class, ...]&#125;);</span><br><span class="line">Constructor&lt;?&gt;[] cs = clazz.getDeclaredConstructors();</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> 反射 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git命令大全</title>
      <link href="posts/18012"/>
      <url>posts/18012</url>
      
        <content type="html"><![CDATA[<p>One more thing</p><span id="more"></span><h1 id="Git-常用命令"><a href="#Git-常用命令" class="headerlink" title="Git 常用命令"></a>Git 常用命令</h1><p>&gt;_</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Git-basic-operation/git%E8%AF%B4%E6%98%8E.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Git-basic-operation/git%E8%AF%B4%E6%98%8E.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="git"></p><ul><li>Workspace：工作区</li><li>Index / Stage：暂存区</li><li>Repository：仓库区（或本地仓库）</li><li>Remote：远程仓库</li></ul><p><strong>先放上一张常用Git 命令导航图</strong></p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Git-basic-operation/git%E5%B8%B8%E7%94%A8.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Git-basic-operation/git%E5%B8%B8%E7%94%A8.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="GIT"></p><h2 id="一、新建代码库"><a href="#一、新建代码库" class="headerlink" title="一、新建代码库"></a>一、新建代码库</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">在当前目录新建一个Git代码库（常用）</span><br><span class="line">git init</span><br><span class="line"></span><br><span class="line">新建一个目录，将其初始化为Git代码库</span><br><span class="line">git init [project-name]</span><br><span class="line"></span><br><span class="line">下载一个项目和它的整个代码历史（常用）</span><br><span class="line">git clone [url]</span><br></pre></td></tr></table></figure><h2 id="二、配置"><a href="#二、配置" class="headerlink" title="二、配置"></a>二、配置</h2><p>Git的设置文件为.gitconfig，它可以在用户主目录下（全局配置），也可以在项目目录下（项目配置）。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">显示当前的Git配置</span><br><span class="line">git config --list</span><br><span class="line"></span><br><span class="line">编辑Git配置文件</span><br><span class="line">git config -e [--global]</span><br><span class="line"></span><br><span class="line">设置提交代码时的用户信息</span><br><span class="line">git config [--global] user.name &quot;[name]&quot;</span><br><span class="line">git config [--global] user.email &quot;[email address]&quot;</span><br></pre></td></tr></table></figure><h2 id="三、增加-删除文件"><a href="#三、增加-删除文件" class="headerlink" title="三、增加/删除文件"></a>三、增加/删除文件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">添加指定文件到暂存区（常用）</span><br><span class="line">git add [file1] [file2] ...</span><br><span class="line"></span><br><span class="line">添加指定目录到暂存区，包括子目录</span><br><span class="line">git add [dir]</span><br><span class="line"></span><br><span class="line">添加当前目录的所有文件到暂存区（常用）</span><br><span class="line">git add .</span><br><span class="line"></span><br><span class="line">添加每个变化前，都会要求确认</span><br><span class="line">对于同一个文件的多处变化，可以实现分次提交</span><br><span class="line">git add -p</span><br><span class="line"></span><br><span class="line">删除工作区文件，并且将这次删除放入暂存区</span><br><span class="line">git rm [file1] [file2] ...</span><br><span class="line"></span><br><span class="line">停止追踪指定文件，但该文件会保留在工作区</span><br><span class="line">git rm --cached [file]</span><br><span class="line"></span><br><span class="line">改名文件，并且将这个改名放入暂存区</span><br><span class="line">git mv [file-original] [file-renamed]</span><br></pre></td></tr></table></figure><h2 id="四、代码提交"><a href="#四、代码提交" class="headerlink" title="四、代码提交"></a>四、代码提交</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">提交暂存区到仓库区（常用）</span><br><span class="line">git commit -m [message]</span><br><span class="line"></span><br><span class="line">提交暂存区的指定文件到仓库区（常用）</span><br><span class="line">git commit [file1] [file2] ... -m [message]</span><br><span class="line"></span><br><span class="line">提交工作区自上次commit之后的变化，直接到仓库区</span><br><span class="line">git commit -a</span><br><span class="line"></span><br><span class="line">提交时显示所有diff信息</span><br><span class="line">git commit -v</span><br><span class="line"></span><br><span class="line">使用一次新的commit，替代上一次提交</span><br><span class="line">如果代码没有任何新变化，则用来改写上一次commit的提交信息</span><br><span class="line">git commit --amend -m [message]</span><br><span class="line"></span><br><span class="line">重做上一次commit，并包括指定文件的新变化</span><br><span class="line">git commit --amend [file1] [file2] ...</span><br></pre></td></tr></table></figure><h2 id="五、分支"><a href="#五、分支" class="headerlink" title="五、分支"></a>五、分支</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">列出所有本地分支（常用）</span><br><span class="line">git branch</span><br><span class="line"></span><br><span class="line">列出所有远程分支</span><br><span class="line">git branch -r</span><br><span class="line"></span><br><span class="line">列出所有本地分支和远程分支（常用）</span><br><span class="line">git branch -a</span><br><span class="line"></span><br><span class="line">新建一个分支，但依然停留在当前分支（常用）</span><br><span class="line">git branch [branch-name]</span><br><span class="line"></span><br><span class="line">新建一个分支，并切换到该分支（常用）</span><br><span class="line">git checkout -b [branch]</span><br><span class="line"></span><br><span class="line">新建一个分支，指向指定commit</span><br><span class="line">git branch [branch] [commit]</span><br><span class="line"></span><br><span class="line">新建一个分支，与指定的远程分支建立追踪关系</span><br><span class="line">git branch --track [branch] [remote-branch]</span><br><span class="line"></span><br><span class="line">切换到指定分支，并更新工作区（常用）</span><br><span class="line">git checkout [branch-name]</span><br><span class="line"></span><br><span class="line">切换到上一个分支（常用）</span><br><span class="line">git checkout -</span><br><span class="line"></span><br><span class="line">建立追踪关系，在现有分支与指定的远程分支之间</span><br><span class="line">git branch --set-upstream [branch] [remote-branch]</span><br><span class="line"></span><br><span class="line">合并指定分支到当前分支</span><br><span class="line">git merge [branch]</span><br><span class="line"></span><br><span class="line">选择一个commit，合并进当前分支</span><br><span class="line">git cherry-pick [commit]</span><br><span class="line"></span><br><span class="line">删除分支（常用）</span><br><span class="line">git branch -d [branch-name]</span><br><span class="line"></span><br><span class="line">删除远程分支</span><br><span class="line">git push origin --delete [branch-name]</span><br><span class="line">git branch -dr [remote/branch]</span><br></pre></td></tr></table></figure><h2 id="六、标签"><a href="#六、标签" class="headerlink" title="六、标签"></a>六、标签</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">列出所有tag</span><br><span class="line">git tag</span><br><span class="line"></span><br><span class="line">新建一个tag在当前commit</span><br><span class="line">git tag [tag]</span><br><span class="line"></span><br><span class="line">新建一个tag在指定commit</span><br><span class="line">git tag [tag] [commit]</span><br><span class="line"></span><br><span class="line">删除本地tag</span><br><span class="line">git tag -d [tag]</span><br><span class="line"></span><br><span class="line">删除远程tag</span><br><span class="line">git push origin :refs/tags/[tagName]</span><br><span class="line"></span><br><span class="line">查看tag信息</span><br><span class="line">git show [tag]</span><br><span class="line"></span><br><span class="line">提交指定tag</span><br><span class="line">git push [remote] [tag]</span><br><span class="line"></span><br><span class="line">提交所有tag</span><br><span class="line">git push [remote] --tags</span><br><span class="line"></span><br><span class="line">新建一个分支，指向某个tag</span><br><span class="line">git checkout -b [branch] [tag]</span><br></pre></td></tr></table></figure><h2 id="七、查看信息"><a href="#七、查看信息" class="headerlink" title="七、查看信息"></a>七、查看信息</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">显示有变更的文件（常用）</span><br><span class="line">git status</span><br><span class="line"></span><br><span class="line">显示当前分支的版本历史（常用）</span><br><span class="line">git log</span><br><span class="line"></span><br><span class="line">显示commit历史，以及每次commit发生变更的文件</span><br><span class="line">git log --stat</span><br><span class="line"></span><br><span class="line">搜索提交历史，根据关键词</span><br><span class="line">git log -S [keyword]</span><br><span class="line"></span><br><span class="line">显示某个commit之后的所有变动，每个commit占据一行</span><br><span class="line">git log [tag] HEAD --pretty=format:%s</span><br><span class="line"></span><br><span class="line">显示某个commit之后的所有变动，其&quot;提交说明&quot;必须符合搜索条件</span><br><span class="line">git log [tag] HEAD --grep feature</span><br><span class="line"></span><br><span class="line">显示某个文件的版本历史，包括文件改名</span><br><span class="line">git log --follow [file]</span><br><span class="line">git whatchanged [file]</span><br><span class="line"></span><br><span class="line">显示指定文件相关的每一次diff</span><br><span class="line">git log -p [file]</span><br><span class="line"></span><br><span class="line">显示过去5次提交</span><br><span class="line">git log -5 --pretty --oneline</span><br><span class="line"></span><br><span class="line">显示所有提交过的用户，按提交次数排序</span><br><span class="line">git shortlog -sn</span><br><span class="line"></span><br><span class="line">显示指定文件是什么人在什么时间修改过</span><br><span class="line">git blame [file]</span><br><span class="line"></span><br><span class="line">显示暂存区和工作区的代码差异（常用）</span><br><span class="line">git diff</span><br><span class="line"></span><br><span class="line">显示暂存区和上一个commit的差异</span><br><span class="line">git diff --cached [file]</span><br><span class="line"></span><br><span class="line">显示工作区与当前分支最新commit之间的差异</span><br><span class="line">git diff HEAD</span><br><span class="line"></span><br><span class="line">显示两次提交之间的差异</span><br><span class="line">git diff [first-branch]...[second-branch]</span><br><span class="line"></span><br><span class="line">显示今天你写了多少行代码</span><br><span class="line">git diff --shortstat &quot;@&#123;0 day ago&#125;&quot;</span><br><span class="line"></span><br><span class="line">显示某次提交的元数据和内容变化（常用）</span><br><span class="line">git show [commit]</span><br><span class="line"></span><br><span class="line">显示某次提交发生变化的文件</span><br><span class="line">git show --name-only [commit]</span><br><span class="line"></span><br><span class="line">显示某次提交时，某个文件的内容</span><br><span class="line">git show [commit]:[filename]</span><br><span class="line"></span><br><span class="line">显示当前分支的最近几次提交</span><br><span class="line">git reflog</span><br><span class="line"></span><br><span class="line">从本地master拉取代码更新当前分支：branch 一般为master</span><br><span class="line">git rebase [branch]</span><br></pre></td></tr></table></figure><h2 id="八、远程同步"><a href="#八、远程同步" class="headerlink" title="八、远程同步"></a>八、远程同步</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">git remote update  --更新远程仓储（常用）</span><br><span class="line">下载远程仓库的所有变动</span><br><span class="line">git fetch [remote]</span><br><span class="line"></span><br><span class="line">显示所有远程仓库</span><br><span class="line">git remote -v</span><br><span class="line"></span><br><span class="line">显示某个远程仓库的信息</span><br><span class="line">git remote show [remote]</span><br><span class="line"></span><br><span class="line">增加一个新的远程仓库，并命名</span><br><span class="line">git remote add [shortname] [url]</span><br><span class="line"></span><br><span class="line">取回远程仓库的变化，并与本地分支合并（常用）</span><br><span class="line">git pull [remote] [branch]</span><br><span class="line"></span><br><span class="line">上传本地指定分支到远程仓库（常用）</span><br><span class="line">git push [remote] [branch]</span><br><span class="line"></span><br><span class="line">强行推送当前分支到远程仓库，即使有冲突</span><br><span class="line">git push [remote] --force</span><br><span class="line"></span><br><span class="line">推送所有分支到远程仓库</span><br><span class="line">git push [remote] --all</span><br></pre></td></tr></table></figure><h2 id="九、撤销"><a href="#九、撤销" class="headerlink" title="九、撤销"></a>九、撤销</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">恢复暂存区的指定文件到工作区</span><br><span class="line">git checkout [file]</span><br><span class="line"></span><br><span class="line">恢复某个commit的指定文件到暂存区和工作区</span><br><span class="line">git checkout [commit] [file]</span><br><span class="line"></span><br><span class="line">恢复暂存区的所有文件到工作区</span><br><span class="line">git checkout .</span><br><span class="line"></span><br><span class="line">重置暂存区的指定文件，与上一次commit保持一致，但工作区不变</span><br><span class="line">git reset [file]</span><br><span class="line"></span><br><span class="line">重置暂存区与工作区，与上一次commit保持一致(取消所有修改)（常用）</span><br><span class="line">git reset --hard</span><br><span class="line"></span><br><span class="line">重置当前分支的指针为指定commit，同时重置暂存区，但工作区不变</span><br><span class="line">git reset [commit]</span><br><span class="line"></span><br><span class="line">重置当前分支的HEAD为指定commit，同时重置暂存区和工作区，与指定commit一致</span><br><span class="line">git reset --hard [commit]</span><br><span class="line"></span><br><span class="line">重置当前HEAD为指定commit，但保持暂存区和工作区不变</span><br><span class="line">git reset --keep [commit]</span><br><span class="line"></span><br><span class="line">新建一个commit，用来撤销指定commit</span><br><span class="line">后者的所有变化都将被前者抵消，并且应用到当前分支</span><br><span class="line">git revert [commit]</span><br><span class="line"></span><br><span class="line">暂时将未提交的变化移除，稍后再移入（常用）</span><br><span class="line">git stash</span><br><span class="line">git stash pop</span><br></pre></td></tr></table></figure><h2 id="十、其他"><a href="#十、其他" class="headerlink" title="十、其他"></a>十、其他</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">生成一个可供发布的压缩包（常用）</span><br><span class="line">git archive</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
            <tag> 命令 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>多端同步管理Hexo博客</title>
      <link href="posts/41079"/>
      <url>posts/41079</url>
      
        <content type="html"><![CDATA[<p>多端管理其实很简单。</p><span id="more"></span><p>hexo 其实是帮我们编译好放在<code>博客根目录\public</code>目录下的，然后把<code>public目录</code>推送到github上的，所以说github.io上面都是编译过的文件，他们是光鲜亮丽的演员，但离不开默默付出的后台人员。这些默默付出的后台人员就是除了public之外的所有的文件。</p><p>我们的博客是发布到master主分支的，那就建另一个分支，把所有文件都传上去，在别的电脑上都拉下去就可以了。</p><h3 id="1-首先填写忽略声明文件-gitignore"><a href="#1-首先填写忽略声明文件-gitignore" class="headerlink" title="1. 首先填写忽略声明文件.gitignore"></a>1. 首先填写忽略声明文件<code>.gitignore</code></h3><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.DS_Store</span></span><br><span class="line">Thumbs<span class="number">.</span><span class="built_in">db</span></span><br><span class="line"><span class="built_in">db</span><span class="number">.</span>json</span><br><span class="line">*.log</span><br><span class="line">node_modules/</span><br><span class="line"><span class="meta">public</span>/</span><br><span class="line"><span class="meta">.deploy</span>*/</span><br><span class="line">_config<span class="number">.</span>yml</span><br></pre></td></tr></table></figure><ul><li>public  每次都会编译覆盖，所以不需要它</li><li>.deploy*   编译产生的文件，也不需要</li><li>_config.yml  配置文件里会有一些id/key的重要信息，所以不上传</li></ul><h3 id="2-初始化仓库和提交"><a href="#2-初始化仓库和提交" class="headerlink" title="2. 初始化仓库和提交"></a>2. 初始化仓库和提交</h3><p>之前我以为hexo就是帮我们操作git，所以不明白为什么还能再初始化git</p><p>后来才知道不是那么回事。但是hexo是怎么操作我还是没明白。这里不管</p><p>像往常一样，在根目录右键 git bash here</p><blockquote><p>注意！！！大坑！！！</p><p>如果你用的是第三方的主题theme，是使用git clone下来的话，要把主题文件夹下面把.git文件夹删除掉，不然主题无法push到远程仓库，导致你发布的博客是一片空白。所以先去检查你使用的主题有没有.git这个目录</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git init  //初始化本地仓库</span><br><span class="line">git add . //添加本地所有文件到仓库        </span><br><span class="line">git commit -m &quot;blog源文件&quot; //添加commit</span><br><span class="line">git branch backup //添加本地仓库分支hexo</span><br><span class="line">git remote add origin &lt;server&gt;  //添加远程仓库 &lt;server&gt; 是指在线仓库的地址 origin是本地分支,remote add操作会将本地仓库映射到云端</span><br><span class="line">git push origin backup //将本地仓库的源文件推送到远程仓库hexo分支</span><br></pre></td></tr></table></figure><h3 id="在另一台电脑的操作"><a href="#在另一台电脑的操作" class="headerlink" title="在另一台电脑的操作"></a>在另一台电脑的操作</h3><p>首先肯定要搭建环境啦（Node 和 Git）</p><p>完了后用这个命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone &lt;server&gt; hexo //&lt;server&gt; 是指在线仓库的地址</span><br><span class="line">cd hexo </span><br><span class="line">npm install</span><br></pre></td></tr></table></figure><p>npm install的时候会根据package.json中的插件列表自动加载相应插件。<br> 本机的同步完成。</p><blockquote><p>因为在上传博客源文件的时候忽略了配置文件（_config.yml这是站点的配置文件）的上传，也就是没有上传配置文件的，在克隆下来的时候记得把配置文件拿过来，不然会报错。主题里面的配置文件也要（themes/next/_config.yml这是主题配置文件）</p></blockquote><p>这里贴一张常用Git命令</p><p>&gt;_</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Git-basic-operation/git%E5%B8%B8%E7%94%A8.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Git-basic-operation/git%E5%B8%B8%E7%94%A8.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="git常用命令"></p>]]></content>
      
      
      <categories>
          
          <category> HEXO </category>
          
          <category> Git </category>
          
          <category> Note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HEXO </tag>
            
            <tag> note </tag>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>几句话区分并行和并发</title>
      <link href="posts/38965"/>
      <url>posts/38965</url>
      
        <content type="html"><![CDATA[<p>吃饭和打电话你选择哪个？</p><span id="more"></span><h3 id="举个栗子"><a href="#举个栗子" class="headerlink" title="举个栗子"></a>举个栗子</h3><ul><li>你在吃饭，电话进来，你等到吃完了才接电话 –&gt; 你<strong>不支持</strong>【并行或者并发】</li></ul><p>（1个CPU，队列式执行任务，这个做完了才做下一个，不允许插队）</p><ul><li>你在吃饭，电话进来，接一下电话，吃一下饭，交替进行，说明你<strong>支持</strong>【并发】 </li></ul><p>（一个CPU，多个任务同时进行，这个做一下，那个做一下，回过来这个再做一下…，允许插队）</p><ul><li>你在吃饭，电话进来，你继续吃饭，秘书帮你接电话，说明你<strong>支持</strong>【并行】</li></ul><p>（多于一个CPU，多个任务同时进行，各忙各的）</p><p>&gt;_</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/cover/parallel-concurrent.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/cover/parallel-concurrent.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="1"></p><h3 id="正儿八经的胡说一下"><a href="#正儿八经的胡说一下" class="headerlink" title="正儿八经的胡说一下"></a>正儿八经的胡说一下</h3><p><strong>并发主要是指：同一时间 【段】 “同时”做多件事</strong></p><p>比如一边打电话一边吃饭。人脑肯定是没法同时专注在两个事情上的，所以你的注意力会一下在电话上（听电话里说什么），一下在吃饭上（大脑下达抬手张嘴咀嚼的指令），CPU也是如此。</p><p>吃饭一个线程，接电话一个线程。分给吃饭线程一点时间片，分给接电话一点时间片，吃饭的时间片执行完了切到电话线程执行，电话线程的时间片执行完了切到吃饭线程，因为切换的快，所以感觉像同时进行。</p><p>这里时间片不懂的话就姑且理解为能量条，CPU切过来执行吃饭线程，吃饭线程的能量条就开始消耗，消耗完了CPU就走了去消耗电话线程的能量条了。与此同时吃饭线程的能量条在CPU切走的时候瞬间满了，CPU那边消耗完了又过来吃饭线程消耗这边的能量条，耗完了又走了。如此往复直到任务执行完毕。</p><p><strong>并行只要是指：同一时间 【点】 “同时”做多件事</strong></p><p>还是上面吃饭打电话的例子，电话来了你吃你的，电话秘书帮你接。你处理吃饭的事情，秘书处理电话的事情，所以就不用CPU切来切去的。因为有两个CPU了嘛（你 和 秘书）。</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul><li><p>一个收银员，只能排一条队伍，一个一个来，就是<strong>不支持并发并行</strong></p></li><li><p>一个收银员，可以排多条队伍，这边忙忙那边忙忙，就是<strong>支持并发</strong></p></li><li><p>多个收银员，可以排多条队伍，一个收银员处理一条队伍，就是<strong>支持并行</strong></p></li></ul><p>可见CPU只有一个的时候，就是假同时；多个CPU的时候，才是真正意义上的同时。</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> 并行与并发 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>当小程序开发完成后</title>
      <link href="posts/6343"/>
      <url>posts/6343</url>
      
        <content type="html"><![CDATA[<p>开发小程序后的一点总结</p><span id="more"></span><p>本来没想搞小程序的，谁知道寒假突然脑子发热，看了点视频和文章，就着现成的点子开始搞起来。</p><p>从1月20日到4月2日，平均每天投入10+小时，历经三次改版，一次阉割，无数次和UI吵架，总算把GoTE小程序做出来了。</p><h2 id="小程序"><a href="#小程序" class="headerlink" title="小程序"></a>小程序</h2><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">小程序名：GoTE行程发布小程序</span><br><span class="line">样式库：ColorUI</span><br><span class="line">插件：<span class="module-access"><span class="module"><span class="identifier">WxValidate</span>.</span></span>js（表单验证）</span><br><span class="line">外部API：高德地图开放平台（用于获取打车费用&lt;已阉割&gt;）</span><br><span class="line">前端：小程序原生</span><br><span class="line">后端：小程序云开发环境</span><br><span class="line">数据库：云开发 -&gt; 云数据库</span><br></pre></td></tr></table></figure><p>&gt;_</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/After-develop-minipro/%E7%95%8C%E9%9D%A2%E8%AE%BE%E8%AE%A11.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/After-develop-minipro/%E7%95%8C%E9%9D%A2%E8%AE%BE%E8%AE%A11.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="index"></p><p>&gt;_</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/After-develop-minipro/%E7%95%8C%E9%9D%A2%E8%AE%BE%E8%AE%A12.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/After-develop-minipro/%E7%95%8C%E9%9D%A2%E8%AE%BE%E8%AE%A12.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="index"></p><p>项目最初的出发点是由于学校地处偏僻，出行不便，坐公车经常拥挤且一站到底。打车费用又十分昂贵，且独自出行来往于学校这偏僻之地具有一定危险性。校外非法黑车趁机拉帮结派，用略低于滴滴的价格拉拢学生乘坐。为了大幅盈利设置了拼车一项，一行4人35元，但是单人拼车费用要17元！</p><p>所以我决定自己开发一个小程序供同学们发布行程信息，有相同行程的人可以互相联系一同出行，即节省了出行成本，又避免单独外出。</p><p>于是1月20日正式开动，在此后的不间断每天投入10+小时在其中，从产品定位，功能定义，开发，测试等等，历经73天最终定版，提交审核。</p><p>正当我满心欢喜的提交审核两天之后，审核团队冷冰冰的打回，再之后不管多少次修改都只有冷冰冰的这么一句话</p><p>&gt;_</p><p><img src="%E5%BD%93%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91%E5%AE%8C%E6%88%90%E5%90%8E/1.png" class="lazyload" data-srcset="%E5%BD%93%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91%E5%AE%8C%E6%88%90%E5%90%8E/1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="审核回复"></p><p>我只是一个单纯的行程发布平台，连个车字都没有哪来的涉及拼车？不管是反馈还是重新提交都只有这么冷冰冰的一句话。</p><p>此项目对我来说有非凡的意义，</p><ol><li>第一个完整的个人项目</li><li>第一次完成想法落地实现的完整执行</li><li>第一次靠自学完成一个项目</li></ol><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>在被腾讯审核团队冷冰冰的打回N次之后，开始有些心灰意冷。在这次项目中，还是有一些体会的。</p><ol><li><p>在开发过程中慢慢明白了，小程序其实可以理解为一个微信内置浏览器，开发小程序的过程就跟开发网页类似。不过小程序封装了很多接口，提供了很多实现。如果是有开发经验的程序员，稍微熟悉语法就可以快速开发出一个完整的小程序，不夸张的说，一个商城，从零开始，快则半月，慢则一月。</p></li><li><p>小程序本身的局限性所致，小程序注定无法完全替代App。作为分销引流可以，要完全替代不太现实。小程序开发完全部资源包括代码不能超过2M，且运行载荷不能太大，否则会被微信的机制强制退出。如果你手机太老，还会把你的微信给强制退出（闪退）。所以承担一点分销展示的任务可以，完全搬上小程序会导致体验极其的差。参考 微信支付 -&gt; 酒店 -&gt; 同程艺龙小程序。大量的网络请求，实测 Iphone6 plus IOS 10.2 上运行体验很差.</p></li><li><p>像微信小程序，支付宝小程序，百度小程序等这种开发都是寄人篱下。用人家的平台，人家接口，享受人家封装好带来的便利，需要付出的代价就是非常严格的审核。这种情况下只能祈福于客服，出了问题或是疑问有个靠谱的客服或者回应显得尤为重要。像微信这种机器人只能说(ta)呵(ma)呵(de)了。</p></li><li><p>做成一件事情很难，特别是这种涉及很多用户，用户之间产生交流的事情，你要够专业，够团结，够投入，够拼，能力够强。GoTE是一个面向学生的，开放的平台，也就是说用户与用户之间会产生交流。在涉及到这种用户之间交流（社交）的时候就需要格外小心。比如GoTE：</p><ul><li><strong>第一</strong>要面临的问题就是用户身份验证。怎么确定你是学生？哪个学校的学生？目前能想到的就是利用超级课程表的方式，利用爬虫接入各学校教务系统，学生提供账号密码验证码，登录到教务系统中验证。</li><li><strong>第二</strong>怎么保障共同出行过程的顺利？怎么尽量确保双方之间不会发生矛盾（因为路费或是任何问题）？</li></ul><p> 看似简单的两个问题其实需要大量的工作。不过我只有一个人，很需要帮手。</p></li></ol><p>此文作为第一次实际行动的总结记录</p><p>谨此</p>]]></content>
      
      
      <categories>
          
          <category> Other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> note </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>通信中的加密与解密-详细版</title>
      <link href="posts/12119"/>
      <url>posts/12119</url>
      
        <content type="html"><![CDATA[<p>换个详细点的捋一捋</p><span id="more"></span><p>首先，用户的操作系统会内置一些CA机构的CA证书</p><blockquote><p>CA证书：CA机构颁发给自己的证书</p></blockquote><p>组成：</p><ul><li>CA的公钥</li><li>颁发者</li><li>颁发机构</li><li>有效期</li><li>其他内容</li><li>签名（CA私钥加密过）：<ul><li>对以上内容进行hash=&gt;hash值</li><li>hash的算法</li></ul></li></ul><p>这里签名是CA私钥加密过的，如果黑客用公钥解开签名，然后篡改信息再Hash，带上hash算法，就没办法加密回去，因为没CA私钥。</p><p>如果篡改成自己的公钥，再hash，带上hash算法，用自己的私钥加密（签名），这就是伪造CA证书，这样等于白干，因为操作系统会提示这个证书不可信，不过CA证书一般都是操作系统内置的，不需要网络请求，所以没机会拦截篡改。一般问题都出在CA机构内部。</p><p>那一个网站，它首先要找CA机构认证，认证完CA机构会给一张证书，这个就是网站证书了</p><blockquote><p>网站证书：CA机构给网站颁发的证书</p></blockquote><p>组成：</p><ul><li>网站的公钥</li><li>颁发者（CA机构）</li><li>颁发机构（网站）</li><li>有效期</li><li>其他内容</li><li>CA签名，也就是指纹（CA私钥加密过的）：<ul><li>对以上内容进行hash=&gt;hash值</li><li>hash的算法</li></ul></li></ul><p>这里的CA签名也是用CA私钥加密过的，如果黑客用CA公钥解开签名，然后篡改网站的公钥再hash，带上hash算法，就没法加密回去，因为没CA私钥。用黑客自己的私钥加密回去的话，用户拿到证书，根据颁发者（CA机构）拿出CA公钥，它解不开黑客的私钥。那就通信终止了。</p><h2 id="场景："><a href="#场景：" class="headerlink" title="场景："></a>场景：</h2><ul><li>首先用户请求网站给个证书看看</li><li>网站给了网站证书</li><li>用户就根据证书的颁发者去操作系统找颁发者的证书（也就是操作系统中的CA证书），去拿到CA公钥出来</li><li>然后用CA公钥解开CA签名拿到hash值1和hash算法</li><li>然后用hash算法自己计算整个证书的内容得到hash值2</li><li>对比hash值1和hash值2来验证网站证书有没有被篡改</li><li>验证通过后会生成一串随机字符串，自己保留一份，然后发一份让网站用网站的私钥加密这串随机字符串</li><li>网站把这串随机字符串用网站的私钥加密，发回给客户</li><li>用户再用证书上的网站的公钥去解，能解开，解开后对比回来的随机字符串和自己保留的那份随机字符串是不是一致</li><li>一致则说明对方就是服务器，而不是黑客瞎搞</li></ul><blockquote><p>为了服务器安全所以用户先hash一下再发，服务器加密就行了。用户解密完对比回来的hash跟自己留着的hash是不是一直就行了。hash过才能防止黑客发送一些有规律的字符串给服务器，从而寻找加密的规律。以此保护服务器私钥的安全</p></blockquote><p>如果证书没问题，对方却是黑客，那字符串用黑客的私钥加密，用户用网站的公钥是解不开的。<br>除非黑客能弄到网站的私钥，才能在这插一脚，像上面说的黑客发送有规律的字符串<br>不过被hash解决了，接下来就要传输密钥了。</p><hr><p>用户验证了一直，就用自己生成一串密钥，然后用网站的公钥加密，发给网站<br>网站用网站的私钥解密，得到密钥。<br>然后双方开始用密钥加密信息通信。</p><hr><p>通信的时候用户的数据写完，会先把内容hash一下生成摘要，再用密钥加密<br>网站收到之后会先用密钥解密，然后网站自己hash一下内容生成摘要，对比传过来的摘要看看是否一致<br><code>是</code>就没问题，<code>不一致</code>则说明黑客在中间捣乱。则断开连接</p><p>所以用密钥的时候，其实是 信息内容本身+hash出来的信息摘要，然后才加密</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Encrypt-Decrypt/1.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Encrypt-Decrypt/1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="总结"></p>]]></content>
      
      
      <categories>
          
          <category> RSA </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RSA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCode-笔记【No-4】0x09-回文数</title>
      <link href="posts/13460"/>
      <url>posts/13460</url>
      
        <content type="html"><![CDATA[<p>LeetCode 第9题</p><span id="more"></span><h3 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h3><p>判断一个整数是否是回文数。回文数是指正序（从左向右）和倒序（从右向左）读都是一样的整数。</p><blockquote><p>示例 1:<br>输入: 121<br>输出: true</p></blockquote><blockquote><p>示例 2:<br>输入: -121<br>输出: false</p></blockquote><p>解释: 从左向右读, 为 -121 。 从右向左读, 为 121- 。因此它不是一个回文数。</p><blockquote><p>示例 3:<br>输入: 10<br>输出: false</p></blockquote><p>解释: 从右向左读, 为 01 。因此它不是一个回文数。</p><blockquote><p>进阶:<br>你能不将整数转为字符串来解决这个问题吗？</p></blockquote><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><ul><li>首先根据题意，负数肯定是不符合要求的。那第一步先判断给进来的数是不是小于0，是直接返回出去。</li><li>要达成回文数一般都要三位数，但是0~9，11，22，33…也可以是回文数，所以小于100的数也要处理一下</li><li>现在开始解题，会有两种情况，数字长度为奇数 和 偶数</li><li>如果是偶数，只要后半段 == 前半段，return ture</li><li>如果是奇数，只要前半段 == 后半段 / 10，return ture</li></ul><p>代码过程和计算水仙花数类似</p><p>把传进来的数x取余数k赋值给res，然后x 自除 10，第二轮res自乘10再＋取余数k</p><p>res向上迭代，x向下迭代，最后进行比较。如果遇到数字位数是奇数位就比较前半段是否等于后半段÷10</p><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isPalindrome</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (x &lt; <span class="number">0</span> || x % <span class="number">10</span> == <span class="number">0</span> )  <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (x &gt; res)&#123;</span><br><span class="line">            res = res * <span class="number">10</span> + x % <span class="number">10</span>;</span><br><span class="line">            x /= <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> x == res || x == res / <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输入 1221，我们可以将数字“1221”的后半部分从“21”反转为“12”，并将其与前半部分“12”进行比较，因为二者相同，我们得知数字 1221 是回文。</p>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCode-笔记【No-3】0x0D-罗马数字转整数</title>
      <link href="posts/64290"/>
      <url>posts/64290</url>
      
        <content type="html"><![CDATA[<p>LeetCode 第13题</p><span id="more"></span><h3 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h3><p>罗马数字包含以下七种字符: I， V， X， L，C，D 和 M。</p><table><thead><tr><th>字符</th><th>数值</th></tr></thead><tbody><tr><td>I</td><td>1</td></tr><tr><td>V</td><td>5</td></tr><tr><td>X</td><td>10</td></tr><tr><td>L</td><td>50</td></tr><tr><td>C</td><td>100</td></tr><tr><td>D</td><td>500</td></tr><tr><td>M</td><td>1000</td></tr></tbody></table><p>例如， 罗马数字 2 写做 II ，即为两个并列的 1。12 写做 XII ，即为 X + II 。 27 写做  XXVII, 即为 XX + V + II 。</p><blockquote><p>通常情况下，罗马数字中小的数字在大的数字的右边。但也存在特例，例如 4 不写做 IIII，而是 IV。数字 1 在数字 5 的左边，所表示的数等于大数 5 减小数 1 得到的数值 4 。同样地，数字 9 表示为 IX。这个特殊的规则只适用于以下六种情况：</p></blockquote><ul><li>I 可以放在 V (5) 和 X (10) 的左边，来表示 4 和 9。</li><li>X 可以放在 L (50) 和 C (100) 的左边，来表示 40 和 90。 </li><li>C 可以放在 D (500) 和 M (1000) 的左边，来表示 400 和 900。</li></ul><p>给定一个罗马数字，将其转换成整数。输入确保在 1 到 3999 的范围内。</p><blockquote><p>示例 1:</p></blockquote><p>输入: “III”</p><p>输出: 3</p><blockquote><p>示例 2:</p></blockquote><p>输入: “IV”</p><p>输出: 4</p><blockquote><p>示例 3:</p></blockquote><p>输入: “IX”</p><p>输出: 9</p><blockquote><p>示例 4:</p></blockquote><p>输入: “LVIII”</p><p>输出: 58</p><p>解释: L = 50, V= 5, III = 3.</p><blockquote><p>示例 5:</p></blockquote><p>输入: “MCMXCIV”</p><p>输出: 1994</p><p>解释: M = 1000, CM = 900, XC = 90, IV = 4.</p><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><ol><li>首先建立一个HashMap来映射符号和值</li><li>然后对字符串从左到右来，如果当前字符代表的值不小于其右边，就加上该值；否则就减去该值。</li><li>以此类推到最右边的数，最终得到的结果即是答案</li></ol><p>这是LeetCode评论上的一条思路。非常简单粗暴。</p><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">romanToInt</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        Map&lt;Character,Integer&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&#x27;I&#x27;</span>,<span class="number">1</span>);</span><br><span class="line">        map.put(<span class="string">&#x27;V&#x27;</span>,<span class="number">5</span>);</span><br><span class="line">        map.put(<span class="string">&#x27;X&#x27;</span>,<span class="number">10</span>);</span><br><span class="line">        map.put(<span class="string">&#x27;L&#x27;</span>,<span class="number">50</span>);</span><br><span class="line">        map.put(<span class="string">&#x27;C&#x27;</span>,<span class="number">100</span>);</span><br><span class="line">        map.put(<span class="string">&#x27;D&#x27;</span>,<span class="number">500</span>);</span><br><span class="line">        map.put(<span class="string">&#x27;M&#x27;</span>,<span class="number">1000</span>);</span><br><span class="line">        <span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> size = s.length();</span><br><span class="line">        <span class="comment">//最后一位不需要判断所以循环次数是size-1</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size - <span class="number">1</span>; i ++) &#123;</span><br><span class="line">            <span class="comment">//如果左边的数字小于右边的数字</span></span><br><span class="line">            <span class="keyword">if</span> (map.get(s.charAt(i)) &gt;= map.get(s.charAt(i+<span class="number">1</span>)))&#123;</span><br><span class="line">                 res += map.get(s.charAt(i));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//如果左边数字小于右边的数字（也就是通常4和9的情况）</span></span><br><span class="line">                res -= map.get(s.charAt(i)); </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//最后一位没被判断到，所以没被加上，记得加上去</span></span><br><span class="line">        res += map.get(s.charAt(size - <span class="number">1</span>));</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这里的if判断先写多数的情况，也就是左边的数大于右边的数。</p><p>这样才不会把时间浪费在 先判断少数情况（左边 小于右边），再执行多数情况的运算</p>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCode-笔记【No-2】0x07-整数反转</title>
      <link href="posts/45196"/>
      <url>posts/45196</url>
      
        <content type="html"><![CDATA[<p>LeetCode 第7题</p><span id="more"></span><h3 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h3><blockquote><p>给出一个 32 位的有符号整数，你需要将这个整数中每位上的数字进行反转。<br>示例 1: 输入:  123  输出: 321<br>示例 2: 输入: -123 输出: -321<br>示例 3: 输入: 120   输出: 21<br>注意: 假设我们的环境只能存储得下 32 位的有符号整数，则其数值范围为 [−2^31, 2^31 − 1]。请根据这个假设，如果反转后整数溢出那么就返回 0。</p></blockquote><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>一开始的思路是把数字取模然后放到int数组里，但是这样复杂又难实现，时间复杂度上也没优势</p><p>后来看到网络上的答案，思路是这样的： 首先把要判断这个数是否超范围 然后再把这个数x拿来取模，获得最后一个数并赋值给一个新的变量 然后x自除10，进入下一次循环 第二次循环的时候新变量自乘10再加取模得到的数。最后返回这个新变量</p><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">reverse</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> rev = <span class="number">0</span>;            <span class="comment">//新变量</span></span><br><span class="line">        <span class="keyword">while</span> (x != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//判断我们取得的数是否超范围</span></span><br><span class="line">            <span class="comment">// 2^31-1 = 2147483647   |  -2^31 = -2147483648</span></span><br><span class="line">            <span class="keyword">if</span> (rev &gt; Integer.MAX_VALUE/<span class="number">10</span> || (rev == Integer.MAX_VALUE / <span class="number">10</span> &amp;&amp; pop &gt; <span class="number">7</span>)) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (rev &lt; Integer.MIN_VALUE/<span class="number">10</span> || (rev == Integer.MIN_VALUE / <span class="number">10</span> &amp;&amp; pop &lt; -<span class="number">8</span>)) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">             <span class="keyword">int</span> pop = x % <span class="number">10</span>;        <span class="comment">//取模拿到个位数</span></span><br><span class="line">             rev = rev * <span class="number">10</span> + pop;      <span class="comment">//自身×10空出个位，然后加上刚刚取模出来的数</span></span><br><span class="line">             x /= <span class="number">10</span>;                   <span class="comment">//迭代条件。因为x是int类型，所以÷10以后小数点就被省略了</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> rev;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这种思路，就不需要把数字切成一个一个再拼接。直接利用数字的特性，通过取模和乘除运算带达到效果。</p><ul><li>时间复杂度：O(log(x))，x 中大约有 log{10}(x)位数字。</li><li>空间复杂度：O(1)</li></ul>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCode-笔记【No-1】0x01-两数之和</title>
      <link href="posts/52628"/>
      <url>posts/52628</url>
      
        <content type="html"><![CDATA[<p>LeetCode 第1题</p><span id="more"></span><h3 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h3><p>给定一个整数数组  <code>nums</code> 和一个目标值 <code>target</code>，请你在该数组中找出和为目标值的那 <strong>两个</strong> 整数，并返回他们的数组下标。</p><p>你可以假设每种输入只会对应一个答案。但是，你不能重复利用这个数组中同样的元素。</p><h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>给定 nums = [2, 7, 11, 15], target = 9</p><p>因为 nums[<strong>0</strong>] + nums[<strong>1</strong>] = 2 + 7 = 9</p><p>所以返回 [<strong>0, 1</strong>]</p><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>思路非常简单，就是把要找的数字target，减去第一个的差，是否等于第二个数</p><p>如果是，返回这两个数的下标，如果不是，循环继续。</p><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] twoSum(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> target) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.length - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = i+<span class="number">1</span>; j &lt; nums.length; j ++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (nums[j] == target - nums[i]) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[] &#123; i , j &#125;;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>第一层循环取第一个数i，然后进入第二层循环，</p><p>第二层循环从第二个数j 开始，判断要找的数-第一个数i 的差 是否等于 第二个数 j</p><p>如果不是第二层取第三个数，再进行比较。</p><p>如果第二层遍历完还没结果说明第一层的第一个数i不对，所以第一层取第二个数</p><p>再次进入第二层依次遍历。</p><p>当差等于第二层的某个数的时候，说明找到了，返回i和j的下标。</p><p>时间复杂度：O(n)</p><p>空间复杂度：O(n)</p>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>通信中的加密与解密</title>
      <link href="posts/42106"/>
      <url>posts/42106</url>
      
        <content type="html"><![CDATA[<p>怎么和聊天才能不被人看到信息内容？</p><span id="more"></span><h1 id="加密与解密"><a href="#加密与解密" class="headerlink" title="加密与解密"></a>加密与解密</h1><blockquote><p>应用场景：通信</p></blockquote><h3 id="传统的通信场景：明文"><a href="#传统的通信场景：明文" class="headerlink" title="传统的通信场景：明文"></a>传统的通信场景：明文</h3><p>&gt;_</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Encrypt-Decrypt/1.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Encrypt-Decrypt/1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="1"></p><p>如果这时候有个Hacker在中间嗅探他们的通信链路，那他们的内容就全都被看到了，甚至会被篡改</p><p>&gt;_</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Encrypt-Decrypt/2.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Encrypt-Decrypt/2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2"></p><h3 id="加密-amp-解密"><a href="#加密-amp-解密" class="headerlink" title="加密&amp;解密"></a>加密&amp;解密</h3><p>明文有问题，那就加密，让中间的Hacker看不懂</p><h4 id="凯撒密码"><a href="#凯撒密码" class="headerlink" title="凯撒密码"></a>凯撒密码</h4><p><strong>通过约定的偏移和回正，达到A、B都看得懂，中间人看不懂的目的</strong></p><p>加密：A发送的信息，全部右偏移3个字母</p><p>解密：B接收后左回正3个字母，就得到正确信息了。</p><p><strong>例如</strong>：<code>Hello world</code></p><p>右偏移后变成 <code>Khnnr zrung</code></p><p><strong>但是</strong>这样的加密太容易被破解了。凯撒密码是一种很古老的在战争中使用过的一种加密信件的方式，这里不说汉字，就说英文26个字母，最多进行（回正1，回正2，回正3…回正25,回正-1，回正-2…回正-25）共50次就可以破解。</p><h4 id="对称加密"><a href="#对称加密" class="headerlink" title="对称加密"></a>对称加密</h4><p><strong>A、B都将信息异或运算</strong></p><p>如果将信息转成二进制，然后和另一个二进制(这里用E表示)，得到加密结果</p><p>那加密结果和E异或就能得到原本的信息的二进制，再转换成文字就得到了信息。</p><p><code>A ^ E = C</code>    <code>C ^ E = A</code></p><p><strong>例如</strong>：</p><blockquote><p>加密的一方</p></blockquote><p>假设 Hello world 的二进制是 0110 0101 1101 </p><p>E 是：                    0101 1001 1010</p><p>加密（异或）的结果就是:    0011 1100 0111</p><blockquote><p>解密的一方</p></blockquote><p>收到了加密的信息:        0011 1100 0111</p><p>E 是：                    0101 1001 1010</p><p>解密（异或）的结果就是：0110 0101 1101</p><p>&gt;_</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Encrypt-Decrypt/3.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Encrypt-Decrypt/3.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="对称加密"></p><p>这就是利用异或的特性来进行信息的加密。所以关键的E 就叫做<strong>密钥</strong>（所以拿到密钥就能破解了）。</p><p>要确保双方都有 E 这把密钥。</p><p>对称加密有3个特点：</p><ul><li>仅做XOR（异或）运算，速度快    –优点</li><li>密钥跟数据长度相等     –缺点</li><li>双方需要提前拥有密钥</li></ul><h5 id="加密分片"><a href="#加密分片" class="headerlink" title="加密分片"></a>加密分片</h5><p>对称加密的缺点也明显，密钥长度跟数据长度相等。</p><p>解决的办法是：</p><p>把信息分组，每组对应一段密钥，分别做异或运算就可以得到<strong>密文分片</strong>，再合并到一起就得到密文（加密的信息）了。</p><p>接收的一方分别做异或运算得到<strong>明文分片</strong>，在合并到一起就得到原本的信息了。</p><p>加密分片的特点：</p><ul><li>数据按密钥长度分组，不足的填充</li><li>可以并行计算各个分组，优化了性能</li><li>密文跟明文的序列存在规律对应关系</li></ul><p>上面说的就是DES的ECB模式加密</p><p>不过这种简单的分组模式也是很容易发现规律</p><p>一般的改进思路是：信息第一次分组、加密、合并得到了一次密文，然后再进行第二次分组、加密、合并得到二次密文。</p><p>或者第一次分组，一次加密、二次加密、合并。</p><h4 id="非对称加密"><a href="#非对称加密" class="headerlink" title="非对称加密"></a>非对称加密</h4><p><strong>请求方请求公钥，接收方发送公钥，请求方加密后发送，接收方用私钥解密</strong></p><blockquote><p>那密钥这么好，但是有个问题：E（密钥）怎么传输？明文还是密文？</p></blockquote><p>答案是：明文。</p><p>那密钥是明文的，被Hacker嗅探到了，那上面那些不都白费了。</p><p>所以就有了 <strong>非对称加密</strong></p><p>&gt;_</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Encrypt-Decrypt/4.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Encrypt-Decrypt/4.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="非对称加密"></p><p>简单说就是：我先要个保险箱，然后把密钥放进去，关上。这个保险箱只有你开的了，所以被Hacker截获了他也开不了。</p><p>这就是非对称加密。谁都可以跟B拿保险箱，只有B自己才开得了保险箱。</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">打开状态的<span class="comment">[保险箱]</span> == 公钥</span><br><span class="line"></span><br><span class="line">关闭状态的<span class="comment">[保险箱]</span> == 密文</span><br><span class="line"></span><br><span class="line">保险箱钥匙 == 私钥</span><br></pre></td></tr></table></figure><p>他们的特点就是：</p><ul><li>任何人都可以请求并拿到公钥</li><li>用公钥加密明文变成密文</li><li>仅能用私钥解开密文得到明文</li><li>私钥不能丢失</li></ul><p>RSA就是这样一个公钥（保险箱）私钥（钥匙）的算法，具体的数学应用利用了 <em>大质数相乘难以分解</em>，<em>费马小定理</em> 等数学理论，使得它难以破解（思考：所以从质数、小定理这些数学理论入手，是不是有机会破解非对称加密？）。</p><blockquote><p>非对称加密需要做乘法模除等运算，性能效率比对称加密差很多。</p><p>对称加密需要做异或预算，性能效率比较高。</p><p>那么就综合起来，用非对称加密传输密钥E，然后再用对称加密传输数据。</p></blockquote><h4 id="认证"><a href="#认证" class="headerlink" title="认证"></a>认证</h4><p><strong>找个我们都信得过的组织来保证我们不会被骗走密钥</strong></p><p>接上面的思考，其实不用那么麻烦，硬刚刚不赢，可以曲线救国嘛~~</p><p>&gt;_</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Encrypt-Decrypt/5.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Encrypt-Decrypt/5.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="认证"></p><p>如上，因为Hacker在中间截胡，所以他两边欺骗，然后只是做一个转发的工作。这个过程中，信息就给他看完了，而A、B都以为自己在跟对方通信，其实都被Hacker欺骗了。接下来开始传输数据的时候，Hacker前面拿到了密钥，所以他能解密任何数据，这样就绕过了非对称加密，保险箱不起作用了。</p><h5 id="CA证书"><a href="#CA证书" class="headerlink" title="CA证书"></a>CA证书</h5><blockquote><p>那要怎么保证A请求B的公钥（保险箱）后，对方发过来的公钥（保险箱）就一定是B的呢？</p></blockquote><p>这里就需要一个彼此信任的组织，给每个人发身份证。就好像我们信任政府发的个人身份证（假设身份证没法伪造），所以我们看到个人身份证的时候就相信这个叫身份证上的名字。</p><p><strong>在加密中，这个政府就是CA，身份证就是CA证书、CA数字签名。</strong></p><p>大家都信任CA，所以检查CA证书后我们就相信B 是 B。</p><p>这个证书里面有两个重要的内容：<strong>B的公钥+CA做的数字签名</strong></p><p>CA证书是<strong>反过来的</strong>，用私钥加密，用公钥解密。</p><p>CA用自己的私钥加密B的信息，A手里都有CA的公钥，在收到信息的时候，用CA的公钥解密，如果能解开，就证明B就是B。</p><p>换句话说，A请求B发保险箱过来，B先把保险箱给CA做个记号（CA认证加密），然后再发给A，A收到后看看记号跟CA约定的一不一样（CA的公钥解不解得开），如果Hacker发一个自己的保险箱，上面是没记号的（或者记号跟约定的不一样），那就说明这个保险箱是假的。</p><p>&gt;_</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Encrypt-Decrypt/6.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Encrypt-Decrypt/6.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="CA证书"></p><p>以上就是一个简单的过程，Hacker发的假保险箱（公钥）跟CA约定的不一样（CA公钥解不开），A就停止发送密钥，Hacker欺骗失败</p><h4 id="完整性"><a href="#完整性" class="headerlink" title="完整性"></a>完整性</h4><p>非对称加密 和 认证 解决了保密性和真实性，但是完整性还没有一个保障。</p><blockquote><p>如果Hacker等A、B非对称加密传输完密钥之后，在对称加密传输数据这个环节入手，篡改信息怎么办？</p></blockquote><p>答案是：哈希一下</p><p>单向哈希（Hash）可以把一个输入变成一个定长的输出串，它的特点就是无法从这个输入逆向还原输入内容，并且输入只要有一点改变，哪怕是那么一丢丢，输出串都会完全不同。</p><p>&gt;_</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Encrypt-Decrypt/7.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Encrypt-Decrypt/7.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="完整性"></p><p>这里哈希并不是这么简单，只需要知道哈希不可逆，一点点改变都会导致结果完全不同。</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>安全可靠的通信：</p><ol><li>B让CA用 # CA私钥 # 签名 [B的公钥]（给B的保险箱做个记号）</li><li>A请求B给 [B的公钥]（打开的保险箱）</li><li>B发送签名过的 [[B的公钥]]（带记号的保险箱）给A</li><li>A用 ## CA的公钥 ## 校验B发来的 [[ B的公钥 ]]（检查记号）</li><li>用 [ B的公钥 ] 加密 “密钥E”（密钥放进保险箱关上门）</li><li>B用【B的私钥】解密 “密钥E”</li><li>A 用 “密钥E” 加密后传输数据</li><li>B 用 “密钥E” 解密数据</li></ol><p>&gt;_</p><p><img src="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Encrypt-Decrypt/8.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/TCP404/Picgo/blog/illustration-pic/Encrypt-Decrypt/8.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="总结"></p>]]></content>
      
      
      <categories>
          
          <category> RSA </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RSA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RSA加密原理</title>
      <link href="posts/35371"/>
      <url>posts/35371</url>
      
        <content type="html"><![CDATA[<p>数学是一种很奇妙的东西</p><span id="more"></span><p>质数：只能<strong>被1和自身整除</strong>的数</p><p>互质数：两个数的<strong>公约数只有1</strong>，这两个为互质数</p><p>欧拉函数：OL(n)=x，x：从0到n的范围内，和n互质的数 的 <strong>个数</strong>，也就是从0到n的范围内，和n的公约数只有1的数的个数</p><h1 id="RSA加密原理"><a href="#RSA加密原理" class="headerlink" title="RSA加密原理"></a>RSA加密原理</h1><blockquote><p>P：质数1    Q：质数2    N：最小公倍数    OL(N)=X  -&gt; X：小于N &amp; 和N互质 的数的<strong>个数</strong></p><p>E：公钥    D：私钥    M：明文    C：密文</p></blockquote><ol><li><p>找出P、Q</p><p> 比如：P = 3    Q=11</p></li><li><p>找公共模数（求最小公倍数）</p><p> N = P * Q = 3 * 11 = 33    N=33</p></li><li><p>欧拉函数</p><p> OL(N) = (P - 1)(Q - 1)</p><p> OL(33) = (3 - 1)(11 - 1) = 20</p></li><li><p>计算公钥E</p><p> 1 &lt; E &lt; OL(N)    =    1 &lt; (1,20) &lt; 20</p><blockquote><p>E的取值范围{3，5，7，11，13，17，19}</p><p>E必须是整数，E必须和**OL(N)**互质</p><p>假设E=3，3是整数，3和20互质</p></blockquote></li><li><p>计算私钥D</p><p> E * D % OL(N) = 1    =    3 * D % 20 = 1，得出D=7</p></li></ol><p>到这我们就计算出公钥和密钥了，现在我们开始用公钥加密，然后用私钥解密</p><h3 id="加密解密"><a href="#加密解密" class="headerlink" title="加密解密"></a>加密解密</h3><ol><li><p>公钥加密</p><p> 比如我们加密数字2：M=2</p><p> C = M<sup>E</sup> mod N; 即    密文 = 明文<sup>公钥</sup> % 最小公倍数</p><p> C = 2<sup>3</sup> % 33 = 8    C = 8 </p><blockquote><p>明文2经过RSA加密后变成密文8</p></blockquote></li><li><p>私钥解密</p><p> M = C<sup>d</sup> mod N; 即 明文 = 密文<sup>私钥</sup> % 最小公倍数</p><p> M = 8<sup>7</sup> % 33 = 2    M = 2</p><blockquote><p>密文8经过RSA解密后变成明文2</p></blockquote></li></ol>]]></content>
      
      
      <categories>
          
          <category> RSA </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RSA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="posts/16107"/>
      <url>posts/16107</url>
      
        <content type="html"><![CDATA[<p>Hello world !</p><span id="more"></span><p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>or</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo s</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>or</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo g</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>or</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo d</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      <categories>
          
          <category> HEXO </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HEXO </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
