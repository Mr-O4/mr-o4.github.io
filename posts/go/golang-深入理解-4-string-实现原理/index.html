<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Golang [深入理解] 4-string 实现原理 | Mr.Boii</title><meta name=keywords content="Golang,底层原理"><meta name=description content="关于你可能知道的 string"><meta name=author content="Boii"><link rel=canonical href=https://boii.xyz/posts/go/golang-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-4-string-%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/><link crossorigin=anonymous href=/assets/css/stylesheet.min.30c0c973d02d0622251a43d6856208a4b7655389233c0e74e71274fc9f3dc8dd.css integrity="sha256-MMDJc9AtBiIlGkPWhWIIpLdlU4kjPA505xJ0/J89yN0=" rel="preload stylesheet" as=style><link rel=icon href=https://boii.xyz/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://boii.xyz/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://boii.xyz/favicon-32x32.png><link rel=apple-touch-icon href=https://boii.xyz/apple-touch-icon.png><link rel=mask-icon href=https://boii.xyz/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=text/javascript async src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">MathJax.Hub.Config({tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["[[","]]"]],processEscapes:!0,processEnvironments:!0,skipTags:["script","noscript","style","textarea","pre"],TeX:{equationNumbers:{autoNumber:"AMS"},extensions:["AMSmath.js","AMSsymbols.js"]}}}),MathJax.Hub.Queue(function(){var e,t=MathJax.Hub.getAllJax();for(e=0;e<t.length;e+=1)t[e].SourceElement().parentNode.className+=" has-jax"})</script><style>code.has-jax{font:inherit;font-size:100%;background:inherit;border:inherit;color:#515151}</style><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,o,i,a,t,n,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Golang [深入理解] 4-string 实现原理"><meta property="og:description" content="关于你可能知道的 string"><meta property="og:type" content="article"><meta property="og:url" content="https://boii.xyz/posts/go/golang-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-4-string-%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/"><meta property="og:image" content="https://boii.xyz/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-09-14T15:08:20+00:00"><meta property="article:modified_time" content="2021-09-14T15:08:20+00:00"><meta property="og:site_name" content="Mr.Boii"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://boii.xyz/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Golang [深入理解] 4-string 实现原理"><meta name=twitter:description content="关于你可能知道的 string"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://boii.xyz/posts/"},{"@type":"ListItem","position":2,"name":"Golang [深入理解] 4-string 实现原理","item":"https://boii.xyz/posts/go/golang-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-4-string-%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Golang [深入理解] 4-string 实现原理","name":"Golang [深入理解] 4-string 实现原理","description":"关于你可能知道的 string\n","keywords":["Golang","底层原理"],"articleBody":"关于你可能知道的 string\nstring 实现原理 UTF-8 在计算机中，一切都是数字「0」和「1」，确切点说应该是「低电平」和「高电平」。\n从理论角度来说，「数」是客观存在的，是真理般的存在，而「进制」是主观存在的，是人类掌握「数」的一种工具。\n一个数，可以用二进制、八进制、十进制、十六进制、二十六进制、三十八进制等各种进制来表示。不同进制之间可以按照一定规则进行转换，0 和 1 两个数字，可以组成二进制的最基本单位，所以可以通过 101 表示十进制 5，110 表示十进制 6。\n于是，在计算机中，不管我们要表示任何数，只要转换成二进制，并替换成计算机中的高低电平，既可以在计算机中确切的表示一个数。\n但是人类世界不仅有数，还有文字。文字由一个一个字符组成，正如英文由字母组成，汉字由笔画组成。在计算机中无法直接表示文字，于是计算机先驱们想出了使用“编号约定”的办法，为每一个字符编一个数字编号，这样就使得文字和数字之间有了映射关系，进而可以在计算机中表示文字。\n最初的“编号约定”是 ASCII 码表，由于计算机发展于西方，西文的基本单位 26 个字母，大小写一共 52 个，加上一些符号、控制字符，组成了 ASCII 码表。\n基础 ASCII 码表只有 127 个字符，使用 7 个比特（7 位二进制数）即可表示，而在计算机中 8 个比特组成 1 个字节，所以基础 ASCII 码表也好，扩展 ASCII 码表也好，用 1 个字节足矣。\n但是人类语言不止英文一种，还有中文、俄文、日文等等，每种语言一个编码表又使得相互之间会导致码值冲突，混乱不堪。所以 Unicode 通用学术学会便制定了一个通用字符集 UTF，国内也称作“万国码”，由此促进了文字在每一台计算机上的兼容性，防止两台计算机采用不同的编码方式导致 A 计算机的文字到 B 计算机上变成乱码。\nUTF 采用的是变长编码（有兴趣的同学自行了解为什么不是定长编码 Golang string ），小编号的字符占少字节，大编号占多字节。每一个字符的编码中的每一个字节都有几个位来用作“前缀”，通过前缀识别出该字节属于哪一个区间。具体如下：\n   编号 编码模版     0~127 0xxx xxxx   128~2047 110x xxxx 10xx xxxx   2048~65535 1110 xxxx 10xx xxxx 10xx xxxx    例如，英文字符 c 的编号为 99，在 0 到 127 的区间，于是采用 0xxx xxxx 的模板，十进制 99 转为二进制为 1100011，替换到 xxx xxxx，最终编码结果为 0110 0011。\n再比如，中文字符 世 的编号为 19990，在 2048 到 65535 的区间，于是采用 1110 xxxx 10xx xxxx 10xx xxxx 的模板，十进制的 19990 转为二进制为 0100 1110 0001 0110 ，替换到模板中，最终编码结果为 1110 0100 1011 1000 1001 0110。\n再比如，当计算机看到 1110 0111 10 010101 10 001100 时，第一个字节的前缀 1110 使得计算机明白，这个字符一共占用 3 个字节，除了读取完当前这个字节，还要往后读取 2 个字节。于是从第一个字节中抽取 0111，第二和第三个字节剥离前缀 10 后得到 010101 和 001100，将这三部分拼接得到 0111 010101 001100，十进制为 30028，对应中文字符 界 字。\nstring 结构 说回 string 结构。在 C 语言中，字符串是一个字符数组指针，指向一个字符数组，这样便知道了字符串的开始，使用 \\0 表示字符串结束。这样的设计存在的问题是，字符串中无法表示 \\0 本身。\ngolang 在这个基础上进行了改进，没有采用 \\0 表示，而是增加了一个 len 字段用于记录字节数组 str 的长度，这样即可以在字符串中使用 \\0，而且求字符串长度时直接返回 len 的值即可，时间复杂度仅为 O(1)。\n在源码包中 src/runtime/stirng.go:stringStruct 对 字符串 定义如下：\n1 2 3 4  type stringStruct struct { str unsafe.Pointer\t// 指向字节数组的指针  len int\t// 字节数组的长度，即字节个数 }   要注意的是，len 表示的是 str 这个字节数组的长度，不是字符的长度。因为有的字符的长度为 2，有的为 3，有的为 1。例如一个中英混合的字符串 \"abc世界\"，它的 len 为 9，abc 占用 3 字节，世 占用 3 字节，界 占用 3 字节。\n复制问题 字符串的复制有 2 种方法：\n 直接赋值 = re-slice 语法  1 2 3 4  hello1 := \"hello\" hello2 := hello1\t// hello hello3 := hello1[1:4]\t// ell   采用这两种方法时，两个字符串共享同一个底层字节数组，也就是说，是一种浅复制。\n因为 Golang 中字符串一旦定义就不可更改，对字符串中字符的修改较为麻烦，且修改完后会返回一个新的修改好的字节数组，已经不是一开始那个字节数组了，所以可以放心的使用浅复制。\n类型转换问题 一个字符串的值可以显式地转换成一个字节切片 []byte，反过来也可以。字节 byte 是 uint8 的别名，所以 []byte 等于 []uint8。\n一个字符串的值可以显式地转换成一个码点切片 []rune，反过来也可以。码点 rune 是 uint32 的别名，所以 []rune 等于 []uint32。\n所以转换问题的主角就是 string、[]byte、[]rune 三者。\n[]rune - string 在一个从码点切片 []rune 到字符串 string 的转换中，码点切片中的每个码点值 rune 将被 UTF-8 编码为一到四个字节至结果字符串中。\n如果一个码点值是一个不合法的Unicode码点值，则它将被视为「Unicode替换字符值（Unicode replacement character）0xFFFD」。\n替换字符值0xFFFD将被 UTF-8 编码为三个字节0xef 0xbf 0xbd。\nstring - []rune 当一个字符串 string 被转换为一个码点切片 []rune 时，此字符串中存储的字节序列将被解读为一个一个码点的 UTF-8 编码序列。\n非法的UTF-8编码字节序列将被转化为Unicode替换字符值0xFFFD。\nstring - []byte 当一个字符串 string 被转换为一个字节切片 []byte 时，结果切片中的底层字节序列是此字符串中存储的字节序列的一份深复制。\n即Go运行时将为结果切片开辟一块足够大的内存来容纳被复制过来的所有字节。当此字符串的长度较长时，此转换开销是比较大的。\n[]byte - string 当一个字节切片 []byte 被转换为一个字符串 string 时，此字节切片中的字节序列也将被深复制到结果字符串中。 当此字节切片的长度较长时，此转换开销同样是比较大的。\n在这两种转换（string - []byte、[]byte - string）中，必须使用深复制的原因是：\n []byte 字节切片中的字节元素是可修改的，但是字符串中的字节是不可修改的；\n所以一个 []byte 和一个字符串 string 是不能共享底层字节序列的。\n 请注意，在字符串和字节切片之间的转换中，\n 非法的UTF-8编码字节序列将被保持原样不变。 标准编译器做了一些优化，从而使得这些转换在某些情形下将不用深复制。 这样的情形将在下一节中介绍。  []byte  []rune Go并不支持字节切片和码点切片之间的直接转换。我们可以用下面列出的方法来实现这样的转换：\n 利用字符串做为中间过渡。这种方法相对方便但效率较低，因为需要做两次深复制。 使用unicode/utf8标准库包中的函数来实现这些转换。 这种方法效率较高，但使用起来不太方便。 使用bytes标准库包中的Runes函数来将一个字节切片转换为码点切片（[]byte - []rune：bytes.Runes()）。 但此包中没有将码点切片转换为字节切片的函数。  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29  package main import ( \"bytes\" \"unicode/utf8\" ) func main() { s := \"颜色感染是一个有趣的游戏。\" bs := []byte(s) // string - []byte \ts = string(bs) // []byte - string \trs := []rune(s) // string - []rune \ts = string(rs) // []rune - string  rs = bytes.Runes(bs) // []byte - []rune \tbs = Runes2Bytes(rs) // []rune - []byte } func Runes2Bytes(rs []rune) []byte { n := 0 for _, r := range rs { n += utf8.RuneLen(r) } n, bs := 0, make([]byte, n) for _, r := range rs { n += utf8.EncodeRune(bs[n:], r) } return bs }   本小节摘自 《Go 101》字符串相关的类型转换\n比较问题 字符串类型都是可比较类型，因为底层是字节数组，和字符 byte、rune 一样，他们背后的基础类型是 uint8 和 uint32 。\n所以两个字符串 string 或 两个字符 byte、rune 之间可以使用等于、不等、大于、大于等于、小于、小于等于的比较：string == string、string != string、string  string、rune = rune、byte 、byte 。\n1 2 3 4 5 6 7 8 9  hello := \"hello\" world := \"world\" fmt.Println(hello == world)\t// false fmt.Println(hello != world)\t// true fmt.Println(hello  world)\t// false fmt.Println(hello = world)\t// false fmt.Println(hello  world)\t// true fmt.Println(hello  world)\t// true   当比较两个字符串值的时候，它们的底层字节将逐一进行比较。\n如果一个字符串 a 是另一个字符串 b 的前缀，并且另一个字符串 b 较长; 则另一个字符串 b 为两者中的较大者。\n1 2 3 4 5 6 7 8  hello := \"hello\" world := \"world\" helloworld := hello + world fmt.Println(hello  helloworld)\t// false fmt.Println(hello = helloworld) // false fmt.Println(hello  helloworld)\t// true fmt.Println(hello  helloworld) // true   字符串相等比较 对于两个字符串相等或不等的比较，Go编译器会先比较他们的 len 字段：\n 如果两个 len 的值不相等，则两个字符串肯定不相等； 如果两个 len 的值相等，则比较两个字符串底层的字节数组指针 str 是否相等，也就是看看是不是引用了同一个底层字节数组。如果是则相等，如果不是则逐个比较每一个字节。 ","wordCount":"600","inLanguage":"en","datePublished":"2021-09-14T15:08:20Z","dateModified":"2021-09-14T15:08:20Z","author":{"@type":"Person","name":"Boii"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://boii.xyz/posts/go/golang-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-4-string-%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/"},"publisher":{"@type":"Organization","name":"Mr.Boii","logo":{"@type":"ImageObject","url":"https://boii.xyz/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://boii.xyz/ accesskey=h title="Boii (Alt + H)"><img src=https://boii.xyz/apple-touch-icon.png alt=logo aria-label=logo height=35>Boii</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://boii.xyz/archives title=Archive><span>Archive</span></a></li><li><a href=https://boii.xyz/categories/ title=categories><span>categories</span></a></li><li><a href=https://boii.xyz/tags/ title=tags><span>tags</span></a></li><li><a href=https://boii.xyz/me title=me><span>me</span></a></li><li><a href=https://boii.xyz/search/ title="🔍 (Alt + /)" accesskey=/><span><i class="fa-solid fa-magnifying-glass"></i>🔍</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://boii.xyz/>Home</a>&nbsp;»&nbsp;<a href=https://boii.xyz/posts/>Posts</a></div><h1 class=post-title>Golang [深入理解] 4-string 实现原理</h1><div class=post-meta><span title="2021-09-14 15:08:20 +0000 UTC">September 14, 2021</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Boii</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#string-%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86 aria-label="string 实现原理">string 实现原理</a><ul><li><a href=#utf-8 aria-label=UTF-8>UTF-8</a></li><li><a href=#string-%e7%bb%93%e6%9e%84 aria-label="string 结构">string 结构</a></li><li><a href=#%e5%a4%8d%e5%88%b6%e9%97%ae%e9%a2%98 aria-label=复制问题>复制问题</a></li><li><a href=#%e7%b1%bb%e5%9e%8b%e8%bd%ac%e6%8d%a2%e9%97%ae%e9%a2%98 aria-label=类型转换问题>类型转换问题</a><ul><li><a href=#rune---string aria-label="[]rune -&amp;gt; string"><code>[]rune -> string</code></a></li><li><a href=#string---rune aria-label="string -&amp;gt; []rune"><code>string -> []rune</code></a></li><li><a href=#string---byte aria-label="string -&amp;gt; []byte"><code>string -> []byte</code></a></li><li><a href=#byte---string aria-label="[]byte -&amp;gt; string"><code>[]byte -> string</code></a></li><li><a href=#byte----rune aria-label="[]byte &amp;lt;-!-&amp;gt; []rune"><code>[]byte &lt;-!-> []rune</code></a></li></ul></li><li><a href=#%e6%af%94%e8%be%83%e9%97%ae%e9%a2%98 aria-label=比较问题>比较问题</a><ul><li><a href=#%e5%ad%97%e7%ac%a6%e4%b8%b2%e7%9b%b8%e7%ad%89%e6%af%94%e8%be%83 aria-label=字符串相等比较>字符串相等比较</a></li></ul></li></ul></li></ul></div></details></div><div class=post-content><p>关于你可能知道的 string</p><h1 id=string-实现原理>string 实现原理<a hidden class=anchor aria-hidden=true href=#string-实现原理>#</a></h1><h2 id=utf-8>UTF-8<a hidden class=anchor aria-hidden=true href=#utf-8>#</a></h2><p>在计算机中，一切都是数字「0」和「1」，确切点说应该是「低电平」和「高电平」。</p><p>从理论角度来说，「数」是客观存在的，是真理般的存在，而「进制」是主观存在的，是人类掌握「数」的一种工具。</p><p>一个数，可以用二进制、八进制、十进制、十六进制、二十六进制、三十八进制等各种进制来表示。不同进制之间可以按照一定规则进行转换，0 和 1 两个数字，可以组成二进制的最基本单位，所以可以通过 101 表示十进制 5，110 表示十进制 6。</p><p>于是，在计算机中，不管我们要表示任何数，只要转换成二进制，并替换成计算机中的高低电平，既可以在计算机中确切的表示一个数。</p><p>但是人类世界不仅有数，还有文字。文字由一个一个字符组成，正如英文由字母组成，汉字由笔画组成。在计算机中无法直接表示文字，于是计算机先驱们想出了使用“编号约定”的办法，为每一个字符编一个数字编号，这样就使得文字和数字之间有了映射关系，进而可以在计算机中表示文字。</p><p>最初的“编号约定”是 ASCII 码表，由于计算机发展于西方，西文的基本单位 26 个字母，大小写一共 52 个，加上一些符号、控制字符，组成了 ASCII 码表。</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/TCP404/Picgo//blog/illustration-pic/Go/IMG/20210905115324.png alt></p><p>基础 ASCII 码表只有 127 个字符，使用 7 个比特（7 位二进制数）即可表示，而在计算机中 8 个比特组成 1 个字节，所以基础 ASCII 码表也好，扩展 ASCII 码表也好，用 1 个字节足矣。</p><p>但是人类语言不止英文一种，还有中文、俄文、日文等等，每种语言一个编码表又使得相互之间会导致码值冲突，混乱不堪。所以 Unicode 通用学术学会便制定了一个通用字符集 UTF，国内也称作“万国码”，由此促进了文字在每一台计算机上的兼容性，防止两台计算机采用不同的编码方式导致 A 计算机的文字到 B 计算机上变成乱码。</p><p>UTF 采用的是变长编码（有兴趣的同学自行了解为什么不是定长编码 <a href=https://www.bilibili.com/video/BV1hv411x7we>Golang string</a> ），小编号的字符占少字节，大编号占多字节。每一个字符的编码中的每一个字节都有几个位来用作“前缀”，通过前缀识别出该字节属于哪一个区间。具体如下：</p><table><thead><tr><th>编号</th><th>编码模版</th></tr></thead><tbody><tr><td>0~127</td><td>0xxx xxxx</td></tr><tr><td>128~2047</td><td>110x xxxx 10xx xxxx</td></tr><tr><td>2048~65535</td><td>1110 xxxx 10xx xxxx 10xx xxxx</td></tr></tbody></table><p>例如，英文字符 <code>c</code> 的编号为 99，在 0 到 127 的区间，于是采用 <code>0xxx xxxx</code> 的模板，十进制 99 转为二进制为 <code>1100011</code>，替换到 <code>xxx xxxx</code>，最终编码结果为 <code>0110 0011</code>。</p><p>再比如，中文字符 <code>世</code> 的编号为 19990，在 2048 到 65535 的区间，于是采用 <code>1110 xxxx 10xx xxxx 10xx xxxx</code> 的模板，十进制的 19990 转为二进制为 <code>0100 1110 0001 0110</code> ，替换到模板中，最终编码结果为 <code>1110 0100 1011 1000 1001 0110</code>。</p><p>再比如，当计算机看到 <code>1110 0111 10 010101 10 001100</code> 时，第一个字节的前缀 <code>1110</code> 使得计算机明白，这个字符一共占用 3 个字节，除了读取完当前这个字节，还要往后读取 2 个字节。于是从第一个字节中抽取 <code>0111</code>，第二和第三个字节剥离前缀 <code>10</code> 后得到 <code>010101</code> 和 <code>001100</code>，将这三部分拼接得到 <code>0111 010101 001100</code>，十进制为 30028，对应中文字符 <code>界</code> 字。</p><h2 id=string-结构>string 结构<a hidden class=anchor aria-hidden=true href=#string-结构>#</a></h2><p>说回 string 结构。在 C 语言中，字符串是一个字符数组指针，指向一个字符数组，这样便知道了字符串的开始，使用 <code>\0</code> 表示字符串结束。这样的设计存在的问题是，字符串中无法表示 <code>\0</code> 本身。</p><p>golang 在这个基础上进行了改进，没有采用 <code>\0</code> 表示，而是增加了一个 <code>len</code> 字段用于记录字节数组 <code>str</code> 的长度，这样即可以在字符串中使用 <code>\0</code>，而且求字符串长度时直接返回 <code>len</code> 的值即可，时间复杂度仅为 <code>O(1)</code>。</p><p>在源码包中 <code>src/runtime/stirng.go:stringStruct</code> 对 字符串 定义如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl> <span class=kd>type</span> <span class=nx>stringStruct</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>str</span> <span class=nx>unsafe</span><span class=p>.</span><span class=nx>Pointer</span>	<span class=c1>// 指向字节数组的指针
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>len</span> <span class=kt>int</span>				<span class=c1>// 字节数组的长度，即字节个数
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>要注意的是，<code>len</code> 表示的是 <code>str</code> 这个字节数组的长度，不是字符的长度。因为有的字符的长度为 2，有的为 3，有的为 1。例如一个中英混合的字符串 <code>"abc世界"</code>，它的 len 为 9，<code>abc</code> 占用 3 字节，<code>世</code> 占用 3 字节，<code>界</code> 占用 3 字节。</p><h2 id=复制问题>复制问题<a hidden class=anchor aria-hidden=true href=#复制问题>#</a></h2><p>字符串的复制有 2 种方法：</p><ul><li>直接赋值 <code>=</code></li><li><code>re-slice</code> 语法</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>hello1</span> <span class=o>:=</span> <span class=s>&#34;hello&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>hello2</span> <span class=o>:=</span> <span class=nx>hello1</span>		<span class=c1>// hello
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>hello3</span> <span class=o>:=</span> <span class=nx>hello1</span><span class=p>[</span><span class=mi>1</span><span class=p>:</span><span class=mi>4</span><span class=p>]</span>	<span class=c1>// ell
</span></span></span></code></pre></td></tr></table></div></div><p>采用这两种方法时，两个字符串共享同一个底层字节数组，也就是说，是一种浅复制。</p><p>因为 Golang 中字符串一旦定义就不可更改，对字符串中字符的修改较为麻烦，且修改完后会返回一个新的修改好的字节数组，已经不是一开始那个字节数组了，所以可以放心的使用浅复制。</p><h2 id=类型转换问题>类型转换问题<a hidden class=anchor aria-hidden=true href=#类型转换问题>#</a></h2><p>一个字符串的值可以显式地转换成一个字节切片 <code>[]byte</code>，反过来也可以。字节 <code>byte</code> 是 <code>uint8</code> 的别名，所以 <code>[]byte</code> 等于 <code>[]uint8</code>。</p><p>一个字符串的值可以显式地转换成一个码点切片 <code>[]rune</code>，反过来也可以。码点 <code>rune</code> 是 <code>uint32</code> 的别名，所以 <code>[]rune</code> 等于 <code>[]uint32</code>。</p><p>所以转换问题的主角就是 <code>string</code>、<code>[]byte</code>、<code>[]rune</code> 三者。</p><h3 id=rune---string><code>[]rune -> string</code><a hidden class=anchor aria-hidden=true href=#rune---string>#</a></h3><p>在一个从码点切片 <code>[]rune</code> 到字符串 <code>string</code> 的转换中，码点切片中的每个码点值 <code>rune</code> 将被 UTF-8 编码为一到四个字节至结果字符串中。</p><p>如果一个码点值是一个不合法的Unicode码点值，则它将被视为「Unicode替换字符值（Unicode replacement character）<code>0xFFFD</code>」。</p><p>替换字符值<code>0xFFFD</code>将被 UTF-8 编码为三个字节<code>0xef 0xbf 0xbd</code>。</p><h3 id=string---rune><code>string -> []rune</code><a hidden class=anchor aria-hidden=true href=#string---rune>#</a></h3><p>当一个字符串 <code>string</code> 被转换为一个码点切片 <code>[]rune</code> 时，此字符串中存储的字节序列将被解读为一个一个码点的 UTF-8 编码序列。</p><p>非法的UTF-8编码字节序列将被转化为Unicode替换字符值<code>0xFFFD</code>。</p><h3 id=string---byte><code>string -> []byte</code><a hidden class=anchor aria-hidden=true href=#string---byte>#</a></h3><p>当一个字符串 <code>string</code> 被转换为一个字节切片 <code>[]byte</code> 时，结果切片中的底层字节序列是此字符串中存储的字节序列的一份<strong>深复制</strong>。</p><p>即Go运行时将为结果切片开辟一块足够大的内存来容纳被复制过来的所有字节。当此字符串的长度较长时，此转换开销是比较大的。</p><h3 id=byte---string><code>[]byte -> string</code><a hidden class=anchor aria-hidden=true href=#byte---string>#</a></h3><p>当一个字节切片 <code>[]byte</code> 被转换为一个字符串 <code>string</code> 时，此字节切片中的字节序列也将被<strong>深复制</strong>到结果字符串中。 当此字节切片的长度较长时，此转换开销同样是比较大的。</p><p>在这两种转换（<code>string -> []byte</code>、<code>[]byte -> string</code>）中，必须使用深复制的原因是：</p><blockquote><p><code>[]byte</code> 字节切片中的字节元素是可修改的，但是字符串中的字节是不可修改的；</p><p>所以一个 <code>[]byte</code> 和一个字符串 <code>string</code> 是不能共享底层字节序列的。</p></blockquote><p>请注意，在字符串和字节切片之间的转换中，</p><ul><li>非法的UTF-8编码字节序列将被保持原样不变。</li><li>标准编译器做了一些优化，从而使得这些转换在某些情形下将不用深复制。 这样的情形将在下一节中介绍。</li></ul><h3 id=byte----rune><code>[]byte &lt;-!-> []rune</code><a hidden class=anchor aria-hidden=true href=#byte----rune>#</a></h3><p>Go并不支持字节切片和码点切片之间的直接转换。我们可以用下面列出的方法来实现这样的转换：</p><ul><li>利用字符串做为中间过渡。这种方法相对方便但效率较低，因为需要做两次深复制。</li><li>使用<a href=https://golang.google.cn/pkg/unicode/utf8/>unicode/utf8</a>标准库包中的函数来实现这些转换。 这种方法效率较高，但使用起来不太方便。</li><li>使用<a href=https://golang.google.cn/pkg/bytes/#Runes><code>bytes</code>标准库包中的<code>Runes</code>函数</a>来将一个字节切片转换为码点切片（<code>[]byte -> []rune</code>：<code>bytes.Runes()</code>）。 但此包中没有将码点切片转换为字节切片的函数。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;bytes&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;unicode/utf8&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>s</span> <span class=o>:=</span> <span class=s>&#34;颜色感染是一个有趣的游戏。&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>bs</span> <span class=o>:=</span> <span class=p>[]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>s</span><span class=p>)</span> <span class=c1>// string -&gt; []byte
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>s</span> <span class=p>=</span> <span class=nb>string</span><span class=p>(</span><span class=nx>bs</span><span class=p>)</span>  <span class=c1>// []byte -&gt; string
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>rs</span> <span class=o>:=</span> <span class=p>[]</span><span class=nb>rune</span><span class=p>(</span><span class=nx>s</span><span class=p>)</span> <span class=c1>// string -&gt; []rune
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>s</span> <span class=p>=</span> <span class=nb>string</span><span class=p>(</span><span class=nx>rs</span><span class=p>)</span>  <span class=c1>// []rune -&gt; string
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>	<span class=nx>rs</span> <span class=p>=</span> <span class=nx>bytes</span><span class=p>.</span><span class=nf>Runes</span><span class=p>(</span><span class=nx>bs</span><span class=p>)</span> <span class=c1>// []byte -&gt; []rune
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>bs</span> <span class=p>=</span> <span class=nf>Runes2Bytes</span><span class=p>(</span><span class=nx>rs</span><span class=p>)</span> <span class=c1>// []rune -&gt; []byte
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>Runes2Bytes</span><span class=p>(</span><span class=nx>rs</span> <span class=p>[]</span><span class=kt>rune</span><span class=p>)</span> <span class=p>[]</span><span class=kt>byte</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>n</span> <span class=o>:=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>r</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>rs</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>n</span> <span class=o>+=</span> <span class=nx>utf8</span><span class=p>.</span><span class=nf>RuneLen</span><span class=p>(</span><span class=nx>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>n</span><span class=p>,</span> <span class=nx>bs</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>,</span> <span class=nb>make</span><span class=p>([]</span><span class=kt>byte</span><span class=p>,</span> <span class=nx>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>r</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>rs</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>n</span> <span class=o>+=</span> <span class=nx>utf8</span><span class=p>.</span><span class=nf>EncodeRune</span><span class=p>(</span><span class=nx>bs</span><span class=p>[</span><span class=nx>n</span><span class=p>:],</span> <span class=nx>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>bs</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>本小节摘自 <a href=https://gfw.go101.org/article/string.html>《Go 101》字符串相关的类型转换</a></p><h2 id=比较问题>比较问题<a hidden class=anchor aria-hidden=true href=#比较问题>#</a></h2><p>字符串类型都是可比较类型，因为底层是字节数组，和字符 <code>byte</code>、<code>rune</code> 一样，他们背后的基础类型是 <code>uint8</code> 和 <code>uint32</code> 。</p><p>所以两个字符串 <code>string</code> 或 两个字符 <code>byte、rune</code> 之间可以使用等于、不等、大于、大于等于、小于、小于等于的比较：<code>string == string</code>、<code>string != string</code>、<code>string > string</code>、<code>rune >= rune</code>、<code>byte &lt; byte</code>、<code>byte &lt;= byte</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>hello</span> <span class=o>:=</span> <span class=s>&#34;hello&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>world</span> <span class=o>:=</span> <span class=s>&#34;world&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>hello</span> <span class=o>==</span> <span class=nx>world</span><span class=p>)</span>	<span class=c1>// false
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>hello</span> <span class=o>!=</span> <span class=nx>world</span><span class=p>)</span>	<span class=c1>// true
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>hello</span> <span class=p>&gt;</span> <span class=nx>world</span><span class=p>)</span>	<span class=c1>// false
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>hello</span> <span class=o>&gt;=</span> <span class=nx>world</span><span class=p>)</span>	<span class=c1>// false
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>hello</span> <span class=p>&lt;</span> <span class=nx>world</span><span class=p>)</span>	<span class=c1>// true
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>hello</span> <span class=o>&lt;=</span> <span class=nx>world</span><span class=p>)</span>	<span class=c1>// true
</span></span></span></code></pre></td></tr></table></div></div><p>当比较两个字符串值的时候，它们的底层字节将逐一进行比较。</p><p>如果一个字符串 a 是另一个字符串 b 的前缀，并且另一个字符串 b 较长;
则另一个字符串 b 为两者中的较大者。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>hello</span> <span class=o>:=</span> <span class=s>&#34;hello&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>world</span> <span class=o>:=</span> <span class=s>&#34;world&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>helloworld</span> <span class=o>:=</span> <span class=nx>hello</span> <span class=o>+</span> <span class=nx>world</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>hello</span> <span class=p>&gt;</span> <span class=nx>helloworld</span><span class=p>)</span>	 <span class=c1>// false
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>hello</span> <span class=o>&gt;=</span> <span class=nx>helloworld</span><span class=p>)</span> <span class=c1>// false
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>hello</span> <span class=p>&lt;</span> <span class=nx>helloworld</span><span class=p>)</span>	 <span class=c1>// true
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>hello</span> <span class=o>&lt;=</span> <span class=nx>helloworld</span><span class=p>)</span> <span class=c1>// true
</span></span></span></code></pre></td></tr></table></div></div><h3 id=字符串相等比较>字符串相等比较<a hidden class=anchor aria-hidden=true href=#字符串相等比较>#</a></h3><p>对于两个字符串相等或不等的比较，Go编译器会先比较他们的 <code>len</code> 字段：</p><ul><li>如果两个 <code>len</code> 的值不相等，则两个字符串肯定不相等；</li><li>如果两个 <code>len</code> 的值相等，则比较两个字符串底层的字节数组指针 <code>str</code> 是否相等，也就是看看是不是引用了同一个底层字节数组。如果是则相等，如果不是则逐个比较每一个字节。</li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://boii.xyz/tags/golang/>Golang</a></li><li><a href=https://boii.xyz/tags/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/>底层原理</a></li></ul><nav class=paginav><a class=prev href=https://boii.xyz/posts/go/golang-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-7-%E5%85%B3%E4%BA%8E-nil/><span class=title>« Prev Page</span><br><span>Golang [深入理解] 7-关于 nil</span></a>
<a class=next href=https://boii.xyz/posts/go/golang-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-2-slice-%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/><span class=title>Next Page »</span><br><span>Golang [深入理解] 2-slice 实现原理</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Golang [深入理解] 4-string 实现原理 on twitter" href="https://twitter.com/intent/tweet/?text=Golang%20%5b%e6%b7%b1%e5%85%a5%e7%90%86%e8%a7%a3%5d%204-string%20%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86&url=https%3a%2f%2fboii.xyz%2fposts%2fgo%2fgolang-%25E6%25B7%25B1%25E5%2585%25A5%25E7%2590%2586%25E8%25A7%25A3-4-string-%25E5%25AE%259E%25E7%258E%25B0%25E5%258E%259F%25E7%2590%2586%2f&hashtags=Golang%2c%e5%ba%95%e5%b1%82%e5%8e%9f%e7%90%86"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Golang [深入理解] 4-string 实现原理 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fboii.xyz%2fposts%2fgo%2fgolang-%25E6%25B7%25B1%25E5%2585%25A5%25E7%2590%2586%25E8%25A7%25A3-4-string-%25E5%25AE%259E%25E7%258E%25B0%25E5%258E%259F%25E7%2590%2586%2f&title=Golang%20%5b%e6%b7%b1%e5%85%a5%e7%90%86%e8%a7%a3%5d%204-string%20%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86&summary=Golang%20%5b%e6%b7%b1%e5%85%a5%e7%90%86%e8%a7%a3%5d%204-string%20%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86&source=https%3a%2f%2fboii.xyz%2fposts%2fgo%2fgolang-%25E6%25B7%25B1%25E5%2585%25A5%25E7%2590%2586%25E8%25A7%25A3-4-string-%25E5%25AE%259E%25E7%258E%25B0%25E5%258E%259F%25E7%2590%2586%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Golang [深入理解] 4-string 实现原理 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fboii.xyz%2fposts%2fgo%2fgolang-%25E6%25B7%25B1%25E5%2585%25A5%25E7%2590%2586%25E8%25A7%25A3-4-string-%25E5%25AE%259E%25E7%258E%25B0%25E5%258E%259F%25E7%2590%2586%2f&title=Golang%20%5b%e6%b7%b1%e5%85%a5%e7%90%86%e8%a7%a3%5d%204-string%20%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Golang [深入理解] 4-string 实现原理 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fboii.xyz%2fposts%2fgo%2fgolang-%25E6%25B7%25B1%25E5%2585%25A5%25E7%2590%2586%25E8%25A7%25A3-4-string-%25E5%25AE%259E%25E7%258E%25B0%25E5%258E%259F%25E7%2590%2586%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Golang [深入理解] 4-string 实现原理 on whatsapp" href="https://api.whatsapp.com/send?text=Golang%20%5b%e6%b7%b1%e5%85%a5%e7%90%86%e8%a7%a3%5d%204-string%20%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86%20-%20https%3a%2f%2fboii.xyz%2fposts%2fgo%2fgolang-%25E6%25B7%25B1%25E5%2585%25A5%25E7%2590%2586%25E8%25A7%25A3-4-string-%25E5%25AE%259E%25E7%258E%25B0%25E5%258E%259F%25E7%2590%2586%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Golang [深入理解] 4-string 实现原理 on telegram" href="https://telegram.me/share/url?text=Golang%20%5b%e6%b7%b1%e5%85%a5%e7%90%86%e8%a7%a3%5d%204-string%20%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86&url=https%3a%2f%2fboii.xyz%2fposts%2fgo%2fgolang-%25E6%25B7%25B1%25E5%2585%25A5%25E7%2590%2586%25E8%25A7%25A3-4-string-%25E5%25AE%259E%25E7%258E%25B0%25E5%258E%259F%25E7%2590%2586%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://boii.xyz/>Mr.Boii</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement("button");e.classList.add("copy-code"),e.innerText="copy";function s(){e.innerText="copied!",setTimeout(()=>{e.innerText="copy"},2e3)}e.addEventListener("click",o=>{if("clipboard"in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy"),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>